{"title":"Oct International Break 2526","markdown":{"yaml":{"title":"Oct International Break 2526","author":"Dr Phil Barter","format":{"dashboard":{"scrolling":true,"logo":"https://anfieldindex.com/wp-content/uploads/2016/09/AI-Under-Pressure.png","nav-buttons":[{"icon":"github","href":"https://github.com/Barts78"},{"icon":"linkedin","href":"https://www.linkedin.com/in/phil-barter-55500122/"},{"icon":"twitter","href":"https://twitter.com/Barts78"}],"theme":["Lux","Matchdash.scss"],"type":"default"}}},"headingText":"Reusable function to compute team summary metrics","containsRefs":false,"markdown":"\n\n```{r}\n#' Simulate Football Match Outcomes Based on xG\n#'\n#' @param home_xg_vector Numeric vector of xG values for each home team shot\n#' @param away_xg_vector Numeric vector of xG values for each away team shot\n#' @param runs Number of simulations to perform (default: 10000)\n#' @param seed Random seed for reproducibility (default: 1111)\n#'\n#' @return A list containing:\n#' - `prob_matrix`: A matrix of scoreline probabilities\n#' - `long_prob_matrix`: Data frame for plotting with ggplot\n#' - `simulation_results`: Data frame of simulated outcomes\n\n\nsimulate_match_outcomes <- function(\n  home_xg_vector, \n  away_xg_vector, \n  runs = 10000, \n  seed = 1111,\n  actual_home_goals = NULL,\n  actual_away_goals = NULL\n) {\n  set.seed(seed)\n\n  safe_simulate_goals <- function(xg_vector, runs) {\n    # Flatten in case it's a list (like from dplyr::select)\n    xg_vector <- unlist(xg_vector)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    # Clean and clip to [0, 1]\n    xg_vector <- as.numeric(xg_vector)\n    xg_vector <- xg_vector[!is.na(xg_vector)]\n    xg_vector <- pmin(pmax(xg_vector, 0), 1)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    draws <- rbinom(length(xg_vector) * runs, size = 1, prob = rep(xg_vector, each = runs))\n    goals_matrix <- matrix(draws, nrow = runs, byrow = FALSE)\n    rowSums(goals_matrix)\n  }\n\n  home_goals <- safe_simulate_goals(home_xg_vector, runs)\n  away_goals <- safe_simulate_goals(away_xg_vector, runs)\n\n  simulation_results <- data.frame(Home = home_goals, Away = away_goals)\n  prob_matrix <- table(simulation_results$Home, simulation_results$Away) / runs\n\n  long_prob_matrix <- as.data.frame(as.table(prob_matrix))\n  colnames(long_prob_matrix) <- c(\"Home\", \"Away\", \"Probability\")\n  long_prob_matrix <- long_prob_matrix %>%\n    mutate(Probability = round(Probability * 100, 2))\n\n  goal_summary <- NULL\n  if (!is.null(actual_home_goals) && !is.null(actual_away_goals)) {\n    exact_count <- sum(home_goals == actual_home_goals & away_goals == actual_away_goals)\n    at_least_home <- sum(home_goals >= actual_home_goals)\n    at_least_away <- sum(away_goals >= actual_away_goals)\n\n    goal_summary <- list(\n      actual_score = paste(actual_home_goals, \"-\", actual_away_goals),\n      exact_occurrences = exact_count,\n      exact_percentage = round(100 * exact_count / runs, 2),\n      home_goals_at_least = at_least_home,\n      away_goals_at_least = at_least_away,\n      home_goals_at_least_pct = round(100 * at_least_home / runs, 2),\n      away_goals_at_least_pct = round(100 * at_least_away / runs, 2)\n    )\n  }\n\n  return(list(\n    prob_matrix = prob_matrix,\n    long_prob_matrix = long_prob_matrix,\n    simulation_results = simulation_results,\n    goal_summary = goal_summary\n  ))\n}\n\n\n```\n\n\n\n\n```{r}\n\ncompute_summary <- function(data, group_vars) {\n  data %>%\n    mutate(Successful_Touch = ifelse(isTouch == \"TRUE\", 1, 0),\n           TeamEPV = ifelse(str_detect(`outcomeType/value`, \"1\"), EPVvalue, 0),\n           TeamEPV = as.numeric(TeamEPV)) %>%\n    group_by(across(all_of(group_vars))) %>%\n    summarise(Match_day = first(Match_day), \n              across(c(Goals, \n                       In_play_time, \n                       Touches, \n                       UnSuccessful_Touches, \n                       PK_Box_Touches,\n                       Final_Third_Touches, \n                       Attacking_Half_Touches, \n                       Defensive_Half_Touches,\n                       Mis_Control, \n                       Dispossessed_Total, \n                       Dribbles_Total, \n                       Dribbles_Won, \n                       Dribbles_Lost,\n                       TotalShots, \n                       OFShots, \n                       Blocked_Shot, \n                       OTShots, \n                       SixYard_Box_Shots,\n                       PK_Box_Shots, \n                       Out_Box_Shots, \n                       BCs, \n                       xG, \n                       NPxG, \n                       xGOT, \n                       Attempted_Passes,\n                       Successful_Passes, \n                       UnSuccessful_Passes, \n                       Long_Passes, \n                       Successful_Long_Passes,\n                       Corners, \n                       Short_Corners, \n                       Cross_Passes, \n                       Successful_Cross, \n                       UnSuccessful_Cross,\n                       Tackles_Total, \n                       Tackles_Won, \n                       Tackles_Lost, \n                       Fouls_Total, \n                       Fouls_Conceeded,\n                       Fouls_Received, \n                       Aerial_Won, \n                       Aerial_Lost, \n                       Interceptions_Total,\n                       Recoverys_Total, \n                       Offside_Won, \n                       Offside_Lost, \n                       TeamEPV, \n                       Defensive_Third_Touches,\n                       Middle_Third_Touches, \n                      SixYard_Box_Touches, \n                      Attempted_Carries, \n                      Successful_Carries, \n                      Prog_Carries, \n                      Final_Third_Carries,\n                      Final_Third_Passes, \n                      PK_Box_Passes,\n                      Prog_Passes,\n                      Key_Passes,\n                      Assists,\n                      MyxA,\n                      TeamxT,\n                      Aerial_total, \n                      Ground_Duels_Total, \n                      Ground_Duels_Won, \n                      Ground_Duels_Lost,\n        ),\n                 sum, na.rm = TRUE)) %>%\n    mutate(In_play_time = round(In_play_time / 60, 1),\n           Possession = round((Touches/(sum(Touches)))*100,1),\n           Field_Tilt = round((Final_Third_Touches/(sum(Final_Third_Touches)))*100,1),\n           Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n           Long_Pass_Success = round((Successful_Long_Passes / Long_Passes) * 100, 1),\n           Long_Pass_Rate = round((Long_Passes / Attempted_Passes) * 100, 2),\n           Cross_Success = round((Successful_Cross / Cross_Passes) * 100, 2),\n           Failed_Pass = Attempted_Passes - Successful_Passes,\n           Failed_Cross = Cross_Passes - Successful_Cross,\n           Failed_Dribble = Dribbles_Total - Dribbles_Won,\n           Poss_Gained = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost),\n           Poss_Lost = Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble + OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost,\n           Posession_Control = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) +\n                               (Aerial_Won - Aerial_Lost) -\n                               (Mis_Control + Dispossessed_Total + UnSuccessful_Passes +\n                               UnSuccessful_Cross + Dribbles_Lost + OFShots + Blocked_Shot + Offside_Lost),\n           `EPV % xG Con.` = round((xG / TeamEPV) * 100, 1),\n           `EPV % NPxG Con.` = round((NPxG / TeamEPV) * 100, 1),\n           ) %>%\n    \n    mutate(across(everything(), ~replace_na(.x, 0))) \n  \n}\n\n```\n\n\n``` {r}\n#| label: Dashboard Setup\n#| echo: false\n#| output: false\n#| warning: false\n\nlibrary(tidyverse)\nlibrary(shiny)\nlibrary(gifski)\nlibrary(magick)\nlibrary(systemfonts)\nlibrary(sysfonts)\nlibrary(fontawesome)\nlibrary(glue)\nlibrary(worldfootballR)\nlibrary(gganimate)\nlibrary(ggsoccer)\n#library(viridis)\nlibrary(paletteer)\n#library(RColorBrewer)\nlibrary(ggpointdensity)\nlibrary(ggthemes)\nlibrary(ggtext)\nlibrary(ggiraph)\n#library(ggiraphExtra)\nlibrary(ggimage)\nlibrary(gt)\nlibrary(gtExtras)\nlibrary(grid)\nlibrary(ggdensity)\nlibrary(treemapify)\nlibrary(magick)\n#library(ggpubr)\n#library(cowplot)\nlibrary(readxl)\nlibrary(writexl)\n#library(webshot2)\nlibrary(chromote)\nlibrary(ggrepel)\nlibrary(png)\nlibrary(patchwork)\nlibrary(plotly)\nlibrary(reshape)\nlibrary(psych)\nlibrary(ggshakeR)\n#library(xtable)\nlibrary(tidyquant)\nlibrary(gfonts)\nlibrary(extrafont)\nlibrary(extrafontdb)\nlibrary(ggnewscale)\nlibrary(stringr)\nlibrary(ggh4x)\nlibrary(ggh4x)\nlibrary(ggforce)\n\n#load logos\nAI_Logo <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/UP logo.png\")\nlogo_AI <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/UP logo.png\")\nSoccerball  <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/ball1.png\")\nFootball  <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\")\n\n\n#load fonts\n#set fonts\nfont_add(\"Awesome\", regular = \"/Library/Fonts/Font Awesome 7 Brands-Regular-400.otf\")\n\n#set viz location for camcorder\nVizlocation <- paste0(\"~/Documents/Dropbox files/AI LFC data/R files/AI UP/Scripts/Viz Pack/Season 2526/Specials/Oct International break\")\n\n#set oppo\nMatch_Away <- paste(\"All Oppo\")\n\n#set oppo color\nColor_Away <- paste(\"blue4\")\n\n#set oppo text\nColor_Away_Text <- paste(\"white\")\n\n#Set LFC\nMatch_Home <- paste(\"Liverpool\")\n\n#set Home color\nColor_Home <- paste(\"red4\")\n\n#set home text color\nColor_Home_Text <- paste(\"white\")\n\n#set home color scale\nColorScale_Away <- paste(\"ggsci::blue_material\")\n\n#set away color scale\nColorScale_Home <- paste(\"ggsci::red_material\")\n\n#set home color scale con\nColorScale_AwayC <- paste(\"ggthemes::Classic Blue\")\n\n#set away color scale con\nColorScale_HomeC <- paste(\"ggthemes::Classic Red\")\n\n#set match date\nGame_date1 <- paste(\"17-08-2025 to 06-10-2025\")\nGame_date2 <- paste(\"07-10-2025 to 22-05-2026\")\n\n#set data type (EPL opta and Understat, CL opta, Fa cup Opta)\nData_type <- paste(\"(Opta data)\")\n\n#set Home h/a\nHomeHA <- paste(\"Home\")\n\n#set Away h/a\nAwayHA <- paste(\"Away\") \n\n# set home and away teams\nAway_T = Match_Away\nHome_T = Match_Home\n\n#set home and away colors\nAway_Color = Color_Away\nHome_Color = Color_Home\n\n#set fixture\nMatch_Fixture <- paste0(Match_Home, \" vs \", Match_Away)\n\n#set Game name\nGameName <- paste(\"AllComp_LFC_Games_2526\")\n\n#set league points\nLeague_Points <- 18\nAFC_League_Points <- 17 \nMC_League_Points <- 17\n\n#set Waves titles\nWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\nAwayWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#set xg line titles \nxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\nAwayxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\n#set dribbles title\nDribblesTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Dribbles (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set duels title\nDuelsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set PPs title\nPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nAwayPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\n\n##new socials\nsocial_caption <- function(twitter=\"@Barts78\",\n                           github = \"Barts78\",\n                           linkedin= \"Phil-barter\",\n                           mastodon= \"@DrBarts\",\n                           threads = \"Barts78\",\n                           data = \"OPTA\",\n                           icon_color=\"black\",\n                           font_color=\"#454545\",\n                           bg_color=\"snow\",\n                           font_family=\"sans-serif\"){\n  \n  icons = list(\n    twitter = \"&#xe61a\",\n    github = \"&#xf09b\",\n    linkedin = \"&#xf08c\",\n    mastodon = \"&#xf4f6\",\n    threads = \"&#xe618\",\n    data = \"&#xf16b\"\n  )   \n  \n  social = list(threads = threads, linkedin = linkedin, twitter = twitter, mastodon = mastodon, github = github, data = data)\n  social = social[!is.na(social)]\n  \n  caption = \"\"\n  for (name in names(social)) {\n    icon = icons[name]\n    info = social[name]\n    html = glue(\"<span style='font-family:\\\"Font Awesome 7 Brands\\\";color:{icon_color};font-size:8px;'>{icon};</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\n                <span style='font-family:{font_family};color:{font_color};font-size:8px;'>{info}</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\")\n    \n    \n    caption = paste0(caption,html)\n  }\n  \n  caption\n}\n\n#create social caption\nmy_socials <- social_caption(twitter = \"@Barts78\",\n                             github = \"Barts78\",\n                             linkedin = \"Phil-barter\",\n                             mastodon = \"@DrBarts\",\n                             threads = NA,\n                             data = \"OPTA\",\n                             icon_color = \"#454545\",\n                             font_color = \"#454545\",\n                             bg_color = \"snow\",\n                             font_family = \"sans-serif\")\n\nmy_datasource <- paste0('<span style=\"font-family:\\'Font Awesome 7 Free\\', Arial, sans-serif;color:#454545;font-size:8px;\">&#x1F4BE;</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>',\n                        '<span style=\"font-family:sans-serif;color:#454545;font-size:8px;\">OPTA</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>')\n\nMy_caption <- paste0(my_socials)\n```\n\n```{r}\n#| output: false\n#| warning: false\n#load in data frames\n\nfileName <- paste0(\"~/Documents/Dropbox files/AI LFC data/Data Sets/WhoScored/Databases/\", GameName, \".xlsx\")\nplottingData <- read_xlsx(fileName)\n\n#set summary values\nTotal_EPV <- sum(plottingData$Cumalative_EPV)\nGameTime <- max(plottingData$expandedMinute)\nOutofPlayTime <- round(sum(plottingData$Out_of_play_time)/60,2)\nInPlayTime <- round(sum(plottingData$In_play_time)/60,2)\nPossession <- round(sum(plottingData$Touches),2)\nHomePossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName == Match_Home))/Possession)*100),2)\nAwayPossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName != Match_Home))/Possession)*100),2)\nHomeEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName != Match_Home & plottingData$`outcomeType/value` == 1]),2)\nHomeEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName != Match_Home & plottingData$`outcomeType/value` == 1]),2)\nHomexG <- round(sum(plottingData$xG[plottingData$TeamName == Match_Home]),2)\nAwayxG <- round(sum(plottingData$xG[plottingData$TeamName != Match_Home]),2)\nHomeNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName == Match_Home]),2)\nAwayNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName != Match_Home]),2)\nHomeBCs <- round(sum(plottingData$BCs[plottingData$TeamName == Match_Home]),0)\nAwayBCs <- round(sum(plottingData$BCs[plottingData$TeamName != Match_Home]),0)\nFinal_Third_Possession <- round(sum(plottingData$Final_Third_Touches),2)\nHomeFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName == Match_Home))/Final_Third_Possession)*100),2)\nAwayFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName != Match_Home))/Final_Third_Possession)*100),2)\nHomeDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName == Match_Home]),0)\nAwayDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName != Match_Home]),0)\nHomePasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName == Match_Home]),0)\nAwayPasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName != Match_Home]),0)\nHomePPDA <- round(sum(AwayPasses/HomeDActions),2)\nAwayPPDA <- round(sum(HomePasses/AwayDActions),2)\nHomeProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName == Match_Home]),2)\nAwayProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName != Match_Home]),2)\nHomeCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName == Match_Home]),2)\nHomeProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName == Match_Home]),2)\nAwayCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName != Match_Home]),2)\nAwayProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName != Match_Home]),2)\nHomeGoals <- round(sum(plottingData$Home_Goals),0)\nHomeSOT <- round(sum(plottingData$OTShots[plottingData$TeamName == Match_Home]),0)\nHomeShootingP <- round(sum(HomeGoals/HomeSOT), 2)\nAwayGoals <- round(sum(plottingData$Away_Goals),0)\nAwaySOT <- round(sum(plottingData$OTShots[plottingData$Team_Group == Match_Away]),0)\nAwayShootingP <- round(sum(AwayGoals/AwaySOT), 2)\nHomePPDO <- round(sum(HomeShootingP + (1 - AwayShootingP))*1000, 0)\nAwayPPDO <- round(sum(AwayShootingP + (1 - HomeShootingP))*1000, 0)\n\n#prepare first sub time data (min before sub) \nfirstSubHome <- plottingData %>%\n  filter(TeamName == Match_Home, SubTime != 0) %>%\n  summarise(firstsubhome = min(SubTime)) %>%\n  pull(firstsubhome)\n\nfirstSubAway <- plottingData %>%\n  filter(TeamName == Match_Away, SubTime != 0) %>%\n  summarise(firstsubaway = min(SubTime)) %>%\n  pull(firstsubaway)\n\n# set-up data frame from main variables above for summary tables\nPossessionTable <- data.frame(\n  TeamName = c(Match_Home, Match_Away),\n  Possession = c(HomePossession, AwayPossession))\n\nPossessionTable <- PossessionTable %>%\n  mutate(Possession = round(Possession,2))\n          \nEPVTable <- data.frame(\n  TeamName = c(Match_Home, Match_Away),\n  EPV = c(HomeEPV, AwayEPV)\n)\n\nEPVTable <- EPVTable %>%\n  mutate(EPV = round(EPV,2))\n\nFieldTiltTable <- data.frame(\n  TeamName = c(Match_Home, Match_Away),\n Field_Tilt = c(HomeFieldTilt, AwayFieldTilt))\n\nFieldTiltTable <- FieldTiltTable %>%\n  mutate(Field_Tilt = round(Field_Tilt,2))\n\nPPDOTable <- data.frame(TeamName = c(Match_Home, Match_Away),\n                         PPDO = c(HomePPDO, AwayPPDO))\n#set game block dates\nplottingData <- plottingData %>%\n  #mutate(Game_date = as.Date(Game_date, format = \"%d-%m-%y\")) %>%\n  mutate(Game_Block = case_when(\n    Game_date >= as.Date(\"01-08-2025\", format = \"%d-%m-%Y\") & Game_date <= as.Date(\"31-08-2025\", format = \"%d-%m-%Y\") ~ 1,\n    Game_date >= as.Date(\"01-09-2025\", format = \"%d-%m-%Y\") & Game_date <= as.Date(\"31-10-2025\", format = \"%d-%m-%Y\") ~ 2,\n\n    TRUE ~ NA_integer_\n  ))\n\n#add all oppo tag\nplottingData <- plottingData %>%\n  mutate(Team_Group = ifelse(TeamName == Match_Home, Match_Home, Match_Away))\n\nplottingDataB1 <- plottingData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nplottingDataB2 <- plottingData %>%\n  filter(Game_State == \"Draw\")\n\nplottingDataB3 <- plottingData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n```\n\n\n\n# Season Summary\n``` {r}\n#| output: false\n#| label: summary table setup\n#posession and goals by team\nMatchSummaryData <- compute_summary(plottingData, group_vars = c(\"Team_Group\")) \n\nMatchSummaryData <- MatchSummaryData %>%\n  select('Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryHalfData <- compute_summary(plottingData %>% mutate(Half = case_when(\n  period == 1 ~ \"First Half\",\n  period == 2 ~ \"Second Half\",\n  period == 3 ~ \"First Half Extra Time\",\n  period == 4 ~ \"Second Half Extra Time\",\n  TRUE ~ \"Injury Time\")\n), group_vars = c(\"Half\", \"Team_Group\"))\n\nMatchSummaryHalfData <- MatchSummaryHalfData %>%\n  select(Half, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryPeriodData <- compute_summary(plottingData, group_vars = c(\"Game_Period\", \"Team_Group\"))\n\nMatchSummaryPeriodData <- MatchSummaryPeriodData %>%\n  select(Game_Period, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'ONT Shots' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryGameStateData <- compute_summary(plottingData, group_vars = c(\"Game_State\", \"Team_Group\"))\n\nMatchSummaryGameStateData <- MatchSummaryGameStateData %>%\n  select(Game_State, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryGameNameData <- compute_summary(plottingData, group_vars = c(\"game_name\", \"Team_Group\"))\n\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  select('Fixture' = game_name, Match_day, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\n```\n## Row {.flow}\n```{r}\n#| results: asis\n#| label: Summary tables\nMatchSummaryTable <- MatchSummaryData %>%\n  gt(groupname_col = \"Team\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - Full Games**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(3, 14:17),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(2, 6, 19, 22, 24, 26, 30),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = Match_Away)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = Match_Home)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"#B22222\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \nMatchSummaryTable\n```\n## Row {.flow}\n```{r}\n#| results: asis\nMatchSummaryHalfsTable <- MatchSummaryHalfData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Half\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Half**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryHalfData$Half)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryHalfData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryHalfData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryHalfsTable\n```\n## Row {.flow}\n``` {r}  \n#| results: asis\n#| fig-height: 10\n#| label: Match summary by time period\n#possession and goals by time period\nMatchSummaryPeriodTable <- MatchSummaryPeriodData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_Period\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game Period**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryPeriodData$Game_Period)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryPeriodData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryPeriodData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryPeriodTable\n```\n\n## Row {.flow}\n``` {r}  \n#| results: asis\n\n#possession and goals by time period\nMatchSummaryGameStateTable <- MatchSummaryGameStateData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_State\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game State**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(5, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameStateData$Game_State)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameStateData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameStateData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameStateTable\n```\n## Row {.flow}\n``` {r}  \n#| results: asis\n\n#possession and goals by time period\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  mutate(Match_day = as.numeric(Match_day)) %>%\n  filter(!Match_day == 0) %>%\n  arrange(Match_day)\n  \n  MatchSummaryGameNameTable <- MatchSummaryGameNameData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Match_day\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Match Day**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(6, 16:19),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(4, 8, 21, 24, 26, 28, 32),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  #tab_style(\n  #  locations = cells_row_groups(groups = unique(MatchSummaryGameNameData$Match_day)),\n  #  style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  #) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameNameTable\n```\n\n```{r}\n#| output: false\n#| label: Match MC setup\n#Load data\ndashboard_data <- plottingData\n\n#Dashboard data wrangling all data\ndashboard_data <- dashboard_data %>%\n  filter(Team_Group == Match_Home) %>%\n      filter(period != 5) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period, Game_Block, Game_State, Match_day)\n\n#Oppo dashboard\n\nOppodashboard_data <- plottingData\n\nOppodashboard_data <- Oppodashboard_data %>%\n  filter(Team_Group == Match_Away) %>%\n      filter(period != 5) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period, Game_Block, Game_State, Match_day)\n\nWinDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\") %>%\n    filter(!period == 5) %>%\n  filter(!Match_day == 0)\n  \n\nDrawDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Draw\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nGTimeDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nWinOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nDrawOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Draw\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nGTimeOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\n\nHomexGMC <- HomeShots <- dashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- Oppodashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(dashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(Oppodashboard_data$type == \"Goal\", 1, NA)))\n```\n\n```{r}\n\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMC$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMC$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrix <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrix <- as.data.frame(as.table(prob_matrix))\ncolnames(long_prob_matrix) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n#| label: Match probablity calculations\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrix[upper.tri(prob_matrix)])*100)\nHome_wins_prob <- (sum(prob_matrix[lower.tri(prob_matrix)])*100)\ntie_prob <- (sum(diag(prob_matrix))*100)\n\n# Create a data frame for bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- dashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- Oppodashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(dashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(Oppodashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- WinDashboard_data %>%\n\n  select(xG)\nAwayxGMCB1 <- AwayShots <- WinOppoDashboard_data %>%\n\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(WinDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(WinOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n#| label: Match probablity calculations block 1\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n## Column {.flow}\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n```{r}\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\", size = 4) + \n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_Plot\n```\n\n\n```{r}\n#| label: Match Result Probablity Plot\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Match Result Probablity Plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- dashboard_data\n\nOppoShotsALL <- Oppodashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 4)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n    theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- WinDashboard_data %>%\n\n  select(xG)\nAwayxGMCB1 <- AwayShots <- WinOppoDashboard_data %>%\n\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(WinDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(WinOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- WinDashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- WinOppoDashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(WinDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(WinOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#| label: Match Result Probablity Plot win\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n```\n\n\n```{r}\nMD_MC_Result_PlotB1 <- ggplot(outcome_probB1) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_PlotB1\n\n```\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- WinDashboard_data\n\nOppoShotsALL <- WinOppoDashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 2)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- DrawDashboard_data %>%\n  select(xG)\nAwayxGMCB1 <- AwayShots <- DrawOppoDashboard_data %>%\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(DrawDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(DrawOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- DrawDashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- DrawOppoDashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(DrawDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(DrawOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#| label: Match Result Probablity Plot draw\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n```\n\n\n\n```{r}\nMD_MC_Result_PlotB1 <- ggplot(outcome_probB1) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = \"\",\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_PlotB1\n\n```\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- DrawDashboard_data\n\nOppoShotsALL <- DrawOppoDashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 2)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(), \n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- GTimeDashboard_data %>%\n  select(xG)\nAwayxGMCB1 <- AwayShots <- GTimeOppoDashboard_data %>%\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(GTimeDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(GTimeOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- GTimeDashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- GTimeOppoDashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(GTimeDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(GTimeOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#| label: Match Result Probablity Plot gt\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n```\n\n\n\n\n```{r}\nMD_MC_Result_PlotB1 <- ggplot(outcome_probB1) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = \"\",\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_PlotB1\n\n```\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- GTimeDashboard_data\n\nOppoShotsALL <- GTimeOppoDashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 2)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n\n# Passing Analysis\n\n```{r passnetwork function, echo:FALSE, messages:FALSE, warnings:FALSE}\n#' Function for plotting pass networks\n\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  }  \n\nplot_passnet_AI <- function(data, team_name, scale_stat = \"EPV\", \n                         scale_color = \"firebrick2\", text_color = \"white\", subtitle = \"\", plot_start = \"00\", plot_finish = \"45\", logo = \"\", pitch = \"\", wrap = \"\", pressmap = \"\", passes = \"4\") {\n  \n    # Checking data frame \n    \n    if ((nrow(data) > 0) &&\n        sum(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"minute\", \"outcome\", \"Game_Period\", \"player_shirt\") %in% names(data)) == 11) {\n    } else {\n      print(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"minute\", \"outcome\", \"Game_Period\", \"player_shirt\"))\n      stop(\"The dataset has insufficient columns and/or insufficient data.\")\n    }\n    \n    # Generate error messages\n    \n    if (is.character(data$playerId) == FALSE) {\n      stop(\"The playerId column is supposed to contain player names.\")\n    }\n    \n    if (is.character(data$TeamName) == FALSE) {\n      stop(\"The TeamName column is supposed to contain team names.\")\n    }\n  \n    # full Pitch or half Pitch\n\n    if  (pitch == \"Half\") { \n      data <- data %>%\n        filter(x >= 50)\n    \n    }else if (pitch == \"Full\") {\n      data <- data\n    }\n  # exclude set pieces and throw ins\n  Pass_data <- data %>%\n    filter(Attempted_Passes == 1)\n\n      # Stat calculation\n    \n    if (scale_stat == \"xT\") {\n      \n      df <- Pass_data %>%\n        calculate_threat(type = \"opta\")\n      \n      df <- df %>%\n        mutate(xT = xTEnd - xTStart) %>%\n        select(xT)\n      df[is.na(df)] <- 0\n      \n      data$stat <- df$xT\n      \n      leg_title <- \"xT\"\n      \n    } else if (scale_stat == \"EPV\") {\n      \n      df <- Pass_data %>%\n        calculate_epv(type = \"opta\")\n      \n      df <- df %>%\n        mutate(EPV = EPVEnd - EPVStart) %>%\n        select(EPV)\n      df[is.na(df)] <- 0\n      \n      Pass_data$stat <- df$EPV\n      \n      leg_title <- \"EPV\"\n      \n    }\n    \n  # Calculate Pass percentage\n  Pass_data <- Pass_data %>%\n    replace_na(list(Attempted_Passes = 0)) %>%\n    mutate(Pass_Suc = Successful_Passes / Attempted_Passes)\n  \n  #set title text\n    PassNetTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network</span>\"))\n  \n  PassNetTitle_textD <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network & </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:14px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:14px;'>Unsuccessful</span><span style='color:gray12;font-size:14px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:14px;'>Successful</span><span style='color:gray12;font-size:14px;'>)</span>\"))\n  \n    # wrap or not\n    if (wrap == \"Yes\") {\n      \n      #calculate pressing date\n      \n      if (pressmap == \"Yes\") {\n\n        PressData <- data %>%\n          filter(TeamName == team_name) \n        \n        PressData <- PressData %>%\n          filter(Aerial_total == 1 | Ground_Duels_Total == 1)\n\n      } else if (pressmap == \"\") {\n        \n      }\n\n            plotCaption <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Links =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Size of Line = Number of links</span>\"))\n      \n      # Data Wrangling \n      \n      data1 <- Pass_data %>%\n        filter(TeamName == team_name)\n      \n      data1 <- data1[complete.cases(data1[, \"playerId\"]), ]\n      data1 <- shift_column(data = data1, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n      \n      # Nodes - Player Average Locations\n      nodes <- data1 %>% \n        group_by(playerId, player_shirt, Game_Period) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n(), stat = sum(stat)) %>% \n        na.omit()\n      \n      # Edges - Pass lines and connections between players\n      \n      edgelist <- data1 %>% \n        filter(type == \"Pass\" & outcome == \"Successful\") %>% \n        select(from = playerId, to = receiver, Game_Period) %>% \n        group_by(from, to, Game_Period) %>% \n        summarise(n = n()) %>% \n        na.omit()\n      \n      edges <- left_join(edgelist, \n                         nodes %>% select(playerId, x, y),\n                         by = c(\"from\" = \"playerId\"))\n      \n      edges <- left_join(edges, \n                         nodes %>% select(playerId, xend = x, yend = y),\n                         by = c(\"to\" = \"playerId\"))\n      \n      edges <- edges %>% \n        group_by(player1 = pmin(from, to), player2 = pmax(from, to) ,Game_Period) %>%\n        summarise(n = n[1], x = x[1], y = y[1], xend = xend[1], yend = yend[1], Game_Period = Game_Period[1])\n      \n      #match up coordinates for lines using node coordinates and by game period\n            edgescoord <- nodes\n              \n            colnames(edgescoord)[colnames(edgescoord) == \"playerId\"] <- \"player1\"\n\n            edgescoord <- edgescoord %>%  \n              mutate(player2 = player1,\n                     xend = x,\n                     yend = y)\n\n            \n            edgesnew <- edges\n            colnames(edgesnew)[colnames(edgesnew) == \"x\"] <- \"xold\"\n            colnames(edgesnew)[colnames(edgesnew) == \"y\"] <- \"yold\"\n            colnames(edgesnew)[colnames(edgesnew) == \"xend\"] <- \"xendold\"\n            colnames(edgesnew)[colnames(edgesnew) == \"yend\"] <- \"yendold\"\n\n            edgescoordp1 <- edgescoord\n            \n            edgescoordp1 <- edgescoordp1 %>%\n              select(player1, Game_Period, x, y)\n                        \n            edgesnew <- left_join(edgesnew, edgescoordp1, by = c(\"player1\" = \"player1\", \"Game_Period\" = \"Game_Period\")) \n            \n            edgescoordp2 <- edgescoord\n            \n            edgescoordp2 <- edgescoordp2 %>%\n              select(player2, Game_Period, xend, yend)\n\n            edgesnew <- left_join(edgesnew, edgescoordp2, by = c(\"player2\" = \"player2\", \"Game_Period\" = \"Game_Period\")) \n            \n            edgesnew <- edgesnew %>%\n              select(player1 = player1.x, player2, Game_Period, n, x, y, xend, yend)\n            \n            edges <- edgesnew\n                        \n      # Minimum Number of Connections\n      \n      edges <- edges %>% \n        filter(n >= passes)\n      \n      # Create Line-up Table\n      \n      nodes <- nodes %>%\n        arrange(Game_Period)\n      \n      # reduce names to surname only\n      nodes$playerId <- sub(\".* \", \"\", nodes$playerId)\n      \n      # Plot \n      \n      plot_passnet <- ggplot() +\n        \n        #setup the pitch\n        annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n        theme_pitch() +\n        geom_hline(yintercept = 21.1, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_hline(yintercept = 36.8, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_hline(yintercept = 63.2, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_hline(yintercept = 78.9, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 17, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 33.2, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 50, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 66.4, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 83, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        \n        # add zone numbers\n        #geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n        #geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n        #geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n        \n        #set scale and color gradient\n        scale_size_continuous(range = c(0.5, 3)) +\n        scale_colour_gradientn(\n          colors = c(\"#FFFFF0\", scale_color),\n          values = scales::rescale(c(0, 1)), \n          breaks = scales::breaks_width(0.05), \n          name = \"EPV\") +\n        scale_fill_manual(values = c(\"#0000FF\",  \"red2\"))\n      \n      if (pressmap == \"Yes\") {\n        \n        #plot pressing data\n        plot_passnet <- plot_passnet +\n          geom_point(data = PressData, aes(x = x, y = y, group = Game_Period, fill = outcome, ), shape = 21, size = 1, show.legend = FALSE)\n        \n      } else if (pressmap == \"\") {\n        \n        plot_passnet <- plot_passnet\n      }\n      \n        #plot player connections\n        plot_passnet <- plot_passnet +\n          geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, size = n), linewidth = 0.5, colour = \"black\", alpha = 0.8, show.legend = FALSE) +\n\n        #plot player positions\n          new_scale_color() +\n          new_scale_fill() +\n          geom_point(data = nodes, aes(x, y, fill = stat), size = 3, shape = 21, colour = \"black\", stroke = 0.5) +\n\n        #plot player names\n          geom_text(data = nodes, aes(x, y, label = player_shirt), colour = \"black\", size = 1) +\n          \n        scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)), \n        breaks = scales::breaks_width(0.05), \n        name = \"EPV\") +\n        \n        #formatting\n          labs(title = PassNetTitle_text,\n               subtitle = plotCaption,\n             #subtitle = paste(subtitle,\"\\n\",plotCaption),\n             x = \"\",\n             colour = leg_title,\n             caption = My_caption) +\n          \n            theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            axis.title.x = element_text(colour = \"black\", size = 4)) +\n\n        #Wrap the plots\n          facet_wrap(~Game_Period, ncol = 4) +\n          theme(strip.text.x = element_text(face = \"bold\", size = 10, colour = text_color),\n              strip.background.x = element_rect(fill = scale_color, color = \"black\", linetype = \"solid\", linewidth = 1))\n\n    } else if (wrap == \"\") {\n      \n      #calculate pressing date\n      \n      if (pressmap == \"Yes\") {\n        \n        data <- data %>%\n          filter(between(minute, plot_start, plot_finish))\n        \n        PressData <- data %>%\n          filter(TeamName == team_name) \n        \n        PressData <- PressData %>%\n          filter(Aerial_total == 1 | Ground_Duels_Total == 1)\n\n      } else if (pressmap == \"\") {\n        \n      }\n      \n            plotCaption <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Links =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Size of Line = Number of links</span>\"))\n      \n      # Data Wrangling \n      \n      data1 <- Pass_data %>%\n        filter(TeamName == team_name)\n      \n      data1 <- data1[complete.cases(data1[, \"playerId\"]), ]\n      data1 <- shift_column(data = data1, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n      \n      # Filter for specific time period\n      data1 <- data1 %>%\n        filter(between(minute, plot_start, plot_finish))\n      \n      # Player Average Locations\n      \n      nodes <- data1 %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n(), stat = sum(stat)) %>% \n        na.omit()\n\n      # Edges number of passess between players \n      \n      edgelist <- data1 %>% \n        filter(type == \"Pass\" & outcome == \"Successful\") %>% \n        select(from = playerId, to = receiver) %>% \n        group_by(from, to) %>% \n        summarise(n = n()) %>% \n        na.omit()\n      \n      edges <- left_join(edgelist, \n                         nodes %>% select(playerId, x, y),\n                         by = c(\"from\" = \"playerId\"))\n      \n      edges <- left_join(edges, \n                         nodes %>% select(playerId, xend = x, yend = y),\n                         by = c(\"to\" = \"playerId\"))\n      \n      edges <- edges %>%\n        group_by(player1 = pmin(from, to), player2 = pmax(from, to)) %>%\n        summarise(Total_Passes = sum(n), x = x[1], y = y[1], xend = xend[1], yend = yend[1])\n      \n      #Calculate passing % for each connection\n      PassStats <- data1 %>% \n        select(player1 = playerId, player2 = receiver, Successful_Passes, Attempted_Passes) %>% \n        group_by(player1, player2) %>% \n        summarise(n = n(), Successful_Passes = sum(Successful_Passes), Attempted_Passes = sum(Attempted_Passes)) %>% \n        na.omit() %>%\n        mutate(Pass_Suc = Successful_Passes / Attempted_Passes) %>%\n        replace_na(list(Pass_Suc = 0))\n      \n      #join passing stats to main table\n      edges <- left_join(edges, PassStats %>% select(player1, player2, Pass_Suc), by = c(\"player1\" = \"player1\", \"player2\" = \"player2\")) %>%\n                replace_na(list(Pass_Suc = 1))\n      \n\n      # Minimum Number of Connections\n      edges <- edges %>% \n        filter(Total_Passes >= passes)\n      \n      # Create Line-up Table (see if you can add in pass %)\n      \n      nodes <- nodes %>%\n        arrange(events)\n      \n      nodes$playerId <- sub(\".* \", \"\", nodes$playerId)\n\n      EPVRange <- (max(nodes$stat)) * 0.7\n      \n      # Plot\n\n    plot_passnet <- ggplot() +\n      \n      #setup the pitch\n      annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n      theme_pitch() +\n      geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      \n      # add zone numbers\n      geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      \n      #set scale and color gradient\n      scale_size_continuous(range = c(0.5, 4)) +\n      scale_fill_manual(values = c(\"#0000FF\",  \"red2\"), labels = c(\"Won\", \"Lost\"), name = \"\")\n\n\n      \n    if (pressmap == \"Yes\") {\n      \n      #plot pressing data\n      plot_passnet <- plot_passnet +\n        geom_point(data = PressData, aes(x = x, y = y, fill = outcome), shape = 21, size = 1.5, stroke = 0.5, show.legend = FALSE)\n\n    } else if (pressmap == \"\") {\n     \n      plot_passnet <- plot_passnet\n      \n    }\n      \n      #plot player connections\n    plot_passnet <- plot_passnet +\n      new_scale_color() +\n      new_scale_fill() +\n      geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, size = (Total_Passes*0.25), colour = Pass_Suc)) +\n      guides(size = \"none\") +\n\n      \n      #plot player positions\n      geom_point(data = nodes, aes(x, y, fill = stat), size = 4, shape = 21, colour = \"black\", stroke = 0.5) +\n      \n      #plot player EPV\n#      geom_point(data = nodes, aes(x, y, colour = stat), size = 7, shape = 21, fill = \"#FFFFF0\", stroke = 4) +\n      \n      #plot player names\n      geom_text(data = nodes, aes(x, y, label = player_shirt), color = if_else(nodes$stat > EPVRange, 'white', 'black'), size = 1.5) +\n      \n      # set colour\n      scale_colour_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)), \n        breaks = scales::breaks_width(0.25), \n        name = \"Passing Success %\") +\n      \n      scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)), \n        breaks = scales::breaks_width(0.05), \n        name = \"EPV\") +\n      \n      #formatting\n      labs(title = PassNetTitle_text,\n           subtitle = plotCaption,\n           x = \"\",\n           colour = leg_title,\n           caption = My_caption) +\n      theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            axis.title.x = element_text(colour = \"black\", size = 4))\n    }\n    \n    # If half pitch\n    \n    if (pitch == \"Half\") {\n      \n      plot_passnet <- plot_passnet +\n        coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n        labs(y = \" \") +\n        theme(axis.title.y = element_blank(),\n              axis.title.x = element_blank())\n      \n    } else if (pitch == \"Full\") {\n      \n      plot_passnet <- plot_passnet\n      \n    }\n    \n    # Press or not formatting\n    \n    if (pressmap == \"Yes\") {\n      \n      plot_passnet <- plot_passnet +\n\n        #formatting\n        labs(title = PassNetTitle_textD,\n             x = \"\",\n             colour = leg_title)\n      \n    } else if (pressmap == \"\") {\n      \n      plot_passnet <- plot_passnet\n    }\n\n    # logo or not\n  \n    if (logo == \"Yes\") {\n    \n    # annotate plot\n    Finalplot_passnet <- plot_passnet +\n    annotation_custom(AI_Logo, xmin = 90, xmax = 100, ymin = 105, ymax = 115) +\n      coord_cartesian(clip = \"off\") +\n      theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n    \n    } else if (logo == \"\") {\n      \n      Finalplot_passnet <- plot_passnet\n    }\n\n  return(Finalplot_passnet)\n}\n```\n\n```{r}\n#| output: false\n# Step 1: Filter successful passes open play only\nsuccessful_passes <- plottingData \nsuccessful_passesB1 <- plottingDataB1 \nsuccessful_passesB2 <- plottingDataB2 \nsuccessful_passesB3 <- plottingDataB3 \n\n# Step 2: Identify passing sequences with more than the defined level of pass\n\npassing_sequencesLFC <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppo <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\npassing_sequencesLFCB1 <- successful_passesB1 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppoB1 <- successful_passesB1 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\npassing_sequencesLFCB2 <- successful_passesB2 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppoB2 <- successful_passesB2 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\npassing_sequencesLFCB3 <- successful_passesB3 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppoB3 <- successful_passesB3 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n#tabeldata\npassing_sequencesLFC_Table <- passing_sequencesLFC %>%\n  filter(Team_Group == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesLFC_1st_Table <- passing_sequencesLFC %>%\n  filter(Team_Group == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #, \n    #Game_Block == 1\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance, Game_State) %>%\n  group_by(Pass_Chain_Length, Game_State) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance',  Game_State)\n\npassing_sequencesLFC_2nd_Table <- passing_sequencesLFC %>%\n  filter(Team_Group == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #,\n    #Game_Block == 2\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n\npassing_sequencesOppo_Table <- passing_sequencesOppo %>%\n  filter(Team_Group == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesOppo_1st_Table <- passing_sequencesOppo %>%\n  filter(Team_Group == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #,\n    #Game_Block == 1\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance, Game_State) %>%\n  group_by(Pass_Chain_Length, Game_State) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance',  Game_State)\n\npassing_sequencesOppo_2nd_Table <- passing_sequencesOppo %>%\n  filter(Team_Group == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #,\n    #Game_Block == 2\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n# Define the desired order\ndesired_order <- c(\"VLow\", \"Low\", \"Medium\", \"High\")\n\n# Arrange passing_sequencesLFC_Table\npassing_sequencesLFC_Table <- passing_sequencesLFC_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesOppo_Table\npassing_sequencesOppo_Table <- passing_sequencesOppo_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesLFC_1st_Table <- passing_sequencesLFC_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesOppo_Table\npassing_sequencesOppo_1st_Table <- passing_sequencesOppo_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesLFC_2nd_Table <- passing_sequencesLFC_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesOppo_Table\npassing_sequencesOppo_2nd_Table <- passing_sequencesOppo_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n```\n\n```{r}\n#| output: false\nZone14_Passes_LFC_Data <- plottingData %>%\n  filter(Team_Group == Match_Home,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start, Game_State, Match_day)\n\nZone14_Passes_LFC_Data <- Zone14_Passes_LFC_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_LFC_Data <- plottingData %>%\n  filter(Team_Group == Match_Home,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start, Game_State, Match_day)\n\nLHS_Passes_LFC_Data <- LHS_Passes_LFC_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_LFC_Data <- plottingData %>%\n  filter(Team_Group == Match_Home,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start, Game_State, Match_day)\n\nRHS_Passes_LFC_Data <- RHS_Passes_LFC_Data %>%\n  filter(Successful_Passes == 1)\n\nZone14_Passes_Oppo_Data <- plottingData %>%\n  filter(Team_Group == Match_Away,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start, Game_State, Match_day)\n\nZone14_Passes_Oppo_Data <- Zone14_Passes_Oppo_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_Oppo_Data <- plottingData %>%\n  filter(Team_Group == Match_Away,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start, Game_State, Match_day)\n\nLHS_Passes_Oppo_Data <- LHS_Passes_Oppo_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_Oppo_Data <- plottingData %>%\n  filter(Team_Group == Match_Away,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start, Game_State, Match_day)\n\nRHS_Passes_Oppo_Data <- RHS_Passes_Oppo_Data %>%\n  filter(Successful_Passes == 1)\n\n#combine data frames\nZ14_HS_Passes_LFC_Data <- bind_rows(Zone14_Passes_LFC_Data, LHS_Passes_LFC_Data, RHS_Passes_LFC_Data)\n\nZ14_HS_Passes_Oppo_Data <- bind_rows(Zone14_Passes_Oppo_Data, LHS_Passes_Oppo_Data, RHS_Passes_Oppo_Data)\n\nZ14_HS_Passes_LFC_Data <- Z14_HS_Passes_LFC_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_Oppo_Data <- Z14_HS_Passes_Oppo_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_LFC_Data <- Z14_HS_Passes_LFC_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n\nZ14_HS_Passes_Oppo_Data <- Z14_HS_Passes_Oppo_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n\n\nZ14_HS_Passes_LFC_DataB1 <- Z14_HS_Passes_LFC_Data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nZ14_HS_Passes_LFC_DataB2 <- Z14_HS_Passes_LFC_Data %>%\n  filter(Game_State == \"Draw\")\n\nZ14_HS_Passes_LFC_DataB3 <- Z14_HS_Passes_LFC_Data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nZ14_HS_Passes_Oppo_DataB1 <- Z14_HS_Passes_Oppo_Data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nZ14_HS_Passes_Oppo_DataB2 <- Z14_HS_Passes_Oppo_Data %>%\n  filter(Game_State == \"Draw\")\n\nZ14_HS_Passes_Oppo_DataB3 <- Z14_HS_Passes_Oppo_Data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n```\n\n## Row {.flow}\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n## Row {.flow}\n```{r Passnetworks home 1st half}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingData,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r home 2nd half}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingData,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_Plot <- passing_sequencesLFC %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFC$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFC$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_Plot\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_Plot <- passing_sequencesOppo %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppo$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppo$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_Plot\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_Plot <- Z14_HS_Passes_LFC_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_Plot\n```\n```{r}\nZone14_HS_Passes_Oppo_Plot <- Z14_HS_Passes_Oppo_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_Plot\n```\n\n## Row {.flow}\n```{r}\n#| label: home passing chaing tables\n#| results: asis\nHome_Passing_Chains_Table <- passing_sequencesLFC_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Full season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_Table\n\n\n```\n\n```{r}\n#| results: asis\n#| label: away passing chaing tables\nOppo_Passing_Chains_Table <- passing_sequencesOppo_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Full Season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nOppo_Passing_Chains_Table\n\n```\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingData %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName, Match_day) %>%\nmutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\", \"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  #filter(!Match_day == 0) %>%\n  filter(EPVvalue >= 0.08) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  #facet_grid(Pass_Type ~ Match_day) +\n  #facet_wrap(~ Pass_Type + Half + Match_day) +\n  #facet_wrap(vars(Pass_Type, Half, Match_day), ncol = 3) +\n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\n#ggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n    filter(EPVvalue >= 0.08) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n## Row {.flow}\n```{r Passnetworks home 1st half B1}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingDataB1,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r home 2nd half B1}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingDataB1,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_PlotB1 <- passing_sequencesLFCB1 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFCB1$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFCB1$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_PlotB1\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_PlotB1 <- passing_sequencesOppoB1 %>%\n    #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppoB1$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppoB1$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_PlotB1\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_PlotB1 <- Z14_HS_Passes_LFC_DataB1 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_PlotB1\n```\n```{r}\nZone14_HS_Passes_Oppo_PlotB1 <- Z14_HS_Passes_Oppo_DataB1 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_PlotB1\n```\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingDataB1 %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName) %>%\n  mutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n#| height: \"100%\"\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n\n```\n## Row {.flow}\n```{r}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingDataB2,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingDataB2,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_PlotB2 <- passing_sequencesLFCB2 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFCB2$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFCB2$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_PlotB2\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_PlotB2 <- passing_sequencesOppoB2 %>%\n    #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppoB2$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppoB2$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_PlotB2\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_PlotB2 <- Z14_HS_Passes_LFC_DataB2 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_PlotB2\n```\n```{r}\nZone14_HS_Passes_Oppo_PlotB2 <- Z14_HS_Passes_Oppo_DataB2 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_PlotB2\n```\n\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingDataB2 %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName) %>%\n    mutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n## Row {.flow}\n```{r}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingDataB3,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingDataB3,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_PlotB3 <- passing_sequencesLFCB3 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFCB3$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFCB3$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_PlotB3\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_PlotB3 <- passing_sequencesOppoB3 %>%\n    #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppoB3$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppoB3$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_PlotB3\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_PlotB3 <- Z14_HS_Passes_LFC_DataB3 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_PlotB3\n```\n```{r}\nZone14_HS_Passes_Oppo_PlotB3 <- Z14_HS_Passes_Oppo_DataB3 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_PlotB3\n```\n\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingDataB3 %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName) %>%\n    mutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row {.flow}\n```{r}\n#| results: asis\n#| label: home passing chaing tables all\nHome_Passing_Chains_Table_all <- passing_sequencesLFC_1st_Table %>%\n  gt(groupname_col = \"Game_State\") %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Full season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_Table_all\n\n\n```\n\n```{r}\n#| results: asis\n#| label: away passing chaing tables all\nOppo_Passing_Chains_Table_all <- passing_sequencesOppo_1st_Table %>%\n  gt(groupname_col = \"Game_State\") %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Full Season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nOppo_Passing_Chains_Table_all\n\n```\n\n# Player Analysis\n\n```{r player data setup, echo:FALSE, messages:FALSE, warnings:FALSE}\n#| output: false\n#player summary tables\n#posession and goals by Player\nMatchSummaryPLayerData <- plottingData %>%\n  mutate(\n    Out_of_play_time = round(Out_of_play_time / 60, 1),\n    EventTime = round(EventTime / 60, 1),\n    TeamEPV = as.numeric(ifelse(str_detect(`outcomeType/value`, \"1\"), paste0(EPVvalue), 0))) %>%\n  group_by(TeamName, playerId, Team_Group, role) %>%\n  summarise_at(vars(Goals, TotalShots, 'OFT Shots' = OFShots, 'OT Shots' = OTShots, Out_Box_Shots, Touches, PK_Box_Touches, Attempted_Passes, Successful_Passes, TeamEPV, Key_Passes, Assists, Hockey_Assists, BCs, xG, xGOT, Aerial_total, Aerial_Won, Aerial_Lost, Ground_Duels_Total, Ground_Duels_Won, Ground_Duels_Lost), list(sum), na.rm = TRUE) %>%\n  ungroup() %>%\n  group_by(Team_Group) %>%\n  mutate(\n    Team_TotalTouches = sum(Touches),\n    Team_TotalEPV = sum(TeamEPV),\n    Team_TotalxG = sum(xG),\n    Team_TotalPasses = sum(Attempted_Passes),\n    Team_TotalDuels = sum(Ground_Duels_Total),\n    Team_TotalAerials = sum(Aerial_total),\n    Team_TotalShots = sum(TotalShots),\n    Possession = round((Touches / Team_TotalTouches) * 100, 1),\n    Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n    Aerial_Success = round((Aerial_Won / Aerial_total) * 100, 1),\n    Duel_Success = round((Ground_Duels_Won / Ground_Duels_Total) * 100, 1),\n    On_Ball_Time = round(InPlayTime * (Possession / 100), 1),\n    Team_EPV_P = round((TeamEPV / Team_TotalEPV) * 100, 1),\n    Team_xG_P = round((xG / Team_TotalxG) * 100, 1),\n    Team_Duels_P = round((Ground_Duels_Total / Team_TotalDuels) * 100, 1),\n    Team_Aerial_P = round((Aerial_total / Team_TotalAerials) * 100, 1),\n    Team_Passes_P = round((Attempted_Passes / Team_TotalPasses) * 100, 1),\n    Team_Shots_P = round((TotalShots / Team_TotalShots) * 100, 1)\n  ) %>%\n  replace_na(list( Aerial_Success = 0)) %>%\n  replace_na(list( Duel_Success = 0)) %>%\n  filter(role != is.na(role)) %>%\n  ungroup()\n\nMatchSummaryPLayerProfileData <- MatchSummaryPLayerData\n\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  select(Team = Team_Group, role, Name = playerId, '% of Team Possession' = Possession, `% of Team On Ball Time` = On_Ball_Time, Touches = Touches, 'Total Shots' = TotalShots, 'Out Box Shots' = Out_Box_Shots, BCs, Goals, xG, xGOT,  'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, Assists, 'Key Passes' = Key_Passes, EPV = TeamEPV, '% of Team EPV' = Team_EPV_P, 'Aerials Total' = Aerial_total, 'Aerials Won' = Aerial_Won, 'Aerial Success %' = Aerial_Success, 'Duels Total' = Ground_Duels_Total, 'Duels Won' = Ground_Duels_Won, 'Duel Success' = Duel_Success)\n\n\n\nPlayer_Summary_plot_data <- MatchSummaryPLayerProfileData %>%\n  select(Team = Team_Group, Name = playerId, role, '% Possession' = Possession, `% On Ball Time` = On_Ball_Time, Touches = Touches, 'Total Shots' = TotalShots, 'OFT Shots', 'OT Shots', 'Out Box Shots' = Out_Box_Shots, BCs, Goals, xG, xGOT, '% xG' = Team_xG_P, Touches, PK_Box_Touches, 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, Assists, 'Key Passes' = Key_Passes, EPV = TeamEPV, '% EPV' = Team_EPV_P, 'Aerials Total' = Aerial_total, 'Aerials Won' = Aerial_Won, 'Aerial Success %' = Aerial_Success, 'Duels Total' = Ground_Duels_Total, 'Duels Won' = Ground_Duels_Won, 'Duel Success %' = Duel_Success, '% Duels' = Team_Duels_P, '% Passes' = Team_Passes_P, '% Shots' = Team_Shots_P, '% Aerials' = Team_Aerial_P)\n\n\nPlayer_Summary_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, '% Possession', '% On Ball Time', '% EPV', '% Passes', '% Shots', '% Duels', '% Aerials') %>%\n  pivot_longer(cols = c('% Possession', '% On Ball Time', '% EPV','% Passes', '% Shots', '% Duels', '% Aerials'), names_to = \"Metric\", values_to = \"Value\")\n\n#player profile plot data\n\nPlayer_Goal_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, 'OFT Shots', 'OT Shots', 'Out Box Shots', BCs, Goals, Assists, 'Key Passes') %>%\n  pivot_longer(cols = c(`OFT Shots`, 'OT Shots', `Out Box Shots`, BCs, Goals, Assists, `Key Passes`), names_to = \"Metric\", values_to = \"Value\") \n\n#filter data by team\nPlayer_Summary_plot_data_Home <- Player_Summary_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Summary_plot_data_Away <- Player_Summary_data %>%\n  filter(Team == Match_Away) \n\nPlayer_Goal_plot_data_Home <- Player_Goal_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Goal_plot_data_Away <- Player_Goal_data %>%\n  filter(Team == Match_Away) \n\n\n#work out team and unit averages\n#general metrics\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\ngroup_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n#goal metrics\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n\n\n#wrap the tiles for the general plot\nPlayer_Summary_data_Home$Metric  <- str_wrap(Player_Summary_data_Home$Metric, width = 5)  \n\nPlayer_Summary_data_Away$Metric  <- str_wrap(Player_Summary_data_Away$Metric, width = 5)  \n\n\n#wrap the tiles for the goal plot\nPlayer_Goal_data_Home$Metric  <- str_wrap(Player_Goal_data_Home$Metric, width = 5)  \n\nPlayer_Goal_data_Away$Metric  <- str_wrap(Player_Goal_data_Away$Metric, width = 5)  \n\n\n#reorder data\nfacet_order <- c(\"Keeper\", \"Defender\", \"Midfielder\", \"Attacker\")\n\n#general plot\nPlayer_Summary_data_Home  <- Player_Summary_data_Home  %>%\narrange(factor(role, levels = facet_order))\n\nPlayer_Summary_data_Away  <- Player_Summary_data_Away  %>%\n  arrange(factor(role, levels = facet_order))\n\n#goal plot\nPlayer_Goal_data_Home <- Player_Goal_data_Home %>%\n  arrange(factor(role, levels = facet_order))\n\nPlayer_Goal_data_Away <- Player_Goal_data_Away %>%\n  arrange(factor(role, levels = facet_order))\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n## Row\n```{r}\n#| results: asis\nMatchSummaryPlayerTableHome <- MatchSummaryPLayerData %>%\n  filter(Team == Match_Home) %>%\n  gt(groupname_col = \"role\", rowname_col = \"Name\") %>%\n  #row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Attacker\")) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  #cols_hide(Player) %>%\n  #gt_img_rows(columns = Player, height = 25) %>%\n#  gt_img_circle(column = 'Player', height = 40, border_color = \"black\", border_weight = 1.5) %>%\n#  cols_width(Player ~ px(45)) %>% # 110 = 100 (height) + 10 (padding around imgs)\n  summary_rows(columns = c(5:25), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:25), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(4:5, 5, 15, 19, 22, 25),\n    scale_values = FALSE,\n    decimals = 1\n  ) %>%\n  fmt_number(\n    columns = c(18),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Shots\", columns = c(9:12)) %>%\n  tab_spanner(label = \"Passes\", columns = c(13:19)) %>%\n  tab_spanner(label = \"Duels\", columns = c(20:25)) %>%\n  #tab_style(\n  #  style = cell_text(color = \"#E5E5E5\"),\n  #  locations = cells_column_labels('Player')) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  gt_color_rows(columns = c(5), palette = ColorScale_Home, domain = c(0,15)) %>%\n  gt_color_rows(columns = c(7, 6, 13, 14, 15, 19, 22, 25), palette = ColorScale_Home, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(7, 20, 24), palette = ColorScale_Home, domain = c(0,10)) %>%\n  gt_color_rows(columns = c(8:10, 16:17), palette = ColorScale_Home, domain = c(0,5)) %>%\n  gt_color_rows(columns = c(21, 23), palette = ColorScale_Home, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(18), palette = ColorScale_Home, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(11:12), palette = ColorScale_Home, domain = c(0,3))\n\nMatchSummaryPlayerTableHome\n\n```\n\n\n```{r}\n#| results: asis\nMatchSummaryPlayerTableAway <- MatchSummaryPLayerData %>%\n  filter(Team == Match_Away) %>%\n  gt(groupname_col = \"role\", rowname_col = \"Name\") %>%\n  #row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Attacker\")) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  #cols_hide(Player) %>%\n  #gt_img_rows(columns = Player, height = 25) %>%\n#  gt_img_circle(column = 'Player', height = 40, border_color = \"black\", border_weight = 1.5) %>%\n#  cols_width(Player ~ px(45)) %>% # 110 = 100 (height) + 10 (padding around imgs)\n  summary_rows(columns = c(4:25), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(4:25), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(4:5, 5, 15, 19, 22, 25),\n    scale_values = FALSE,\n    decimals = 1\n  ) %>%\n  fmt_number(\n    columns = c(18),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:12)) %>%\n  tab_spanner(label = \"Passes\", columns = c(13:19)) %>%\n  tab_spanner(label = \"Duels\", columns = c(20:25)) %>%\n  #tab_style(\n  #  style = cell_text(color = \"#E5E5E5\"),\n  #  locations = cells_column_labels('Player')) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  gt_color_rows(columns = c(5), palette = ColorScale_Away, domain = c(0,15)) %>%\n  gt_color_rows(columns = c(5, 6, 13, 14, 15, 19, 22, 25), palette = ColorScale_Away, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(7, 19, 24), palette = ColorScale_Away, domain = c(0,10)) %>%\n  gt_color_rows(columns = c(8:10, 16:17), palette = ColorScale_Away, domain = c(0,5)) %>%\n  gt_color_rows(columns = c(21, 23), palette = ColorScale_Away, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(18), palette = ColorScale_Away, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(11:12), palette = ColorScale_Away, domain = c(0,3))\n\n#MatchSummaryPlayerTableAway\n```\n\n\n```{r pass connections home}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingData \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n\n\n```{r}\n#| output: false\n#' Function for plotting Player touch areas\n#' Function for plotting Team touch areas - set at 75%\n\n#calculate touch area of player - set at 75% using quantiles\ntouch_area_shape <- function(data) {\n  \n  x_low <- quantile(data$x, 0.15)\n  x_high <- quantile(data$x, 0.85)\n  \n  y_low <- quantile(data$y, 0.15)\n  y_high <- quantile(data$y, 0.85)\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n#calculate touch area of player - set at 1.5 MAD (75% of data) using medians\ntouch_area_shape_mad <- function(data) {\n  \n  x_median <- median(data$x)\n  y_median <- median(data$y)\n  \n  x_mad <- median(abs(data$x - x_median))/0.6745\n  y_mad <- median(abs(data$y - y_median))/0.6745\n  \n  x_low <- x_median - 1.5*x_mad\n  x_high <- x_median + 1.5*x_mad\n  \n  y_low <- y_median - 1.5*y_mad\n  y_high <- y_median + 1.5*y_mad\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n#Main function\nTouchPlayerPlot_AI <- function(data, \n                            color = \"firebrick4\", text_color = \"\", title = \"\", subtitle = \"\", plot_start = \"0\", plot_finish = \"45\", logo = \"\") {\n  \n    if (nrow(data) > 0 &&\n        sum(x = c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"minute\", \"Game_Period\", \"role\") %in% names(data)) == 8) {\n    } else {\n      print(c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\"))\n      stop(\"The dataset has insufficient columns and/or insufficient data.\")\n    }\n    \n    data <- data %>%\n      filter(!`qualifiers/0/type/value` == 2, \n        !`qualifiers/0/type/value` == 6, #corner\n        !`qualifiers/0/type/value` == 5, #free kick\n        !`qualifiers/0/type/value` == 107, #throw in\n        !`qualifiers/1/type/value` == 2, \n        !`qualifiers/1/type/value` == 6,\n        !`qualifiers/1/type/value` == 5,\n        !`qualifiers/1/type/value` == 107,\n        !`qualifiers/2/type/value` == 2, \n        !`qualifiers/2/type/value` == 6,\n        !`qualifiers/2/type/value` == 5,\n        !`qualifiers/2/type/value` == 107,\n        !`qualifiers/3/type/value` == 2, \n        !`qualifiers/3/type/value` == 6,\n        !`qualifiers/3/type/value` == 5,\n        !`qualifiers/3/type/value` == 107,\n        `type/value` == 1 & `outcomeType/value` == 1 |\n          `type/value` == 2 & `outcomeType/value` == 1 | \n          `type/value` == 3 & `outcomeType/value` == 1 |\n          `type/value` == 4 & `outcomeType/value` == 1 |\n          `type/value` == 9 |\n          `type/value` == 7 |\n          `type/value` == 8 |\n          `type/value` == 10 |\n          `type/value` == 11 |\n          `type/value` == 12 |\n          `type/value` == 13 |\n          `type/value` == 14 |\n          `type/value` == 15 |\n          `type/value` == 16 |\n          `type/value` == 41 |\n          `type/value` == 44 |\n          `type/value` == 42 |\n          `type/value` == 45 |\n          `type/value` == 50 |\n          `type/value` == 52 |\n          `type/value` == 54 |\n          `type/value` == 61 |\n          `type/value` == 73 |\n          `type/value` == 74) \n    \n    data <- data %>%\n      drop_na(playerId, x, y) %>%\n      filter(between(minute, plot_start, plot_finish))\n  \n  list_data <- split(data, data$playerId)\n  \n  touch_area_data <- list_data %>%\n    purrr::map(touch_area_shape) %>%\n    purrr::reduce(full_join)\n  \n  #calculate average position\n  PlayerPos <- touch_area_data\n  \n  PlayerPos <- PlayerPos %>% \n    group_by(playerId) %>% \n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE)) %>% \n    na.omit()\n  \n  teamtitle <- paste(title,\"Player Touch Areas\")\n  \n  #canvas  \n  player_touch_map <- ggplot(touch_area_data) +\n    \n    #setup Pitch\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    \n    # add zone numbers\n    geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n    geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n    geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n    \n    #geometrics\n    geom_point(data = data, aes(x = x, y = y), alpha = 0.5, colour = \"black\", size = 1) +\n    geom_polygon(aes(x = x, y = y), colour = color, alpha = 0.2, fill = color, size = 0.8) +\n    #stat_density_2d(aes(x = x, y = y, color = after_stat(level), fill = after_stat(level)),geom = \"polygon\", alpha = 0.4, linewidth = 1) +\n    \n    #plot player average position\n    geom_point(data = PlayerPos, aes(x = x, y = y), colour = color, alpha = 0.8, shape = 19, size = 1) +\n    \n    #Wrap or not\n#    facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Attacker\")) + playerId, ncol = 5) +\n    facet_wrap(~ playerId, nrow = 3) +\n    \n    #formatting\n    labs(title = teamtitle,\n         x = \"\",\n         caption = My_caption,\n         subtitle = paste(subtitle,\"\\nArea = 75% of activity, Team Colour Dot = Player Average Position\")) +\n    theme(legend.position = \"none\",\n          plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n          panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n          strip.background = element_rect(fill = color, color = \"black\", linetype = \"solid\", linewidth = 1),\n          strip.text = element_text(size = 4, colour = text_color),\n          plot.title = element_text(colour = \"black\", size = 10, face = \"bold\"),\n          plot.subtitle = element_text(colour = \"black\", size = 8),\n          plot.caption = element_markdown(),\n          axis.title.x = element_blank())\n\n\n  \n  \n  if (logo == \"Yes\") {\n    \n  #Annotate Plot\n  player_touch_mapAI <- ggdraw() +\n    draw_plot(player_touch_map, x = 0, y = 0, width = 1, height = , scale = 1) +\n    draw_image(logo_AI,  x = 0.445, y = 0.438, scale = 0.12) \n#    draw_image(logo_AI,  x = 0.3, y = 0.45, scale = 0.06) \n  \n  } else if (logo == \"\") {\n    player_touch_mapAI <- player_touch_map\n  }\n  \n  return(player_touch_mapAI)\n}\n  \n\n```\n\n```{r}\n# Enhanced TouchTeamPlot_OPTA with method selection\nTouchTeamPlot_OPTA <- function(\n  data,\n  color = \"#E74C3C\",\n  title = \"\",\n  subtitle = \"\",\n  plot_start = 0,\n  plot_finish = 45,\n  logo = \"\",\n  method = \"mad\"  # or \"quantile\"\n) {\n  required_cols <- c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"expandedMinute\", \"Game_Period\", \"file_name\", \"role\")\n  if (nrow(data) == 0 || !all(required_cols %in% names(data))) {\n    stop(\"The dataset has insufficient columns and/or insufficient data.\")\n  }\n\n  data <- data %>%\n    drop_na(playerId, x, y) %>%\n    filter(between(expandedMinute, plot_start, plot_finish))\n\n  shape_fn <- if (method == \"quantile\") touch_area_shapenonmad else touch_area_shape\n\n  list_data <- split(data, data$playerId)\n  touch_area_data <- purrr::map(list_data, shape_fn) %>% purrr::reduce(full_join)\n\n  PlayerPos <- touch_area_data %>%\n    group_by(playerId) %>%\n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), .groups = \"drop\") %>%\n    na.omit()\n\n  teamtitle <- paste(title, \"Areas\")\n\n  touch_map <- ggplot(touch_area_data) +\n    scale_color_paletteer_d(palette = \"tvthemes::gravityFalls\") +\n    scale_fill_paletteer_d(palette = \"tvthemes::gravityFalls\") +\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 4, color = \"grey\") +\n    geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 4, color = \"grey\") +\n    geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 4, color = \"grey\") +\n    geom_polygon(aes(x = x, y = y, fill = playerId, colour = playerId), alpha = 0.15, size = 0.5) +\n    geom_point(data = PlayerPos, aes(x = x, y = y, fill = playerId, colour = playerId), alpha = 0.7, shape = 21, size = 3, stroke = 0.5) +\n    geom_text(data = PlayerPos, aes(x = x, y = y + 4, label = playerId, colour = playerId), size = 2.5) +\n    labs(\n      title = teamtitle,\n      subtitle = paste(subtitle, \"\nArea = 75% of activity, Dot = Player Average Position\"),\n      caption = My_caption,\n      x = \"\"\n    ) +\n    theme(\n      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      strip.background = element_rect(fill = \"#E5E5E5\", colour = NA),\n      strip.text = element_text(colour = \"black\", size = 10),\n      plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n      plot.subtitle = element_text(colour = \"black\", size = 10),\n      plot.caption = element_markdown(),\n      axis.title.x = element_text(colour = \"black\", size = 12, face = \"bold\"),\n      legend.position = \"none\"\n    )\n\n  if (logo == \"Yes\") {\n    touch_mapAI <- ggdraw() +\n      draw_plot(touch_map, x = 0, y = 0, width = 1, scale = 1) +\n      draw_image(logo_AI, x = 0.4, y = 0.45, scale = 0.07)\n  } else {\n    touch_mapAI <- touch_map\n  }\n\n  return(touch_mapAI)\n}\n\n#| output: false\n#' Function for plotting Team touch areas\n\n#calculate touch area of player - set at 75% using quantiles- chnage to 70%\ntouch_area_shapenonmad <- function(data) {\n  \n  x_low <- quantile(data$x, 0.15)\n  x_high <- quantile(data$x, 0.85)\n  \n  y_low <- quantile(data$y, 0.15)\n  y_high <- quantile(data$y, 0.85)\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n#calculate touch area of player - set at 1 MAD (60% of data) using medians\ntouch_area_shape <- function(data) {\n  \n  x_median <- median(data$x)\n  y_median <- median(data$y)\n  \n  x_mad <- median(abs(data$x - x_median))/0.6745\n  y_mad <- median(abs(data$y - y_median))/0.6745\n  \n  x_low <- x_median - 1*x_mad\n  x_high <- x_median + 1*x_mad\n  \n  y_low <- y_median - 1*y_mad\n  y_high <- y_median + 1*y_mad\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n```\n\n\n```{r}\n#| output: false\n#| #' dribbles and duels data setup\n\nheatmapdata <- plottingData \n\nDribblesmapdata <- heatmapdata %>%\n  filter(Dribbles_Total == 1) %>%\n  mutate(DribblesFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DribblesFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName, Team_Group, teamId, playerId, player_shirt, #player_image_url, \n         playerNumber, role,  x, y, DribblesFinalX, DribblesFinalY, outcome, Game_Period )\n\n\n#duels aerial and ground data\nDuelsmapdata <- heatmapdata\n  \nDuelsmapdata <- heatmapdata %>%\n  filter(Ground_Duels_Total == 1 |\n           Aerial_total == 1) %>%\n  mutate(DuelsFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DuelsFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName,Team_Group, teamId, playerId, player_shirt, #player_image_url, \n         playerNumber, role, x, y, DuelsFinalX, DuelsFinalY, outcome, Game_Period )\n\n\n#Liverpool duels data\nLFCDuelsmapdata <- Duelsmapdata %>%\n  filter(Team_Group == Match_Home)\n\n#Oppo duels data\nOppoDuelsmapdata <- Duelsmapdata %>%\n  filter(Team_Group == Match_Away)\n\n#Home Dribbles Data\nLFCDribblesmapdata <- Dribblesmapdata %>%\n  filter(Team_Group == Match_Home)\n\n#Away Dribbles Data\nOppoDribblesmapdata <- Dribblesmapdata %>%\n  filter(Team_Group == Match_Away)\n\n#PLayer touch data \nTouchDataLFC <- plottingData %>%\n  filter(Team_Group == Match_Home)\n\nTouchDataLFCB1 <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nTouchDataLFCB2 <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n           filter(Game_State == \"Draw\")\n\nTouchDataLFCB3 <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nTouchDataOppo <- plottingData %>%\n  filter(Team_Group == Match_Away)\n\n#LFC TEAM Touch zones\nTouchData <- plottingData %>%\n  filter(!`qualifiers/0/type/value` %in% c(5, 6, 107, 2),\n    !`qualifiers/1/type/value` %in% c(5, 6, 107, 2),\n    !`qualifiers/2/type/value` %in% c(5, 6, 107, 2),\n    !`qualifiers/3/type/value` %in% c(5, 6, 107, 2),\n    `type/value` %in% c(1, 2, 3, 13, 14, 15, 16, 42, 50, 61))\n\nLFCTeamTouchData <- TouchData %>%\n  filter(TeamName == Match_Home)\n\nOppoTeamTouchData <- TouchData %>%\n  filter(Team_Group == Match_Away)\n\n```\n## Row\n\n```{r}\n#|height: 100%\nLFCconvexPlot1st <- TouchPlayerPlot_AI(TouchDataLFC,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1st\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n```{r pass connections homeb1}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingDataB1 \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n## Row\n```{r}\n#|height: 100%\nLFCconvexPlot1stB1 <- TouchPlayerPlot_AI(TouchDataLFCB1,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1stB1\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n```{r pass connections home b2}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingDataB2 \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n## Row\n```{r}\n#|height: 100%\nLFCconvexPlot1stB2 <- TouchPlayerPlot_AI(TouchDataLFCB2,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1stB2\n\n\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n```{r pass connections homeb3}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingDataB3 \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n\n## Row\n```{r}\n#|height: 100%\nLFCconvexPlot1stB3 <- TouchPlayerPlot_AI(TouchDataLFCB3,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1stB3\n\n\n```\n\n# EPV Analysis\n```{r EPV home time plot}\n#| output: false\n#set final plot data frame\n\n#EPV over time line plot Opta data\n#data wrangling\nEPVPlotData <- plottingData\n\nEPVPlotData <- EPVPlotData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Home_Cumalative_EPV = cumsum(EPVvalue)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Home_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Home_Cumalative_EPV = round(Home_Cumalative_EPV,2))\n\nOppoEPVPlotData <- plottingData\n\nOppoEPVPlotData <- OppoEPVPlotData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Away_Cumalative_EPV = cumsum(EPVvalue)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Away_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Away_Cumalative_EPV = round(Away_Cumalative_EPV,2))\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n\n```{r EPV home area}\n#| output: false\n#EPV Development area  plot Opta data\n#data wrangling\nEPVAreaPlotData <- plottingData\n\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  filter(Team_Group == Match_Home)\n\n#set final plot data frame\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = mean(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(isGoal, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(isGoal, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n#Oppo EPV Development area  plot Opta data\n#data wrangling\nOppoEPVAreaPlotData <- plottingData\n\nOppoEPVAreaPlotData <- OppoEPVAreaPlotData %>%\n  filter(Team_Group == Match_Away)\n\n#set final plot data frame\nOppoEPVAreaPlotData <- OppoEPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = mean(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(isGoal, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(isGoal, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n```\n\n## Row {.flow}\n\n```{r}  \n#| output: false\nEPVHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74)\n\n#set time period\nEPVHeatMapDataFT <- EPVHeatMapData\n\n# Calculte average player position\n      Average_PlayerFT <- EPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPVFT <- sum(EPVHeatMapDataFT$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFT$zone_x <- cut(EPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFT$zone_y <- cut(EPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFT <- EPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nEPVMapplotFT <- ggplot(average_epvFT, aes(x = zone_x, y = zone_y, fill = avg_epv)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PEPV, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n\n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher EPV, \\nBox figures = % of Total EPV\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_epvNZFT <- average_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZFT <- average_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPVFT,2)))  \n\n```\n\n\n```{r}\n#Oppo EPV heat plots\n#| output: false\nOppoEPVHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74)\n\n#set for time period\nOppoEPVHeatMapDataFT <- OppoEPVHeatMapData\n\n# Calculate average player position\n      OppoAverage_PlayerFT <- OppoEPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nOppoEPVFT <- sum(OppoEPVHeatMapDataFT$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFT$zone_x <- cut(OppoEPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFT$zone_y <- cut(OppoEPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFT <- OppoEPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFT,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFT <- Oppoaverage_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFT <- Oppoaverage_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPVFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nEPVHeatMapplotFT <- EPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n    #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n\n  # add zone percentage numbers\n  geom_text(data = average_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n\n   #scale_fill_paletteer_d(ColorScale_Home) +\n   scale_color_paletteer_d(ColorScale_Home) +\n#  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nEPVHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplotFT <- OppoEPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplotFT\n\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup fs\n#| output: false\n\nDefEPVData <- plottingData %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables FS\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n## Row\n```{r}\n#| height: 100%\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#first subs\n#set for time period\nOppoEPVHeatMapData1sub <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nOppoEPV1sub <- sum(OppoEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapData1sub$zone_x <- cut(OppoEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapData1sub$zone_y <- cut(OppoEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epv1sub <- OppoEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPV1sub,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZ1sub <- Oppoaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZ1sub <- Oppoaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPV1sub,2)))  \n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplot1sub <- OppoEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n    \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData  %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup win\n#| output: false\n\nDefEPVData <- plottingDataB1 %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables win\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n## Row\n```{r}\n#| height: 100%\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#first subs\n#set for time period\nOppoEPVHeatMapData1sub <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nOppoEPV1sub <- sum(OppoEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapData1sub$zone_x <- cut(OppoEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapData1sub$zone_y <- cut(OppoEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epv1sub <- OppoEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPV1sub,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZ1sub <- Oppoaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZ1sub <- Oppoaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPV1sub,2)))  \n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplot1sub <- OppoEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n    \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData  %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup draw\n#| output: false\n\nDefEPVData <- plottingDataB2 %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables draw\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n## Row\n```{r}\n#| height: 100%\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#first subs\n#set for time period\nOppoEPVHeatMapData1sub <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nOppoEPV1sub <- sum(OppoEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapData1sub$zone_x <- cut(OppoEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapData1sub$zone_y <- cut(OppoEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epv1sub <- OppoEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPV1sub,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZ1sub <- Oppoaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZ1sub <- Oppoaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPV1sub,2)))  \n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplot1sub <- OppoEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n    \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData  %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup gt\n#| output: false\n\nDefEPVData <- plottingDataB3 %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables gt\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n# PPDA Analysis\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1)\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n              caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)  %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup b1\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingDataB1 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingDataB1 %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingDataB1 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingDataB1 %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half b1\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half b1\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half b1\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half b1\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  filter(Game_State == \"Draw\")\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)  %>%\n  filter(Game_State == \"Draw\")\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup b2\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingDataB2 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingDataB2 %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingDataB2 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingDataB2 %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half b2\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half b2\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half b2\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half b2\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)  %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup B3\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingDataB3 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingDataB3 %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingDataB3 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingDataB3 %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half b3\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half b3\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half b3\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half b3\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n# xG Analysis\n\n```{r xG setup, echo:FALSE, messages:FALSE, warnings:FALSE}\n#| output: false\n#Load home data\ndashboard_data <- plottingData\n\ndashboard_data <- dashboard_data %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, minute, expandedMinute, result = type, player = playerId, Team_Group, Game_Block, Game_State)\n\n#Load away data\nOppodashboard_data <- plottingData\n\nOppodashboard_data <- Oppodashboard_data %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, minute, expandedMinute, result = type, player = playerId, Team_Group, Game_Block, Game_State)\n\n\nWinDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n\nDrawDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Draw\")\n\nGTimeDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nWinOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nDrawOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Draw\")\n\nGTimeOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n## Row\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- dashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- Oppodashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n    #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n   \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Team_Group == Match_Home)\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Team_Group == Match_Away)\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- Oppodashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"key\",\n  color = \"primary\",\n  value = \"Game State - Winning\")\n```\n\n## Row\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- WinDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- WinOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#xGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\n#xGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Away)  %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- WinDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- WinOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Draw\")\n```\n\n## Row\n\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- DrawDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- DrawOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Draw\")\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Away)  %>%\n  filter(Game_State == \"Draw\")\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- DrawDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- DrawOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\")\n```\n\n## Row\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- GTimeDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- GTimeOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Away)  %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- GTimeDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- GTimeOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n\n\n# Shot Analysis\n\n```{r shot map function}\n#| output: false\n\n#' Function for plotting shots for a team\n\nplot_shot_AI <- function(data, type = \"\", teamColor = \"#B22222\", text_color = \"\", bins = 30, highlight_goals = \"\", average_location = \"\", matchFixture = \"\", mapName = \"\", mapType = \"\", matchDate = \"\", dataSource = \"\", logo = \"\", wrap = \"\") {\n  \n  # Checking data frame   \n  if ((nrow(data) > 0) &&\n      sum(c(\"minute\", \"X\", \"Y\", \"xG\", \"result\", \"player\") %in% names(data)) == 6) {\n\n    # set plot names\n    if (dataSource == \"UnderStat\") {\n      \n      if (mapType == \"Home\") {\n      \n        home_team <- (data$home_team[nrow(data)])\n        \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"Away\") {\n      \n        away_team <- (data$away_team[nrow(data)]) \n        \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n    \n      } else if (mapType == \"Player\") {  \n      \n        last <- sub(\".* \", \"\", data$player[nrow(data)])\n        first <- sub(\" .*\", \"\", data$player[nrow(data)])\n        player_name <- paste(first, last)\n      \n        #shot_map_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n      \n    } else if (dataSource == \"FotMob\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$home_team[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$away_team[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        last <- (data$last_name[nrow(data)])\n        first <- (data$first_name[nrow(data)])\n        player_name <- paste(first, last)\n        \n        #shotshot_map_name_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n        \n    } else if (dataSource == \"Opta\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        player_name <- (data$playerId[nrow(data)])\n        \n        #shot_map_name <- paste(player, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n    }\n      \n    fixture_name <- paste(matchFixture, \"(\",dataSource,\")\")\n  \n\n    # set Plot Colours and scale\n    fill_b <- \"#E5E5E5\"\n    color_b <- \"black\"\n    colorLine <- \"#95A5A6\"\n    colorText <- \"black\"\n    fill_Goal <- c(\"No Goal\" = fill_b, \"Goal\" = teamColor)\n    \n    # Data Wrangling \n    if (dataSource == \"UnderStat\") {\n      data <- data %>%\n        mutate(X = 100 * X) %>%\n        mutate(Y = 100 * Y)\n      \n     } else if (dataSource == \"FotMob\") {\n        data <- data %>%\n             mutate(X = (X * 0.941050375),\n                    Y = (Y * 1.464079972))\n        \n     } else if (dataSource == \"Opta\") {\n        data <- data \n      }\n    \n    if (nrow(data) >= 1) {\n      data <- data %>%\n        mutate(xG = round(xG,2)) %>%\n        mutate(isGoal = ifelse(result == \"Goal\", \"Goal\", \"No Goal\")) %>%\n        mutate('Game_Period' = ifelse(minute < 16, \"0 - 15\",\n                                      ifelse(minute < 31 & minute > 15, \"16 - 30\",\n                                             ifelse(minute < 46 & minute > 30, \"31 - 45\",\n                                                    ifelse(minute < 61 & minute > 45, \"46 - 60\",\n                                                           ifelse(minute < 76 & minute > 60, \"61 - 75\",\n                                                                  ifelse(minute < 91 & minute > 75, \"76 - 90\",\n                                                                         ifelse(minute > 90, \"90 +\", \"Extra Time\"))))))))\n\n              # set the pitch up\n              plot <- data %>%\n                ggplot() +\n                annotate_pitch(dimensions = pitch_opta, colour = color_b, fill = fill_b) +\n                theme_pitch() +\n                geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                \n                # add zone numbers\n                geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE)\n              \n              # geometrics \n              if (average_location == TRUE || average_location == \"\") {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") { ## Don't highlight goals ----\n                    plot  <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), alpha = 0.7, stroke = 0.5) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\",\n                      )\n                  } else if (highlight_goals == TRUE) { ## Highlight goals ----\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, fill = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), color = color_b, shape = 21, alpha = 0.7, stroke = 0.5) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") { ## DENSITY ----\n                  plot <- plot +\n                    stat_density_2d(data = data, aes(x = X, y = Y, fill = ..level..), geom = \"polygon\", alpha = 0.7) +\n                    scale_fill_gradient(high = teamColor, low = \"#01141D\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    theme(legend.position = \"none\")\n                  \n                } else if (type == \"hexbin\") { ## HEXBIN ----\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    labs(\n                      fill = \"Count of Shots\"\n                    )\n                }\n              } else if (average_location == FALSE) {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") {\n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), alpha = 0.7, stroke = 0.5) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } else if (highlight_goals == TRUE) {\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, fill = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), color = color_b, shape = 21, alpha = 0.7, stroke = 0.5) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") {\n                  plot <- plot +\n                    stat_density_2d(data = data, aes(x = X, y = Y, fill = ..level..), geom = \"polygon\", alpha = 0.7) +\n                    scale_fill_gradient(high = teamColor, low = \"#01141D\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(fill = \"xG\")\n                  \n                  \n                } else if (type == \"hexbin\") {\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(\n                      fill = \"Count of Shots\")\n                } \n              }\n              # Make Half pitch  \n              plot <- plot +\n                coord_flip(xlim = c(50, 100),\n                           ylim = c(100, 0))\n              # formatting  \n              plot <- plot +\n                labs(title = shot_map_name, \n                     subtitle = fixture_name,\n                     caption = My_caption) +\n                \n                theme(legend.position = \"none\",\n                      legend.direction = \"horizontal\",\n                      legend.background = element_rect(fill = \"snow\"),\n                      legend.title = element_text(colour = colorText, face = \"bold\"),\n                      legend.text = element_text(colour = colorText, size = 10),\n                      legend.key = element_rect(fill = \"snow\"),\n                      plot.title = element_markdown(),\n                      plot.caption = element_markdown(),\n                      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      plot.subtitle = element_text(colour = colorText, hjust = 0, size = 10))\n              \n              # wrap or not\n              if (wrap == \"Player\") {\n                #divide stats by player\n                player_stats <- data %>%\n                  group_by(player) %>%\n                  summarize(\n                    total_xG = sum(xG),\n                    total_goal = sum(result == \"Goal\"),\n                    xg_sot = total_xG / n(),\n                    total_shots = n(),\n                    SOT = sum(result == \"Goal\" | result == \"SavedShot\")\n                  )\n\n                plot <- plot +\n                  facet_wrap(~player) +\n                  theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                        strip.text = element_text(size = 10, colour = text_color))\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 71.05, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 50, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 28.95, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 10.55, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                \n                } else if (wrap == \"Time\") {\n                  \n                  #divide stats by time period\n                  GPeriod_stats <- data %>%\n                    group_by(Game_Period) %>%\n                    summarize(\n                      total_xG = sum(xG),\n                      total_goal = sum(result == \"Goal\"),\n                      xg_sot = total_xG / n(),\n                      total_shots = n(),\n                      SOT = sum(result == \"Goal\" | result == \"SavedShot\")\n                    )\n                  \n                  \n                    plot <- plot +\n                      \n                      facet_wrap(~ Game_Period) +\n                      theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                            strip.text = element_text(size = 10, colour = text_color)) \n                    \n                    plot <- plot +\n                    geom_point(x = 54, y = 89.45, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 71.05, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 50, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 28.95, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 10.55, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                  \n              } else if (wrap == \"\") {\n                total_xG <- sum(data$xG)\n                total_goal <- sum(data$result == \"Goal\")\n                xg_sot <- total_xG / nrow(data)\n                total_shots <- nrow(data)\n                SOT <- sum(data$result == \"Goal\" | data$result == \"SavedShot\")\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 89.45, label = format(round(total_xG, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 89.45, label = \"Total xG\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 71.05, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 71.05, label = format(round(SOT, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 71.05, label = \"SOT\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 50, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 50, label = format(round(total_shots, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 50, label = \"Total Shots\", color = colorText, size = 3) +  \n                  geom_point(x = 54, y = 28.95, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 28.95, label = format(round(xg_sot, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 28.95, label = \"xG/Shot\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 10.55, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 10.55, label = format(round(total_goal, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 10.55, label = \"Goals\", color = colorText, size = 3)\n              \n                Finalplot <- plot\n              }\n              \n              # logo or not\n              if (logo == \"Yes\") {\n                \n                # annotate plot\n                Finalplot <- ggdraw() +\n                  draw_plot(plot, x = 0, y = 0, width = 1, height = , scale = 1) +\n                  draw_image(logo_AI,  x = 0.42, y = 0.45, scale = 0.07) \n                \n              } else if (logo == \"\") {\n                \n                Finalplot <- plot\n              }\n              \n              return(Finalplot)\n              \n             } else \n               {\n              ## add WARNING that there were no rows in the data frame passed into function??\n              return(plot)\n    }\n    }\n  }\n\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\nLFC_S_plot <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(Oppodashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(Oppodashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\n\n\nLFC_S_plot <- plot_shot_AI(WinDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(WinOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(WinDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(WinOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n#| height: \"100%\"\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n\n```\n\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\n\n\nLFC_S_plot <- plot_shot_AI(DrawDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(DrawOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(WinDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(WinOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\n\n\nLFC_S_plot <- plot_shot_AI(GTimeDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(GTimeOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(GTimeDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(GTimeOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```","srcMarkdownNoYaml":"\n\n```{r}\n#' Simulate Football Match Outcomes Based on xG\n#'\n#' @param home_xg_vector Numeric vector of xG values for each home team shot\n#' @param away_xg_vector Numeric vector of xG values for each away team shot\n#' @param runs Number of simulations to perform (default: 10000)\n#' @param seed Random seed for reproducibility (default: 1111)\n#'\n#' @return A list containing:\n#' - `prob_matrix`: A matrix of scoreline probabilities\n#' - `long_prob_matrix`: Data frame for plotting with ggplot\n#' - `simulation_results`: Data frame of simulated outcomes\n\n\nsimulate_match_outcomes <- function(\n  home_xg_vector, \n  away_xg_vector, \n  runs = 10000, \n  seed = 1111,\n  actual_home_goals = NULL,\n  actual_away_goals = NULL\n) {\n  set.seed(seed)\n\n  safe_simulate_goals <- function(xg_vector, runs) {\n    # Flatten in case it's a list (like from dplyr::select)\n    xg_vector <- unlist(xg_vector)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    # Clean and clip to [0, 1]\n    xg_vector <- as.numeric(xg_vector)\n    xg_vector <- xg_vector[!is.na(xg_vector)]\n    xg_vector <- pmin(pmax(xg_vector, 0), 1)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    draws <- rbinom(length(xg_vector) * runs, size = 1, prob = rep(xg_vector, each = runs))\n    goals_matrix <- matrix(draws, nrow = runs, byrow = FALSE)\n    rowSums(goals_matrix)\n  }\n\n  home_goals <- safe_simulate_goals(home_xg_vector, runs)\n  away_goals <- safe_simulate_goals(away_xg_vector, runs)\n\n  simulation_results <- data.frame(Home = home_goals, Away = away_goals)\n  prob_matrix <- table(simulation_results$Home, simulation_results$Away) / runs\n\n  long_prob_matrix <- as.data.frame(as.table(prob_matrix))\n  colnames(long_prob_matrix) <- c(\"Home\", \"Away\", \"Probability\")\n  long_prob_matrix <- long_prob_matrix %>%\n    mutate(Probability = round(Probability * 100, 2))\n\n  goal_summary <- NULL\n  if (!is.null(actual_home_goals) && !is.null(actual_away_goals)) {\n    exact_count <- sum(home_goals == actual_home_goals & away_goals == actual_away_goals)\n    at_least_home <- sum(home_goals >= actual_home_goals)\n    at_least_away <- sum(away_goals >= actual_away_goals)\n\n    goal_summary <- list(\n      actual_score = paste(actual_home_goals, \"-\", actual_away_goals),\n      exact_occurrences = exact_count,\n      exact_percentage = round(100 * exact_count / runs, 2),\n      home_goals_at_least = at_least_home,\n      away_goals_at_least = at_least_away,\n      home_goals_at_least_pct = round(100 * at_least_home / runs, 2),\n      away_goals_at_least_pct = round(100 * at_least_away / runs, 2)\n    )\n  }\n\n  return(list(\n    prob_matrix = prob_matrix,\n    long_prob_matrix = long_prob_matrix,\n    simulation_results = simulation_results,\n    goal_summary = goal_summary\n  ))\n}\n\n\n```\n\n\n\n\n```{r}\n\n# Reusable function to compute team summary metrics\ncompute_summary <- function(data, group_vars) {\n  data %>%\n    mutate(Successful_Touch = ifelse(isTouch == \"TRUE\", 1, 0),\n           TeamEPV = ifelse(str_detect(`outcomeType/value`, \"1\"), EPVvalue, 0),\n           TeamEPV = as.numeric(TeamEPV)) %>%\n    group_by(across(all_of(group_vars))) %>%\n    summarise(Match_day = first(Match_day), \n              across(c(Goals, \n                       In_play_time, \n                       Touches, \n                       UnSuccessful_Touches, \n                       PK_Box_Touches,\n                       Final_Third_Touches, \n                       Attacking_Half_Touches, \n                       Defensive_Half_Touches,\n                       Mis_Control, \n                       Dispossessed_Total, \n                       Dribbles_Total, \n                       Dribbles_Won, \n                       Dribbles_Lost,\n                       TotalShots, \n                       OFShots, \n                       Blocked_Shot, \n                       OTShots, \n                       SixYard_Box_Shots,\n                       PK_Box_Shots, \n                       Out_Box_Shots, \n                       BCs, \n                       xG, \n                       NPxG, \n                       xGOT, \n                       Attempted_Passes,\n                       Successful_Passes, \n                       UnSuccessful_Passes, \n                       Long_Passes, \n                       Successful_Long_Passes,\n                       Corners, \n                       Short_Corners, \n                       Cross_Passes, \n                       Successful_Cross, \n                       UnSuccessful_Cross,\n                       Tackles_Total, \n                       Tackles_Won, \n                       Tackles_Lost, \n                       Fouls_Total, \n                       Fouls_Conceeded,\n                       Fouls_Received, \n                       Aerial_Won, \n                       Aerial_Lost, \n                       Interceptions_Total,\n                       Recoverys_Total, \n                       Offside_Won, \n                       Offside_Lost, \n                       TeamEPV, \n                       Defensive_Third_Touches,\n                       Middle_Third_Touches, \n                      SixYard_Box_Touches, \n                      Attempted_Carries, \n                      Successful_Carries, \n                      Prog_Carries, \n                      Final_Third_Carries,\n                      Final_Third_Passes, \n                      PK_Box_Passes,\n                      Prog_Passes,\n                      Key_Passes,\n                      Assists,\n                      MyxA,\n                      TeamxT,\n                      Aerial_total, \n                      Ground_Duels_Total, \n                      Ground_Duels_Won, \n                      Ground_Duels_Lost,\n        ),\n                 sum, na.rm = TRUE)) %>%\n    mutate(In_play_time = round(In_play_time / 60, 1),\n           Possession = round((Touches/(sum(Touches)))*100,1),\n           Field_Tilt = round((Final_Third_Touches/(sum(Final_Third_Touches)))*100,1),\n           Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n           Long_Pass_Success = round((Successful_Long_Passes / Long_Passes) * 100, 1),\n           Long_Pass_Rate = round((Long_Passes / Attempted_Passes) * 100, 2),\n           Cross_Success = round((Successful_Cross / Cross_Passes) * 100, 2),\n           Failed_Pass = Attempted_Passes - Successful_Passes,\n           Failed_Cross = Cross_Passes - Successful_Cross,\n           Failed_Dribble = Dribbles_Total - Dribbles_Won,\n           Poss_Gained = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost),\n           Poss_Lost = Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble + OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost,\n           Posession_Control = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) +\n                               (Aerial_Won - Aerial_Lost) -\n                               (Mis_Control + Dispossessed_Total + UnSuccessful_Passes +\n                               UnSuccessful_Cross + Dribbles_Lost + OFShots + Blocked_Shot + Offside_Lost),\n           `EPV % xG Con.` = round((xG / TeamEPV) * 100, 1),\n           `EPV % NPxG Con.` = round((NPxG / TeamEPV) * 100, 1),\n           ) %>%\n    \n    mutate(across(everything(), ~replace_na(.x, 0))) \n  \n}\n\n```\n\n\n``` {r}\n#| label: Dashboard Setup\n#| echo: false\n#| output: false\n#| warning: false\n\nlibrary(tidyverse)\nlibrary(shiny)\nlibrary(gifski)\nlibrary(magick)\nlibrary(systemfonts)\nlibrary(sysfonts)\nlibrary(fontawesome)\nlibrary(glue)\nlibrary(worldfootballR)\nlibrary(gganimate)\nlibrary(ggsoccer)\n#library(viridis)\nlibrary(paletteer)\n#library(RColorBrewer)\nlibrary(ggpointdensity)\nlibrary(ggthemes)\nlibrary(ggtext)\nlibrary(ggiraph)\n#library(ggiraphExtra)\nlibrary(ggimage)\nlibrary(gt)\nlibrary(gtExtras)\nlibrary(grid)\nlibrary(ggdensity)\nlibrary(treemapify)\nlibrary(magick)\n#library(ggpubr)\n#library(cowplot)\nlibrary(readxl)\nlibrary(writexl)\n#library(webshot2)\nlibrary(chromote)\nlibrary(ggrepel)\nlibrary(png)\nlibrary(patchwork)\nlibrary(plotly)\nlibrary(reshape)\nlibrary(psych)\nlibrary(ggshakeR)\n#library(xtable)\nlibrary(tidyquant)\nlibrary(gfonts)\nlibrary(extrafont)\nlibrary(extrafontdb)\nlibrary(ggnewscale)\nlibrary(stringr)\nlibrary(ggh4x)\nlibrary(ggh4x)\nlibrary(ggforce)\n\n#load logos\nAI_Logo <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/UP logo.png\")\nlogo_AI <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/UP logo.png\")\nSoccerball  <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/ball1.png\")\nFootball  <- image_read(\"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\")\n\n\n#load fonts\n#set fonts\nfont_add(\"Awesome\", regular = \"/Library/Fonts/Font Awesome 7 Brands-Regular-400.otf\")\n\n#set viz location for camcorder\nVizlocation <- paste0(\"~/Documents/Dropbox files/AI LFC data/R files/AI UP/Scripts/Viz Pack/Season 2526/Specials/Oct International break\")\n\n#set oppo\nMatch_Away <- paste(\"All Oppo\")\n\n#set oppo color\nColor_Away <- paste(\"blue4\")\n\n#set oppo text\nColor_Away_Text <- paste(\"white\")\n\n#Set LFC\nMatch_Home <- paste(\"Liverpool\")\n\n#set Home color\nColor_Home <- paste(\"red4\")\n\n#set home text color\nColor_Home_Text <- paste(\"white\")\n\n#set home color scale\nColorScale_Away <- paste(\"ggsci::blue_material\")\n\n#set away color scale\nColorScale_Home <- paste(\"ggsci::red_material\")\n\n#set home color scale con\nColorScale_AwayC <- paste(\"ggthemes::Classic Blue\")\n\n#set away color scale con\nColorScale_HomeC <- paste(\"ggthemes::Classic Red\")\n\n#set match date\nGame_date1 <- paste(\"17-08-2025 to 06-10-2025\")\nGame_date2 <- paste(\"07-10-2025 to 22-05-2026\")\n\n#set data type (EPL opta and Understat, CL opta, Fa cup Opta)\nData_type <- paste(\"(Opta data)\")\n\n#set Home h/a\nHomeHA <- paste(\"Home\")\n\n#set Away h/a\nAwayHA <- paste(\"Away\") \n\n# set home and away teams\nAway_T = Match_Away\nHome_T = Match_Home\n\n#set home and away colors\nAway_Color = Color_Away\nHome_Color = Color_Home\n\n#set fixture\nMatch_Fixture <- paste0(Match_Home, \" vs \", Match_Away)\n\n#set Game name\nGameName <- paste(\"AllComp_LFC_Games_2526\")\n\n#set league points\nLeague_Points <- 18\nAFC_League_Points <- 17 \nMC_League_Points <- 17\n\n#set Waves titles\nWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\nAwayWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#set xg line titles \nxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\nAwayxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\n#set dribbles title\nDribblesTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Dribbles (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set duels title\nDuelsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set PPs title\nPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nAwayPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\n\n##new socials\nsocial_caption <- function(twitter=\"@Barts78\",\n                           github = \"Barts78\",\n                           linkedin= \"Phil-barter\",\n                           mastodon= \"@DrBarts\",\n                           threads = \"Barts78\",\n                           data = \"OPTA\",\n                           icon_color=\"black\",\n                           font_color=\"#454545\",\n                           bg_color=\"snow\",\n                           font_family=\"sans-serif\"){\n  \n  icons = list(\n    twitter = \"&#xe61a\",\n    github = \"&#xf09b\",\n    linkedin = \"&#xf08c\",\n    mastodon = \"&#xf4f6\",\n    threads = \"&#xe618\",\n    data = \"&#xf16b\"\n  )   \n  \n  social = list(threads = threads, linkedin = linkedin, twitter = twitter, mastodon = mastodon, github = github, data = data)\n  social = social[!is.na(social)]\n  \n  caption = \"\"\n  for (name in names(social)) {\n    icon = icons[name]\n    info = social[name]\n    html = glue(\"<span style='font-family:\\\"Font Awesome 7 Brands\\\";color:{icon_color};font-size:8px;'>{icon};</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\n                <span style='font-family:{font_family};color:{font_color};font-size:8px;'>{info}</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\")\n    \n    \n    caption = paste0(caption,html)\n  }\n  \n  caption\n}\n\n#create social caption\nmy_socials <- social_caption(twitter = \"@Barts78\",\n                             github = \"Barts78\",\n                             linkedin = \"Phil-barter\",\n                             mastodon = \"@DrBarts\",\n                             threads = NA,\n                             data = \"OPTA\",\n                             icon_color = \"#454545\",\n                             font_color = \"#454545\",\n                             bg_color = \"snow\",\n                             font_family = \"sans-serif\")\n\nmy_datasource <- paste0('<span style=\"font-family:\\'Font Awesome 7 Free\\', Arial, sans-serif;color:#454545;font-size:8px;\">&#x1F4BE;</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>',\n                        '<span style=\"font-family:sans-serif;color:#454545;font-size:8px;\">OPTA</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>')\n\nMy_caption <- paste0(my_socials)\n```\n\n```{r}\n#| output: false\n#| warning: false\n#load in data frames\n\nfileName <- paste0(\"~/Documents/Dropbox files/AI LFC data/Data Sets/WhoScored/Databases/\", GameName, \".xlsx\")\nplottingData <- read_xlsx(fileName)\n\n#set summary values\nTotal_EPV <- sum(plottingData$Cumalative_EPV)\nGameTime <- max(plottingData$expandedMinute)\nOutofPlayTime <- round(sum(plottingData$Out_of_play_time)/60,2)\nInPlayTime <- round(sum(plottingData$In_play_time)/60,2)\nPossession <- round(sum(plottingData$Touches),2)\nHomePossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName == Match_Home))/Possession)*100),2)\nAwayPossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName != Match_Home))/Possession)*100),2)\nHomeEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName != Match_Home & plottingData$`outcomeType/value` == 1]),2)\nHomeEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName != Match_Home & plottingData$`outcomeType/value` == 1]),2)\nHomexG <- round(sum(plottingData$xG[plottingData$TeamName == Match_Home]),2)\nAwayxG <- round(sum(plottingData$xG[plottingData$TeamName != Match_Home]),2)\nHomeNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName == Match_Home]),2)\nAwayNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName != Match_Home]),2)\nHomeBCs <- round(sum(plottingData$BCs[plottingData$TeamName == Match_Home]),0)\nAwayBCs <- round(sum(plottingData$BCs[plottingData$TeamName != Match_Home]),0)\nFinal_Third_Possession <- round(sum(plottingData$Final_Third_Touches),2)\nHomeFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName == Match_Home))/Final_Third_Possession)*100),2)\nAwayFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName != Match_Home))/Final_Third_Possession)*100),2)\nHomeDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName == Match_Home]),0)\nAwayDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName != Match_Home]),0)\nHomePasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName == Match_Home]),0)\nAwayPasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName != Match_Home]),0)\nHomePPDA <- round(sum(AwayPasses/HomeDActions),2)\nAwayPPDA <- round(sum(HomePasses/AwayDActions),2)\nHomeProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName == Match_Home]),2)\nAwayProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName != Match_Home]),2)\nHomeCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName == Match_Home]),2)\nHomeProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName == Match_Home]),2)\nAwayCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName != Match_Home]),2)\nAwayProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName != Match_Home]),2)\nHomeGoals <- round(sum(plottingData$Home_Goals),0)\nHomeSOT <- round(sum(plottingData$OTShots[plottingData$TeamName == Match_Home]),0)\nHomeShootingP <- round(sum(HomeGoals/HomeSOT), 2)\nAwayGoals <- round(sum(plottingData$Away_Goals),0)\nAwaySOT <- round(sum(plottingData$OTShots[plottingData$Team_Group == Match_Away]),0)\nAwayShootingP <- round(sum(AwayGoals/AwaySOT), 2)\nHomePPDO <- round(sum(HomeShootingP + (1 - AwayShootingP))*1000, 0)\nAwayPPDO <- round(sum(AwayShootingP + (1 - HomeShootingP))*1000, 0)\n\n#prepare first sub time data (min before sub) \nfirstSubHome <- plottingData %>%\n  filter(TeamName == Match_Home, SubTime != 0) %>%\n  summarise(firstsubhome = min(SubTime)) %>%\n  pull(firstsubhome)\n\nfirstSubAway <- plottingData %>%\n  filter(TeamName == Match_Away, SubTime != 0) %>%\n  summarise(firstsubaway = min(SubTime)) %>%\n  pull(firstsubaway)\n\n# set-up data frame from main variables above for summary tables\nPossessionTable <- data.frame(\n  TeamName = c(Match_Home, Match_Away),\n  Possession = c(HomePossession, AwayPossession))\n\nPossessionTable <- PossessionTable %>%\n  mutate(Possession = round(Possession,2))\n          \nEPVTable <- data.frame(\n  TeamName = c(Match_Home, Match_Away),\n  EPV = c(HomeEPV, AwayEPV)\n)\n\nEPVTable <- EPVTable %>%\n  mutate(EPV = round(EPV,2))\n\nFieldTiltTable <- data.frame(\n  TeamName = c(Match_Home, Match_Away),\n Field_Tilt = c(HomeFieldTilt, AwayFieldTilt))\n\nFieldTiltTable <- FieldTiltTable %>%\n  mutate(Field_Tilt = round(Field_Tilt,2))\n\nPPDOTable <- data.frame(TeamName = c(Match_Home, Match_Away),\n                         PPDO = c(HomePPDO, AwayPPDO))\n#set game block dates\nplottingData <- plottingData %>%\n  #mutate(Game_date = as.Date(Game_date, format = \"%d-%m-%y\")) %>%\n  mutate(Game_Block = case_when(\n    Game_date >= as.Date(\"01-08-2025\", format = \"%d-%m-%Y\") & Game_date <= as.Date(\"31-08-2025\", format = \"%d-%m-%Y\") ~ 1,\n    Game_date >= as.Date(\"01-09-2025\", format = \"%d-%m-%Y\") & Game_date <= as.Date(\"31-10-2025\", format = \"%d-%m-%Y\") ~ 2,\n\n    TRUE ~ NA_integer_\n  ))\n\n#add all oppo tag\nplottingData <- plottingData %>%\n  mutate(Team_Group = ifelse(TeamName == Match_Home, Match_Home, Match_Away))\n\nplottingDataB1 <- plottingData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nplottingDataB2 <- plottingData %>%\n  filter(Game_State == \"Draw\")\n\nplottingDataB3 <- plottingData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n```\n\n\n\n# Season Summary\n``` {r}\n#| output: false\n#| label: summary table setup\n#posession and goals by team\nMatchSummaryData <- compute_summary(plottingData, group_vars = c(\"Team_Group\")) \n\nMatchSummaryData <- MatchSummaryData %>%\n  select('Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryHalfData <- compute_summary(plottingData %>% mutate(Half = case_when(\n  period == 1 ~ \"First Half\",\n  period == 2 ~ \"Second Half\",\n  period == 3 ~ \"First Half Extra Time\",\n  period == 4 ~ \"Second Half Extra Time\",\n  TRUE ~ \"Injury Time\")\n), group_vars = c(\"Half\", \"Team_Group\"))\n\nMatchSummaryHalfData <- MatchSummaryHalfData %>%\n  select(Half, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryPeriodData <- compute_summary(plottingData, group_vars = c(\"Game_Period\", \"Team_Group\"))\n\nMatchSummaryPeriodData <- MatchSummaryPeriodData %>%\n  select(Game_Period, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'ONT Shots' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryGameStateData <- compute_summary(plottingData, group_vars = c(\"Game_State\", \"Team_Group\"))\n\nMatchSummaryGameStateData <- MatchSummaryGameStateData %>%\n  select(Game_State, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryGameNameData <- compute_summary(plottingData, group_vars = c(\"game_name\", \"Team_Group\"))\n\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  select('Fixture' = game_name, Match_day, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\n```\n## Row {.flow}\n```{r}\n#| results: asis\n#| label: Summary tables\nMatchSummaryTable <- MatchSummaryData %>%\n  gt(groupname_col = \"Team\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - Full Games**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(3, 14:17),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(2, 6, 19, 22, 24, 26, 30),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = Match_Away)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = Match_Home)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"#B22222\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \nMatchSummaryTable\n```\n## Row {.flow}\n```{r}\n#| results: asis\nMatchSummaryHalfsTable <- MatchSummaryHalfData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Half\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Half**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryHalfData$Half)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryHalfData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryHalfData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryHalfsTable\n```\n## Row {.flow}\n``` {r}  \n#| results: asis\n#| fig-height: 10\n#| label: Match summary by time period\n#possession and goals by time period\nMatchSummaryPeriodTable <- MatchSummaryPeriodData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_Period\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game Period**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryPeriodData$Game_Period)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryPeriodData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryPeriodData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryPeriodTable\n```\n\n## Row {.flow}\n``` {r}  \n#| results: asis\n\n#possession and goals by time period\nMatchSummaryGameStateTable <- MatchSummaryGameStateData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_State\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game State**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(5, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameStateData$Game_State)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameStateData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameStateData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameStateTable\n```\n## Row {.flow}\n``` {r}  \n#| results: asis\n\n#possession and goals by time period\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  mutate(Match_day = as.numeric(Match_day)) %>%\n  filter(!Match_day == 0) %>%\n  arrange(Match_day)\n  \n  MatchSummaryGameNameTable <- MatchSummaryGameNameData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Match_day\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Match Day**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(6, 16:19),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(4, 8, 21, 24, 26, 28, 32),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  #tab_style(\n  #  locations = cells_row_groups(groups = unique(MatchSummaryGameNameData$Match_day)),\n  #  style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  #) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == Away_T)),\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == Home_T)),\n    style = list(cell_fill(color = Color_Home),\n                cell_text(size = 16,  weight = \"bold\", color = Color_Home_Text))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameNameTable\n```\n\n```{r}\n#| output: false\n#| label: Match MC setup\n#Load data\ndashboard_data <- plottingData\n\n#Dashboard data wrangling all data\ndashboard_data <- dashboard_data %>%\n  filter(Team_Group == Match_Home) %>%\n      filter(period != 5) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period, Game_Block, Game_State, Match_day)\n\n#Oppo dashboard\n\nOppodashboard_data <- plottingData\n\nOppodashboard_data <- Oppodashboard_data %>%\n  filter(Team_Group == Match_Away) %>%\n      filter(period != 5) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period, Game_Block, Game_State, Match_day)\n\nWinDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\") %>%\n    filter(!period == 5) %>%\n  filter(!Match_day == 0)\n  \n\nDrawDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Draw\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nGTimeDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nWinOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nDrawOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Draw\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\nGTimeOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\") %>%\n    filter(period != 5) %>%\n  filter(!Match_day == 0)\n\n\nHomexGMC <- HomeShots <- dashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- Oppodashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(dashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(Oppodashboard_data$type == \"Goal\", 1, NA)))\n```\n\n```{r}\n\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMC$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMC$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrix <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrix <- as.data.frame(as.table(prob_matrix))\ncolnames(long_prob_matrix) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n#| label: Match probablity calculations\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrix[upper.tri(prob_matrix)])*100)\nHome_wins_prob <- (sum(prob_matrix[lower.tri(prob_matrix)])*100)\ntie_prob <- (sum(diag(prob_matrix))*100)\n\n# Create a data frame for bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- dashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- Oppodashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(dashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(Oppodashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- WinDashboard_data %>%\n\n  select(xG)\nAwayxGMCB1 <- AwayShots <- WinOppoDashboard_data %>%\n\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(WinDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(WinOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n#| label: Match probablity calculations block 1\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n## Column {.flow}\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n```{r}\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\", size = 4) + \n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_Plot\n```\n\n\n```{r}\n#| label: Match Result Probablity Plot\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Match Result Probablity Plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- dashboard_data\n\nOppoShotsALL <- Oppodashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 4)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n    theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- WinDashboard_data %>%\n\n  select(xG)\nAwayxGMCB1 <- AwayShots <- WinOppoDashboard_data %>%\n\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(WinDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(WinOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- WinDashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- WinOppoDashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(WinDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(WinOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#| label: Match Result Probablity Plot win\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n```\n\n\n```{r}\nMD_MC_Result_PlotB1 <- ggplot(outcome_probB1) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_PlotB1\n\n```\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- WinDashboard_data\n\nOppoShotsALL <- WinOppoDashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 2)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- DrawDashboard_data %>%\n  select(xG)\nAwayxGMCB1 <- AwayShots <- DrawOppoDashboard_data %>%\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(DrawDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(DrawOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- DrawDashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- DrawOppoDashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(DrawDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(DrawOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#| label: Match Result Probablity Plot draw\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n```\n\n\n\n```{r}\nMD_MC_Result_PlotB1 <- ggplot(outcome_probB1) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = \"\",\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_PlotB1\n\n```\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- DrawDashboard_data\n\nOppoShotsALL <- DrawOppoDashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 2)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(), \n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n\n```{r}\n#Matchday MC\nHomexGMCB1 <- HomeShots <- GTimeDashboard_data %>%\n  select(xG)\nAwayxGMCB1 <- AwayShots <- GTimeOppoDashboard_data %>%\n  select(xG)\n\nHomeTotalGoals <- sum(!is.na(ifelse(GTimeDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(GTimeOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nAwayxGMC_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nHomexGMC_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Away team\nfor (i in 1:runs) {\n  temp_game <- sapply(AwayxGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  AwayxGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- AwayTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(AwayxGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(AwayxGMC_output >= goals) # at least that many goals\n\n#table(AwayxGMC_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals Home\nfor (i in 1:runs) {\n  temp_game <- sapply(HomexGMCB1$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  HomexGMC_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- HomeTotalGoals # set number of goals you want proportion for\n\nnumber_goals <- sum(HomexGMC_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(HomexGMC_output >= goals) # at least that many goals\n\n#table(HomexGMC_output)\n\n\n# create data frame from the MC output, so converting vector into data frame\nMC_output <- data.frame(HomexGMC_output, AwayxGMC_output)\n\nMD_MC <- MC_output %>%\n  select(Home = HomexGMC_output, Away = AwayxGMC_output)\n\n\nprob_matrixB1 <- table(MD_MC$Home, MD_MC$Away) / runs\n\n\n# Assuming you have the 'prob_matrix' from the previous example\n\n# Convert probability matrix to long format for ggplot\nlong_prob_matrixB1 <- as.data.frame(as.table(prob_matrixB1))\ncolnames(long_prob_matrixB1) <- c(\"Home\", \"Away\", \"Probability\")\n\nlong_prob_matrixB1 <- long_prob_matrixB1 %>%\n  mutate(Probability = round(Probability, 2)*100)\n```\n\n```{r}\n#| output: false\n\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(prob_matrixB1[upper.tri(prob_matrixB1)])*100)\nHome_wins_prob <- (sum(prob_matrixB1[lower.tri(prob_matrixB1)])*100)\ntie_prob <- (sum(diag(prob_matrixB1))*100)\n\n# Create a data frame for bar chart\noutcome_probB1 <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_probB1 <- outcome_probB1 %>%\n  mutate(Probability = round(Probability,2))\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#calculate match actual goals\n#Matchday MC\nHomexGMC <- HomeShots <- GTimeDashboard_data %>%\n  select(xG)\nAwayxGMC <- AwayShots <- GTimeOppoDashboard_data %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(GTimeDashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(GTimeOppoDashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n```{r}\n#| label: Match Result Probablity Plot gt\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n```\n\n\n\n\n```{r}\nMD_MC_Result_PlotB1 <- ggplot(outcome_probB1) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (1000 Sims)\",\n       subtitle = \"\",\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#MD_MC_Result_PlotB1\n\n```\n\n``` {r}\n#| output: false\n#MC Season calculations for top three\n#load data\n\nLFCShotsALL <- GTimeDashboard_data\n\nOppoShotsALL <- GTimeOppoDashboard_data\n\nOppoShotsB1 <- OppoShotsALL \n\nLFCShotsB1 <- LFCShotsALL \n\n#set total goals for and against\nTotalGoals <- sum(!is.na(ifelse(LFCShotsALL$result == \"Goal\", 1, NA)))\nTotalGA <- sum(!is.na(ifelse(OppoShotsALL$result == \"Goal\", 1, NA)))\nTotalGoals_OG <- sum(!is.na(ifelse(LFCShotsALL$result == \"OwnGoal\", 1, NA)))\nTotalGA_OG <- sum(!is.na(ifelse(OppoShotsALL$result == \"OwnGoal\", 1, NA)))\n\nB1TotalGoals <- sum(!is.na(ifelse(LFCShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGA <- sum(!is.na(ifelse(OppoShotsB1$result == \"Goal\", 1, NA)))\nB1TotalGoals_OG <- sum(!is.na(ifelse(LFCShotsB1$result == \"OwnGoal\", 1, NA)))\nB1TotalGA_OG <- sum(!is.na(ifelse(OppoShotsB1$result == \"OwnGoal\", 1, NA)))\n\n\n\n#set final goal total\n\nSeason_G <- sum(TotalGoals + TotalGA_OG)\nSeason_GA <- sum(TotalGA + TotalGoals_OG)\n\nB1_G <- sum(B1TotalGoals + B1TotalGA_OG)\nB1_GA <- sum(B1TotalGA + B1TotalGoals_OG)\n\n\n\n#filter for just xg and xga\nOppoShotsSeason <- OppoShotsALL %>%\n  select(xGA = xG)\n\nLFCShotsSeason <- LFCShotsALL %>%\n  select(xG)\n\nOppoB1Shots <- OppoShotsB1 %>%\n  select(xGA = xG)\n\nLFCB1Shots <- LFCShotsB1 %>%\n  select(xG)\n\n\ncolor_mapping <- c(\"xG\" = Color_Home, \"xGA\" = Color_Away) \n\n\nMC_Title_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Liverpool Expected Goals </span>\n                 <span style='color:gray12;font-size:16px;'>(</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>For</span>\n                 <span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>and</span>\n                 <span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Against</span>\n                 <span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#Season MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nSeasonxG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoShotsSeason$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- Season_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxGA_output >= goals) # at least that many goals\n\ntable(SeasonxGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCShotsSeason$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  SeasonxG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- Season_G # set number of goals you want proportion for\n\nnumber_goals <- sum(SeasonxG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(SeasonxG_output >= goals) # at least that many goals\n\ntable(SeasonxG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nSeasonMC_Output <- data.frame(SeasonxGA_output, SeasonxG_output)\n\n\n\n#Block 1 MC\n# Set up for monte carlo --------------------------------------------------\n\n#Goals Against\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xGA_output <- numeric(runs) # makes a vector to put data in (good practice for when you start building really big simulations)\n\n#Goals for\nset.seed(1111) # if you set the same seed, you will get the same output\n\nruns = 1000; # change based on how many simulation runs you want\n\nB1xG_output <- numeric(runs)\n\n\n# monte carlo simulation --------------------------------------------------\n\n#goals Against\nfor (i in 1:runs) {\n  temp_game <- sapply(OppoB1Shots$xGA, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xGA_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (overall 17 ga, 28g, home 21g 8 ga, away 7g 9 ga)\n\ngoals <- B1_GA # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xGA_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xGA_output >= goals) # at least that many goals\n\ntable(B1xGA_output)\n\n\n# monte carlo simulation --------------------------------------------------\n#Goals For\nfor (i in 1:runs) {\n  temp_game <- sapply(LFCB1Shots$xG, function(x) rbinom(1,1,x)) # apply applies the function to each row, and gives backs the output as a vector\n  B1xG_output[i] <- sum(temp_game)\n}\n\n# proportion of certain goals -------------------------------------------- (use totals for block)\n\ngoals <- B1_G # set number of goals you want proportion for\n\nnumber_goals <- sum(B1xG_output == goals) # number of times those goals were \"scored\" out of the number of runs\n\nat_least_goals <- sum(B1xG_output >= goals) # at least that many goals\n\ntable(B1xG_output)\n\n# create data frame from the MC output, so converting vector into data frame\nB1MC_Output <- data.frame(B1xGA_output, B1xG_output)\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nx <- c(SeasonxG_output, SeasonxGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_SeasonxG <- data.frame(x, group = group)\n\n\nx <- c(B1xG_output, B1xGA_output)\ngroup <- c(rep(\"xG\", 1000), rep(\"xGA\", 1000))\ndf_B1xG <- data.frame(x, group = group)\n\nB1_Histogram_xG <- df_B1xG %>%\n  ggplot(aes(x = x, fill = group, color = group)) + \n  geom_histogram(\n    binwidth = 1, \n    alpha = 0.5, \n    position = \"identity\") +\n  scale_x_continuous(breaks = seq(0, max(x), 2)) +\n  \n  #formatting\n  scale_fill_manual(values = color_mapping) +\n  scale_color_manual(values = color_mapping) +\n  labs(title = paste(MC_Title_text),\n       subtitle = paste(\"1000 sims\"),\n       x=\"Goals\",\n       y=\"Count\", \n       caption = My_caption) +\n theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        panel.grid.major.y = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nB1_Histogram_xG\n\n```\n\n\n# Passing Analysis\n\n```{r passnetwork function, echo:FALSE, messages:FALSE, warnings:FALSE}\n#' Function for plotting pass networks\n\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  }  \n\nplot_passnet_AI <- function(data, team_name, scale_stat = \"EPV\", \n                         scale_color = \"firebrick2\", text_color = \"white\", subtitle = \"\", plot_start = \"00\", plot_finish = \"45\", logo = \"\", pitch = \"\", wrap = \"\", pressmap = \"\", passes = \"4\") {\n  \n    # Checking data frame \n    \n    if ((nrow(data) > 0) &&\n        sum(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"minute\", \"outcome\", \"Game_Period\", \"player_shirt\") %in% names(data)) == 11) {\n    } else {\n      print(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"minute\", \"outcome\", \"Game_Period\", \"player_shirt\"))\n      stop(\"The dataset has insufficient columns and/or insufficient data.\")\n    }\n    \n    # Generate error messages\n    \n    if (is.character(data$playerId) == FALSE) {\n      stop(\"The playerId column is supposed to contain player names.\")\n    }\n    \n    if (is.character(data$TeamName) == FALSE) {\n      stop(\"The TeamName column is supposed to contain team names.\")\n    }\n  \n    # full Pitch or half Pitch\n\n    if  (pitch == \"Half\") { \n      data <- data %>%\n        filter(x >= 50)\n    \n    }else if (pitch == \"Full\") {\n      data <- data\n    }\n  # exclude set pieces and throw ins\n  Pass_data <- data %>%\n    filter(Attempted_Passes == 1)\n\n      # Stat calculation\n    \n    if (scale_stat == \"xT\") {\n      \n      df <- Pass_data %>%\n        calculate_threat(type = \"opta\")\n      \n      df <- df %>%\n        mutate(xT = xTEnd - xTStart) %>%\n        select(xT)\n      df[is.na(df)] <- 0\n      \n      data$stat <- df$xT\n      \n      leg_title <- \"xT\"\n      \n    } else if (scale_stat == \"EPV\") {\n      \n      df <- Pass_data %>%\n        calculate_epv(type = \"opta\")\n      \n      df <- df %>%\n        mutate(EPV = EPVEnd - EPVStart) %>%\n        select(EPV)\n      df[is.na(df)] <- 0\n      \n      Pass_data$stat <- df$EPV\n      \n      leg_title <- \"EPV\"\n      \n    }\n    \n  # Calculate Pass percentage\n  Pass_data <- Pass_data %>%\n    replace_na(list(Attempted_Passes = 0)) %>%\n    mutate(Pass_Suc = Successful_Passes / Attempted_Passes)\n  \n  #set title text\n    PassNetTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network</span>\"))\n  \n  PassNetTitle_textD <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network & </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:14px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:14px;'>Unsuccessful</span><span style='color:gray12;font-size:14px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:14px;'>Successful</span><span style='color:gray12;font-size:14px;'>)</span>\"))\n  \n    # wrap or not\n    if (wrap == \"Yes\") {\n      \n      #calculate pressing date\n      \n      if (pressmap == \"Yes\") {\n\n        PressData <- data %>%\n          filter(TeamName == team_name) \n        \n        PressData <- PressData %>%\n          filter(Aerial_total == 1 | Ground_Duels_Total == 1)\n\n      } else if (pressmap == \"\") {\n        \n      }\n\n            plotCaption <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Links =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Size of Line = Number of links</span>\"))\n      \n      # Data Wrangling \n      \n      data1 <- Pass_data %>%\n        filter(TeamName == team_name)\n      \n      data1 <- data1[complete.cases(data1[, \"playerId\"]), ]\n      data1 <- shift_column(data = data1, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n      \n      # Nodes - Player Average Locations\n      nodes <- data1 %>% \n        group_by(playerId, player_shirt, Game_Period) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n(), stat = sum(stat)) %>% \n        na.omit()\n      \n      # Edges - Pass lines and connections between players\n      \n      edgelist <- data1 %>% \n        filter(type == \"Pass\" & outcome == \"Successful\") %>% \n        select(from = playerId, to = receiver, Game_Period) %>% \n        group_by(from, to, Game_Period) %>% \n        summarise(n = n()) %>% \n        na.omit()\n      \n      edges <- left_join(edgelist, \n                         nodes %>% select(playerId, x, y),\n                         by = c(\"from\" = \"playerId\"))\n      \n      edges <- left_join(edges, \n                         nodes %>% select(playerId, xend = x, yend = y),\n                         by = c(\"to\" = \"playerId\"))\n      \n      edges <- edges %>% \n        group_by(player1 = pmin(from, to), player2 = pmax(from, to) ,Game_Period) %>%\n        summarise(n = n[1], x = x[1], y = y[1], xend = xend[1], yend = yend[1], Game_Period = Game_Period[1])\n      \n      #match up coordinates for lines using node coordinates and by game period\n            edgescoord <- nodes\n              \n            colnames(edgescoord)[colnames(edgescoord) == \"playerId\"] <- \"player1\"\n\n            edgescoord <- edgescoord %>%  \n              mutate(player2 = player1,\n                     xend = x,\n                     yend = y)\n\n            \n            edgesnew <- edges\n            colnames(edgesnew)[colnames(edgesnew) == \"x\"] <- \"xold\"\n            colnames(edgesnew)[colnames(edgesnew) == \"y\"] <- \"yold\"\n            colnames(edgesnew)[colnames(edgesnew) == \"xend\"] <- \"xendold\"\n            colnames(edgesnew)[colnames(edgesnew) == \"yend\"] <- \"yendold\"\n\n            edgescoordp1 <- edgescoord\n            \n            edgescoordp1 <- edgescoordp1 %>%\n              select(player1, Game_Period, x, y)\n                        \n            edgesnew <- left_join(edgesnew, edgescoordp1, by = c(\"player1\" = \"player1\", \"Game_Period\" = \"Game_Period\")) \n            \n            edgescoordp2 <- edgescoord\n            \n            edgescoordp2 <- edgescoordp2 %>%\n              select(player2, Game_Period, xend, yend)\n\n            edgesnew <- left_join(edgesnew, edgescoordp2, by = c(\"player2\" = \"player2\", \"Game_Period\" = \"Game_Period\")) \n            \n            edgesnew <- edgesnew %>%\n              select(player1 = player1.x, player2, Game_Period, n, x, y, xend, yend)\n            \n            edges <- edgesnew\n                        \n      # Minimum Number of Connections\n      \n      edges <- edges %>% \n        filter(n >= passes)\n      \n      # Create Line-up Table\n      \n      nodes <- nodes %>%\n        arrange(Game_Period)\n      \n      # reduce names to surname only\n      nodes$playerId <- sub(\".* \", \"\", nodes$playerId)\n      \n      # Plot \n      \n      plot_passnet <- ggplot() +\n        \n        #setup the pitch\n        annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n        theme_pitch() +\n        geom_hline(yintercept = 21.1, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_hline(yintercept = 36.8, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_hline(yintercept = 63.2, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_hline(yintercept = 78.9, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 17, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 33.2, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 50, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 66.4, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        geom_vline(xintercept = 83, size = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n        \n        # add zone numbers\n        #geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n        #geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n        #geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n        \n        #set scale and color gradient\n        scale_size_continuous(range = c(0.5, 3)) +\n        scale_colour_gradientn(\n          colors = c(\"#FFFFF0\", scale_color),\n          values = scales::rescale(c(0, 1)), \n          breaks = scales::breaks_width(0.05), \n          name = \"EPV\") +\n        scale_fill_manual(values = c(\"#0000FF\",  \"red2\"))\n      \n      if (pressmap == \"Yes\") {\n        \n        #plot pressing data\n        plot_passnet <- plot_passnet +\n          geom_point(data = PressData, aes(x = x, y = y, group = Game_Period, fill = outcome, ), shape = 21, size = 1, show.legend = FALSE)\n        \n      } else if (pressmap == \"\") {\n        \n        plot_passnet <- plot_passnet\n      }\n      \n        #plot player connections\n        plot_passnet <- plot_passnet +\n          geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, size = n), linewidth = 0.5, colour = \"black\", alpha = 0.8, show.legend = FALSE) +\n\n        #plot player positions\n          new_scale_color() +\n          new_scale_fill() +\n          geom_point(data = nodes, aes(x, y, fill = stat), size = 3, shape = 21, colour = \"black\", stroke = 0.5) +\n\n        #plot player names\n          geom_text(data = nodes, aes(x, y, label = player_shirt), colour = \"black\", size = 1) +\n          \n        scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)), \n        breaks = scales::breaks_width(0.05), \n        name = \"EPV\") +\n        \n        #formatting\n          labs(title = PassNetTitle_text,\n               subtitle = plotCaption,\n             #subtitle = paste(subtitle,\"\\n\",plotCaption),\n             x = \"\",\n             colour = leg_title,\n             caption = My_caption) +\n          \n            theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            axis.title.x = element_text(colour = \"black\", size = 4)) +\n\n        #Wrap the plots\n          facet_wrap(~Game_Period, ncol = 4) +\n          theme(strip.text.x = element_text(face = \"bold\", size = 10, colour = text_color),\n              strip.background.x = element_rect(fill = scale_color, color = \"black\", linetype = \"solid\", linewidth = 1))\n\n    } else if (wrap == \"\") {\n      \n      #calculate pressing date\n      \n      if (pressmap == \"Yes\") {\n        \n        data <- data %>%\n          filter(between(minute, plot_start, plot_finish))\n        \n        PressData <- data %>%\n          filter(TeamName == team_name) \n        \n        PressData <- PressData %>%\n          filter(Aerial_total == 1 | Ground_Duels_Total == 1)\n\n      } else if (pressmap == \"\") {\n        \n      }\n      \n            plotCaption <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Links =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Size of Line = Number of links</span>\"))\n      \n      # Data Wrangling \n      \n      data1 <- Pass_data %>%\n        filter(TeamName == team_name)\n      \n      data1 <- data1[complete.cases(data1[, \"playerId\"]), ]\n      data1 <- shift_column(data = data1, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n      \n      # Filter for specific time period\n      data1 <- data1 %>%\n        filter(between(minute, plot_start, plot_finish))\n      \n      # Player Average Locations\n      \n      nodes <- data1 %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n(), stat = sum(stat)) %>% \n        na.omit()\n\n      # Edges number of passess between players \n      \n      edgelist <- data1 %>% \n        filter(type == \"Pass\" & outcome == \"Successful\") %>% \n        select(from = playerId, to = receiver) %>% \n        group_by(from, to) %>% \n        summarise(n = n()) %>% \n        na.omit()\n      \n      edges <- left_join(edgelist, \n                         nodes %>% select(playerId, x, y),\n                         by = c(\"from\" = \"playerId\"))\n      \n      edges <- left_join(edges, \n                         nodes %>% select(playerId, xend = x, yend = y),\n                         by = c(\"to\" = \"playerId\"))\n      \n      edges <- edges %>%\n        group_by(player1 = pmin(from, to), player2 = pmax(from, to)) %>%\n        summarise(Total_Passes = sum(n), x = x[1], y = y[1], xend = xend[1], yend = yend[1])\n      \n      #Calculate passing % for each connection\n      PassStats <- data1 %>% \n        select(player1 = playerId, player2 = receiver, Successful_Passes, Attempted_Passes) %>% \n        group_by(player1, player2) %>% \n        summarise(n = n(), Successful_Passes = sum(Successful_Passes), Attempted_Passes = sum(Attempted_Passes)) %>% \n        na.omit() %>%\n        mutate(Pass_Suc = Successful_Passes / Attempted_Passes) %>%\n        replace_na(list(Pass_Suc = 0))\n      \n      #join passing stats to main table\n      edges <- left_join(edges, PassStats %>% select(player1, player2, Pass_Suc), by = c(\"player1\" = \"player1\", \"player2\" = \"player2\")) %>%\n                replace_na(list(Pass_Suc = 1))\n      \n\n      # Minimum Number of Connections\n      edges <- edges %>% \n        filter(Total_Passes >= passes)\n      \n      # Create Line-up Table (see if you can add in pass %)\n      \n      nodes <- nodes %>%\n        arrange(events)\n      \n      nodes$playerId <- sub(\".* \", \"\", nodes$playerId)\n\n      EPVRange <- (max(nodes$stat)) * 0.7\n      \n      # Plot\n\n    plot_passnet <- ggplot() +\n      \n      #setup the pitch\n      annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n      theme_pitch() +\n      geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n      \n      # add zone numbers\n      geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      \n      #set scale and color gradient\n      scale_size_continuous(range = c(0.5, 4)) +\n      scale_fill_manual(values = c(\"#0000FF\",  \"red2\"), labels = c(\"Won\", \"Lost\"), name = \"\")\n\n\n      \n    if (pressmap == \"Yes\") {\n      \n      #plot pressing data\n      plot_passnet <- plot_passnet +\n        geom_point(data = PressData, aes(x = x, y = y, fill = outcome), shape = 21, size = 1.5, stroke = 0.5, show.legend = FALSE)\n\n    } else if (pressmap == \"\") {\n     \n      plot_passnet <- plot_passnet\n      \n    }\n      \n      #plot player connections\n    plot_passnet <- plot_passnet +\n      new_scale_color() +\n      new_scale_fill() +\n      geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, size = (Total_Passes*0.25), colour = Pass_Suc)) +\n      guides(size = \"none\") +\n\n      \n      #plot player positions\n      geom_point(data = nodes, aes(x, y, fill = stat), size = 4, shape = 21, colour = \"black\", stroke = 0.5) +\n      \n      #plot player EPV\n#      geom_point(data = nodes, aes(x, y, colour = stat), size = 7, shape = 21, fill = \"#FFFFF0\", stroke = 4) +\n      \n      #plot player names\n      geom_text(data = nodes, aes(x, y, label = player_shirt), color = if_else(nodes$stat > EPVRange, 'white', 'black'), size = 1.5) +\n      \n      # set colour\n      scale_colour_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)), \n        breaks = scales::breaks_width(0.25), \n        name = \"Passing Success %\") +\n      \n      scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)), \n        breaks = scales::breaks_width(0.05), \n        name = \"EPV\") +\n      \n      #formatting\n      labs(title = PassNetTitle_text,\n           subtitle = plotCaption,\n           x = \"\",\n           colour = leg_title,\n           caption = My_caption) +\n      theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            axis.title.x = element_text(colour = \"black\", size = 4))\n    }\n    \n    # If half pitch\n    \n    if (pitch == \"Half\") {\n      \n      plot_passnet <- plot_passnet +\n        coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n        labs(y = \" \") +\n        theme(axis.title.y = element_blank(),\n              axis.title.x = element_blank())\n      \n    } else if (pitch == \"Full\") {\n      \n      plot_passnet <- plot_passnet\n      \n    }\n    \n    # Press or not formatting\n    \n    if (pressmap == \"Yes\") {\n      \n      plot_passnet <- plot_passnet +\n\n        #formatting\n        labs(title = PassNetTitle_textD,\n             x = \"\",\n             colour = leg_title)\n      \n    } else if (pressmap == \"\") {\n      \n      plot_passnet <- plot_passnet\n    }\n\n    # logo or not\n  \n    if (logo == \"Yes\") {\n    \n    # annotate plot\n    Finalplot_passnet <- plot_passnet +\n    annotation_custom(AI_Logo, xmin = 90, xmax = 100, ymin = 105, ymax = 115) +\n      coord_cartesian(clip = \"off\") +\n      theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n    \n    } else if (logo == \"\") {\n      \n      Finalplot_passnet <- plot_passnet\n    }\n\n  return(Finalplot_passnet)\n}\n```\n\n```{r}\n#| output: false\n# Step 1: Filter successful passes open play only\nsuccessful_passes <- plottingData \nsuccessful_passesB1 <- plottingDataB1 \nsuccessful_passesB2 <- plottingDataB2 \nsuccessful_passesB3 <- plottingDataB3 \n\n# Step 2: Identify passing sequences with more than the defined level of pass\n\npassing_sequencesLFC <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppo <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\npassing_sequencesLFCB1 <- successful_passesB1 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppoB1 <- successful_passesB1 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\npassing_sequencesLFCB2 <- successful_passesB2 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppoB2 <- successful_passesB2 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\npassing_sequencesLFCB3 <- successful_passesB3 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n\npassing_sequencesOppoB3 <- successful_passesB3 %>%\n  #filter(Game_Block == 1) %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & Team_Group == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & Team_Group == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, Team_Group, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, Game_Block, period, Game_State, Match_day\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1)\n\n#tabeldata\npassing_sequencesLFC_Table <- passing_sequencesLFC %>%\n  filter(Team_Group == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesLFC_1st_Table <- passing_sequencesLFC %>%\n  filter(Team_Group == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #, \n    #Game_Block == 1\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance, Game_State) %>%\n  group_by(Pass_Chain_Length, Game_State) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance',  Game_State)\n\npassing_sequencesLFC_2nd_Table <- passing_sequencesLFC %>%\n  filter(Team_Group == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #,\n    #Game_Block == 2\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n\npassing_sequencesOppo_Table <- passing_sequencesOppo %>%\n  filter(Team_Group == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesOppo_1st_Table <- passing_sequencesOppo %>%\n  filter(Team_Group == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #,\n    #Game_Block == 1\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance, Game_State) %>%\n  group_by(Pass_Chain_Length, Game_State) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance',  Game_State)\n\npassing_sequencesOppo_2nd_Table <- passing_sequencesOppo %>%\n  filter(Team_Group == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1\n    #,\n    #Game_Block == 2\n    ) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n# Define the desired order\ndesired_order <- c(\"VLow\", \"Low\", \"Medium\", \"High\")\n\n# Arrange passing_sequencesLFC_Table\npassing_sequencesLFC_Table <- passing_sequencesLFC_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesOppo_Table\npassing_sequencesOppo_Table <- passing_sequencesOppo_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesLFC_1st_Table <- passing_sequencesLFC_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesOppo_Table\npassing_sequencesOppo_1st_Table <- passing_sequencesOppo_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesLFC_2nd_Table <- passing_sequencesLFC_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesOppo_Table\npassing_sequencesOppo_2nd_Table <- passing_sequencesOppo_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n```\n\n```{r}\n#| output: false\nZone14_Passes_LFC_Data <- plottingData %>%\n  filter(Team_Group == Match_Home,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start, Game_State, Match_day)\n\nZone14_Passes_LFC_Data <- Zone14_Passes_LFC_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_LFC_Data <- plottingData %>%\n  filter(Team_Group == Match_Home,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start, Game_State, Match_day)\n\nLHS_Passes_LFC_Data <- LHS_Passes_LFC_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_LFC_Data <- plottingData %>%\n  filter(Team_Group == Match_Home,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start, Game_State, Match_day)\n\nRHS_Passes_LFC_Data <- RHS_Passes_LFC_Data %>%\n  filter(Successful_Passes == 1)\n\nZone14_Passes_Oppo_Data <- plottingData %>%\n  filter(Team_Group == Match_Away,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start, Game_State, Match_day)\n\nZone14_Passes_Oppo_Data <- Zone14_Passes_Oppo_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_Oppo_Data <- plottingData %>%\n  filter(Team_Group == Match_Away,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start, Game_State, Match_day)\n\nLHS_Passes_Oppo_Data <- LHS_Passes_Oppo_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_Oppo_Data <- plottingData %>%\n  filter(Team_Group == Match_Away,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(Team_Group, Game_Block, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start, Game_State, Match_day)\n\nRHS_Passes_Oppo_Data <- RHS_Passes_Oppo_Data %>%\n  filter(Successful_Passes == 1)\n\n#combine data frames\nZ14_HS_Passes_LFC_Data <- bind_rows(Zone14_Passes_LFC_Data, LHS_Passes_LFC_Data, RHS_Passes_LFC_Data)\n\nZ14_HS_Passes_Oppo_Data <- bind_rows(Zone14_Passes_Oppo_Data, LHS_Passes_Oppo_Data, RHS_Passes_Oppo_Data)\n\nZ14_HS_Passes_LFC_Data <- Z14_HS_Passes_LFC_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_Oppo_Data <- Z14_HS_Passes_Oppo_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_LFC_Data <- Z14_HS_Passes_LFC_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n\nZ14_HS_Passes_Oppo_Data <- Z14_HS_Passes_Oppo_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n\n\nZ14_HS_Passes_LFC_DataB1 <- Z14_HS_Passes_LFC_Data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nZ14_HS_Passes_LFC_DataB2 <- Z14_HS_Passes_LFC_Data %>%\n  filter(Game_State == \"Draw\")\n\nZ14_HS_Passes_LFC_DataB3 <- Z14_HS_Passes_LFC_Data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nZ14_HS_Passes_Oppo_DataB1 <- Z14_HS_Passes_Oppo_Data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nZ14_HS_Passes_Oppo_DataB2 <- Z14_HS_Passes_Oppo_Data %>%\n  filter(Game_State == \"Draw\")\n\nZ14_HS_Passes_Oppo_DataB3 <- Z14_HS_Passes_Oppo_Data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n```\n\n## Row {.flow}\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n## Row {.flow}\n```{r Passnetworks home 1st half}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingData,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r home 2nd half}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingData,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_Plot <- passing_sequencesLFC %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFC$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFC$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_Plot\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_Plot <- passing_sequencesOppo %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppo$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppo$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_Plot\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_Plot <- Z14_HS_Passes_LFC_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_Plot\n```\n```{r}\nZone14_HS_Passes_Oppo_Plot <- Z14_HS_Passes_Oppo_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_Plot\n```\n\n## Row {.flow}\n```{r}\n#| label: home passing chaing tables\n#| results: asis\nHome_Passing_Chains_Table <- passing_sequencesLFC_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Full season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_Table\n\n\n```\n\n```{r}\n#| results: asis\n#| label: away passing chaing tables\nOppo_Passing_Chains_Table <- passing_sequencesOppo_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Full Season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nOppo_Passing_Chains_Table\n\n```\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingData %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName, Match_day) %>%\nmutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\", \"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  #filter(!Match_day == 0) %>%\n  filter(EPVvalue >= 0.08) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  #facet_grid(Pass_Type ~ Match_day) +\n  #facet_wrap(~ Pass_Type + Half + Match_day) +\n  #facet_wrap(vars(Pass_Type, Half, Match_day), ncol = 3) +\n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\n#ggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n    filter(EPVvalue >= 0.08) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n## Row {.flow}\n```{r Passnetworks home 1st half B1}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingDataB1,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r home 2nd half B1}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingDataB1,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_PlotB1 <- passing_sequencesLFCB1 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFCB1$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFCB1$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_PlotB1\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_PlotB1 <- passing_sequencesOppoB1 %>%\n    #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppoB1$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppoB1$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_PlotB1\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_PlotB1 <- Z14_HS_Passes_LFC_DataB1 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_PlotB1\n```\n```{r}\nZone14_HS_Passes_Oppo_PlotB1 <- Z14_HS_Passes_Oppo_DataB1 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_PlotB1\n```\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingDataB1 %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName) %>%\n  mutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n#| height: \"100%\"\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n\n```\n## Row {.flow}\n```{r}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingDataB2,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingDataB2,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_PlotB2 <- passing_sequencesLFCB2 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFCB2$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFCB2$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_PlotB2\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_PlotB2 <- passing_sequencesOppoB2 %>%\n    #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppoB2$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppoB2$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_PlotB2\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_PlotB2 <- Z14_HS_Passes_LFC_DataB2 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_PlotB2\n```\n```{r}\nZone14_HS_Passes_Oppo_PlotB2 <- Z14_HS_Passes_Oppo_DataB2 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_PlotB2\n```\n\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingDataB2 %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName) %>%\n    mutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n## Row {.flow}\n```{r}\nLFCpassPlot1stWD <- plot_passnet_AI(data = plottingDataB3,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot1stWD\n\n```\n\n```{r}\nLFCpassPlot2ndWD <- plot_passnet_AI(data = plottingDataB3,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 25)\nLFCpassPlot2ndWD\n```\n\n## Row {.flow}\n```{r}\n#passing chains all in\npassing_sequencesLFC_PlotB3 <- passing_sequencesLFCB3 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesLFCB3$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesLFCB3$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesLFC_PlotB3\n```\n\n```{r}\n#passing chains all in\npassing_sequencesOppo_PlotB3 <- passing_sequencesOppoB3 %>%\n    #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesOppoB3$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.1,\n    color = passing_sequencesOppoB3$Pchain\n  ) +\n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesOppo_PlotB3\n\n```\n## Row\n```{r}\nZone14_HS_Passes_LFC_PlotB3 <- Z14_HS_Passes_LFC_DataB3 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(\"Zone 14 and HS \", PPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_LFC_PlotB3\n```\n```{r}\nZone14_HS_Passes_Oppo_PlotB3 <- Z14_HS_Passes_Oppo_DataB3 %>%\n  #filter(Game_Block == 1) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.3, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.25) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = paste0(\"Zone 14 and HS \", AwayPPsTitle_text), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Oppo_PlotB3\n```\n\n## Row {.flow}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Data <- plottingDataB3 %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(Team_Group, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName) %>%\n    mutate(Cross_Passes = if_else(is.na(Cross_Passes), 0, Cross_Passes)) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\n\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Home) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(Team_Group == Match_Away) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.2, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row {.flow}\n```{r}\n#| results: asis\n#| label: home passing chaing tables all\nHome_Passing_Chains_Table_all <- passing_sequencesLFC_1st_Table %>%\n  gt(groupname_col = \"Game_State\") %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Full season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_Table_all\n\n\n```\n\n```{r}\n#| results: asis\n#| label: away passing chaing tables all\nOppo_Passing_Chains_Table_all <- passing_sequencesOppo_1st_Table %>%\n  gt(groupname_col = \"Game_State\") %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Full Season Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nOppo_Passing_Chains_Table_all\n\n```\n\n# Player Analysis\n\n```{r player data setup, echo:FALSE, messages:FALSE, warnings:FALSE}\n#| output: false\n#player summary tables\n#posession and goals by Player\nMatchSummaryPLayerData <- plottingData %>%\n  mutate(\n    Out_of_play_time = round(Out_of_play_time / 60, 1),\n    EventTime = round(EventTime / 60, 1),\n    TeamEPV = as.numeric(ifelse(str_detect(`outcomeType/value`, \"1\"), paste0(EPVvalue), 0))) %>%\n  group_by(TeamName, playerId, Team_Group, role) %>%\n  summarise_at(vars(Goals, TotalShots, 'OFT Shots' = OFShots, 'OT Shots' = OTShots, Out_Box_Shots, Touches, PK_Box_Touches, Attempted_Passes, Successful_Passes, TeamEPV, Key_Passes, Assists, Hockey_Assists, BCs, xG, xGOT, Aerial_total, Aerial_Won, Aerial_Lost, Ground_Duels_Total, Ground_Duels_Won, Ground_Duels_Lost), list(sum), na.rm = TRUE) %>%\n  ungroup() %>%\n  group_by(Team_Group) %>%\n  mutate(\n    Team_TotalTouches = sum(Touches),\n    Team_TotalEPV = sum(TeamEPV),\n    Team_TotalxG = sum(xG),\n    Team_TotalPasses = sum(Attempted_Passes),\n    Team_TotalDuels = sum(Ground_Duels_Total),\n    Team_TotalAerials = sum(Aerial_total),\n    Team_TotalShots = sum(TotalShots),\n    Possession = round((Touches / Team_TotalTouches) * 100, 1),\n    Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n    Aerial_Success = round((Aerial_Won / Aerial_total) * 100, 1),\n    Duel_Success = round((Ground_Duels_Won / Ground_Duels_Total) * 100, 1),\n    On_Ball_Time = round(InPlayTime * (Possession / 100), 1),\n    Team_EPV_P = round((TeamEPV / Team_TotalEPV) * 100, 1),\n    Team_xG_P = round((xG / Team_TotalxG) * 100, 1),\n    Team_Duels_P = round((Ground_Duels_Total / Team_TotalDuels) * 100, 1),\n    Team_Aerial_P = round((Aerial_total / Team_TotalAerials) * 100, 1),\n    Team_Passes_P = round((Attempted_Passes / Team_TotalPasses) * 100, 1),\n    Team_Shots_P = round((TotalShots / Team_TotalShots) * 100, 1)\n  ) %>%\n  replace_na(list( Aerial_Success = 0)) %>%\n  replace_na(list( Duel_Success = 0)) %>%\n  filter(role != is.na(role)) %>%\n  ungroup()\n\nMatchSummaryPLayerProfileData <- MatchSummaryPLayerData\n\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  select(Team = Team_Group, role, Name = playerId, '% of Team Possession' = Possession, `% of Team On Ball Time` = On_Ball_Time, Touches = Touches, 'Total Shots' = TotalShots, 'Out Box Shots' = Out_Box_Shots, BCs, Goals, xG, xGOT,  'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, Assists, 'Key Passes' = Key_Passes, EPV = TeamEPV, '% of Team EPV' = Team_EPV_P, 'Aerials Total' = Aerial_total, 'Aerials Won' = Aerial_Won, 'Aerial Success %' = Aerial_Success, 'Duels Total' = Ground_Duels_Total, 'Duels Won' = Ground_Duels_Won, 'Duel Success' = Duel_Success)\n\n\n\nPlayer_Summary_plot_data <- MatchSummaryPLayerProfileData %>%\n  select(Team = Team_Group, Name = playerId, role, '% Possession' = Possession, `% On Ball Time` = On_Ball_Time, Touches = Touches, 'Total Shots' = TotalShots, 'OFT Shots', 'OT Shots', 'Out Box Shots' = Out_Box_Shots, BCs, Goals, xG, xGOT, '% xG' = Team_xG_P, Touches, PK_Box_Touches, 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, Assists, 'Key Passes' = Key_Passes, EPV = TeamEPV, '% EPV' = Team_EPV_P, 'Aerials Total' = Aerial_total, 'Aerials Won' = Aerial_Won, 'Aerial Success %' = Aerial_Success, 'Duels Total' = Ground_Duels_Total, 'Duels Won' = Ground_Duels_Won, 'Duel Success %' = Duel_Success, '% Duels' = Team_Duels_P, '% Passes' = Team_Passes_P, '% Shots' = Team_Shots_P, '% Aerials' = Team_Aerial_P)\n\n\nPlayer_Summary_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, '% Possession', '% On Ball Time', '% EPV', '% Passes', '% Shots', '% Duels', '% Aerials') %>%\n  pivot_longer(cols = c('% Possession', '% On Ball Time', '% EPV','% Passes', '% Shots', '% Duels', '% Aerials'), names_to = \"Metric\", values_to = \"Value\")\n\n#player profile plot data\n\nPlayer_Goal_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, 'OFT Shots', 'OT Shots', 'Out Box Shots', BCs, Goals, Assists, 'Key Passes') %>%\n  pivot_longer(cols = c(`OFT Shots`, 'OT Shots', `Out Box Shots`, BCs, Goals, Assists, `Key Passes`), names_to = \"Metric\", values_to = \"Value\") \n\n#filter data by team\nPlayer_Summary_plot_data_Home <- Player_Summary_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Summary_plot_data_Away <- Player_Summary_data %>%\n  filter(Team == Match_Away) \n\nPlayer_Goal_plot_data_Home <- Player_Goal_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Goal_plot_data_Away <- Player_Goal_data %>%\n  filter(Team == Match_Away) \n\n\n#work out team and unit averages\n#general metrics\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\ngroup_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n#goal metrics\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n\n\n#wrap the tiles for the general plot\nPlayer_Summary_data_Home$Metric  <- str_wrap(Player_Summary_data_Home$Metric, width = 5)  \n\nPlayer_Summary_data_Away$Metric  <- str_wrap(Player_Summary_data_Away$Metric, width = 5)  \n\n\n#wrap the tiles for the goal plot\nPlayer_Goal_data_Home$Metric  <- str_wrap(Player_Goal_data_Home$Metric, width = 5)  \n\nPlayer_Goal_data_Away$Metric  <- str_wrap(Player_Goal_data_Away$Metric, width = 5)  \n\n\n#reorder data\nfacet_order <- c(\"Keeper\", \"Defender\", \"Midfielder\", \"Attacker\")\n\n#general plot\nPlayer_Summary_data_Home  <- Player_Summary_data_Home  %>%\narrange(factor(role, levels = facet_order))\n\nPlayer_Summary_data_Away  <- Player_Summary_data_Away  %>%\n  arrange(factor(role, levels = facet_order))\n\n#goal plot\nPlayer_Goal_data_Home <- Player_Goal_data_Home %>%\n  arrange(factor(role, levels = facet_order))\n\nPlayer_Goal_data_Away <- Player_Goal_data_Away %>%\n  arrange(factor(role, levels = facet_order))\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n## Row\n```{r}\n#| results: asis\nMatchSummaryPlayerTableHome <- MatchSummaryPLayerData %>%\n  filter(Team == Match_Home) %>%\n  gt(groupname_col = \"role\", rowname_col = \"Name\") %>%\n  #row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Attacker\")) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  #cols_hide(Player) %>%\n  #gt_img_rows(columns = Player, height = 25) %>%\n#  gt_img_circle(column = 'Player', height = 40, border_color = \"black\", border_weight = 1.5) %>%\n#  cols_width(Player ~ px(45)) %>% # 110 = 100 (height) + 10 (padding around imgs)\n  summary_rows(columns = c(5:25), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:25), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(4:5, 5, 15, 19, 22, 25),\n    scale_values = FALSE,\n    decimals = 1\n  ) %>%\n  fmt_number(\n    columns = c(18),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Shots\", columns = c(9:12)) %>%\n  tab_spanner(label = \"Passes\", columns = c(13:19)) %>%\n  tab_spanner(label = \"Duels\", columns = c(20:25)) %>%\n  #tab_style(\n  #  style = cell_text(color = \"#E5E5E5\"),\n  #  locations = cells_column_labels('Player')) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  gt_color_rows(columns = c(5), palette = ColorScale_Home, domain = c(0,15)) %>%\n  gt_color_rows(columns = c(7, 6, 13, 14, 15, 19, 22, 25), palette = ColorScale_Home, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(7, 20, 24), palette = ColorScale_Home, domain = c(0,10)) %>%\n  gt_color_rows(columns = c(8:10, 16:17), palette = ColorScale_Home, domain = c(0,5)) %>%\n  gt_color_rows(columns = c(21, 23), palette = ColorScale_Home, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(18), palette = ColorScale_Home, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(11:12), palette = ColorScale_Home, domain = c(0,3))\n\nMatchSummaryPlayerTableHome\n\n```\n\n\n```{r}\n#| results: asis\nMatchSummaryPlayerTableAway <- MatchSummaryPLayerData %>%\n  filter(Team == Match_Away) %>%\n  gt(groupname_col = \"role\", rowname_col = \"Name\") %>%\n  #row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Attacker\")) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  #cols_hide(Player) %>%\n  #gt_img_rows(columns = Player, height = 25) %>%\n#  gt_img_circle(column = 'Player', height = 40, border_color = \"black\", border_weight = 1.5) %>%\n#  cols_width(Player ~ px(45)) %>% # 110 = 100 (height) + 10 (padding around imgs)\n  summary_rows(columns = c(4:25), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(4:25), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(4:5, 5, 15, 19, 22, 25),\n    scale_values = FALSE,\n    decimals = 1\n  ) %>%\n  fmt_number(\n    columns = c(18),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:12)) %>%\n  tab_spanner(label = \"Passes\", columns = c(13:19)) %>%\n  tab_spanner(label = \"Duels\", columns = c(20:25)) %>%\n  #tab_style(\n  #  style = cell_text(color = \"#E5E5E5\"),\n  #  locations = cells_column_labels('Player')) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  gt_color_rows(columns = c(5), palette = ColorScale_Away, domain = c(0,15)) %>%\n  gt_color_rows(columns = c(5, 6, 13, 14, 15, 19, 22, 25), palette = ColorScale_Away, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(7, 19, 24), palette = ColorScale_Away, domain = c(0,10)) %>%\n  gt_color_rows(columns = c(8:10, 16:17), palette = ColorScale_Away, domain = c(0,5)) %>%\n  gt_color_rows(columns = c(21, 23), palette = ColorScale_Away, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(18), palette = ColorScale_Away, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(11:12), palette = ColorScale_Away, domain = c(0,3))\n\n#MatchSummaryPlayerTableAway\n```\n\n\n```{r pass connections home}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingData \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n\n\n```{r}\n#| output: false\n#' Function for plotting Player touch areas\n#' Function for plotting Team touch areas - set at 75%\n\n#calculate touch area of player - set at 75% using quantiles\ntouch_area_shape <- function(data) {\n  \n  x_low <- quantile(data$x, 0.15)\n  x_high <- quantile(data$x, 0.85)\n  \n  y_low <- quantile(data$y, 0.15)\n  y_high <- quantile(data$y, 0.85)\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n#calculate touch area of player - set at 1.5 MAD (75% of data) using medians\ntouch_area_shape_mad <- function(data) {\n  \n  x_median <- median(data$x)\n  y_median <- median(data$y)\n  \n  x_mad <- median(abs(data$x - x_median))/0.6745\n  y_mad <- median(abs(data$y - y_median))/0.6745\n  \n  x_low <- x_median - 1.5*x_mad\n  x_high <- x_median + 1.5*x_mad\n  \n  y_low <- y_median - 1.5*y_mad\n  y_high <- y_median + 1.5*y_mad\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n#Main function\nTouchPlayerPlot_AI <- function(data, \n                            color = \"firebrick4\", text_color = \"\", title = \"\", subtitle = \"\", plot_start = \"0\", plot_finish = \"45\", logo = \"\") {\n  \n    if (nrow(data) > 0 &&\n        sum(x = c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"minute\", \"Game_Period\", \"role\") %in% names(data)) == 8) {\n    } else {\n      print(c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\"))\n      stop(\"The dataset has insufficient columns and/or insufficient data.\")\n    }\n    \n    data <- data %>%\n      filter(!`qualifiers/0/type/value` == 2, \n        !`qualifiers/0/type/value` == 6, #corner\n        !`qualifiers/0/type/value` == 5, #free kick\n        !`qualifiers/0/type/value` == 107, #throw in\n        !`qualifiers/1/type/value` == 2, \n        !`qualifiers/1/type/value` == 6,\n        !`qualifiers/1/type/value` == 5,\n        !`qualifiers/1/type/value` == 107,\n        !`qualifiers/2/type/value` == 2, \n        !`qualifiers/2/type/value` == 6,\n        !`qualifiers/2/type/value` == 5,\n        !`qualifiers/2/type/value` == 107,\n        !`qualifiers/3/type/value` == 2, \n        !`qualifiers/3/type/value` == 6,\n        !`qualifiers/3/type/value` == 5,\n        !`qualifiers/3/type/value` == 107,\n        `type/value` == 1 & `outcomeType/value` == 1 |\n          `type/value` == 2 & `outcomeType/value` == 1 | \n          `type/value` == 3 & `outcomeType/value` == 1 |\n          `type/value` == 4 & `outcomeType/value` == 1 |\n          `type/value` == 9 |\n          `type/value` == 7 |\n          `type/value` == 8 |\n          `type/value` == 10 |\n          `type/value` == 11 |\n          `type/value` == 12 |\n          `type/value` == 13 |\n          `type/value` == 14 |\n          `type/value` == 15 |\n          `type/value` == 16 |\n          `type/value` == 41 |\n          `type/value` == 44 |\n          `type/value` == 42 |\n          `type/value` == 45 |\n          `type/value` == 50 |\n          `type/value` == 52 |\n          `type/value` == 54 |\n          `type/value` == 61 |\n          `type/value` == 73 |\n          `type/value` == 74) \n    \n    data <- data %>%\n      drop_na(playerId, x, y) %>%\n      filter(between(minute, plot_start, plot_finish))\n  \n  list_data <- split(data, data$playerId)\n  \n  touch_area_data <- list_data %>%\n    purrr::map(touch_area_shape) %>%\n    purrr::reduce(full_join)\n  \n  #calculate average position\n  PlayerPos <- touch_area_data\n  \n  PlayerPos <- PlayerPos %>% \n    group_by(playerId) %>% \n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE)) %>% \n    na.omit()\n  \n  teamtitle <- paste(title,\"Player Touch Areas\")\n  \n  #canvas  \n  player_touch_map <- ggplot(touch_area_data) +\n    \n    #setup Pitch\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    \n    # add zone numbers\n    geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n    geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n    geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n    \n    #geometrics\n    geom_point(data = data, aes(x = x, y = y), alpha = 0.5, colour = \"black\", size = 1) +\n    geom_polygon(aes(x = x, y = y), colour = color, alpha = 0.2, fill = color, size = 0.8) +\n    #stat_density_2d(aes(x = x, y = y, color = after_stat(level), fill = after_stat(level)),geom = \"polygon\", alpha = 0.4, linewidth = 1) +\n    \n    #plot player average position\n    geom_point(data = PlayerPos, aes(x = x, y = y), colour = color, alpha = 0.8, shape = 19, size = 1) +\n    \n    #Wrap or not\n#    facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Attacker\")) + playerId, ncol = 5) +\n    facet_wrap(~ playerId, nrow = 3) +\n    \n    #formatting\n    labs(title = teamtitle,\n         x = \"\",\n         caption = My_caption,\n         subtitle = paste(subtitle,\"\\nArea = 75% of activity, Team Colour Dot = Player Average Position\")) +\n    theme(legend.position = \"none\",\n          plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n          panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n          strip.background = element_rect(fill = color, color = \"black\", linetype = \"solid\", linewidth = 1),\n          strip.text = element_text(size = 4, colour = text_color),\n          plot.title = element_text(colour = \"black\", size = 10, face = \"bold\"),\n          plot.subtitle = element_text(colour = \"black\", size = 8),\n          plot.caption = element_markdown(),\n          axis.title.x = element_blank())\n\n\n  \n  \n  if (logo == \"Yes\") {\n    \n  #Annotate Plot\n  player_touch_mapAI <- ggdraw() +\n    draw_plot(player_touch_map, x = 0, y = 0, width = 1, height = , scale = 1) +\n    draw_image(logo_AI,  x = 0.445, y = 0.438, scale = 0.12) \n#    draw_image(logo_AI,  x = 0.3, y = 0.45, scale = 0.06) \n  \n  } else if (logo == \"\") {\n    player_touch_mapAI <- player_touch_map\n  }\n  \n  return(player_touch_mapAI)\n}\n  \n\n```\n\n```{r}\n# Enhanced TouchTeamPlot_OPTA with method selection\nTouchTeamPlot_OPTA <- function(\n  data,\n  color = \"#E74C3C\",\n  title = \"\",\n  subtitle = \"\",\n  plot_start = 0,\n  plot_finish = 45,\n  logo = \"\",\n  method = \"mad\"  # or \"quantile\"\n) {\n  required_cols <- c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"expandedMinute\", \"Game_Period\", \"file_name\", \"role\")\n  if (nrow(data) == 0 || !all(required_cols %in% names(data))) {\n    stop(\"The dataset has insufficient columns and/or insufficient data.\")\n  }\n\n  data <- data %>%\n    drop_na(playerId, x, y) %>%\n    filter(between(expandedMinute, plot_start, plot_finish))\n\n  shape_fn <- if (method == \"quantile\") touch_area_shapenonmad else touch_area_shape\n\n  list_data <- split(data, data$playerId)\n  touch_area_data <- purrr::map(list_data, shape_fn) %>% purrr::reduce(full_join)\n\n  PlayerPos <- touch_area_data %>%\n    group_by(playerId) %>%\n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), .groups = \"drop\") %>%\n    na.omit()\n\n  teamtitle <- paste(title, \"Areas\")\n\n  touch_map <- ggplot(touch_area_data) +\n    scale_color_paletteer_d(palette = \"tvthemes::gravityFalls\") +\n    scale_fill_paletteer_d(palette = \"tvthemes::gravityFalls\") +\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 4, color = \"grey\") +\n    geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 4, color = \"grey\") +\n    geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 4, color = \"grey\") +\n    geom_polygon(aes(x = x, y = y, fill = playerId, colour = playerId), alpha = 0.15, size = 0.5) +\n    geom_point(data = PlayerPos, aes(x = x, y = y, fill = playerId, colour = playerId), alpha = 0.7, shape = 21, size = 3, stroke = 0.5) +\n    geom_text(data = PlayerPos, aes(x = x, y = y + 4, label = playerId, colour = playerId), size = 2.5) +\n    labs(\n      title = teamtitle,\n      subtitle = paste(subtitle, \"\nArea = 75% of activity, Dot = Player Average Position\"),\n      caption = My_caption,\n      x = \"\"\n    ) +\n    theme(\n      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      strip.background = element_rect(fill = \"#E5E5E5\", colour = NA),\n      strip.text = element_text(colour = \"black\", size = 10),\n      plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n      plot.subtitle = element_text(colour = \"black\", size = 10),\n      plot.caption = element_markdown(),\n      axis.title.x = element_text(colour = \"black\", size = 12, face = \"bold\"),\n      legend.position = \"none\"\n    )\n\n  if (logo == \"Yes\") {\n    touch_mapAI <- ggdraw() +\n      draw_plot(touch_map, x = 0, y = 0, width = 1, scale = 1) +\n      draw_image(logo_AI, x = 0.4, y = 0.45, scale = 0.07)\n  } else {\n    touch_mapAI <- touch_map\n  }\n\n  return(touch_mapAI)\n}\n\n#| output: false\n#' Function for plotting Team touch areas\n\n#calculate touch area of player - set at 75% using quantiles- chnage to 70%\ntouch_area_shapenonmad <- function(data) {\n  \n  x_low <- quantile(data$x, 0.15)\n  x_high <- quantile(data$x, 0.85)\n  \n  y_low <- quantile(data$y, 0.15)\n  y_high <- quantile(data$y, 0.85)\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n#calculate touch area of player - set at 1 MAD (60% of data) using medians\ntouch_area_shape <- function(data) {\n  \n  x_median <- median(data$x)\n  y_median <- median(data$y)\n  \n  x_mad <- median(abs(data$x - x_median))/0.6745\n  y_mad <- median(abs(data$y - y_median))/0.6745\n  \n  x_low <- x_median - 1*x_mad\n  x_high <- x_median + 1*x_mad\n  \n  y_low <- y_median - 1*y_mad\n  y_high <- y_median + 1*y_mad\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n```\n\n\n```{r}\n#| output: false\n#| #' dribbles and duels data setup\n\nheatmapdata <- plottingData \n\nDribblesmapdata <- heatmapdata %>%\n  filter(Dribbles_Total == 1) %>%\n  mutate(DribblesFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DribblesFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName, Team_Group, teamId, playerId, player_shirt, #player_image_url, \n         playerNumber, role,  x, y, DribblesFinalX, DribblesFinalY, outcome, Game_Period )\n\n\n#duels aerial and ground data\nDuelsmapdata <- heatmapdata\n  \nDuelsmapdata <- heatmapdata %>%\n  filter(Ground_Duels_Total == 1 |\n           Aerial_total == 1) %>%\n  mutate(DuelsFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DuelsFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName,Team_Group, teamId, playerId, player_shirt, #player_image_url, \n         playerNumber, role, x, y, DuelsFinalX, DuelsFinalY, outcome, Game_Period )\n\n\n#Liverpool duels data\nLFCDuelsmapdata <- Duelsmapdata %>%\n  filter(Team_Group == Match_Home)\n\n#Oppo duels data\nOppoDuelsmapdata <- Duelsmapdata %>%\n  filter(Team_Group == Match_Away)\n\n#Home Dribbles Data\nLFCDribblesmapdata <- Dribblesmapdata %>%\n  filter(Team_Group == Match_Home)\n\n#Away Dribbles Data\nOppoDribblesmapdata <- Dribblesmapdata %>%\n  filter(Team_Group == Match_Away)\n\n#PLayer touch data \nTouchDataLFC <- plottingData %>%\n  filter(Team_Group == Match_Home)\n\nTouchDataLFCB1 <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nTouchDataLFCB2 <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n           filter(Game_State == \"Draw\")\n\nTouchDataLFCB3 <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nTouchDataOppo <- plottingData %>%\n  filter(Team_Group == Match_Away)\n\n#LFC TEAM Touch zones\nTouchData <- plottingData %>%\n  filter(!`qualifiers/0/type/value` %in% c(5, 6, 107, 2),\n    !`qualifiers/1/type/value` %in% c(5, 6, 107, 2),\n    !`qualifiers/2/type/value` %in% c(5, 6, 107, 2),\n    !`qualifiers/3/type/value` %in% c(5, 6, 107, 2),\n    `type/value` %in% c(1, 2, 3, 13, 14, 15, 16, 42, 50, 61))\n\nLFCTeamTouchData <- TouchData %>%\n  filter(TeamName == Match_Home)\n\nOppoTeamTouchData <- TouchData %>%\n  filter(Team_Group == Match_Away)\n\n```\n## Row\n\n```{r}\n#|height: 100%\nLFCconvexPlot1st <- TouchPlayerPlot_AI(TouchDataLFC,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1st\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n```{r pass connections homeb1}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingDataB1 \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n## Row\n```{r}\n#|height: 100%\nLFCconvexPlot1stB1 <- TouchPlayerPlot_AI(TouchDataLFCB1,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1stB1\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n```{r pass connections home b2}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingDataB2 \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n## Row\n```{r}\n#|height: 100%\nLFCconvexPlot1stB2 <- TouchPlayerPlot_AI(TouchDataLFCB2,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1stB2\n\n\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n```{r pass connections homeb3}\n#| output: false\n# this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\nPassConnections <- plottingDataB3 \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n# number of passess between players\nPassConnections <- PassConnections %>%\n  filter(type == \"Pass\") %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 50) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, EPV_P_Pass)\n```\n\n## Row\n```{r}\n#| results: asis\n#Home pass connextions tables\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(3),\n    scale_values = FALSE,\n    decimals = 1\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 50 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n\n## Row\n```{r}\n#|height: 100%\nLFCconvexPlot1stB3 <- TouchPlayerPlot_AI(TouchDataLFCB3,  title = Match_Home,\n                                    plot_start = 00, plot_finish = 100, color = Color_Home, text_color = Color_Home_Text,\n                                    subtitle = paste0(Match_Fixture))\nLFCconvexPlot1stB3\n\n\n```\n\n# EPV Analysis\n```{r EPV home time plot}\n#| output: false\n#set final plot data frame\n\n#EPV over time line plot Opta data\n#data wrangling\nEPVPlotData <- plottingData\n\nEPVPlotData <- EPVPlotData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Home_Cumalative_EPV = cumsum(EPVvalue)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Home_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Home_Cumalative_EPV = round(Home_Cumalative_EPV,2))\n\nOppoEPVPlotData <- plottingData\n\nOppoEPVPlotData <- OppoEPVPlotData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Away_Cumalative_EPV = cumsum(EPVvalue)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Away_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Away_Cumalative_EPV = round(Away_Cumalative_EPV,2))\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n\n```{r EPV home area}\n#| output: false\n#EPV Development area  plot Opta data\n#data wrangling\nEPVAreaPlotData <- plottingData\n\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  filter(Team_Group == Match_Home)\n\n#set final plot data frame\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = mean(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(isGoal, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(isGoal, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n#Oppo EPV Development area  plot Opta data\n#data wrangling\nOppoEPVAreaPlotData <- plottingData\n\nOppoEPVAreaPlotData <- OppoEPVAreaPlotData %>%\n  filter(Team_Group == Match_Away)\n\n#set final plot data frame\nOppoEPVAreaPlotData <- OppoEPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = mean(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(isGoal, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(isGoal, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n```\n\n## Row {.flow}\n\n```{r}  \n#| output: false\nEPVHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74)\n\n#set time period\nEPVHeatMapDataFT <- EPVHeatMapData\n\n# Calculte average player position\n      Average_PlayerFT <- EPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPVFT <- sum(EPVHeatMapDataFT$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFT$zone_x <- cut(EPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFT$zone_y <- cut(EPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFT <- EPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nEPVMapplotFT <- ggplot(average_epvFT, aes(x = zone_x, y = zone_y, fill = avg_epv)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PEPV, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n\n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher EPV, \\nBox figures = % of Total EPV\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_epvNZFT <- average_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZFT <- average_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPVFT,2)))  \n\n```\n\n\n```{r}\n#Oppo EPV heat plots\n#| output: false\nOppoEPVHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74)\n\n#set for time period\nOppoEPVHeatMapDataFT <- OppoEPVHeatMapData\n\n# Calculate average player position\n      OppoAverage_PlayerFT <- OppoEPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nOppoEPVFT <- sum(OppoEPVHeatMapDataFT$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFT$zone_x <- cut(OppoEPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFT$zone_y <- cut(OppoEPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFT <- OppoEPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFT,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFT <- Oppoaverage_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFT <- Oppoaverage_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPVFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nEPVHeatMapplotFT <- EPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n    #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n\n  # add zone percentage numbers\n  geom_text(data = average_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n\n   #scale_fill_paletteer_d(ColorScale_Home) +\n   scale_color_paletteer_d(ColorScale_Home) +\n#  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nEPVHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplotFT <- OppoEPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplotFT\n\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup fs\n#| output: false\n\nDefEPVData <- plottingData %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables FS\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n## Row\n```{r}\n#| height: 100%\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#first subs\n#set for time period\nOppoEPVHeatMapData1sub <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nOppoEPV1sub <- sum(OppoEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapData1sub$zone_x <- cut(OppoEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapData1sub$zone_y <- cut(OppoEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epv1sub <- OppoEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPV1sub,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZ1sub <- Oppoaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZ1sub <- Oppoaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPV1sub,2)))  \n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplot1sub <- OppoEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n    \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData  %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup win\n#| output: false\n\nDefEPVData <- plottingDataB1 %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables win\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n## Row\n```{r}\n#| height: 100%\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#first subs\n#set for time period\nOppoEPVHeatMapData1sub <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nOppoEPV1sub <- sum(OppoEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapData1sub$zone_x <- cut(OppoEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapData1sub$zone_y <- cut(OppoEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epv1sub <- OppoEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPV1sub,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZ1sub <- Oppoaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZ1sub <- Oppoaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPV1sub,2)))  \n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplot1sub <- OppoEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n    \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData  %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Draw\")\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup draw\n#| output: false\n\nDefEPVData <- plottingDataB2 %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables draw\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n## Row\n```{r}\n#| height: 100%\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#first subs\n#set for time period\nOppoEPVHeatMapData1sub <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nOppoEPV1sub <- sum(OppoEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapData1sub$zone_x <- cut(OppoEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapData1sub$zone_y <- cut(OppoEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epv1sub <- OppoEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPV1sub,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZ1sub <- Oppoaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZ1sub <- Oppoaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/OppoEPV1sub,2)))  \n```\n\n```{r}\n#| height: 100%\nOppoEPVHeatMapplot1sub <- OppoEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n    \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nOppoEPVHeatMapplot1sub\n```\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData  %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#wrapped for time period\nOppoEPVHeatMapDataFTW <- OppoEPVHeatMapData %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n\n#set EPV total for time period\nOppoEPVFTW <- sum(OppoEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nOppoEPVFTGP <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nOppoEPVHeatMapDataFTW$zone_x <- cut(OppoEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nOppoEPVHeatMapDataFTW$zone_y <- cut(OppoEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nOppoaverage_epvFTW <- OppoEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/OppoEPVFTW,3)) \n\n#calculate for combined tile and heat map\nOppoaverage_epvNZFTW <- Oppoaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%\n  left_join(OppoEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nOppoaverage_epvNZFTW <- Oppoaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nOppoEPVHeatMapplotFTW <- OppoEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone percentage numbers\n  geom_text(data = Oppoaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nOppoEPVHeatMapplotFTW\n```\n\n## Row {.flow}\n``` {r}\n#| label: EPV defensive values setup gt\n#| output: false\n\nDefEPVData <- plottingDataB3 %>%\n    filter(!`qualifiers/0/type/value` == 2, \n         !`qualifiers/0/type/value` == 6, #corner\n         !`qualifiers/0/type/value` == 5, #free kick\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 2, \n         !`qualifiers/1/type/value` == 6,\n         !`qualifiers/1/type/value` == 5,\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 2, \n         !`qualifiers/2/type/value` == 6,\n         !`qualifiers/2/type/value` == 5,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 2, \n         !`qualifiers/3/type/value` == 6,\n         !`qualifiers/3/type/value` == 5,\n         !`qualifiers/3/type/value` == 107,\n         `type/value` == 1 & `outcomeType/value` == 1 |\n           `type/value` == 2 & `outcomeType/value` == 1 | \n           `type/value` == 3 & `outcomeType/value` == 1 |\n           `type/value` == 4 & `outcomeType/value` == 1 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"Def_EPV\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(Team_Group, TeamName, playerId, EPVvalue, Defensive_Action, outcome, Def_EPV, role) %>%\n  mutate(Successful_Def_EPV = ifelse(str_detect(outcome, \"Successful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Unsuccessful_Def_EPV = ifelse(str_detect(outcome, \"Unsuccessful\"), paste0(Def_EPV), 0)) %>%\n  mutate(Successful_Def_EPV = as.numeric(Successful_Def_EPV)) %>%\n  mutate(Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nAwayDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Away) \n\nHomeDefEPVData <- DefEPVData %>%\n  filter(Team_Group == Match_Home)\n\n#set EPV total for time period\nHomeEPVFT <- sum(HomeDefEPVData$EPVvalue)\nAwayEPVFT <- sum(AwayDefEPVData$EPVvalue)\n\n\n  \nHomeDefEPVData <- HomeDefEPVData %>%  \n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/AwayEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/AwayEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\n\n\n\n\nAwayDefEPVData <- AwayDefEPVData %>%\n  mutate(Percent_of_Attacking_Team_total = round(Def_EPV/HomeEPVFT,3)) %>%\n  mutate(Percent_of_Attacking_Team_Succ = round(Successful_Def_EPV/HomeEPVFT,3)) %>%\n  #mutate(Percent_of_Attacking_Team_UnSucc = round(Unsuccessful_Def_EPV/AwayEPVFT,3))\n  mutate(Percent_of_Attacking_Team_UnSucc = round(1- Percent_of_Attacking_Team_Succ,3)) \n\nHomeDefEPVTable <- HomeDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\nAwayDefEPVTable <- AwayDefEPVData %>%\n    group_by(Player = playerId, role) %>% \n  summarise(EPV_Faced = sum(Def_EPV+EPVvalue), Percent_Attacking_Team_EPV = sum(Percent_of_Attacking_Team_total), EPV_Won = sum(Successful_Def_EPV/EPV_Faced), EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .))\n\n```\n\n## Column {.flow}\n```{r}\n#| label: Home Defensive EPV performance tables gt\n#| results: asis\n\nHomeDefEPVTable_Final <- HomeDefEPVTable %>%\n  gt(groupname_col = 'role') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  row_group_order(groups = c(\n    #\"Keeper\", \n    \"Defender\", \n    \"Midfielder\"\n    #, \"Forward\"\n    )) %>%\n  fmt_percent(\n    columns = c(4),\n    scale_values = TRUE,\n    decimals = 2\n   ) %>%\n    fmt_percent(\n    columns = c(5, 6),\n    scale_values = TRUE,\n    decimals = 0\n   ) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  grand_summary_rows(columns = c(3), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =3))) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Defensive Actions EPV Performance\")),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nHomeDefEPVTable_Final\n```\n\n# PPDA Analysis\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1)\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n              caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)  %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup b1\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingDataB1 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingDataB1 %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingDataB1 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingDataB1 %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half b1\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half b1\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half b1\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half b1\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n```\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  filter(Game_State == \"Draw\")\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)  %>%\n  filter(Game_State == \"Draw\")\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup b2\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingDataB2 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingDataB2 %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingDataB2 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingDataB2 %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half b2\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half b2\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half b2\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half b2\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1)  %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 5) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup B3\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingDataB3 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingDataB3 %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingDataB3 %>%\n  select(period, period_displayName, Team_Group, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,Team_Group == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"Team_Group\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingDataB3 %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 1st Half b3\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 1st Half b3\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#| label: Home Post DA Plot 2nd Half b3\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| label: Away Post DA Plot 2nd Half b3\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\",\n           EPVvalue >= 0.01) \n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = 21.1, yend = 21.1, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 36.8, yend = 36.8, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 63.2, yend = 63.2, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 78.9, yend = 78.9, x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 17, xend = 17, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 33.2, xend = 33.2, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 50, xend = 50, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 66.4, xend = 66.4, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  annotate(\"segment\", y = 0, yend = 100, x = 83, xend = 83, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n# xG Analysis\n\n```{r xG setup, echo:FALSE, messages:FALSE, warnings:FALSE}\n#| output: false\n#Load home data\ndashboard_data <- plottingData\n\ndashboard_data <- dashboard_data %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, minute, expandedMinute, result = type, player = playerId, Team_Group, Game_Block, Game_State)\n\n#Load away data\nOppodashboard_data <- plottingData\n\nOppodashboard_data <- Oppodashboard_data %>%\n  filter(Team_Group == Match_Away) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, minute, expandedMinute, result = type, player = playerId, Team_Group, Game_Block, Game_State)\n\n\nWinDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\n\nDrawDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Draw\")\n\nGTimeDashboard_data <- dashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nWinOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nDrawOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Draw\")\n\nGTimeOppoDashboard_data <- Oppodashboard_data %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n## Row\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- dashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n  \n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- Oppodashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n    #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n   \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Team_Group == Match_Home)\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Team_Group == Match_Away)\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- Oppodashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"key\",\n  color = \"primary\",\n  value = \"Game State - Winning\")\n```\n\n## Row\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- WinDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- WinOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#xGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\n#xGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Away)  %>%\n  filter(Game_State == \"Away Lead\" | Game_State == \"Home Lead\")\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- WinDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- WinOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Draw\")\n```\n\n## Row\n\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- DrawDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- DrawOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Draw\")\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Away)  %>%\n  filter(Game_State == \"Draw\")\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- DrawDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- DrawOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\")\n```\n\n## Row\n\n```{r}\n# Density Shot Map\n#canvas\nxGDensityPlot <- GTimeDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n        caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlot_I\n\n```\n\n```{r}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotOppo <- GTimeOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  \n  #geometrics\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.4, adjust = 0.5, linewidth = 0.5) +\n\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture),\n       caption = \"Darker Colour + Tighter Lines = Higher xG\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption =  element_text(colour = \"black\", size = 8),\n        legend.position = \"bottom\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nxGDensityPlotOppo_I <- ggplotly(xGDensityPlotOppo, tooltip = \"text\")\n\nxGDensityPlotOppo_I <- xGDensityPlotOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGDensityPlotOppo_I\n```\n\n\n\n## Row\n\n```{r}\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Home) %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n```\n\n```{r}\nOppoShotBubblexG_data <- plottingData \n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  filter(Game_Block == 1) %>%\n  filter(Team_Group == Match_Away)  %>%\n  filter(Game_State == \"Away Garbage Time\" | Game_State == \"Home Garbage Time\")\n\nOppoShotBubblexG_data <- OppoShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGOppoBubblePlot_data <- OppoShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGOppoBubblePlot_data <- xGOppoBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGOppoBubblePlot_data_pivot <- xGOppoBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  OppoxGBubble_Plot <- xGOppoBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 500), breaks = seq(0, 500, 50)) +\n  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 5)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nOppoxGBubble_Plot_I  <- ggplotly(OppoxGBubble_Plot, tooltip = \"text\")\n\nOppoxGBubble_Plot_I <- OppoxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOppoxGBubble_Plot_I\n\n```\n\n## Row\n\n```{r}\n# Bar Plot\n\nxGSituationBarData <- GTimeDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n\n```\n\n```{r}\n# Bar Plot\nxGSituationBarOppoData <- GTimeOppoDashboard_data %>%\n  filter(Game_Block == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarOppo <- xGSituationBarOppoData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n      scale_x_continuous(limits = c(0, 15), breaks = seq(0, 15, 5)) +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarOppo_I <- ggplotly(xGSituationBarOppo, tooltip = \"xG\")\n\nxGSituationBarOppo_I <- xGSituationBarOppo_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarOppo_I\n```\n\n\n# Shot Analysis\n\n```{r shot map function}\n#| output: false\n\n#' Function for plotting shots for a team\n\nplot_shot_AI <- function(data, type = \"\", teamColor = \"#B22222\", text_color = \"\", bins = 30, highlight_goals = \"\", average_location = \"\", matchFixture = \"\", mapName = \"\", mapType = \"\", matchDate = \"\", dataSource = \"\", logo = \"\", wrap = \"\") {\n  \n  # Checking data frame   \n  if ((nrow(data) > 0) &&\n      sum(c(\"minute\", \"X\", \"Y\", \"xG\", \"result\", \"player\") %in% names(data)) == 6) {\n\n    # set plot names\n    if (dataSource == \"UnderStat\") {\n      \n      if (mapType == \"Home\") {\n      \n        home_team <- (data$home_team[nrow(data)])\n        \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"Away\") {\n      \n        away_team <- (data$away_team[nrow(data)]) \n        \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n    \n      } else if (mapType == \"Player\") {  \n      \n        last <- sub(\".* \", \"\", data$player[nrow(data)])\n        first <- sub(\" .*\", \"\", data$player[nrow(data)])\n        player_name <- paste(first, last)\n      \n        #shot_map_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n      \n    } else if (dataSource == \"FotMob\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$home_team[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$away_team[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        last <- (data$last_name[nrow(data)])\n        first <- (data$first_name[nrow(data)])\n        player_name <- paste(first, last)\n        \n        #shotshot_map_name_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n        \n    } else if (dataSource == \"Opta\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        player_name <- (data$playerId[nrow(data)])\n        \n        #shot_map_name <- paste(player, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n    }\n      \n    fixture_name <- paste(matchFixture, \"(\",dataSource,\")\")\n  \n\n    # set Plot Colours and scale\n    fill_b <- \"#E5E5E5\"\n    color_b <- \"black\"\n    colorLine <- \"#95A5A6\"\n    colorText <- \"black\"\n    fill_Goal <- c(\"No Goal\" = fill_b, \"Goal\" = teamColor)\n    \n    # Data Wrangling \n    if (dataSource == \"UnderStat\") {\n      data <- data %>%\n        mutate(X = 100 * X) %>%\n        mutate(Y = 100 * Y)\n      \n     } else if (dataSource == \"FotMob\") {\n        data <- data %>%\n             mutate(X = (X * 0.941050375),\n                    Y = (Y * 1.464079972))\n        \n     } else if (dataSource == \"Opta\") {\n        data <- data \n      }\n    \n    if (nrow(data) >= 1) {\n      data <- data %>%\n        mutate(xG = round(xG,2)) %>%\n        mutate(isGoal = ifelse(result == \"Goal\", \"Goal\", \"No Goal\")) %>%\n        mutate('Game_Period' = ifelse(minute < 16, \"0 - 15\",\n                                      ifelse(minute < 31 & minute > 15, \"16 - 30\",\n                                             ifelse(minute < 46 & minute > 30, \"31 - 45\",\n                                                    ifelse(minute < 61 & minute > 45, \"46 - 60\",\n                                                           ifelse(minute < 76 & minute > 60, \"61 - 75\",\n                                                                  ifelse(minute < 91 & minute > 75, \"76 - 90\",\n                                                                         ifelse(minute > 90, \"90 +\", \"Extra Time\"))))))))\n\n              # set the pitch up\n              plot <- data %>%\n                ggplot() +\n                annotate_pitch(dimensions = pitch_opta, colour = color_b, fill = fill_b) +\n                theme_pitch() +\n                geom_segment(aes(y = 21.1, yend = 21.1, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 36.8, yend = 36.8, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 63.2, yend = 63.2, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 78.9, yend = 78.9, x = 0, xend = 100), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 17, xend = 17), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 33.2, xend = 33.2), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 50, xend = 50), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 66.4, xend = 66.4), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                geom_segment(aes(y = 0, yend = 100, x = 83, xend = 83), linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n                \n                # add zone numbers\n                geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE)\n              \n              # geometrics \n              if (average_location == TRUE || average_location == \"\") {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") { ## Don't highlight goals ----\n                    plot  <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), alpha = 0.7, stroke = 0.5) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\",\n                      )\n                  } else if (highlight_goals == TRUE) { ## Highlight goals ----\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, fill = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), color = color_b, shape = 21, alpha = 0.7, stroke = 0.5) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") { ## DENSITY ----\n                  plot <- plot +\n                    stat_density_2d(data = data, aes(x = X, y = Y, fill = ..level..), geom = \"polygon\", alpha = 0.7) +\n                    scale_fill_gradient(high = teamColor, low = \"#01141D\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    theme(legend.position = \"none\")\n                  \n                } else if (type == \"hexbin\") { ## HEXBIN ----\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    labs(\n                      fill = \"Count of Shots\"\n                    )\n                }\n              } else if (average_location == FALSE) {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") {\n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), alpha = 0.7, stroke = 0.5) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } else if (highlight_goals == TRUE) {\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, fill = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), color = color_b, shape = 21, alpha = 0.7, stroke = 0.5) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") {\n                  plot <- plot +\n                    stat_density_2d(data = data, aes(x = X, y = Y, fill = ..level..), geom = \"polygon\", alpha = 0.7) +\n                    scale_fill_gradient(high = teamColor, low = \"#01141D\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(fill = \"xG\")\n                  \n                  \n                } else if (type == \"hexbin\") {\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nxG\", xG)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(\n                      fill = \"Count of Shots\")\n                } \n              }\n              # Make Half pitch  \n              plot <- plot +\n                coord_flip(xlim = c(50, 100),\n                           ylim = c(100, 0))\n              # formatting  \n              plot <- plot +\n                labs(title = shot_map_name, \n                     subtitle = fixture_name,\n                     caption = My_caption) +\n                \n                theme(legend.position = \"none\",\n                      legend.direction = \"horizontal\",\n                      legend.background = element_rect(fill = \"snow\"),\n                      legend.title = element_text(colour = colorText, face = \"bold\"),\n                      legend.text = element_text(colour = colorText, size = 10),\n                      legend.key = element_rect(fill = \"snow\"),\n                      plot.title = element_markdown(),\n                      plot.caption = element_markdown(),\n                      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      plot.subtitle = element_text(colour = colorText, hjust = 0, size = 10))\n              \n              # wrap or not\n              if (wrap == \"Player\") {\n                #divide stats by player\n                player_stats <- data %>%\n                  group_by(player) %>%\n                  summarize(\n                    total_xG = sum(xG),\n                    total_goal = sum(result == \"Goal\"),\n                    xg_sot = total_xG / n(),\n                    total_shots = n(),\n                    SOT = sum(result == \"Goal\" | result == \"SavedShot\")\n                  )\n\n                plot <- plot +\n                  facet_wrap(~player) +\n                  theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                        strip.text = element_text(size = 10, colour = text_color))\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 71.05, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 50, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 28.95, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 10.55, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = color_b, size = 2) +\n                  geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                \n                } else if (wrap == \"Time\") {\n                  \n                  #divide stats by time period\n                  GPeriod_stats <- data %>%\n                    group_by(Game_Period) %>%\n                    summarize(\n                      total_xG = sum(xG),\n                      total_goal = sum(result == \"Goal\"),\n                      xg_sot = total_xG / n(),\n                      total_shots = n(),\n                      SOT = sum(result == \"Goal\" | result == \"SavedShot\")\n                    )\n                  \n                  \n                    plot <- plot +\n                      \n                      facet_wrap(~ Game_Period) +\n                      theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                            strip.text = element_text(size = 10, colour = text_color)) \n                    \n                    plot <- plot +\n                    geom_point(x = 54, y = 89.45, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 71.05, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 50, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 28.95, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 10.55, size = 5, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = color_b, size = 2) +\n                      geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                  \n              } else if (wrap == \"\") {\n                total_xG <- sum(data$xG)\n                total_goal <- sum(data$result == \"Goal\")\n                xg_sot <- total_xG / nrow(data)\n                total_shots <- nrow(data)\n                SOT <- sum(data$result == \"Goal\" | data$result == \"SavedShot\")\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 89.45, label = format(round(total_xG, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 89.45, label = \"Total xG\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 71.05, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 71.05, label = format(round(SOT, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 71.05, label = \"SOT\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 50, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 50, label = format(round(total_shots, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 50, label = \"Total Shots\", color = colorText, size = 3) +  \n                  geom_point(x = 54, y = 28.95, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 28.95, label = format(round(xg_sot, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 28.95, label = \"xG/Shot\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 10.55, size = 12, color = colorText, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 10.55, label = format(round(total_goal, 2)), color = color_b, size = 3) +\n                  geom_text(x = 60, y = 10.55, label = \"Goals\", color = colorText, size = 3)\n              \n                Finalplot <- plot\n              }\n              \n              # logo or not\n              if (logo == \"Yes\") {\n                \n                # annotate plot\n                Finalplot <- ggdraw() +\n                  draw_plot(plot, x = 0, y = 0, width = 1, height = , scale = 1) +\n                  draw_image(logo_AI,  x = 0.42, y = 0.45, scale = 0.07) \n                \n              } else if (logo == \"\") {\n                \n                Finalplot <- plot\n              }\n              \n              return(Finalplot)\n              \n             } else \n               {\n              ## add WARNING that there were no rows in the data frame passed into function??\n              return(plot)\n    }\n    }\n  }\n\n```\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"calendar-date\",\n  color = \"primary\",\n  value = \"Whole Season\")\n```\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\nLFC_S_plot <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(Oppodashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(Oppodashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Winning\"\n  )\n```\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\n\n\nLFC_S_plot <- plot_shot_AI(WinDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(WinOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(WinDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(WinOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n#| height: \"100%\"\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Drawing\"\n  )\n\n```\n\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\n\n\nLFC_S_plot <- plot_shot_AI(DrawDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(DrawOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(WinDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(WinOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```\n\n## Row\n```{r}\n#| content: valuebox\n\nlist(\n  icon = \"stopwatch-fill\",\n  color = \"primary\",\n  value = \"Game State - Garbage Time\"\n  )\n```\n\n\n## Row {.flow}\n```{r}\n#|height: 100%\n#shot map\n\n\nLFC_S_plot <- plot_shot_AI(GTimeDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\nLFC_S_plot_I <- ggplotly(LFC_S_plot, tooltip = \"text\")\n\nLFC_S_plot_I <- LFC_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nLFC_S_plot_I\n\n```\n```{r}\n#|height: 100%\nOPPO_S_plot <- plot_shot_AI(GTimeOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\nOPPO_S_plot_I <- ggplotly(OPPO_S_plot, tooltip = \"text\")\n\n\nOPPO_S_plot_I <- OPPO_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plot_I\n\n```\n## Row {.flow}\n```{r}\n#|height: 100%\nLFC_S_plotWT <- plot_shot_AI(GTimeDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nLFC_S_plotWT_I <- ggplotly(LFC_S_plotWT, tooltip = \"text\")\nLFC_S_plotWT_I <- LFC_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nLFC_S_plotWT_I\n\n```\n\n```{r}\n#|height: 100%\nOPPO_S_plotWT <- plot_shot_AI(GTimeOppoDashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = ,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nOPPO_S_plotWT_I <- ggplotly(OPPO_S_plotWT, tooltip = \"text\")\nOPPO_S_plotWT_I <- OPPO_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nOPPO_S_plotWT_I\n\n```"},"formats":{"dashboard":{"identifier":{"display-name":"HTML","target-format":"dashboard","base-format":"dashboard"},"execute":{"fig-width":8,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":"all","plotly-connected":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"Oct International break 2526 Dashboard.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.33","page-layout":"custom","title":"Oct International Break 2526","author":"Dr Phil Barter","scrolling":true,"logo":"https://anfieldindex.com/wp-content/uploads/2016/09/AI-Under-Pressure.png","nav-buttons":[{"icon":"github","href":"https://github.com/Barts78"},{"icon":"linkedin","href":"https://www.linkedin.com/in/phil-barter-55500122/"},{"icon":"twitter","href":"https://twitter.com/Barts78"}],"theme":["Lux","Matchdash.scss"],"type":"default"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}