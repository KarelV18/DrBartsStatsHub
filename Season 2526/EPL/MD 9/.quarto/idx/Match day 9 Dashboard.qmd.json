{"title":"Match day 9 Season 2526","markdown":{"yaml":{"title":"Match day 9 Season 2526","author":"Dr Phil Barter","format":{"dashboard":{"scrolling":true,"logo":"https://anfieldindex.com/wp-content/uploads/2016/09/AI-Under-Pressure.png","nav-buttons":[{"icon":"github","href":"https://github.com/Barts78"},{"icon":"linkedin","href":"https://www.linkedin.com/in/phil-barter-55500122/"},{"icon":"twitter","href":"https://twitter.com/Barts78"},{"icon":"bluesky","href":"https://bsky.app/profile/barts78.bsky.social"}],"theme":["Lux","Matchdash.scss"],"type":"default"}}},"headingText":"Reusable function to compute team summary metrics","containsRefs":false,"markdown":"\n\n\n```{r}\n#' Simulate Football Match Outcomes Based on xG\n#'\n#' @param home_xg_vector Numeric vector of xG values for each home team shot\n#' @param away_xg_vector Numeric vector of xG values for each away team shot\n#' @param runs Number of simulations to perform (default: 10000)\n#' @param seed Random seed for reproducibility (default: 1111)\n#'\n#' @return A list containing:\n#' - `prob_matrix`: A matrix of scoreline probabilities\n#' - `long_prob_matrix`: Data frame for plotting with ggplot\n#' - `simulation_results`: Data frame of simulated outcomes\n\n\nsimulate_match_outcomes <- function(\n  home_xg_vector, \n  away_xg_vector, \n  runs = 10000, \n  seed = 1111,\n  actual_home_goals = NULL,\n  actual_away_goals = NULL\n) {\n  set.seed(seed)\n\n  safe_simulate_goals <- function(xg_vector, runs) {\n    # Flatten in case it's a list (like from dplyr::select)\n    xg_vector <- unlist(xg_vector)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    # Clean and clip to [0, 1]\n    xg_vector <- as.numeric(xg_vector)\n    xg_vector <- xg_vector[!is.na(xg_vector)]\n    xg_vector <- pmin(pmax(xg_vector, 0), 1)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    draws <- rbinom(length(xg_vector) * runs, size = 1, prob = rep(xg_vector, each = runs))\n    goals_matrix <- matrix(draws, nrow = runs, byrow = FALSE)\n    rowSums(goals_matrix)\n  }\n\n  home_goals <- safe_simulate_goals(home_xg_vector, runs)\n  away_goals <- safe_simulate_goals(away_xg_vector, runs)\n\n  simulation_results <- data.frame(Home = home_goals, Away = away_goals)\n  prob_matrix <- table(simulation_results$Home, simulation_results$Away) / runs\n\n  long_prob_matrix <- as.data.frame(as.table(prob_matrix))\n  colnames(long_prob_matrix) <- c(\"Home\", \"Away\", \"Probability\")\n  long_prob_matrix <- long_prob_matrix %>%\n    mutate(Probability = round(Probability * 100, 2))\n\n  goal_summary <- NULL\n  if (!is.null(actual_home_goals) && !is.null(actual_away_goals)) {\n    exact_count <- sum(home_goals == actual_home_goals & away_goals == actual_away_goals)\n    at_least_home <- sum(home_goals >= actual_home_goals)\n    at_least_away <- sum(away_goals >= actual_away_goals)\n\n    goal_summary <- list(\n      actual_score = paste(actual_home_goals, \"-\", actual_away_goals),\n      exact_occurrences = exact_count,\n      exact_percentage = round(100 * exact_count / runs, 2),\n      home_goals_at_least = at_least_home,\n      away_goals_at_least = at_least_away,\n      home_goals_at_least_pct = round(100 * at_least_home / runs, 2),\n      away_goals_at_least_pct = round(100 * at_least_away / runs, 2)\n    )\n  }\n\n  return(list(\n    prob_matrix = prob_matrix,\n    long_prob_matrix = long_prob_matrix,\n    simulation_results = simulation_results,\n    goal_summary = goal_summary\n  ))\n}\n\n\n```\n\n```{r}\n#| label: Team season sumary function \n\ncompute_season_summary <- function(data, group_vars) {\n  data %>%\n    mutate(Successful_Touch = ifelse(isTouch == \"TRUE\", 1, 0),\n           TeamEPV = ifelse(str_detect(`outcomeType/value`, \"1\"), EPVvalue, 0),\n           TeamEPV = as.numeric(TeamEPV),\n           Match_day = as.numeric(Match_day)) %>%\n    group_by(across(all_of(group_vars))) %>%\n    summarise(Match_day = first(Match_day),\n              n_matches = n_distinct(game_name),\n              across(c(Goals, In_play_time, Touches, UnSuccessful_Touches, PK_Box_Touches,\n                       Final_Third_Touches, Attacking_Half_Touches, Defensive_Half_Touches,\n                       Mis_Control, Dispossessed_Total, Dribbles_Total, Dribbles_Won, Dribbles_Lost,\n                       TotalShots, OFShots, Blocked_Shot, OTShots, SixYard_Box_Shots,\n                       PK_Box_Shots, Out_Box_Shots, BCs, xG, NPxG, xGOT, \n                       Attempted_Passes,\n                       Successful_Passes, \n                       UnSuccessful_Passes, \n                       Long_Passes, \n                       Successful_Long_Passes,\n                       Corners, \n                       Short_Corners, \n                       Cross_Passes, \n                       Successful_Cross, \n                       UnSuccessful_Cross,\n                       Tackles_Total, \n                       Tackles_Won, \n                       Tackles_Lost, \n                       Fouls_Total, \n                       Fouls_Conceeded,\n                       Fouls_Received, \n                       Aerial_Won, \n                       Aerial_Lost,\n                       Clearances_Total,\n                       Interceptions_Total,\n                       Recoverys_Total, \n                       Offside_Won, \n                       Offside_Lost, \n                       TeamEPV, \n                       Defensive_Third_Touches, \n        Middle_Third_Touches, \n        SixYard_Box_Touches, \n        Attempted_Carries, \n        Successful_Carries, \n        Prog_Carries, \n        Final_Third_Carries,\n        Final_Third_Passes, \n        PK_Box_Passes,\n        Prog_Passes,\n        Key_Passes,\n        Assists,\n        MyxA,\n        TeamxT,\n        Aerial_total, \n        Ground_Duels_Total, \n        Ground_Duels_Won, \n        Ground_Duels_Lost,\n),\n        ~ sum(.x, na.rm = TRUE) / n_matches\n      ),\n      #.groups = \"drop\"\n    ) %>%\n    #select(-n_matches) %>%\n    mutate(\n      In_play_time = round(In_play_time / 60, 1),\n      Possession   = round((Touches / (sum(Touches))) * 100, 1),\n      Field_Tilt   = round((Final_Third_Touches / (sum(Final_Third_Touches))) * 100, 1),\n      Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n      Long_Pass_Success = round((Successful_Long_Passes / Long_Passes) * 100, 1),\n      Long_Pass_Rate    = round((Long_Passes / Attempted_Passes) * 100, 2),\n      Cross_Success     = round((Successful_Cross / Cross_Passes) * 100, 2),\n      Failed_Pass    = Attempted_Passes - Successful_Passes,\n      Failed_Cross   = Cross_Passes - Successful_Cross,\n      Failed_Dribble = Dribbles_Total - Dribbles_Won,\n      Poss_Gained = Interceptions_Total + Recoverys_Total +\n                    (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost),\n      Poss_Lost = Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble +\n                  OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost,\n      Posession_Control =\n        Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) +\n        (Aerial_Won - Aerial_Lost) -\n        (Mis_Control + Dispossessed_Total + UnSuccessful_Passes +\n         UnSuccessful_Cross + Dribbles_Lost + OFShots + Blocked_Shot + Offside_Lost),\n      `EPV % xG Con.`   = round((xG   / TeamEPV) * 100, 1),\n      `EPV % NPxG Con.` = round((NPxG / TeamEPV) * 100, 1)\n    ) %>%\n    mutate(across(everything(), ~ replace_na(.x, 0))) %>%\n    mutate(across(where(is.numeric), ~ round(.x, 2)))\n}\n\n```\n\n\n```{r}\n#| label: Team sumary function \n\n# Reusable function to compute team summary metrics\ncompute_summary <- function(data, group_vars) {\n  data %>%\n    mutate(Successful_Touch = ifelse(isTouch == \"TRUE\", 1, 0),\n           TeamEPV = ifelse(str_detect(`outcomeType/value`, \"1\"), EPVvalue, 0),\n           TeamEPV = as.numeric(TeamEPV)) %>%\n    group_by(across(all_of(group_vars))) %>%\n        summarise(Match_day = first(Match_day), \n                  across(c(Goals, In_play_time, Touches, UnSuccessful_Touches, PK_Box_Touches,\n                       Final_Third_Touches, Attacking_Half_Touches, Defensive_Half_Touches,\n                       Mis_Control, Dispossessed_Total, Dribbles_Total, Dribbles_Won, Dribbles_Lost,\n                       TotalShots, OFShots, Blocked_Shot, OTShots, SixYard_Box_Shots,\n                       PK_Box_Shots, Out_Box_Shots, BCs, xG, NPxG, xGOT, \n                       Attempted_Passes,\n                       Successful_Passes, \n                       UnSuccessful_Passes, \n                       Long_Passes, \n                       Successful_Long_Passes,\n                       Corners, \n                       Short_Corners, \n                       Cross_Passes, \n                       Successful_Cross, \n                       UnSuccessful_Cross,\n                       Tackles_Total, \n                       Tackles_Won, \n                       Tackles_Lost, \n                       Fouls_Total, \n                       Fouls_Conceeded,\n                       Fouls_Received, \n                       Aerial_Won, \n                       Aerial_Lost,\n                       Clearances_Total,\n                       Interceptions_Total,\n                       Recoverys_Total, \n                       Offside_Won, \n                       Offside_Lost, \n                       TeamEPV, \n                       Defensive_Third_Touches, \n        Middle_Third_Touches, \n        SixYard_Box_Touches, \n        Attempted_Carries, \n        Successful_Carries, \n        Prog_Carries, \n        Final_Third_Carries,\n        Final_Third_Passes, \n        PK_Box_Passes,\n        Prog_Passes,\n        Key_Passes,\n        Assists,\n        MyxA,\n        TeamxT,\n        Aerial_total, \n        Ground_Duels_Total, \n        Ground_Duels_Won, \n        Ground_Duels_Lost,\n        ),\n                 sum, na.rm = TRUE)) %>%\n    mutate(In_play_time = round(In_play_time / 60, 1),\n           Possession = round((Touches/(sum(Touches)))*100,1),\n           Field_Tilt = round((Final_Third_Touches/(sum(Final_Third_Touches)))*100,1),\n           Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n           Long_Pass_Success = round((Successful_Long_Passes / Long_Passes) * 100, 1),\n           Long_Pass_Rate = round((Long_Passes / Attempted_Passes) * 100, 2),\n           Cross_Success = round((Successful_Cross / Cross_Passes) * 100, 2),\n           Failed_Pass = Attempted_Passes - Successful_Passes,\n           Failed_Cross = Cross_Passes - Successful_Cross,\n           Failed_Dribble = Dribbles_Total - Dribbles_Won,\n           Poss_Gained = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost),\n           Poss_Lost = Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble + OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost,\n           Posession_Control = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) +\n                               (Aerial_Won - Aerial_Lost) -\n                               (Mis_Control + Dispossessed_Total + UnSuccessful_Passes +\n                               UnSuccessful_Cross + Dribbles_Lost + OFShots + Blocked_Shot + Offside_Lost),\n           `EPV % xG Con.` = round((xG / TeamEPV) * 100, 1),\n           `EPV % NPxG Con.` = round((NPxG / TeamEPV) * 100, 1),\n           ) %>%\n    \n    mutate(across(everything(), ~replace_na(.x, 0))) \n  \n}\n\n```\n\n``` {r}\n#| label: Shift column function\n# Shift column funtion, this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\n```\n\n```{r}\n#| output: false\n#| label: touch area function Quantiles\n#' Function for plotting Player touch areas\n#' Function for plotting Team touch areas - set at 75%\n\n#calculate touch area of player - set at 75% using quantiles\ntouch_area_shape_quantiles <- function(data) {\n  \n  x_low <- quantile(data$x, 0.15)\n  x_high <- quantile(data$x, 0.85)\n  \n  y_low <- quantile(data$y, 0.15)\n  y_high <- quantile(data$y, 0.85)\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n```\n```{r}\n\n#| output: false\n#| label: touch area function Mad\n#' Function for plotting Player touch areas using 1.5 MAD( 75% of data) Mediands\ntouch_area_shape_mad <- function(data) {\n  \n  x_median <- median(data$x)\n  y_median <- median(data$y)\n  \n  x_mad <- median(abs(data$x - x_median))/0.6745\n  y_mad <- median(abs(data$y - y_median))/0.6745\n  \n  x_low <- x_median - 1.5*x_mad\n  x_high <- x_median + 1.5*x_mad\n  \n  y_low <- y_median - 1.5*y_mad\n  y_high <- y_median + 1.5*y_mad\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n```\n\n\n```{r}\n#| output: false\n#| label: Enhanced TouchPlayerPlot_AI with method selection and dynamic faceting\nTouchPlayerPlot_AI <- function(\n  data,\n  color = \"firebrick4\",\n  text_color = \"\",\n  title = \"\",\n  subtitle = \"\",\n  plot_start = 0,\n  plot_finish = 45,\n  logo = \"\",\n  method = \"quantile\",  # or \"mad\"\n  facet_by = \"playerId\"\n) {\n  required_cols <- c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"expandedMinute\", \"Game_Period\", \"role\")\n  if (nrow(data) == 0 || !all(required_cols %in% names(data))) {\n    stop(\"The dataset has insufficient columns and/or insufficient data.\")\n  }\n\n  data <- data %>%\n    filter(`type/value` %in% c(1, 2, 3, 4, 7, 8, 9, 10:16, 41, 42, 44, 45, 50, 52, 54, 61, 73, 74),\n           `outcomeType/value` == 1) %>%\n    drop_na(playerId, x, y) %>%\n    filter(between(expandedMinute, plot_start, plot_finish))\n\n  list_data <- split(data, data$playerId)\n\n  # Use appropriate shape function\n  shape_fn <- if (method == \"mad\") touch_area_shape_mad else touch_area_shape_quantiles\n  touch_area_data <- purrr::map(list_data, shape_fn) %>% purrr::reduce(full_join)\n\n  PlayerPos <- touch_area_data %>%\n    group_by(playerId) %>%\n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), .groups = \"drop\") %>%\n    na.omit()\n\n  teamtitle <- paste(title, \"Player Touch Areas\")\n\n  player_touch_map <- ggplot(touch_area_data) +\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n    annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n    \n    geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\") +\n    geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\") +\n    geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\") +\n    \n    geom_point(data = data, aes(x = x, y = y), alpha = 0.5, colour = \"black\", size = 1) +\n    geom_polygon(aes(x = x, y = y), colour = color, alpha = 0.2, fill = color, size = 0.4) +\n    geom_point(data = PlayerPos, aes(x = x, y = y), colour = color, alpha = 0.8, shape = 19, size = 2) +\n    facet_wrap(as.formula(paste(\"~\", facet_by)), ncol = 4) +\n    labs(\n      title = teamtitle,\n      x = \"\",\n      subtitle = paste(subtitle, \"\nArea = 75% of activity, Team Colour Dot = Player Average Position\"),\n      caption = My_caption\n    ) +\n    theme(\n      legend.position = \"none\",\n      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      strip.background = element_rect(fill = color, color = \"black\", linetype = \"solid\", linewidth = 1),\n      strip.text = element_text(size = 8, colour = text_color),\n      plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n      plot.subtitle = element_text(colour = \"black\", size = 10),\n      plot.caption = element_markdown(),\n      axis.title.x = element_blank()\n    )\n\n  if (logo == \"Yes\") {\n    player_touch_mapAI <- ggdraw() +\n      draw_plot(player_touch_map, x = 0, y = 0, width = 1, scale = 1) +\n      draw_image(logo_AI, x = 0.445, y = 0.438, scale = 0.12)\n  } else {\n    player_touch_mapAI <- player_touch_map\n  }\n\n  return(player_touch_mapAI)\n}\n```\n\n```{r}\n#| output: false\n#| lable: Enhanced TouchTeamPlot_OPTA with method selection\nTouchTeamPlot_OPTA <- function(\n  data,\n  color = \"#E74C3C\",\n  palette = NULL,\n  title = \"\",\n  subtitle = \"\",\n  plot_start = 0,\n  plot_finish = 45,\n  logo = \"\",\n  method = \"mad\"  # or \"quantile\"\n) {\n  required_cols <- c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"expandedMinute\", \"Game_Period\", \"file_name\", \"role\")\n  if (nrow(data) == 0 || !all(required_cols %in% names(data))) {\n    stop(\"The dataset has insufficient columns and/or insufficient data.\")\n  }\n\n  data <- data %>%\n    drop_na(playerId, x, y) %>%\n    filter(dplyr::between(expandedMinute, plot_start, plot_finish))\n\n  shape_fn <- if (method == \"quantile\") touch_area_shape_quantiles else touch_area_shape_mad\n  list_data <- split(data, data$playerId)\n  touch_area_data <- purrr::map(list_data, shape_fn) %>% purrr::reduce(dplyr::full_join)\n\n  PlayerPos <- touch_area_data %>%\n    group_by(playerId) %>%\n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), .groups = \"drop\") %>%\n    tidyr::drop_na()\n\n  # ---- NEW: build palette from `palette` or default white -> color ramp ----\n  players <- sort(unique(as.character(touch_area_data$playerId)))\n  n <- length(players)\n\n  build_palette <- function(players, palette, color) {\n    n <- length(players)\n\n    # 1) Named vector mapping playerId -> color\n    if (is.character(palette) && !is.null(names(palette))) {\n      if (!all(players %in% names(palette))) {\n        warning(\"Named palette does not cover all players; missing players will be auto-colored.\")\n      }\n      cols <- palette[players]\n      # fill any NAs (uncovered players) from a white->color ramp\n      if (anyNA(cols)) {\n        fill_cols <- grDevices::colorRampPalette(c(\"#FFFFFF\", color))(sum(is.na(cols)))\n        cols[is.na(cols)] <- fill_cols\n      }\n      names(cols) <- players\n      return(cols)\n    }\n\n    # 2) Paletteer \"pkg::pal\" string\n    if (is.character(palette) && length(palette) == 1 && grepl(\"::\", palette, fixed = TRUE)) {\n      if (requireNamespace(\"paletteer\", quietly = TRUE)) {\n        cols <- as.character(paletteer::paletteer_d(palette, n))\n        names(cols) <- players\n        return(cols)\n      } else {\n        warning(\"paletteer not installed; falling back to white -> color ramp.\")\n      }\n    }\n\n    # 3) Plain vector of colors to interpolate\n    if (is.character(palette) && length(palette) >= 1) {\n      cols <- grDevices::colorRampPalette(palette)(n)\n      names(cols) <- players\n      return(cols)\n    }\n\n    # Default: white -> color ramp (keeps your 'min = white' feel)\n    cols <- grDevices::colorRampPalette(c(\"#FFFFFF\", color))(n)\n    if (n == 1) cols <- color\n    names(cols) <- players\n    cols\n  }\n\n  pal <- build_palette(players, palette, color)\n\n  # lock factor levels\n  touch_area_data <- touch_area_data %>%\n    mutate(playerId = factor(as.character(playerId), levels = players))\n  PlayerPos <- PlayerPos %>%\n    mutate(playerId = factor(as.character(playerId), levels = players))\n  # -------------------------------------------------------------------------\n\n  teamtitle <- paste(title, \"Areas\")\n\n  touch_map <- ggplot(touch_area_data) +\n    \n    # use the palette (discrete by player)\n    scale_fill_manual(values = pal) +\n    scale_colour_manual(values = pal) +\n\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9),\n             x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83),\n             y = 0, yend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    #plot player touch area\n    geom_polygon(aes(x = x, y = y, fill = playerId, colour = playerId), alpha = 0.15, size = 0.5) +\n    #plot player average position\n    geom_point(data = PlayerPos, aes(x = x, y = y, fill = playerId, colour = playerId),\n               alpha = 0.7, shape = 21, size = 3, stroke = 0.5) +\n    # plot player name\n    geom_text(data = PlayerPos, aes(x = x, y = y + 4, label = playerId, colour = playerId), size = 3) +\n    labs(\n      title = teamtitle,\n      subtitle = paste(subtitle, \"\\nArea = 75% of activity, Dot = Player Average Position\"),\n      caption = My_caption,\n      x = \"\"\n    ) +\n    theme(\n      strip.background = element_rect(fill = \"#E5E5E5\", \n      colour = NA), strip.text = element_text(colour = \"black\", size = 10), \n      plot.title = element_text(colour = \"black\", \n      size = 14, face = \"bold\"),\n      plot.subtitle = element_text(colour = \"black\", size = 10),\n      plot.caption = element_markdown(),\n      axis.title.x = element_text(colour = \"black\", size = 12, face = \"bold\"),\n      legend.position = \"none\"\n    )\n\n  if (logo == \"Yes\") {\n    touch_mapAI <- ggdraw() +\n      draw_plot(touch_map, x = 0, y = 0, width = 1, scale = 1) +\n      draw_image(logo_AI, x = 0.4, y = 0.45, scale = 0.07)\n  } else {\n    touch_mapAI <- touch_map\n  }\n\n  return(touch_mapAI)\n}\n\n```\n\n```{r}\n#| output: false\n#| label: Shot map function\n\n#' Function for plotting shots for a team\n\nplot_shot_AI <- function(data, type = \"\", teamColor = \"#B22222\", text_color = \"\", bins = 30, highlight_goals = \"\", average_location = \"\", matchFixture = \"\", mapName = \"\", mapType = \"\", matchDate = \"\", dataSource = \"\", logo = \"\", wrap = \"\") {\n  \n  # Checking data frame   \n  if ((nrow(data) > 0) &&\n      sum(c(\"minute\", \"X\", \"Y\", \"xG\", \"xGOT\", \"NPxG\", \"result\", \"OTShots\", \"player\", \"Game_Period\") %in% names(data)) == 10) {\n\n    # set plot names\n    if (dataSource == \"UnderStat\") {\n      \n      if (mapType == \"Home\") {\n      \n        home_team <- (data$home_team[nrow(data)])\n        \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"Away\") {\n      \n        away_team <- (data$away_team[nrow(data)]) \n        \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold \\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n    \n      } else if (mapType == \"Player\") {  \n      \n        last <- sub(\".* \", \"\", data$player[nrow(data)])\n        first <- sub(\" .*\", \"\", data$player[nrow(data)])\n        player_name <- paste(first, last)\n      \n        #shot_map_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span>><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n      \n    } else if (dataSource == \"FotMob\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$home_team[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$away_team[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        last <- (data$last_name[nrow(data)])\n        first <- (data$first_name[nrow(data)])\n        player_name <- paste(first, last)\n        \n        #shotshot_map_name_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n        \n    } else if (dataSource == \"Opta\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        player_name <- (data$playerId[nrow(data)])\n        \n        #shot_map_name <- paste(player, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n    }\n      \n    fixture_name <- paste(matchFixture, \"(\",dataSource,\")\")\n  \n\n    # set Plot Colours and scale\n    fill_b <- \"#E5E5E5\"\n    pitch_lines <- \"black\"\n    color_b <- teamColor\n    colorLine <- \"#95A5A6\"\n    colorText <- \"black\"\n    fill_Goal <- c(\"No Goal\" = fill_b,\"SoT\" = teamColor, \"Goal\" = teamColor)\n    Alpha_Goal <- c(\"No Goal\" = 0.9,\"SoT\" = 0.3, \"Goal\" = 1)\n    # Data Wrangling \n    if (dataSource == \"UnderStat\") {\n      data <- data %>%\n        mutate(X = 100 * X) %>%\n        mutate(Y = 100 * Y)\n      \n     } else if (dataSource == \"FotMob\") {\n        data <- data %>%\n             mutate(X = (X * 0.941050375),\n                    Y = (Y * 1.464079972))\n        \n     } else if (dataSource == \"Opta\") {\n        data <- data \n      }\n    \n    if (nrow(data) >= 1) {\n      data <- data %>%\n        mutate(xG = round(xG,2),\n               isGoal = ifelse(result == \"Goal\", \"Goal\", ifelse(OTShots == 1, \"SoT\", \"No Goal\"))) \n\n              # set the pitch up\n              plot <- data %>%\n                ggplot() +\n                annotate_pitch(dimensions = pitch_opta, colour = pitch_lines, fill = fill_b) +\n                theme_pitch() +\n                annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n                annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n                \n                # add zone numbers\n                geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE)\n              \n              # geometrics \n              if (average_location == TRUE || average_location == \"\") {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") { ## Don't highlight goals ----\n                    plot  <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute,\"\\nOutcome:\", result, \"\\nxG\", xG, \"\\nxGOT\", xGOT)), alpha = 0.7, stroke = 0.5) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\",\n                      )\n                  } else if (highlight_goals == TRUE) { ## Highlight goals ----\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, fill = isGoal, alpha = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result, \"\\nxG\", xG, \"\\nxGOT\", xGOT)), color = color_b, shape = 21, stroke = 0.5) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_alpha_manual(values = Alpha_Goal)+\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") { ## DENSITY ----\n                  plot <- plot +\n                      stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n                    scale_fill_gradient(high = teamColor, low = text_color) +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5)\n                  \n                } else if (type == \"hexbin\") { ## HEXBIN ----\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result,  \"\\nxG\", xG, \"\\nxGOT\", xGOT)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    labs(\n                      fill = \"Count of Shots\"\n                    )\n                }\n              } else if (average_location == FALSE) {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") {\n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result, \"\\nxG\", xG, \"\\nxGOT\", xGOT)), alpha = 0.7, stroke = 0.5) +\n                      geom_image(data = filter(data, isGoal == \"Goal\"),\n    mapping = aes(x = X, y = Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball3.png\"), \n     by = \"width\", inherit.aes = TRUE\n  ) +\n                      \n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } else if (highlight_goals == TRUE) {\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, fill = isGoal, alpha = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute,  \"\\nOutcome:\", result,  \"\\nxG\", xG, \"\\nxGOT\", xGOT)), color = color_b, shape = 21,  stroke = 0.5) +\n                      \n                      geom_image(data = filter(data, isGoal == \"Goal\"),\n    mapping = aes(x = X, y = Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball3.png\"),\n    by = \"width\", inherit.aes = TRUE\n  ) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_alpha_manual(values = Alpha_Goal) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") {\n                  plot <- plot +\n                    stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n                    scale_fill_gradient(high = teamColor, low = text_color) +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(fill = \"xG\")\n                  \n                  \n                } else if (type == \"hexbin\") {\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result,  \"\\nxG\", xG, \"\\nxGOT\", xGOT)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(\n                      fill = \"Count of Shots\")\n                } \n              }\n              # Make Half pitch  \n              plot <- plot +\n                coord_flip(xlim = c(50, 100),\n                           ylim = c(100, 0))\n              # formatting  \n              plot <- plot +\n                labs(title = shot_map_name, \n                     subtitle = fixture_name,\n                     caption = My_caption) +\n                \n                theme(legend.position = \"none\",\n                      legend.direction = \"horizontal\",\n                      legend.background = element_rect(fill = \"snow\"),\n                      legend.title = element_text(colour = colorText, face = \"bold\"),\n                      legend.text = element_text(colour = colorText, size = 10),\n                      legend.key = element_rect(fill = \"snow\"),\n                      plot.title = element_markdown(),\n                      plot.caption = element_markdown(),\n                      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      plot.subtitle = element_text(colour = colorText, hjust = 0, size = 10))\n              \n              # wrap or not\n              if (wrap == \"Player\") {\n                #divide stats by player\n                player_stats <- data %>%\n                  group_by(player) %>%\n                  summarize(\n                    total_xG = sum(xG),\n                    total_goal = sum(result == \"Goal\"),\n                    xg_sot = total_xG / n(),\n                    total_shots = n(),\n                    SOT = sum(OTShots)\n                  )\n\n                plot <- plot +\n                  facet_wrap(~player) +\n                  theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                        strip.text = element_text(size = 10, colour = text_color))\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 71.05, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 50, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 28.95, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 10.55, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                \n                } else if (wrap == \"Time\") {\n                  \n                  #divide stats by time period\n                  GPeriod_stats <- data %>%\n                    group_by(Game_Period) %>%\n                    summarize(\n                      total_xG = sum(xG),\n                      total_goal = sum(result == \"Goal\"),\n                      xg_sot = total_xG / n(),\n                      total_shots = n(),\n                      SOT = sum(OTShots)\n                    )\n                  \n                  \n                    plot <- plot +\n                      \n                      facet_wrap(~ Game_Period) +\n                      theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                            strip.text = element_text(size = 10, colour = text_color)) \n                    \n                    plot <- plot +\n                    geom_point(x = 54, y = 89.45, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 71.05, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 50, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 28.95, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 10.55, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                  \n              } else if (wrap == \"\") {\n                total_xG <- sum(data$xG)\n                total_goal <- sum(data$result == \"Goal\")\n                xg_sot <- total_xG / nrow(data)\n                total_shots <- nrow(data)\n                SOT <- sum(data$OTShots)\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 89.45, label = format(round(total_xG, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 89.45, label = \"Total xG\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 71.05, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 71.05, label = format(round(SOT, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 71.05, label = \"SOT\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 50, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  \n                  geom_text(x = 54, y = 50, label = format(round(total_shots, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 50, label = \"Total Shots\", color = colorText, size = 3) +  \n                  geom_point(x = 54, y = 28.95, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 28.95, label = format(round(xg_sot, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 28.95, label = \"xG/Shot\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 10.55, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 10.55, label = format(round(total_goal, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 10.55, label = \"Goals\", color = colorText, size = 3)\n              \n                Finalplot <- plot\n              }\n              \n              # logo or not\n              if (logo == \"Yes\") {\n                \n                # annotate plot\n                Finalplot <- ggdraw() +\n                  draw_plot(plot, x = 0, y = 0, width = 1, height = , scale = 1) +\n                  draw_image(logo_AI,  x = 0.42, y = 0.45, scale = 0.07) \n                \n              } else if (logo == \"\") {\n                \n                Finalplot <- plot\n              }\n              \n              return(Finalplot)\n              \n             } else \n               {\n              ## add WARNING that there were no rows in the data frame passed into function??\n              return(plot)\n    }\n    }\n  }\n\n```\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n#| label: Pass network function\n#' Function for plotting pass networks\n\nplot_passnet_AI <- function(data, team_name, scale_stat = \"EPV\", \n                         scale_color = \"firebrick2\", text_color = \"white\", subtitle = \"\", plot_start = \"00\", plot_finish = \"45\", logo = \"\", pitch = \"\", wrap = \"\", pressmap = \"\", passes = \"2\") {\n  \n    # Checking data frame \n    \n    if ((nrow(data) > 0) &&\n        sum(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"expandedMinute\", \"outcome\", \"Game_Period\", \"player_shirt\", \"Successful_Passes\") %in% names(data)) == 12) {\n    } else {\n      print(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"expandedMinute\", \"outcome\", \"Game_Period\", \"player_shirt\", \"Successful_Passes\"))\n      stop(\"The dataset has insufficient columns and/or insufficient data.\")\n    }\n    \n    # Generate error messages\n    \n    if (is.character(data$playerId) == FALSE) {\n      stop(\"The playerId column is supposed to contain player names.\")\n    }\n    \n    if (is.character(data$TeamName) == FALSE) {\n      stop(\"The TeamName column is supposed to contain team names.\")\n    }\n  \n    # full Pitch or half Pitch\n\n    if  (pitch == \"Half\") { \n      data <- data %>%\n        filter(x >= 50)\n    \n    }else if (pitch == \"Full\") {\n      data <- data\n    }\n  # exclude set pieces and throw ins\n  Pass_data <- data %>%\n    filter(Attempted_Passes == 1)\n\n      # Stat calculation\n    \n    if (scale_stat == \"xT\") {\n      \n      df <- Pass_data %>%\n        calculate_threat(type = \"opta\")\n      \n      df <- df %>%\n        mutate(xT = xTEnd - xTStart) %>%\n        select(xT)\n      df[is.na(df)] <- 0\n      \n      Pass_data$stat <- df$xT\n      \n      leg_title <- \"xT\"\n      \n    } else if (scale_stat == \"EPV\") {\n      \n      df <- Pass_data %>%\n        calculate_epv(type = \"opta\")\n      \n      df <- df %>%\n        mutate(EPV = EPVEnd - EPVStart) %>%\n        select(EPV)\n      df[is.na(df)] <- 0\n      \n      Pass_data$stat <- df$EPV\n      \n      leg_title <- \"EPV\"\n      \n    }\n    \n  # Calculate Pass percentage\n  Pass_data <- Pass_data %>%\n  replace_na(list(Attempted_Passes = 0, Successful_Passes = 0)) %>%\n  mutate(stat = as.numeric(stat)) %>%\n replace_na(list(stat = 0))\n\n  Pass_data <- Pass_data %>%\n  mutate(Pass_Suc = if_else(Attempted_Passes > 0,\n                                   Successful_Passes / Attempted_Passes, NA_real_))\n  \n  #set title text\n    PassNetTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network</span>\"))\n  \n  PassNetTitle_textD <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network & </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:14px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:14px;'>Unsuccessful</span><span style='color:gray12;font-size:14px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:14px;'>Successful</span><span style='color:gray12;font-size:14px;'>)</span>\"))\n  \n    # wrap or not\n    if (wrap == \"Yes\") {\n      \n      #calculate pressing date\n\nif (pressmap == \"Yes\") {\n  PressData <- data %>%\n    filter(TeamName == team_name, Defensive_Action == 1)\n}\n\nplotCaption <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span>\n       <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Line = </span>\n       <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span>\n       <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes</span>\"))\n\n# ---- Data wrangling --------------------------------------------------------\ndata1 <- Pass_data %>%\n  filter(TeamName == team_name) %>%\n  filter(!is.na(playerId))\n\n# If you still want the \"receiver\" column by next event within period:\ndata1 <- data1 %>%\n  arrange(Game_Period, expandedMinute) %>%\n  group_by(Game_Period) %>%\n  mutate(receiver = dplyr::lead(playerId, n = 1)) %>%\n  ungroup()\n\n# ---- Nodes: player averages per period (DROP groups) -----------------------\nnodes <- data1 %>% \n  group_by(playerId, player_shirt, Game_Period) %>% \n  summarise(\n    x = mean(x, na.rm = TRUE),\n    y = mean(y, na.rm = TRUE),\n    events = dplyr::n(),\n    stat   = sum(stat, na.rm = TRUE),\n    Successful_Passes = sum(Successful_Passes, na.rm = TRUE),\n    Attempted_Passes  = sum(Attempted_Passes,  na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# ---- Edgelist: successful passes per period ------------------\nedgelist <- data1 %>%\n  filter(Successful_Passes == 1) %>%\n  select(from = playerId, to = receiver, Game_Period) %>%\n  filter(!is.na(to)) %>%\n  group_by(from, to, Game_Period) %>%\n  summarise(n = dplyr::n(), .groups = \"drop\")\n\n# ---- Coordinates for pass lines -----------------\ncoords <- nodes %>%\n  ungroup() %>%\n  select(playerId, Game_Period, x, y)\n\n# Join coords for 'from' and 'to' WITH Game_Period\nedges <- edgelist %>%\n  left_join(coords, by = c(\"from\" = \"playerId\", \"Game_Period\" = \"Game_Period\")) %>%\n  left_join(coords, by = c(\"to\"   = \"playerId\", \"Game_Period\" = \"Game_Period\"),\n            suffix = c(\"\", \".to\")) %>%\n  mutate(xend = x.to, yend = y.to)\n\n# Collapse to undirected pairs *within period*, keep one geometry per pair\nedges <- edges %>%\n  mutate(player1 = pmin(from, to), player2 = pmax(from, to)) %>%\n  group_by(player1, player2, Game_Period) %>%\n  summarise(\n    Total_Passes = sum(n, na.rm = TRUE),\n    x    = dplyr::first(x),\n    y    = dplyr::first(y),\n    xend = dplyr::first(xend),\n    yend = dplyr::first(yend),\n    .groups = \"drop\"\n  ) %>%\n  filter(Total_Passes >= passes)\n\n# ---- Final tidy on nodes ---------------------------------------------------\nnodes <- nodes %>%\n  arrange(Game_Period) %>%\n  mutate(playerId = ifelse(grepl(\" \", playerId), sub(\".*\\\\s\", \"\", playerId), playerId),\n         playerId_short = if_else(grepl(\" \", playerId),\n                                         sub(\".*\\\\s\", \"\", playerId),\n                                         playerId))\n\n# Plot the passnetwork\n      \n      plot_passnet <- ggplot() +\n        \n        #setup the pitch\n        annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n        theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        \n        #set scale and color gradient\n        scale_colour_gradientn(\n          colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 0.5)), \n        breaks = scales::breaks_width(0.1), \n        name = \"Circle Colour = Threat (EPV)\") +\n        \n        scale_size_continuous(range = c(0.5, 3)) +\n        \n        scale_fill_manual(values = c(\"#0000FF\",  \"red2\"))\n      \n      if (pressmap == \"Yes\") {\n        \n        #plot pressing data\n        plot_passnet <- plot_passnet +\n          geom_point(data = PressData, aes(x = x, y = y, group = Game_Period, fill = outcome), shape = 21, size = 1, show.legend = FALSE)\n        \n      } else if (pressmap == \"\") {\n        \n        plot_passnet <- plot_passnet\n      }\n      \n        #plot player connections\n        plot_passnet <- plot_passnet +\n          geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, linewidth = (Total_Passes*0.25)), colour = \"black\", alpha = 0.8, show.legend = FALSE) +\n\n        #plot player positions\n          new_scale_color() +\n          new_scale_fill() +\n          geom_point(data = nodes, aes(x, y, fill = stat), size = 3, shape = 21, colour = \"black\", stroke = 0.5) +\n\n        #plot player Numbers\n        geom_text(data = nodes, aes(x, y, label = player_shirt), colour = \"black\", size = 1) +\n        \n        # set scale and colors\n        scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 0.5)), \n        breaks = scales::breaks_width(0.1), \n        name = \"Circle Colour = Threat (EPV)\") +\n        \n        #formatting\n          labs(title = PassNetTitle_text,\n               subtitle = plotCaption,\n             x = \"\",\n             colour = leg_title,\n             caption = My_caption) +\n          \n            theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            #axis.title.x = element_text(colour = \"black\", size = 6)\n            axis.title.x = element_blank()) +\n\n        #Wrap the plots\n          facet_wrap(~Game_Period, ncol = 4) +\n          theme(strip.text.x = element_text(face = \"bold\", size = 10, colour = text_color),\n              strip.background.x = element_rect(fill = scale_color, color = \"black\", linetype = \"solid\", linewidth = 1))\n\n    } else if (wrap == \"\") {\n      \n      #calculate pressing date\n      \n      if (pressmap == \"Yes\") {\n        \n        data <- data %>%\n          filter(between(expandedMinute, plot_start, plot_finish))\n        \n        PressData <- data %>%\n          filter(TeamName == team_name) \n        \n        PressData <- PressData %>%\n          filter(Defensive_Action == 1)\n\n      } else if (pressmap == \"\") {\n        \n      }\n      \n      plotCaption <- paste0(\n  glue(\"\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><br>\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>Line = </span>\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span>\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes, Larger Circle = More Passes</span>\"))\n\n#            plotCaption <- paste0(\n#              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Line =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes, Larger Circle = More Passes</span>\"))\n            \n            plotTag <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span\"))\n            \n            plotExplaination <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Line =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Darker Circle Colour = Higher Threat (EPV)</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;', Darker Line = Higher Pass Completion, Direction of Attack Right to Left</span>\"))\n\n# Data Wrangling \n      \n# Team + valid IDs\ndata1 <- Pass_data %>%\n  dplyr::filter(TeamName == team_name) %>%\n  dplyr::filter(!is.na(playerId))\n\n# Create Receiver data\n  data1 <- data1 %>%\n  mutate(receiver = dplyr::lead(playerId, n = 1))\n\n# Restrict time window (ensure plot_start/finish are numeric)\ndata1 <- data1 %>%\n  dplyr::filter(dplyr::between(expandedMinute, as.numeric(plot_start), as.numeric(plot_finish)))\n\n# Nodes (per player)\nnodes <- data1 %>%\n  dplyr::group_by(playerId, player_shirt) %>%\n  dplyr::summarise(\n    x = mean(x, na.rm = TRUE),\n    y = mean(y, na.rm = TRUE),\n    events = dplyr::n(),\n    stat   = sum(stat, na.rm = TRUE),\n    Successful_Passes = sum(Successful_Passes, na.rm = TRUE),\n    Attempted_Passes  = sum(Attempted_Passes,  na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Edgelist (successful passes between players)\nedgelist <- data1 %>%\n  dplyr::filter(Successful_Passes == 1) %>%\n  dplyr::select(from = playerId, to = receiver) %>%\n  dplyr::group_by(from, to) %>%\n  dplyr::summarise(n = dplyr::n(), .groups = \"drop\") %>%  \n  tidyr::drop_na()\n\n# Join coordinates\ncoords <- nodes %>% dplyr::ungroup() %>% dplyr::select(playerId, x, y)\n\nedges <- edgelist %>%\n  dplyr::left_join(coords, by = c(\"from\" = \"playerId\")) %>%\n  dplyr::rename(x = x, y = y) %>%\n  dplyr::left_join(coords, by = c(\"to\"   = \"playerId\"), suffix = c(\"\", \".to\")) %>%\n  dplyr::rename(xend = x.to, yend = y.to)\n\n# Collapse to undirected pairs\nedges <- edges %>%\n  dplyr::mutate(player1 = pmin(from, to), player2 = pmax(from, to)) %>%\n  dplyr::group_by(player1, player2) %>%\n  dplyr::summarise(\n    Total_Passes = sum(n, na.rm = TRUE),\n    x    = dplyr::first(x),\n    y    = dplyr::first(y),\n    xend = dplyr::first(xend),\n    yend = dplyr::first(yend),\n    .groups = \"drop\"                         \n  ) %>%\n  dplyr::filter(Total_Passes >= passes)\n\n# Pass % per connection\nPassStats <- data1 %>%\n  dplyr::select(player1 = playerId, player2 = receiver,\n                Successful_Passes, Attempted_Passes) %>%\n  dplyr::group_by(player1, player2) %>%\n  dplyr::summarise(\n    n = dplyr::n(),\n    Successful_Passes = sum(Successful_Passes, na.rm = TRUE),\n    Attempted_Passes  = sum(Attempted_Passes,  na.rm = TRUE),\n    .groups = \"drop\"                \n  ) %>%\n  tidyr::drop_na() %>%\n  dplyr::mutate(Pass_Suc = dplyr::if_else(Attempted_Passes > 0,\n                                          Successful_Passes / Attempted_Passes, NA_real_)) %>%\n  tidyr::replace_na(list(Pass_Suc = 0))\n\nedges <- edges %>%\n  dplyr::left_join(PassStats %>% dplyr::select(player1, player2, Pass_Suc),\n                   by = c(\"player1\", \"player2\")) %>%\n  tidyr::replace_na(list(Pass_Suc = 1))\n\n# Final tidy on nodes\nnodes <- nodes %>%\n  dplyr::arrange(events) %>%\n  dplyr::mutate(\n    playerId_short = dplyr::if_else(grepl(\" \", playerId),\n                                    sub(\".*\\\\s\", \"\", playerId),\n                                    playerId)\n  )\n\n      #set range for text to change on player circle\n      EPVRange <- (max(nodes$stat)) * 0.7\n      \n      # Plot\n\n    plot_passnet <- ggplot() +\n      \n      #setup the pitch\n      annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n      theme_pitch() +\n      annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n      annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n      \n      # add zone numbers\n      geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      \n      #set scale and color gradient\n      scale_fill_manual(values = c(\"#0000FF\",  \"red2\"), labels = c(\"Won\", \"Lost\"), name = \"\")\n\n      \n    if (pressmap == \"Yes\") {\n      \n      #plot pressing data\n      plot_passnet <- plot_passnet +\n        geom_point(data = PressData, aes(x = x, y = y, fill = outcome), shape = 21, size = 1.5, stroke = 0.5, show.legend = FALSE)\n\n    } else if (pressmap == \"\") {\n     \n      plot_passnet <- plot_passnet\n      \n    }\n      \n      #plot player connections\n    plot_passnet <- plot_passnet +\n      new_scale_fill() +\n      \n      geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, linewidth = (Total_Passes*0.25), colour = Pass_Suc)) +\n      guides(linewidth = \"none\") +\n\n      #plot player positions\n      geom_point(data = nodes, aes(x, y, fill = stat, size = Attempted_Passes), shape = 21, colour = \"black\", stroke = 0.5) +\n      \n      # set colour\n      scale_colour_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)),\n        breaks = c(0, .25, .5, .75, 1),\n        labels = scales::label_percent(accuracy = 1),\n        name   = \"Line Color = Passing Success\") +\n      \n      scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 0.5)), \n        breaks = scales::breaks_width(0.1), \n        name = \"Circle Colour = Threat (EPV)\") +\n      \n      # set scale\n      scale_size_continuous(range = c(2, 10),\n                        name = \"Attempted Passes\",\n        guide = \"none\")\n      \n      plot_passnet <- plot_passnet +\n      new_scale_color() +\n      \n      #plot player Numbers\n      geom_text(data = nodes,\n          aes(x, y, label = player_shirt,\n              color = stat > EPVRange,\n              size = Successful_Passes/4),\n          show.legend = FALSE) +\n      \n      # set scale    \n      scale_color_manual(values = c(\"TRUE\" = \"white\", \"FALSE\" = \"black\"), guide = \"none\") +\n      \n      #formatting\n      labs(title = PassNetTitle_text,\n           subtitle = plotCaption,\n           #tag = plotTag,\n           x = \"\",\n           colour = leg_title,\n           caption = My_caption) +\n      theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.tag = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            #axis.title.x = element_text(colour = \"black\", size = 6)\n            axis.title.x = element_blank())\n    }\n    \n    # If half pitch\n    \n    if (pitch == \"Half\") {\n      \n      plot_passnet <- plot_passnet +\n        coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n        labs(y = \" \") +\n        theme(axis.title.y = element_blank(),\n              axis.title.x = element_blank())\n      \n    } else if (pitch == \"Full\") {\n      \n      plot_passnet <- plot_passnet\n      \n    }\n    \n    # Press or not formatting\n    \n    if (pressmap == \"Yes\") {\n      \n      plot_passnet <- plot_passnet +\n\n        #formatting\n        labs(title = PassNetTitle_textD,\n             x = \"\",\n             colour = leg_title)\n      \n    } else if (pressmap == \"\") {\n      \n      plot_passnet <- plot_passnet\n    }\n\n    # logo or not\n  \n    if (logo == \"Yes\") {\n    \n    # annotate plot\n    Finalplot_passnet <- plot_passnet +\n    annotation_custom(AI_Logo, xmin = 90, xmax = 100, ymin = 105, ymax = 115) +\n      coord_cartesian(clip = \"off\") +\n      theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n    \n    } else if (logo == \"\") {\n      \n      Finalplot_passnet <- plot_passnet \n      #+\n       # theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n    }\n\n  return(Finalplot_passnet)\n  #return(list(plot = Finalplot_passnet, nodes = nodes, edges = edges))\n\n}\n```\n\n\n``` {r}\n#| label: Dashboard Setup\n#| echo: false\n#| output: false\n#| warning: false\n#| message: false\n\nlibrary(tidyverse)\nlibrary(shiny)\nlibrary(gifski)\nlibrary(magick)\nlibrary(systemfonts)\nlibrary(sysfonts)\nlibrary(fontawesome)\nlibrary(glue)\nlibrary(worldfootballR)\nlibrary(gganimate)\nlibrary(ggsoccer)\nlibrary(paletteer)\nlibrary(ggpointdensity)\nlibrary(ggthemes)\nlibrary(ggtext)\nlibrary(ggiraph)\n#library(ggiraphExtra)\nlibrary(ggimage)\nlibrary(gt)\nlibrary(gtExtras)\nlibrary(grid)\nlibrary(ggdensity)\nlibrary(treemapify)\nlibrary(magick)\nlibrary(readxl)\nlibrary(writexl)\nlibrary(chromote)\nlibrary(ggrepel)\nlibrary(png)\nlibrary(patchwork)\nlibrary(plotly)\nlibrary(reshape)\nlibrary(psych)\nlibrary(ggshakeR)\nlibrary(tidyquant)\nlibrary(gfonts)\nlibrary(extrafont)\nlibrary(extrafontdb)\nlibrary(ggnewscale)\nlibrary(stringr)\nlibrary(ggh4x)\nlibrary(ggforce)\nlibrary(scales)\nlibrary(slider)\n\n#load fonts\n#set fonts\nfont_add(\"Awesome\", regular = \"/Library/Fonts/Font Awesome 7 Brands-Regular-400.otf\")\n\n### data needed for match analysis script\n#set away\nMatch_Away <- paste0(\"Liverpool\")\n\n#Set Home\nMatch_Home <- paste0(\"Brentford\")\n\n#set match date\nGame_date <- paste(\"25-10-2025\")\n\n#set Game name\nGameName <- paste0(Match_Home,\" vs \", Match_Away)\n\n#set fixture\nMatch_Fixture <- paste0(Match_Home, \" vs \", Match_Away, \" - \", Game_date)\n\n#set database\nDataBaseName <- paste0(\"EPLComp_LFC_Games_2526\")\n\n######################\n\n#load match data\nfileName <- paste0(\"~/Documents/Dropbox files/AI LFC data/Data Sets/WhoScored/Season 2526/EPL Games/Processed Games/\", Match_Fixture, \".xlsx\")\nplottingData <- read_xlsx(fileName)\n\n#load player data\nPlayerfileName <- paste0(\"~/Documents/Dropbox files/AI lfc data/Data Sets/WhoScored/Season 2526/EPL Players/Processed Games/\", Match_Fixture, \"- PlayerData.xlsx\")\nPlayerdata <- read_xlsx(PlayerfileName)\n\n#load sesondata\nfileName <- paste0(\"~/Documents/Dropbox files/AI LFC data/Data Sets/WhoScored/Databases/\", DataBaseName, \".xlsx\")\nSeasonData <- read_xlsx(fileName)\n\n#add in team group to data base\nSeasonData <- SeasonData %>%\n  mutate(Team_Group = ifelse(TeamName == \"Liverpool\", \"Liverpool\", \"All Oppo\"))\n\n#set match day number\n#MatchDay <- first(na.omit(plottingData$Match_day))\nMatchDay <- 9\n\nGame_date <- first(na.omit(plottingData$Game_date))\n\n#set Home h/a\nHomeHA <- paste(\"Home\")\n\n#set Away h/a\nAwayHA <- paste(\"Away\") \n\n#set game week\nGameWeek <- paste0(\"MD \",MatchDay)\n\n#set Away color\nColor_Home <- paste(\"red\")\n\n#set Away text\nColor_Home_Text <- paste(\"white\")\n\n#set away color scale\nColorScale_Home <- paste(\"ggsci::red_material\")\n\n#set away color scale con\nColorScale_HomeC <- paste(\"ggthemes::Red\")\n\n#set Home color\nColor_Away <- paste(\"green4\")\n\n#set home text color\nColor_Away_Text <- paste(\"white\")\n\n#set home color scale\nColorScale_Away <- paste(\"ggsci::green_material\")\n\n#set home color scale con\nColorScale_AwayC <- paste(\"ggthemes::Green\")\n\n\n#set viz location for camcorder adn blue sky images\nVizlocation <- paste0(\"~/Documents/Dropbox files/AI LFC data/R files/AI UP/Scripts/Viz Pack/Season 2526/EPL/\", GameWeek)\n\n#seet pk timte\nPKTime <- 00\n\n#redcard (min before)\nredcard <- 00\n\n#redcard (min before)\nredcard2 <- 00\n\n#set league points\nLeague_Points <- 0\nAFC_League_Points <- 00\nMC_League_Points <- 00\n\n#set man of the match\nHMOM = paste(\"\")\nAMOM = paste(\"\")\n\n#set Waves titles\nWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\nAwayWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#set xg line titles \nxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\nAwayxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\n#set dribbles title\nDribblesTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Dribbles (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set duels title\nDuelsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set PPs title\nPPsTitle_textHalf <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayPPsTitle_textHalf <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nAwayPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nHomeTertiary_title <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Match  </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Possession</span><span style='color:grey12;font-size:16px;'> to </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Field Tilt</span><span style='color:gray12;font-size:16px;'> conversion</span>\"))\n\nAwayTertiary_title <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Match  </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Possession</span><span style='color:grey12;font-size:16px;'> to </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Field Tilt</span><span style='color:gray12;font-size:16px;'> conversion</span>\"))\n\n##new socials\nsocial_caption <- function(twitter=\"@Barts78\",\n                           github = \"Barts78\",\n                           linkedin= \"Phil-barter\",\n                           mastodon= \"@DrBarts\",\n                           threads = \"Barts78\",\n                           data = \"OPTA\",\n                           blueSky = \"@barts78\",\n                           icon_color=\"black\",\n                           font_color=\"#454545\",\n                           bg_color=\"snow\",\n                           font_family=\"sans-serif\"){\n  \n  icons = list(\n    twitter = \"&#xe61a\",\n    github = \"&#xf09b\",\n    linkedin = \"&#xf08c\",\n    mastodon = \"&#xf4f6\",\n    threads = \"&#xe618\",\n    data = \"&#xf16b\",\n    blueSky = \"&#xe671\"\n  )   \n  \n  social = list(threads = threads, linkedin = linkedin, twitter = twitter, mastodon = mastodon, github = github, blueSky = blueSky, data = data)\n  social = social[!is.na(social)]\n  \n  caption = \"\"\n  for (name in names(social)) {\n    icon = icons[name]\n    info = social[name]\n    html = glue(\"<span style='font-family:\\\"Font Awesome 7 Brands\\\";color:{icon_color};font-size:8px;'>{icon};</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\n                <span style='font-family:{font_family};color:{font_color};font-size:8px;'>{info}</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\")\n    \n    \n    caption = paste0(caption,html)\n  }\n  \n  caption\n}\n\n#create social caption\nmy_socials <- social_caption(twitter = \"@Barts78\",\n                             github = \"Barts78\",\n                             linkedin = \"Phil-barter\",\n                             mastodon = \"@DrBarts\",\n                             threads = NA,\n                             blueSky = \"@barts78\",\n                             data = \"OPTA\",\n                             icon_color = \"#454545\",\n                             font_color = \"#454545\",\n                             bg_color = \"snow\",\n                             font_family = \"sans-serif\")\n\nmy_datasource <- paste0('<span style=\"font-family:\\'Font Awesome 7 Free\\', Arial, sans-serif;color:#454545;font-size:8px;\">&#x1F4BE;</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>',\n                        '<span style=\"font-family:sans-serif;color:#454545;font-size:8px;\">OPTA</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>')\n\nMy_caption <- paste0(my_socials)\n\n```\n\n```{r}\n#| output: false\n#| label: set Summary values\n#| message: false\n#| warning: false\n\n#set summary values\nTotal_EPV <- sum(plottingData$Cumalative_EPV)\nGameTime <- max(plottingData$expandedMinute)\nOutofPlayTime <- round(sum(plottingData$Out_of_play_time)/60,2)\nInPlayTime <- round(sum(plottingData$In_play_time)/60,2)\nPossession <- round(sum(plottingData$Touches),2)\nHomePossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName == Match_Home))/Possession)*100),2)\nAwayPossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName == Match_Away))/Possession)*100),2)\nHomeEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomeEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomexT <- round(sum(plottingData$xTvalue[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayxT <- round(sum(plottingData$xTvalue[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomexTA <- round(sum(plottingData$TeamxT[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayxTA <- round(sum(plottingData$TeamxT[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomexG <- round(sum(plottingData$xG[plottingData$TeamName == Match_Home]),2)\nAwayxG <- round(sum(plottingData$xG[plottingData$TeamName == Match_Away]),2)\nHomeNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName == Match_Home]),2)\nAwayNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName == Match_Away]),2)\nHomeBCs <- round(sum(plottingData$BCs[plottingData$TeamName == Match_Home]),0)\nAwayBCs <- round(sum(plottingData$BCs[plottingData$TeamName == Match_Away]),0)\nFinal_Third_Possession <- round(sum(plottingData$Final_Third_Touches),2)\nHomeFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName == Match_Home))/Final_Third_Possession)*100),2)\nAwayFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName == Match_Away))/Final_Third_Possession)*100),2)\nHomeDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName == Match_Home]),0)\nAwayDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName == Match_Away]),0)\nHomePasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName == Match_Home]),0)\nAwayPasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName == Match_Away]),0)\nHomePPDA <- round(sum(AwayPasses/HomeDActions),2)\nAwayPPDA <- round(sum(HomePasses/AwayDActions),2)\nHomeEPVCon <- round(sum(HomexG/HomeEPVA),2)\nAwayEPVCon <- round(sum(AwayxG/AwayEPVA),2)\nHomeProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName == Match_Home]),2)\nAwayProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName == Match_Away]),2)\nHomeCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName == Match_Home]),2)\nHomeProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName == Match_Home]),2)\nAwayCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName == Match_Away]),2)\nAwayProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName == Match_Away]),2)\nHomeGoals <- round(sum(plottingData$Home_Goals),0)\nHomeSOT <- round(sum(plottingData$OTShots[plottingData$TeamName == Match_Home]),0)\nHomeShootingP <- round(sum(HomeGoals/HomeSOT), 2)\nAwayGoals <- round(sum(plottingData$Away_Goals),0)\nAwaySOT <- round(sum(plottingData$OTShots[plottingData$TeamName == Match_Away]),0)\nAwayShootingP <- round(sum(AwayGoals/AwaySOT), 2)\nHomePPDO <- round(sum(HomeShootingP + (1 - AwayShootingP))*1000, 0)\nAwayPPDO <- round(sum(AwayShootingP + (1 - HomeShootingP))*1000, 0)\n\n#prepare first sub time data (min before sub)\nfirstSubHome <- plottingData %>%\n  filter(TeamName == Match_Home, SubTime != 0) %>%\n  summarise(firstsubhome = min(SubTime)) %>%\n  pull(firstsubhome)\n\nfirstSubAway <- plottingData %>%\n  filter(TeamName == Match_Away, SubTime != 0) %>%\n  summarise(firstsubaway = min(SubTime)) %>%\n  pull(firstsubaway)\n\n# set-up data frame from main variables above for summary tables\nPPDOTable <- data.frame(TeamName = c(Match_Home, Match_Away),\n                         PPDO = c(HomePPDO, AwayPPDO))\n\n```\n\n# Line Up\n\n```{r}\n#| label: lineup setup\n#| output: false\n\nPlayerdata <- Playerdata %>%\n  filter(role == \"Substitute\") %>%\n    select(Team = TeamName, Player = PlayerName, Shirt_Number = jerseyNumber, Mins_Played = substitution_minute, role) %>%\n    replace_na(list(Mins_Played = 0))\n\nMD_lineups <- plottingData %>%\n  select(TeamName, playerId, playerNumber, Shirt_Number = player_shirt, role, minutes_played) %>%\n  group_by(playerId, TeamName) %>%\n  replace_na(list(minutes_played = 0)) %>%\n  summarise(Mins_Played = min(minutes_played),  playerNumber = first(playerNumber), Shirt_Number = first(Shirt_Number),\n    role = first(role), .groups = \"drop\") %>%\n  select(Team = TeamName, Player = playerId, Shirt_Number, Mins_Played, role)\n\nMD_lineups <- bind_rows(MD_lineups, Playerdata)\n\n```\n\n## Row {.flow}\n### column\n```{r}\n#| label: Line up Home\n#| message: false\n#| warning: false\n#| results: asis\nlineupdataHome <- MD_lineups %>%\n  filter(Team == Match_Home) %>%\n  arrange(desc(Mins_Played)) %>%\n  mutate(role = factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\", \"Substitute\"))) %>%\n  arrange(role) %>%\n  \n  #lineupdataHome <- lineupdataHome %>%\n  gt(groupname_col = \"role\") %>%\n  cols_hide(Team) %>%\n  cols_move_to_end(columns = c(Shirt_Number, Player)) %>%\n  #cols_move_to_end(columns = c(Player, Shirt_Number, Mins_Played, Sub_On)) %>%\n  #row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\", \"Substitute\")) %>%\n  cols_align(align = \"right\", columns = (rev(everything()))) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Line up\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_style(\n    style = list(cell_text(align = \"right\"), \n                 cell_fill(color = \"#E5E5E5\")),\n    locations = cells_body(columns = \"Player\")) %>%\n    tab_style(\n    style = cell_text(color = \"#E5E5E5\"),\n    locations = cells_column_labels('Player')) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text, align = \"right\"), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"Right\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 20,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nlineupdataHome\n```\n### column\n```{r}\n#| label: Line up Away\n#| message: false\n#| warning: false\n#| results: asis\n\nlineupdataAway <- MD_lineups %>%\n  filter(Team == Match_Away) %>%\n  arrange(desc(Mins_Played)) %>%\n  gt(groupname_col = \"role\", rowname_col = \"Player\") %>%\n  cols_hide(Team) %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\", \"Substitute\")) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Line up\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text, align = \"left\"), \n                 cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"Left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 20,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\n\nlineupdataAway\n```\n\n# Match Summary\n``` {r}\n#| output: false\n#| label: Season summary table setup\n#posession and goals by team\nMatchSummarySeasonData <- compute_season_summary(SeasonData, group_vars = c(\"Team_Group\")) \n\nMatchSummarySeasonData <- MatchSummarySeasonData %>%\n  select('Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummarySeasonHalfData <- compute_season_summary(SeasonData %>% mutate(Half = case_when(\n  period == 1 ~ \"First Half\",\n  period == 2 ~ \"Second Half\",\n  period == 3 ~ \"First Half Extra Time\",\n  period == 4 ~ \"Second Half Extra Time\",\n  TRUE ~ \"Injury Time\")\n), group_vars = c(\"Half\", \"Team_Group\"))\n\nMatchSummarySeasonHalfData <- MatchSummarySeasonHalfData %>%\n  select(Half, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummarySeasonPeriodData <- compute_season_summary(SeasonData, group_vars = c(\"Game_Period\", \"Team_Group\"))\n\nMatchSummarySeasonPeriodData <- MatchSummarySeasonPeriodData %>%\n  select(Game_Period, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'ONT Shots' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummarySeasonGameStateData <- compute_season_summary(SeasonData, group_vars = c(\"Game_State\", \"Team_Group\"))\n\nMatchSummarySeasonGameStateData <- MatchSummarySeasonGameStateData %>%\n  select(Game_State, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryGameNameData <- compute_summary(SeasonData, group_vars = c(\"game_name\", \"Team_Group\"))\n\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  select('Fixture' = game_name, Match_day, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\n```\n\n``` {r}\n#| output: false\n#| message: false\n#| warning: false\n#| label: Match summary table setup\n#posession and goals by team\nMatchSummaryData <- compute_summary(plottingData, group_vars = c(\"TeamName\")) \n\n\nMatchSummaryData <- MatchSummaryData %>%\n  left_join(PPDOTable, by = c(\"TeamName\" = \"TeamName\"), copy = TRUE) \n\n\nMatchSummaryData <- MatchSummaryData %>%\n  select('Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, PPDO, 'Possession Control' = Posession_Control)\n\nMatchSummaryHalfData <- compute_summary(plottingData %>% mutate(Half = case_when(\n  period == 1 ~ \"First Half\",\n  period == 2 ~ \"Second Half\",\n  period == 3 ~ \"First Half Extra Time\",\n  period == 4 ~ \"Second Half Extra Time\",\n  TRUE ~ \"Injury Time\")\n), group_vars = c(\"Half\", \"TeamName\"))\n\nMatchSummaryHalfData <- MatchSummaryHalfData %>%\n  select(Half, 'Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control)\n\nMatchSummaryPeriodData <- compute_summary(plottingData, group_vars = c(\"Game_Period\", \"TeamName\"))\n\nMatchSummaryPeriodData <- MatchSummaryPeriodData %>%\n  select(Game_Period, 'Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'ONT Shots' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control)\n\nMatchSummaryGameStateData <- compute_summary(plottingData, group_vars = c(\"Game_State\", \"TeamName\"))\n\nMatchSummaryGameStateData <- MatchSummaryGameStateData %>%\n  select(Game_State, 'Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control)\n\n```\n```{r}\n#| output: false\n#| message: false\n#| warning: false\n#| label: Match MC setup\n\n#Load data (opta Data)\ndashboard_data <- plottingData\n\n#Home team Dashboard data\ndashboard_data <- dashboard_data %>%\n  filter(TeamName == Match_Home) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period)\n\n#Away dashboard data\n#Load data\nAwaydashboard_data <- plottingData\n\nAwaydashboard_data <- Awaydashboard_data %>%\n  filter(TeamName == Match_Away) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period)\n\n#Matchday MC Data setup\nHomexGMC <- HomeShots <- dashboard_data %>%\n  filter(period != 5) %>%\n  select(xG)\nAwayxGMC <- AwayShots <- Awaydashboard_data %>%\n  filter(period != 5) %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(dashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(Awaydashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n## Row {.tabset}\n```{r}\n#| title: Match Summary tables\n#| label: Summary tables\n#| results: asis\nMatchSummaryTable <- MatchSummaryData %>%\n  gt(groupname_col = \"Team\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - Full Time**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(3, 16:19),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(2, 6, 20:21, 24, 26, 28),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(2:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:18)) %>%\n  tab_spanner(label = \"Passes\", columns = c(19:26)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = Match_Away)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = Match_Home)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \nMatchSummaryTable\n\nMatchSummaryHalfsTable <- MatchSummaryHalfData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Half\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - By Half**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 17:20),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 21:22, 25, 27, 29),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:7)) %>%\n  tab_spanner(label = \"Shots\", columns = c(8:19)) %>%\n  tab_spanner(label = \"Passes\", columns = c(20:27)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryHalfData$Half)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Home),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Home_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Home\n    )\n  ) %>%\n  \n  tab_style(\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Away\n    )\n  ) %>%\n  \n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryHalfsTable\n\nMatchSummaryPeriodTable <- MatchSummaryPeriodData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_Period\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - By Game Period**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 17:20),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 21:22, 25, 27, 29),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:7)) %>%\n  tab_spanner(label = \"Shots\", columns = c(8:19)) %>%\n  tab_spanner(label = \"Passes\", columns = c(20:27)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryPeriodData$Game_Period)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n\n  tab_style(\n    style = list(cell_fill(color = Color_Home),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Home_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Home\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Away\n    )\n  ) %>%\n  \n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryPeriodTable\n\nMatchSummaryGameStateTable <- MatchSummaryGameStateData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_State\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - By Game State**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  #cols_hide(`Possession %`) %>%\n  fmt_number(\n    columns = c(4, 17:20),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 21:22, 25, 27, 29),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:7)) %>%\n  tab_spanner(label = \"Shots\", columns = c(8:19)) %>%\n  tab_spanner(label = \"Passes\", columns = c(20:27)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Home),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Home_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Home\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Away\n    )\n  ) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameStateData$Game_State)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameStateTable\n\n```\n\n``` {r}\n#| title: Season Summary Tables\n#| results: asis\n#| label: Season summary tables\n\n\nMatchSummarySeasonTable <- MatchSummarySeasonData %>%\n  gt(groupname_col = \"Team\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - Full Games**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(3, 14:17),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(2, 6, 19, 22, 24, 26, 30),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = \"white\"), cell_fill(color = \"black\")),\n    locations = cells_row_groups(groups = \"All Oppo\")) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = \"white\"), cell_fill(color = \"red4\")),\n    locations = cells_row_groups(groups = \"Liverpool\")) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"#B22222\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \nMatchSummarySeasonTable\n\nMatchSummarySeasonHalfsTable <- MatchSummarySeasonHalfData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Half\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Half**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryHalfData$Half)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n    tab_style(\n    style = list(cell_fill(color = \"red4\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"Liverpool\"\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"All Oppo\"\n    )\n  ) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummarySeasonHalfsTable\n\nMatchSummarySeasonPeriodTable <- MatchSummarySeasonPeriodData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_Period\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game Period**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryPeriodData$Game_Period)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"red4\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"Liverpool\"\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"All Oppo\"\n    )\n  ) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummarySeasonPeriodTable\n\nMatchSummarySeasonGameStateTable <- MatchSummarySeasonGameStateData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_State\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game State**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(5, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    style = list(cell_fill(color = \"red4\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"Liverpool\"\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"All Oppo\"\n    )\n  ) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameStateData$Game_State)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  \n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummarySeasonGameStateTable\n\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  mutate(Match_day = as.numeric(Match_day)) %>%\n  filter(!Match_day == 0) %>%\n  arrange(Match_day)\n  \n  MatchSummaryGameNameTable <- MatchSummaryGameNameData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Match_day\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Match Day**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(6, 16:19),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(4, 8, 21, 24, 26, 28, 32),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameNameData$Match_day)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == \"All Oppo\")),\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\"))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == \"Liverpool\")),\n    style = list(cell_fill(color = \"red4\"),\n                cell_text(size = 16,  weight = \"bold\", color = \"white\"))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameNameTable\n\n```\n\n## Row {.flow}\n```{r}\n#| label: Match Goals Probablity Plot\n# Create a tiled plot for the MC Match scores\nMD_MC_Plot <- ggplot(long_prob_matrix, aes(x = as.numeric(Home), y = as.numeric(Away), fill = Probability)) +\n  geom_tile(colour = \"black\") +\n  geom_text(aes(label = paste(Probability, \"%\")), size = 4, color = if_else(long_prob_matrix$Probability > 4.5, Color_Home_Text, Color_Away_Text),) +\n        scale_fill_gradientn(\n        colors = c(Color_Away, Color_Home),\n        values = scales::rescale(c(0, 1)), \n        name = \"Probablity\") +\n  scale_x_continuous(breaks = seq(0, max(long_prob_matrix$Home), 1)) +\n  scale_y_continuous(breaks = seq(0, max(long_prob_matrix$Away), 1)) +\n  labs(title = paste(\"Match Final Score Probablity (10000 sims)\"),\n        subtitle = paste(Match_Fixture),\n        x = paste0(Match_Home, \" Goals\"), \n        y = paste0(Match_Away, \" Goals\"),\n        caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Match Goals Probality Plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n```{r}\n#| label: Match Result Probablity Plot\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Match Result Probablity Plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n## Row {.flow}\n```{r}\n#|label: Home Match teratitory plot\n#data imports\ndf <- plottingData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    possession_roll5 = slide_dbl(Home_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE),\n    Field_tilt_roll5 = slide_dbl(Home_FThird_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE)) %>% \n  \n  select(expandedMinute, Home_Possession, Away_Possession, TeamName, possession_roll5, Field_tilt_roll5, Home_FThird_Possession, Away_FThird_Possession) %>%   \n  mutate(across(everything(), ~replace_na(., 0))) %>%\n  mutate(\n    Possession_diff = possession_roll5 - Field_tilt_roll5   # positive = home leading\n  )\n\n# 2) Smooth the two lines into 'pred' (loess) and clamp to [0,1]\nlo_home <- loess(possession_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\nlo_away <- loess(Field_tilt_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\n\npred <- tibble(expandedMinute = sort(unique(df$expandedMinute))) %>%\n  mutate(\n    home_s = pmax(0, pmin(1, predict(lo_home, newdata = cur_data()))),\n    away_s = pmax(0, pmin(1, predict(lo_away, newdata = cur_data())))\n  )\n\n\n\n#data wrangling \nseg <- pred %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    xmin = expandedMinute,\n    xmax = lead(expandedMinute),\n    home_next = lead(home_s),\n    away_next = lead(away_s)\n  ) %>%\n  filter(!is.na(xmax)) %>%\n  mutate(\n    ymin = pmin(home_s, away_s, home_next, away_next),\n    ymax = pmax(home_s, away_s, home_next, away_next),\n    leader = ifelse(home_s > away_s, \"home\", \"away\")\n  )\n\neps <- 1e-3  # small tolerance around crossings\n\n# seg must already have: expandedMinute, home_s, away_s\nrib <- seg %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    ymin = pmin(home_s, away_s),\n    ymax = pmax(home_s, away_s),\n    home_on_top = home_s > away_s + eps,\n    away_on_top = away_s > home_s + eps\n  )\n\n# Two masked ribbons (no overlap)\nrib_home <- rib %>%\n  mutate(ymin = ifelse(home_on_top, ymin, NA_real_),\n         ymax = ifelse(home_on_top, ymax, NA_real_))\n\nrib_away <- rib %>%\n  mutate(ymin = ifelse(away_on_top, ymin, NA_real_),\n         ymax = ifelse(away_on_top, ymax, NA_real_))\n#plot the ribbons and lines\nggplot() +\n  # ribbon when HOME is above\n  geom_ribbon(data = rib_home,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Home, alpha = 0.30, color = NA) +\n  # ribbon when AWAY is above\n  geom_ribbon(data = rib_away,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Away, alpha = 0.30, color = NA) +\n\n\n  # smoothed lines\n  geom_line(data = seg, aes(x = expandedMinute, y = home_s),\n            linewidth = 1.2, color = Color_Home) +\n  geom_line(data = seg, aes(x = expandedMinute, y = away_s),\n            linewidth = 1.2, color = Color_Away) +\n  \n  scale_fill_manual(\n    values = c(\"home\" = Color_Home, \"away\" = Color_Away),\n    name   = \"Tertiary\",\n    labels = c(\"home\" = \"Possession (red)\", \"away\" = \"Field Tilt (blue)\")\n  ) +\n  \n  scale_y_continuous(\n    labels = label_percent(accuracy = 1),   # show 25% instead of 0.25\n    limits = c(0, 1)                        # keep axis from 0% to 100%\n  ) +\n  scale_x_continuous(breaks = seq(0, max(seg$expandedMinute), 15)) +\n  \n  labs(\n    title    = HomeTertiary_title,\n    subtitle = Match_Fixture,\n    x        = \"Match Time (Mins)\",\n    y        = \"Possession (%)\",\n    caption  = My_caption\n  ) +\n  coord_cartesian(ylim = c(0, 1), clip = \"off\") +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    legend.background = element_rect(fill = \"snow\"),\n    legend.key = element_rect(fill = \"snow\"),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    plot.title = element_markdown(),\n    plot.subtitle = element_markdown(),\n    plot.caption = element_markdown(),\n    legend.title = element_text(colour = \"black\", size = 6),\n    legend.text  = element_text(colour = \"black\", size = 6),\n    axis.title = element_text(colour = \"black\", size = 8),\n    \n    plot.margin  = margin(28, 20, 48, 20)\n  ) +\n  # team labels\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 1,\n           label = paste(Match_Away, \" Defensive Goal Line\"), vjust = 0, hjust = 0.5,\n           size = 4, color = Color_Away_Text, fontface = \"bold\", fill = Color_Away) +\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 0.05,\n           label = paste(Match_Home, \" Defensive Goal Line\"), vjust = 1, hjust = 0.5,\n           size = 4, color = Color_Home_Text, fontface = \"bold\", fill = Color_Home)\n\n```\n```{r}\n#|label: Away Match teratitory plot\n#data imports\ndf <- plottingData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    possession_roll5 = slide_dbl(Away_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE),\n    Field_tilt_roll5 = slide_dbl(Away_FThird_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE)) %>% \n  \n  select(expandedMinute, Home_Possession, Away_Possession, TeamName, possession_roll5, Field_tilt_roll5, Home_FThird_Possession, Away_FThird_Possession) %>%   \n  mutate(across(everything(), ~replace_na(., 0))) %>%\n  mutate(\n    Possession_diff = possession_roll5 - Field_tilt_roll5   # positive = home leading\n  )\n\n# 2) Smooth the two lines into 'pred' (loess) and clamp to [0,1]\nlo_home <- loess(possession_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\nlo_away <- loess(Field_tilt_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\n\npred <- tibble(expandedMinute = sort(unique(df$expandedMinute))) %>%\n  mutate(\n    home_s = pmax(0, pmin(1, predict(lo_home, newdata = cur_data()))),\n    away_s = pmax(0, pmin(1, predict(lo_away, newdata = cur_data())))\n  )\n\n#pred <- df %>% transmute(expandedMinute, home_s = possession_roll5, away_s = Field_tilt_roll5).\n\n#data wrangling \nseg <- pred %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    xmin = expandedMinute,\n    xmax = lead(expandedMinute),\n    home_next = lead(home_s),\n    away_next = lead(away_s)\n  ) %>%\n  filter(!is.na(xmax)) %>%\n  mutate(\n    ymin = pmin(home_s, away_s, home_next, away_next),\n    ymax = pmax(home_s, away_s, home_next, away_next),\n    leader = ifelse(home_s > away_s, \"home\", \"away\")\n  )\n\neps <- 1e-3  # small tolerance around crossings\n\n# seg must already have: expandedMinute, home_s, away_s\nrib <- seg %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    ymin = pmin(home_s, away_s),\n    ymax = pmax(home_s, away_s),\n    home_on_top = home_s > away_s + eps,\n    away_on_top = away_s > home_s + eps\n  )\n\n# Two masked ribbons (no overlap)\nrib_home <- rib %>%\n  mutate(ymin = ifelse(home_on_top, ymin, NA_real_),\n         ymax = ifelse(home_on_top, ymax, NA_real_))\n\nrib_away <- rib %>%\n  mutate(ymin = ifelse(away_on_top, ymin, NA_real_),\n         ymax = ifelse(away_on_top, ymax, NA_real_))\n#plot the ribbons and lines\nggplot() +\n  # ribbon when HOME is above\n  geom_ribbon(data = rib_home,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Home, alpha = 0.30, color = NA) +\n  # ribbon when AWAY is above\n  geom_ribbon(data = rib_away,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Away, alpha = 0.30, color = NA) +\n\n\n  # smoothed lines\n  geom_line(data = seg, aes(x = expandedMinute, y = home_s),\n            linewidth = 1.2, color = Color_Home) +\n  geom_line(data = seg, aes(x = expandedMinute, y = away_s),\n            linewidth = 1.2, color = Color_Away) +\n  \n  scale_fill_manual(\n    values = c(\"home\" = Color_Home, \"away\" = Color_Away),\n    name   = \"Tertiary\",\n    labels = c(\"home\" = \"Possession (red)\", \"away\" = \"Field Tilt (blue)\")\n  ) +\n  \n  scale_y_continuous(\n    labels = label_percent(accuracy = 1),   # show 25% instead of 0.25\n    limits = c(0, 1)                        # keep axis from 0% to 100%\n  ) +\n  scale_x_continuous(breaks = seq(0, max(seg$expandedMinute), 15)) +\n  \n  labs(\n    title    = AwayTertiary_title,\n    subtitle = Match_Fixture,\n    x        = \"Match Time (Mins)\",\n    y        = \"Possession (%)\",\n    caption  = My_caption\n  ) +\n  coord_cartesian(ylim = c(0, 1), clip = \"off\") +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    legend.background = element_rect(fill = \"snow\"),\n    legend.key = element_rect(fill = \"snow\"),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    plot.title = element_markdown(),\n    plot.subtitle = element_markdown(),\n    plot.caption = element_markdown(),\n    legend.title = element_text(colour = \"black\", size = 6),\n    legend.text  = element_text(colour = \"black\", size = 6),\n    axis.title = element_text(colour = \"black\", size = 8),\n    \n    plot.margin  = margin(28, 20, 48, 20)\n  ) +\n  # team labels\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 1,\n           label = paste(Match_Home, \" Defensive Goal Line\"), vjust = 0, hjust = 0.5,\n           size = 4, color = Color_Home_Text, fontface = \"bold\", fill = Color_Home) +\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 0.05,\n           label = paste(Match_Away, \" Defensive Goal Line\"), vjust = 1, hjust = 0.5,\n           size = 4, color = Color_Away_Text, fontface = \"bold\", fill = Color_Away)\n\n```\n\n\n``` {r}\n#| output: false\n#| message: false\n#| warning: false\n#MC Season calculations for top three\n#load data\n\n#Awaydashboard__Season_data <- Awaydashboard__Season_data %>%\n#  filter(TeamName == Match_Away) %>%\n#  filter(TotalShots == 1) %>%\n#  filter(!situation == \"NA\") %>%\n#  mutate(TotalxG = cumsum(xG)) %>%\n#  mutate(TotalNPxG = cumsum(NPxG)) %>%\n#  mutate(TotalxGOT = cumsum(xGOT)) %>%\n#  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n#  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n#  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n#  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n#  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, #TotalShots, xG, NPxG, xGOT, expandedMinute, type)\n\nAwayShotsALL <- Awaydashboard_data %>%\n  select(xGA = xG)\n\nHomeShotsALL <- dashboard_data %>%\n  select(xG)\n\n#predit seaosn on a match by match basis\n# Set simulation parameters\nn_sims <- 10000  # Number of simulations\nn_games <- 38    # Number of games in season\nremaining_games <- 38\n#- n_games\ncurrent_points <- League_Points\nwin_prob <- 0.5   # Probability of winning a game (adjust as needed)\ndraw_prob <- 0.5 # Probability of drawing a game (adjust as needed)\n#loss_prob <- 1 - win_prob - draw_prob\nloss_prob <- 0.5\n\n# Simulate goals scored and conceded using appropriate distributions\n# (adjust distributions and parameters based on your data or assumptions)\ngoals_scored <- rpois(n_sims * n_games, lambda = HomeShotsALL$xG)  # Poisson distribution for goals scored\ngoals_conceded <- rpois(n_sims * n_games, lambda = AwayShotsALL$xGA)  # Poisson distribution for goals conceded\n\n# Reshape data into a single data frame for clarity\nsim_data <- data.frame(\n  sim_id = rep(1:n_sims, each = n_games),\n  game_id = 1:n_games,\n  goals_scored = goals_scored,\n  goals_conceded = goals_conceded\n)\n\n# Calculate points per game for each simulated team\nsim_data <- sim_data %>%\n  mutate(\n    points = case_when(\n      goals_scored > goals_conceded ~ 3,\n      goals_scored == goals_conceded ~ 1,\n      TRUE ~ 0\n    )\n  )\n\nP_Season = (remaining_games/38)\n#print(P_Season)\n\n# Calculate total points per season for each simulation\nseason_totals <- sim_data %>%\n  group_by(sim_id) %>%\n  summarise(total_points = sum(points) * P_Season + current_points)\n\n# Limit total points to the maximum possible (current + remaining games * 3)\nseason_totals <- season_totals %>%\n  mutate(total_points = pmin(total_points, current_points + remaining_games * 3))\n\n# Calculate and summarize final point probabilities\npoint_probs <- season_totals %>%\n  mutate(total_points = round(total_points)) %>%  \n  count(total_points) %>%\n  mutate(prob = (n / n_sims) * 100) %>%\n  arrange(total_points) %>%\n  mutate(total_points = round(total_points))\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nSeason_MC_Plot <- ggplot(point_probs, aes(x = total_points, y = prob)) +\n  geom_bar(stat = \"identity\", fill = Color_Home, color = \"black\") +\n  labs(title = \"Liverpool Final Predicted Point Totals (10000 Sims)\",\n       subtitle = paste(\"After Match Day \", MatchDay),\n       x = \"Final Points\",\n       y = \"Probability %\",\n       caption = my_socials) +\n#  scale_x_continuous(limits = c((min(League_Points)), (max(point_probs$total_points))), \n#                     breaks = seq(0, (max(point_probs$total_points)), 1)) +\n  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 5)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#Season_MC_Plot\n\n```\n\n# Pass Maps\n```{r}\n# data wrangling for pass connection tables\n\nPassConnections <- plottingData \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"x\", new_names = \"Endx\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"y\", new_names = \"Endy\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"second\", new_names = \"End_second\", len = 1, up = FALSE)\n\n# number of passes or carries between players\nEPVEvents <- PassConnections %>%\n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Attempted_Passes, Successful_Passes, UnSuccessful_Passes, BCs, Key_Passes, Prog_Passes, Attempted_Carries, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Final_Third_Carries,EPV, xT, x, y, Endx, Endy, PK_Box_Passes, Final_Third_Passes, Cross_Passes, Long_Passes, expandedMinute)\n\n\n#EPV events prep for main tables\nEPVPassEvents <- EPVEvents %>%\n  filter(Attempted_Passes == 1) %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Successful Passes' = Successful_Passes, UnSuccessful_Passes, 'Long Passes' = Long_Passes, Crosses = Cross_Passes, 'PK Box Passes' = PK_Box_Passes, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, 'Final Third Passes' = Final_Third_Passes,  BCs, EPV, xT, 'Game Min' = expandedMinute)\n\nEPVCarrieEvents <- EPVEvents %>%\n    filter(Attempted_Carries == 1) %>%\n    select(Passer_Team, Passer, Receiver, Receiver_Team, 'Successful Carries' = Successful_Carries, UnSuccessful_Carries, 'Prog Carries' = Prog_Carries, 'Final Third Carries' = Final_Third_Carries,  BCs, EPV, xT, 'Game Min' = expandedMinute)\n  \n\n# number of passes between players\nPassConnections <- PassConnections %>%\n  filter(Attempted_Passes == 1) %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue, x, y, Endx, Endy, PK_Box_Passes, Final_Third_Passes, Cross_Passes, Long_Passes, second, End_second, EventTime) %>%\n  mutate(Pass_time = round(((End_second - second) + 60) %% 60, 2))\n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Long_Passes = sum(Long_Passes), Final_Third_Passes = sum(Final_Third_Passes), PK_Box_Passes = sum(PK_Box_Passes), Crosses = sum(Cross_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), Pass_time = mean(EventTime)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 5) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Long_Passes = sum(Long_Passes), 'Final Third Passes' = sum(Final_Third_Passes), 'PK Box Passes' = sum(PK_Box_Passes), Crosses = sum(Crosses), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass, Pass_time)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Final Third Passes', 'PK Box Passes', Crosses,  'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, 'EPV / Pass' = EPV_P_Pass, 'Pass Time' = Pass_time)\n\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: 1st Half passnetwork\n\n\nHomepassPlot1stWD <- plot_passnet_AI(data = plottingData,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlot1stWD\n\n#save Plot\nggsave(path = Vizlocation, \"Home Passnetwork 1st  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: 2nd Half passnetwork\n\n\nHomepassPlot2ndWD <- plot_passnet_AI(data = plottingData,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlot2ndWD\n\n#save Plot\nggsave(path = Vizlocation, \"Home Passnetwork 2nd  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n### column {.tabset}\n```{r}\n#| title: 1st Half passnetwork\n\n\nAwaypassPlot1stWD <- plot_passnet_AI(data = plottingData,  \n                                   team_name = Match_Away, scale_stat = \"EPV\", \n                                   scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                   plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlot1stWD\n\n#save Plot\nggsave(path = Vizlocation, \"Away Passnetwork 1st  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: 2nd Half passnetwork\n\n\nAwaypassPlot2ndWD <- plot_passnet_AI(data = plottingData,  \n                                   team_name = Match_Away, scale_stat = \"EPV\", \n                                   scale_color = Color_Away, text_color = Color_Away_Text,  subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                   plot_start = 46, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlot2ndWD\n\n#save Plot\nggsave(path = Vizlocation, \"Away Passnetwork 2nd  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Passnetwork to 1st Sub \n#| label: Home 1st subs passnetwork\nHomepassPlot1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                   team_name = Match_Home, scale_stat = \"EPV\", \n                                   scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" to 1st Subs\"),\n                                   plot_start = 00, plot_finish = firstSubHome, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlot1stsubsWD\n\n#save Plot\nggsave(path = Vizlocation, \"Home Passnetwork 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n``` {r}\n#| title: Passnetwork Post 1st Sub \n#| label: Home post 1st subs passnetwork\nHomepassPlotPost1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                        team_name = Match_Home, scale_stat = \"EPV\", \n                                        scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                        plot_start = firstSubHome, plot_finish = 100, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlotPost1stsubsWD\n```\n\n### column {.tabset}\n```{r away 1st subs}\n#| title: Passnetwork to 1st Sub \n#| label: Away 1st subs passnetwork\n\nAwaypassPlot1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                   team_name = Match_Away, scale_stat = \"EPV\", \n                                   scale_color = Color_Away, text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" to 1st Subs\"),\n                                   plot_start = 00, plot_finish = firstSubAway, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlot1stsubsWD\n\n#save Plot\nggsave(path = Vizlocation, \"Away Passnetwork 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n``` {r away post 1st subs}\n#| title: Passnetwork post 1st Sub \n#| label: Away post 1st subs passnetwork\nAwaypassPlotpost1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                        team_name = Match_Away, scale_stat = \"EPV\", \n                                        scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                        plot_start = firstSubAway, plot_finish = 100, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlotpost1stsubsWD\n```\n## Row {.flow}\n### column {.tabset}\n```{r home attack pass 1st}\n#| title: Attacking Passnetwork 1st Half\n#pass map EPV Home 1st half\nHomepassPlot1stAtt <- plot_passnet_AI(data = plottingData, \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot1stAtt\n\n\n```\n\n```{r home attack pass 2nd}\n#| title: Attacking Passnetwork 2nd Half\n\n#pass map EPV Home 2nd half\nHomepassPlot2ndAtt <- plot_passnet_AI(data = plottingData,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 46, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot2ndAtt\n\n```\n\n### column {.tabset}\n```{r away attack pass 1st}\n#| title: Attacking Passnetwork 1st Half\n#pass map EPV Away 1st half\nAwaypassPlot1stAtt <- plot_passnet_AI(data = plottingData, \n                                     team_name = Match_Away, scale_stat = \"EPV\", \n                                     scale_color = Color_Away, text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                     plot_start = 00, plot_finish = 44, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot1stAtt\n\n```\n\n```{r away attack pass 2nd}\n#| title: Attacking Passnetwork 2nd Half\n#pass map EPV Away 2nd half\nAwaypassPlot2ndAtt <- plot_passnet_AI(data = plottingData,\n                                     team_name = Match_Away, scale_stat = \"EPV\", \n                                     scale_color = Color_Away, text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                     plot_start = 46, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot2ndAtt\n\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Attacking Passnetwork 1st Sub\n#pass map EPV Home 1st sub\nHomepassPlot1subAtt <- plot_passnet_AI(data = plottingData,  \n                                    team_name = Match_Home, scale_stat = \"EPV\", \n                                    scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" up to 1st Sub\"),\n                                    plot_start = 00, plot_finish = firstSubHome, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot1subAtt\n\n```\n\n```{r}\n#| title: Attacking Passnetwork Post 1st Sub\n#pass map EPV Home 1st sub\nHomepassPlot1subAttpost <- plot_passnet_AI(data = plottingData,  \n                                    team_name = Match_Home, scale_stat = \"EPV\", \n                                    scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                    plot_start = firstSubHome, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot1subAttpost\n\n```\n### column {.tabset}\n```{r}\n#| title: Attacking Passnetwork 1st Sub\n#pass map EPV Away 1st Sub\nAwaypassPlot1SubAtt <- plot_passnet_AI(data = plottingData,\n                                      team_name = Match_Away, scale_stat = \"EPV\", \n                                      scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" up to 1st Sub\"),\n                                      plot_start = 00, plot_finish = firstSubAway, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot1SubAtt\n\n```\n\n```{r}\n#| title: Attacking Passnetwork Post 1st Sub\n#pass map EPV Away 1st Sub\nAwaypassPlot1SubAttpost <- plot_passnet_AI(data = plottingData,\n                                      team_name = Match_Away, scale_stat = \"EPV\", \n                                      scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                      plot_start = firstSubAway, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot1SubAttpost\n\n```\n\n## Row {.flow}\n```{r}\nHomepassPlotFTAttW <- plot_passnet_AI(data = plottingData,  \n                                      team_name = Match_Home, scale_stat = \"EPV\", \n                                      scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" By Time Period\"),\n                                      plot_start = 00, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", wrap = \"Yes\", passes = 2)\nHomepassPlotFTAttW\n```\n\n```{r}\nAwaypassPlotFTAttW <- plot_passnet_AI(data = plottingData,  \n                                     team_name = Match_Away, scale_stat = \"EPV\", \n                                     scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" By Time Period\"),\n                                     plot_start = 00, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", wrap = \"Yes\", passes = 2)\nAwaypassPlotFTAttW\n```\n## Row {.tabset}\n```{r}\n#| title: Pass Connections by Passer\n#| label: Home pass connections tables\n#| results: asis\n\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n```{r}\n#| title: Pass Connections by Receiver\n#| label: Home pass connections tables Reciever\n#| results: asis\n\nPassConnectionTableHomeR <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Passer\", groupname_col = \"Receiver\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHomeR\n```\n\n## Row {.tabset}\n```{r}\n#| title: Pass Connections by Passer\n#| results: asis\n#| label: away Pass connections table\nPassConnectionTableAway <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Away,\n         Passer_Team == Match_Away) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16)))\n\nPassConnectionTableAway\n```\n\n```{r}\n#| title: Pass Connections by Receiver\n#| results: asis\n#| label: away Pass connections table Reciever\nPassConnectionTableAwayr <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Away,\n         Passer_Team == Match_Away) %>%\n  gt(rowname_col = \"Passer\", groupname_col = \"Receiver\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16)))\n\nPassConnectionTableAwayr\n```\n\n## Row {.flow}\n```{r}\n#| label: home passing tree plot\n\nPassConnectionTreeHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) \n\ngroup <- PassConnectionTreeHome$Passer\nsubgroup <- PassConnectionTreeHome$Receiver\nvalue <- PassConnectionTreeHome$'Attempted Passes'\n\nPassConnectionTreeHomePlot <- PassConnectionTreeHome %>%\n  \n  #geometrics\n  ggplot(aes(area = value, fill = value, subgroup = subgroup,\n             label = paste(group, value, sep = \"\\n\"))) +\n  geom_treemap() +\n  geom_treemap_subgroup_border(colour = \"white\", size = 5) +\n  geom_treemap_subgroup_text(place = \"centre\", grow = TRUE,\n                             alpha = 0.25, colour = \"black\",\n                             fontface = \"italic\") +\n  geom_treemap_text(colour = \"black\",\n                    place = \"centre\",\n                    size = 13,\n                    grow = FALSE) +\n  #formatting\n  theme(legend.position = \"none\",\n        plot.background = element_rect(colour = \"black\", fill = \"#E5E5E5\"),\n        panel.background = element_blank()) +\n  scale_fill_paletteer_c(ColorScale_HomeC) + \n  labs(title = paste0(Match_Home, \" Passing Connections (Min 5 passes)\"), \n       subtitle = paste0(Match_Fixture, \" Darker color = More Passes, \\n Number & Name = Number Passes by Player, Large Name =  Reciever\"),\n       caption = my_socials) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nPassConnectionTreeHomePlot\n\n```\n\n``` {r}\n\n#| label: away passing tree plot\n\nPassConnectionTreeAway <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) \n\ngroup <- PassConnectionTreeAway$Passer\nsubgroup <- PassConnectionTreeAway$Receiver\nvalue <- PassConnectionTreeAway$'Attempted Passes'\n\nPassConnectionTreeAwayPlot <- PassConnectionTreeAway %>%\n  \n  #geometrics\n  ggplot(aes(area = value, fill = value, subgroup = subgroup,\n             label = paste(group, value, sep = \"\\n\"))) +\n  geom_treemap() +\n  geom_treemap_subgroup_border(colour = \"white\", size = 5) +\n  geom_treemap_subgroup_text(place = \"centre\", grow = TRUE,\n                             alpha = 0.25, colour = \"black\",\n                             fontface = \"italic\") +\n  geom_treemap_text(colour = \"black\",\n                    place = \"centre\",\n                    size = 13,\n                    grow = FALSE) +\n  #formatting\n  theme(legend.position = \"none\",\n        plot.background = element_rect(colour = \"black\", fill = \"#E5E5E5\"),\n        panel.background = element_blank()) +\n  scale_fill_paletteer_c(ColorScale_AwayC) + \n  labs(title = paste0(Match_Away, \" Passing Connections (Min 5 passes)\"), \n       subtitle = paste0(Match_Fixture, \" Darker color = More Passes,  \\n Number & Name = Number Passes by Player, Large Name =  Reciever\"),\n       caption = my_socials) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nPassConnectionTreeAwayPlot\n\n```\n\n\n# Passing Analysis\n## Row {.flow}\n```{r home wave plot}\ntouchpass_bar_data <- plottingData \n\ntouchpass_bar_data <- touchpass_bar_data %>%\n  filter(TeamName == Match_Home) %>%\n    filter(!Own_Goals == 1)\n\ntouchpass_bar_data <- touchpass_bar_data %>%\n  group_by(expandedMinute, minute) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Successful_Passes = sum(Successful_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    Possession = mean(Home_Possession),\n    TotalShots = sum(TotalShots),) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point = ifelse(str_detect(Goals, \"1\"), paste0(minute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Touches + 0.5), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point = as.numeric(Goal_point)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  mutate(Possession = round(Possession,2))\n\n#canvas\ntouchpass_bar_plot <- touchpass_bar_data %>%\n  ggplot(aes(x = expandedMinute, y = value)) +\n  \n#geometrics\n  geom_bar(aes(x = expandedMinute, y = Touches, fill = Color_Home), stat = \"identity\", colour = \"black\", width = 1, position = position_nudge(x = 0.5)) +\n  geom_bar(aes(x = expandedMinute, y = Attempted_Passes, fill = \"ivory4\"), stat = \"identity\",  colour = \"black\", width = 1, position = position_nudge(x = -0.5)) +\n  geom_bar(aes(x = expandedMinute, y = TotalShots, fill = \"green3\"), stat = \"identity\", colour = \"black\", width = 1) +\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = -0.5, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.03) +    \n  \n  scale_fill_identity(name = \"\",\n                       breaks = c(Color_Home,\"ivory4\", \"green3\"),\n                       labels = c(\"Touches\", \"Passes\", \"Shots\"),\n                       guide = \"legend\") +\n  \n#formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5)) +\n  labs(title = WavesTitle_text,\n        caption = My_caption,\n         subtitle = paste0(Match_Fixture),\n         x = \"Match Time (Mins)\",\n         y = \"Metric Total\") +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(face = \"bold\", size = 12),\n        axis.text = element_text(size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank(),\n        panel.background = element_blank(),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        legend.position = \"none\")\n\ntouchpass_bar_plot\n```\n\n```{r Away waves plot}\nAwaytouchpass_bar_data <- plottingData \n\nAwaytouchpass_bar_data <- Awaytouchpass_bar_data %>%\n  filter(TeamName == Match_Away) %>%\n    filter(!Own_Goals == 1)\n\nAwaytouchpass_bar_data <- Awaytouchpass_bar_data %>%\n  group_by(expandedMinute, minute) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Successful_Passes = sum(Successful_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    AwayPossession = mean(Away_Possession),\n    TotalShots = sum(TotalShots),) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Touches + 0.5), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  mutate(AwayPossession = round(AwayPossession,2))\n\n#canvas\nAwaytouchpass_bar_plot <- Awaytouchpass_bar_data %>%\n  ggplot(aes(x = expandedMinute)) +\n  \n\n  #bars\n  geom_bar(aes(x = expandedMinute, y = Touches, fill = Color_Away), stat = \"identity\", colour = \"black\", width = 1, position = position_nudge(x = 0.5)) +\n  geom_bar(aes(x = expandedMinute, y = Attempted_Passes, fill = \"ivory4\"), stat = \"identity\",  colour = \"black\", width = 1, position = position_nudge(x = -0.5)) +\n  geom_bar(aes(x = expandedMinute, y = TotalShots, fill = \"green3\"), stat = \"identity\", colour = \"black\", width = 1) +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Away,\"ivory4\", \"green3\"),\n                      labels = c(\"Touches\", \"Passes\", \"Shots\"),\n                      guide = \"legend\") +\n  \n  # Other geoms and formatting for half time etc\n  #geom_segment(aes(y = 0, yend = max(Touches), x = 45, xend = 45), linewidth = 0.8, colour = \"black\", linetype = \"longdash\") +\n  #geom_text(aes(x = 45, y = max(Touches), label = \"HT\"), colour = \"black\", hjust = 1.5, vjust = 1, size = 4) +\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = -0.5, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.03) +\n\n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5)) +\n  labs(title = AwayWavesTitle_text,\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Match Time (Mins)\",\n         y = \"Metric Total\") +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(face = \"bold\", size = 12),\n        axis.text = element_text(size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank(),\n        panel.background = element_blank(),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        legend.position = \"none\")\n\nAwaytouchpass_bar_plot\n```\n\n```{r}\n#| output: false\n# Step 1: Filter successful passes open play only\nsuccessful_passes <- plottingData \n\n# Step 2: Identify passing sequences with more than the defined level of pass\n\npassing_sequencesHome <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, TeamName, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, period\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1) %>%\n  mutate(Goal_point_X = ifelse(TeamName == Match_Home & (str_detect(type, \"Goal\")), paste0(x), NA)) %>%\n  mutate(Goal_point_Y = ifelse(TeamName == Match_Home & (str_detect(type, \"Goal\")), paste0(y), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n\npassing_sequencesAway <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, TeamName, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, period\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1) %>%\n  mutate(Goal_point_X = ifelse(TeamName == Match_Away & (str_detect(type, \"Goal\")), paste0(x), NA)) %>%\n  mutate(Goal_point_Y = ifelse(TeamName == Match_Away & (str_detect(type, \"Goal\")), paste0(y), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n#tabeldata\npassing_sequencesHome_Table <- passing_sequencesHome %>%\n  filter(TeamName == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesHome_1st_Table <- passing_sequencesHome %>%\n  filter(TeamName == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1, \n    period == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesHome_2nd_Table <- passing_sequencesHome %>%\n  filter(TeamName == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1,\n    period == 2) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n\npassing_sequencesAway_Table <- passing_sequencesAway %>%\n  filter(TeamName == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesAway_1st_Table <- passing_sequencesAway %>%\n  filter(TeamName == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1,\n    period == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesAway_2nd_Table <- passing_sequencesAway %>%\n  filter(TeamName == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1,\n    period == 2) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n# Define the desired order\ndesired_order <- c(\"VLow\", \"Low\", \"Medium\", \"High\")\n\n# Arrange passing_sequencesHome_Table\npassing_sequencesHome_Table <- passing_sequencesHome_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesAway_Table\npassing_sequencesAway_Table <- passing_sequencesAway_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesHome_1st_Table <- passing_sequencesHome_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesAway_Table\npassing_sequencesAway_1st_Table <- passing_sequencesAway_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesHome_2nd_Table <- passing_sequencesHome_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesAway_Table\npassing_sequencesAway_2nd_Table <- passing_sequencesAway_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n```\n\n## Row {.flow}\n```{r}\n#| label: passing chains all in\n\npassing_sequencesHome_Plot <- passing_sequencesHome %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesHome$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.09, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.08,\n    color = passing_sequencesHome$Pchain\n  ) +\n  # add goal\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.1) +\n\n  #wrap it \n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  \n  #format it\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesHome_Plot\n```\n\n```{r}\n#| label: Away passing chains all in\n\npassing_sequencesAway_Plot <- passing_sequencesAway %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesAway$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.09, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.08,\n    color = passing_sequencesAway$Pchain\n  ) +  \n# add goal\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.1) +\n\n  #wrap it \n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  \n  #format it\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesAway_Plot\n\n```\n\n## Row {.flow}\n### column {.tabset}\n``` {r}\n#| title: Full time\n#| label: home passing chains tables FT\n#| results: asis\n\nHome_Passing_Chains_Table <- passing_sequencesHome_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" FT Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_Table\n```\n\n``` {r}\n#| title: 1st Half\n#| label: home passing chaing tables 1st\n#| results: asis\n\nHome_Passing_Chains_1st_Table <- passing_sequencesHome_1st_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" 1st Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_1st_Table\n```\n\n``` {r}\n#| title: 2nd Half\n#| label: home passing chaing tables 2nd\n#| results: asis\n\nHome_Passing_Chains_2nd_Table <- passing_sequencesHome_2nd_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" 2nd Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_2nd_Table\n\n```\n### column {.tabset}\n``` {r}\n#| title: Full time\n#| label: away passing chaing tables FT\n#| results: asis\nAway_Passing_Chains_Table <- passing_sequencesAway_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" FT Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nAway_Passing_Chains_Table\n```\n\n``` {r}\n#| title: 1st Half\n#| label: away passing chaing tables 1st\n#| results: asis\n\nAway_Passing_Chains_1st_Table <- passing_sequencesAway_1st_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" 1st Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nAway_Passing_Chains_1st_Table\n```\n\n``` {r}\n#| title: 2nd Half\n#| label: away passing chaing tables 2nd\n#| results: asis\n\nAway_Passing_Chains_2nd_Table <- passing_sequencesAway_2nd_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" 2nd Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nAway_Passing_Chains_2nd_Table\n```\n\n```{r}\n#| output: false\nZone14_Passes_Home_Data <- plottingData %>%\n  filter(TeamName == Match_Home,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nZone14_Passes_Home_Data <- Zone14_Passes_Home_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_Home_Data <- plottingData %>%\n  filter(TeamName == Match_Home,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nLHS_Passes_Home_Data <- LHS_Passes_Home_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_Home_Data <- plottingData %>%\n  filter(TeamName == Match_Home,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nRHS_Passes_Home_Data <- RHS_Passes_Home_Data %>%\n  filter(Successful_Passes == 1)\n\nZone14_Passes_Away_Data <- plottingData %>%\n  filter(TeamName == Match_Away,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nZone14_Passes_Away_Data <- Zone14_Passes_Away_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_Away_Data <- plottingData %>%\n  filter(TeamName == Match_Away,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start) %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nLHS_Passes_Away_Data <- LHS_Passes_Away_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_Away_Data <- plottingData %>%\n  filter(TeamName == Match_Away,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start) %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nRHS_Passes_Away_Data <- RHS_Passes_Away_Data %>%\n  filter(Successful_Passes == 1)\n\n#combine data frames\nZ14_HS_Passes_Home_Data <- bind_rows(Zone14_Passes_Home_Data, LHS_Passes_Home_Data, RHS_Passes_Home_Data)\n\nZ14_HS_Passes_Away_Data <- bind_rows(Zone14_Passes_Away_Data, LHS_Passes_Away_Data, RHS_Passes_Away_Data)\n\nZ14_HS_Passes_Home_Data <- Z14_HS_Passes_Home_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_Away_Data <- Z14_HS_Passes_Away_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_Home_Data <- Z14_HS_Passes_Home_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n\nZ14_HS_Passes_Away_Data <- Z14_HS_Passes_Away_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: By half\nZone14_HS_Passes_Home_Plot <- Z14_HS_Passes_Home_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Half) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = PPsTitle_textHalf, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Z14 and HS plot by half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: By Game Period\nZone14_HS_Passes_Home_Plot <- Z14_HS_Passes_Home_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = PPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Z14 and HS plot by period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n### column {.tabset}\n```{r}\n#| title: By Half\nZone14_HS_Passes_Away_Plot <- Z14_HS_Passes_Away_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Half) +\n  labs(title = AwayPPsTitle_textHalf, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Away_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Away Z14 and HS plot by Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: By Game Period\nZone14_HS_Passes_Away_Plot <- Z14_HS_Passes_Away_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = AwayPPsTitle_text,\n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Away_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Away Z14 and HS plot by period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row {.flow}\n```{r}\n#| echo: false\n#| output: false\n#| \nLong_Passes_Data <- plottingData %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName, Corners, Short_Corners) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nLPsTitle_textGP <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nAwayLPsTitle_textGP <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n```\n\n### column {.tabset}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\n#| title: By half\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Home ,\n           Corners == 0,\n           Short_Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot by half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: By Game Period\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Home,\n           Short_Corners == 0,\n           Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Game_Period) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_textGP, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot by game period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n### column {.tabset}\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\n#| title: By Half\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Away,\n           Corners == 0,\n           Short_Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot by half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\n#| title: By Game period\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Away, \n           Short_Corners == 0,\n           Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Game_Period) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_textGP, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot by period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n## Row\n### column {.tabset}\n```{r}\n#| title: 1st Half Pass Recieving Areas\n\nHomePRecievedHeatMapplot1Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Home, \n         period == 1) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Recieving Pass Heat Map \\nUp 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePRecievedHeatMapplot1Half\n\n```\n```{r}\n#| title: 2nd Half Pass Recieving Areas\nHomePRecievedHeatMapplot2Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Home, \n         period == 2) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Recieving Pass Heat Map \\nUp 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePRecievedHeatMapplot2Half\n\n\n```\n```{r}\n#| title: Up to 1st Sub Pass Recieving Areas\n\nHomePRecievedHeatMapplot1Sub <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Home, \n         between(minute, 00, firstSubHome)) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n\n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Recieving Pass Heat Map \\nUp 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePRecievedHeatMapplot1Sub\n```\n### column {.tabset}\n```{r}\n#| title: 1st Half Pass Recieving Areas\nAwayPRecievedHeatMapplot1Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Away, \n         period == 1) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" Open Play Recieving Pass Heat Map \\nUp 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPRecievedHeatMapplot1Half\n```\n```{r}\n#| title: 2nd Half Pass Recieving Areas\n\nAwayPRecievedHeatMapplot2Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Away, \n         period == 2) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" Open Play Recieving Pass Heat Map \\nUp 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPRecievedHeatMapplot2Half\n\n```\n```{r}\n#| title: Up to 1st Sub Pass Recieving Areas\n\nAwayPRecievedHeatMapplot1Sub <- plottingData %>%\n  filter(Attempted_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Away, \n         between(minute, 00, firstSubAway)) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n\n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" Open Play Recieving Pass Heat Map \\nUp 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPRecievedHeatMapplot1Sub\n\n```\n\n\n\n# Player Analysis\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: player stats tables setup\n\nMatchSummaryPLayerData <- plottingData %>%\n  mutate(\n    Out_of_play_time = round(Out_of_play_time / 60, 1),\n    EventTime = round(EventTime / 60, 1),\n    TeamEPV = as.numeric(ifelse(str_detect(`outcomeType/value`, \"1\"), paste0(EPVvalue), 0))) %>%\n  group_by(TeamName, playerId, role, player_shirt) %>%\n    summarise(\n    across(\n      c(Goals, \n        TotalShots, \n        OFShots, \n        SoT = OTShots, \n        Out_Box_Shots, \n        Touches, \n        Defensive_Third_Touches, \n        Middle_Third_Touches, \n        Final_Third_Touches, \n        PK_Box_Touches, \n        SixYard_Box_Touches, \n        Attempted_Carries, \n        Successful_Carries, \n        Prog_Carries, \n        Final_Third_Carries, \n        Attempted_Passes, \n        Successful_Passes, \n        Long_Passes, \n        Final_Third_Passes, \n        PK_Box_Passes,\n        Prog_Passes,\n        Key_Passes,\n        Assists,\n        BCs,\n        TeamEPV,   \n        xG, \n        xGOT, \n        MyxA,\n        TeamxT,\n        Aerial_total, \n        Aerial_Won, \n        Aerial_Lost, \n        Ground_Duels_Total, \n        Ground_Duels_Won, \n        Ground_Duels_Lost,\n        UnSuccessful_Touches,\n        Attacking_Half_Touches, \n        Defensive_Half_Touches, \n        Mis_Control, \n        Dispossessed_Total, \n        Dribbles_Total, \n        Dribbles_Won, \n        Dribbles_Lost,\n        Blocked_Shot,\n        SixYard_Box_Shots, \n        PK_Box_Shots, \n        NPxG,\n        UnSuccessful_Passes,\n        Successful_Long_Passes, \n        Corners, \n        Short_Corners, \n        Cross_Passes, \n        Successful_Cross, \n        UnSuccessful_Cross, \n        Tackles_Total, \n        Tackles_Won, \n        Tackles_Lost, \n        Fouls_Total, \n        Fouls_Conceeded, \n        Fouls_Received,\n        Interceptions_Total, \n        Recoverys_Total,\n        Clearances_Total,\n        Offside_Won, \n        Offside_Lost\n        ), \n      \\(x) sum(x, na.rm = TRUE)\n    ),\n    minutes_played = min(minutes_played, na.rm = TRUE),\n    Carries_distance = sum(Carries_distance, na.rm = TRUE),\n    Successful_Carries_Distance = sum(Successful_Carries_Distance, na.rm = TRUE),\n    Prog_Carries_Distance = sum(Prog_Carries_Distance, na.rm = TRUE)\n  ) %>%\n  ungroup() %>%\n  group_by(TeamName) %>%\n  mutate(\n    Team_TotalTouches = sum(Touches),\n    Team_TotalEPV = sum(TeamEPV),\n    Team_TotalxG = sum(xG),\n    Team_TotalPasses = sum(Attempted_Passes),\n    Team_TotalDuels = sum(Ground_Duels_Total),\n    Team_TotalAerials = sum(Aerial_total),\n    Team_TotalShots = sum(TotalShots),\n    Possession = round((Touches / Team_TotalTouches), 2),\n    Pass_Success = round((Successful_Passes / Attempted_Passes), 2),\n    Aerial_Success = (Aerial_Won / Aerial_total),\n    Duel_Success = (Ground_Duels_Won / Ground_Duels_Total),\n    On_Ball_Time = round(InPlayTime * Possession,2),\n    Team_EPV_P = round((TeamEPV / Team_TotalEPV), 2),\n    Team_xG_P = round((xG / Team_TotalxG), 2),\n    Team_Duels_P = round((Ground_Duels_Total / Team_TotalDuels), 2),\n    Team_Aerial_P = round((Aerial_total / Team_TotalAerials), 2),\n    Team_Passes_P = round((Attempted_Passes / Team_TotalPasses), 2),\n    Team_Shots_P = round((TotalShots / Team_TotalShots), 2)\n  ) %>%\n  replace_na(list( Aerial_Success = 0)) %>%\n  replace_na(list( Duel_Success = 0)) %>%\n  ungroup()\n\nMD_adv_passing <- plottingData \nMD_adv_passing <- shift_column(data = MD_adv_passing, columns = \"playerId\", new_names = \"Receiver\", len = 1, up = TRUE)\nMD_adv_passing <- shift_column(data = MD_adv_passing, columns = \"TeamName\", new_names = \"Receiver_Team\", len = 1, up = TRUE)\nMD_adv_passing <- shift_column(data = MD_adv_passing, columns = \"player_shirt\", new_names = \"Receiver_shirt\", len = 1, up = TRUE)\n\nMD_adv_passing <- MD_adv_passing %>%\n  filter(Attempted_Passes == 1) %>% \n  select(Receiver, Receiver_shirt, Passer_Team = TeamName, Receiver_Team, minutes_played, Attempted_Passes, Successful_Passes, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\nMD_adv_passing <- MD_adv_passing %>%\n  group_by(Receiver, Receiver_Team) %>%\n    summarise(Receiver_shirt = first(Receiver_shirt), Passes_Recieved = sum(Attempted_Passes), Successful_Recieved = sum(Successful_Passes), Key_Passes_Recieved = sum(Key_Passes), Prog_Passes_Recieved = sum(Prog_Passes), EPV = sum(EPV))  %>% \n  #na.omit() %>%\n  mutate(Recieving_Suc = (Successful_Recieved / Passes_Recieved)) %>%\n  replace_na(list(Recieving_Suc = 0)) %>%\n  select(Team = Receiver_Team, Shirt = Receiver_shirt, Passes_Recieved, Successful_Recieved, Key_Passes_Recieved, Prog_Passes_Recieved, EPV_Recieved = EPV, Recieving_Suc)\n\n#data load check for data to be converted to number\n#MatchdayTablePass <- MD_passing_values #xt xa from fbref\nMatchdayTableAdvPass <- MD_adv_passing\n\n#sort out advanced passing for the main table\n#MatchdayTableAdvPass <- MatchdayTableAdvPass %>%\n#  select(Team = Receiver_Team, Shirt = Receiver_shirt, Passes_Recieved, Successful_Recieved, Key_Passes_Recieved, Prog_Passes_Recieved, #EPV_Recieved = EPV, Recieving_Suc)\n  \n\n# add all data together\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  left_join(MatchdayTableAdvPass, by = c(\"TeamName\" = \"Team\", \"player_shirt\" = \"Shirt\", \"playerId\" = \"Receiver\"), copy = TRUE) %>% \n  mutate_all(~ ifelse(is.na(.), 0, .))\n\n#work out detailed passing, and touches variables\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  mutate('xG/Shot' =  xG/TotalShots,\n  'Shot Accuracy' = SoT/TotalShots,\n  'Shot Quality' = (xGOT - xG)/xG) %>%\n  mutate(`% F 3rd Carries` = Final_Third_Carries / Successful_Carries) %>%\n  mutate(`% P Carries` = Prog_Carries / Successful_Carries) %>%\n  mutate(`% Carries D Prog` = Prog_Carries_Distance / Successful_Carries_Distance) %>%\n  mutate(`Def Third Touches / Min` = Defensive_Third_Touches / minutes_played) %>%\n  mutate(`Mid Third Touches / Min` = Middle_Third_Touches / minutes_played) %>%\n  mutate(`F 3rd Touches / Min` = Final_Third_Touches / minutes_played) %>%\n  mutate(`PK Box Touches / Min` = PK_Box_Touches / minutes_played) %>%\n  mutate(`% T D Third` = Defensive_Third_Touches / Touches) %>%\n  mutate(`% T M Third` = Middle_Third_Touches / Touches) %>%\n  mutate(`% T F 3rd` = Final_Third_Touches / Touches) %>%\n  mutate(`% T PK Box` = PK_Box_Touches / Touches) %>%\n  mutate(`T / Min` = Touches / minutes_played) %>%\n  mutate(Failed_Pass = round(Attempted_Passes - Successful_Passes, 2),\n         Failed_Cross = round(Cross_Passes - Successful_Cross, 2),\n         Failed_Dribble = round(Dribbles_Total - Dribbles_Won, 2),\n         Poss_Gained = round(Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost), 2),\n         Poss_Lost = (Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble + OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost),\n         Posession_Control = (Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost) - (Mis_Control + Dispossessed_Total + UnSuccessful_Passes + UnSuccessful_Cross + Dribbles_Lost  + OFShots + Blocked_Shot + Offside_Lost)),) %>%\n  mutate_all(~ ifelse(is.na(.), 0, .))\n\nDefEPVData <- plottingData %>%\n  filter(Corners == 0,\n         Short_Corners == 0,\n         FreeKicks == 0,\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 107,\n           `type/value` == 1 |\n           `type/value` == 2 | \n           `type/value` == 3 |\n           `type/value` == 4 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"EPV_Def\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(TeamName, playerId, EPVvalue, Defensive_Action, `outcomeType/value`, EPV_Def, role) %>%\n  mutate(EPV_Faced = (EPVvalue + EPV_Def),\n    Successful_Def_EPV = ifelse(`outcomeType/value` == 1, paste0(EPV_Faced), 0),\n         Unsuccessful_Def_EPV = ifelse(`outcomeType/value` == 0, paste0(EPV_Faced), 0), \n         Successful_Def_EPV = as.numeric(Successful_Def_EPV),\n         Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nDefEPVData <- DefEPVData %>%\n    group_by(playerId, role, TeamName) %>% \n  summarise(EPV_Faced = sum(EPV_Faced),\n            EPV_Won = sum(Successful_Def_EPV/EPV_Faced), \n            EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .)) \n\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  left_join(DefEPVData, by = c('playerId' = 'playerId', 'TeamName' = 'TeamName', 'role' = 'role'), copy = TRUE)\n\n\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n    replace_na(list( EPV_Faced = 0, EPV_Won = 0, EPV_Lost = 0)) \n\n\n#subset for standard player stats data table 1\nMatchSummaryPLayerPassingData <- MatchSummaryPLayerData\n\n#subset for detailed player stats data table 2\nMatchSummaryPLayerTouchesData <- MatchSummaryPLayerData\n\n#subset for detailed player stats data table 3\nMatchSummaryPLayerShootingData <- MatchSummaryPLayerData\n\n#subset for detailed player stats data table 4\nMatchSummaryPLayerDefensiveData <- MatchSummaryPLayerData\n\n#sub set for player profile plots\nMatchSummaryPLayerProfileData <- MatchSummaryPLayerData\n\n#data wrangling for general player stat table 1\nMatchSummaryPLayerPassingData <- MatchSummaryPLayerPassingData %>%\n  select(Team = TeamName, \n         Position = role, \n         Name = playerId, \n         Mins = minutes_played, \n         '% of Team Possession' = Possession, \n         xA = MyxA, \n         xT = TeamxT,  \n         'Attempted Passes' = Attempted_Passes, \n         'Successful Passes' = Successful_Passes, \n         'Pass Success %' = Pass_Success, Assists, \n         BCs, \n         'Key Passes' = Key_Passes, \n         `Long Ps`  = Long_Passes, \n         `Final 3rd P` = Final_Third_Passes, \n         `Prog Ps` = Prog_Passes, \n         'PK Box P' = PK_Box_Passes, \n         `Pass Received` = Passes_Recieved, \n         `PPs Received` = Prog_Passes_Recieved, \n         `KPs Recieved` = Key_Passes_Recieved, \n         `Recieveing Suc` = Recieving_Suc, \n         `EPV Recieved` = EPV_Recieved, \n         'EPV Created' = TeamEPV, \n         '% of Team EPV' = Team_EPV_P)\n\n#data wrangling for detailed player stats table 2\nMatchSummaryPLayerTouchesData <- MatchSummaryPLayerTouchesData %>%\n  select(Team = TeamName, \n         Name = playerId, \n         Position = role, \n         Mins = minutes_played, \n         Touches, \n         `Def 3rd` = Defensive_Third_Touches, \n         `Mid 3rd` = Middle_Third_Touches, \n         `Final 3rd` = Final_Third_Touches, \n         `PK Box` = PK_Box_Touches, \n         `Total / Min` = `T / Min`, \n         `Def 3rd % TT` = `% T D Third`, \n         `Mid Third % TT` = `% T M Third`, \n         `Final 3rd % TT` = `% T F 3rd`, \n         `PK Box % TT` = `% T PK Box`, \n         `Carries` = Successful_Carries, \n         `% Carries Prog` = `% P Carries`, \n         `% Carries F 3rd` = `% F 3rd Carries`, \n         `% Carries D Prog`)\n\n#data wrangling for detailed player stats table 3\nMatchSummaryPLayerShootingData <- MatchSummaryPLayerShootingData %>%\n    select(Team = TeamName, \n           Position = role, \n           Name = playerId, \n           Mins = minutes_played, \n           'Total Shots' = TotalShots, \n           SoT, \n           '6 yard box' = SixYard_Box_Shots,     \n           'PK Box Shot' = PK_Box_Shots, \n           'Out Box Shots' = Out_Box_Shots, \n           'Blocked Shot' = Blocked_Shot,\n           Goals, \n           xG, \n           xGOT,\n           'xG/Shot',\n           'Shot Accuracy',\n           'Shot Quality')\n\n#data wrangling for detailed player stats table 4\nMatchSummaryPLayerDefensiveData <- MatchSummaryPLayerDefensiveData %>%\n  select(Team = TeamName, \n         Name = playerId, \n         Position = role, \n         Mins = minutes_played, \n         'Aerials Total' = Aerial_total, \n         'Aerials Won' = Aerial_Won, \n         'Aerial Success %' = Aerial_Success, \n         'Duels Total' = Ground_Duels_Total, \n         'Duels Won' = Ground_Duels_Won, \n         'Duel Success' = Duel_Success,         \n         'Tackles Total' = Tackles_Total, \n         'Tackles Won' = Tackles_Won, \n         'Tackles Lost' = Tackles_Lost, \n         'Interceptions Total' = Interceptions_Total, \n         'Recoverys Total' = Recoverys_Total,\n         'Clearances Total' = Clearances_Total, #c16\n         'Fouls Total' = Fouls_Total, \n         'Fouls Conceeded' = Fouls_Conceeded, \n         'Fouls Received' = Fouls_Received,\n         'Offside Won' = Offside_Won, \n         'Offside Lost' = Offside_Lost,\n         'EPV Faced' =  EPV_Faced, \n         'EPV Won'  = EPV_Won, \n         'EPV Lost' = EPV_Lost,\n         'Possession Control' = Posession_Control)\n\n#data wrangling for player profile plots\nPlayer_Summary_plot_data <- MatchSummaryPLayerProfileData %>%\n  select(Team = TeamName, Name = playerId, role, '% Possession' = Possession, `% On Ball Time` = On_Ball_Time, Touches = Touches, 'Total Shots' = TotalShots, OFShots, SoT, 'Out Box Shots' = Out_Box_Shots, BCs, Goals, xG, xGOT, '% xG' = Team_xG_P, Touches, PK_Box_Touches, \n         'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, Assists, 'Key Passes' = Key_Passes, EPV = TeamEPV, '% EPV' = Team_EPV_P, 'Aerials Total' = Aerial_total, 'Aerials Won' = Aerial_Won, 'Aerial Success %' = Aerial_Success, 'Duels Total' = Ground_Duels_Total, 'Duels Won' = Ground_Duels_Won, 'Duel Success %' = Duel_Success, '% Duels' = Team_Duels_P, '% Passes' = Team_Passes_P, '% Shots' = Team_Shots_P, '% Aerials' = Team_Aerial_P)\n\n\nPlayer_Summary_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, '% Possession', '% xG', '% EPV', '% Passes', '% Shots', '% Duels', '% Aerials') %>%\n  pivot_longer(cols = c('% Possession', '% xG', '% EPV','% Passes', '% Shots', '% Duels', '% Aerials'), names_to = \"Metric\", values_to = \"Value\")\n\n#player profile plot data\nPlayer_Goal_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, OFShots, SoT, 'Out Box Shots', BCs, Goals, Assists, 'Key Passes') %>%\n  pivot_longer(cols = c(OFShots, SoT, `Out Box Shots`, BCs, Goals, Assists, `Key Passes`), names_to = \"Metric\", values_to = \"Value\") \n\n#filter data by team\nPlayer_Summary_plot_data_Home <- Player_Summary_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Summary_plot_data_Away <- Player_Summary_data %>%\n  filter(Team == Match_Away) \n\nPlayer_Goal_plot_data_Home <- Player_Goal_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Goal_plot_data_Away <- Player_Goal_data %>%\n  filter(Team == Match_Away) \n\n\n#work out team and unit averages\n#general metrics\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\ngroup_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n#goal metrics\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n\n#wrap the tiles for the general plot\nPlayer_Summary_data_Home$Metric  <- str_wrap(Player_Summary_data_Home$Metric, width = 5)  \n\nPlayer_Summary_data_Away$Metric  <- str_wrap(Player_Summary_data_Away$Metric, width = 5)  \n\n\n#wrap the tiles for the goal plot\nPlayer_Goal_data_Home$Metric  <- str_wrap(Player_Goal_data_Home$Metric, width = 5)  \n\nPlayer_Goal_data_Away$Metric  <- str_wrap(Player_Goal_data_Away$Metric, width = 5)  \n\n\n#reorder data\nfacet_order <- c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")\n\n#general plot\nPlayer_Summary_data_Home  <- Player_Summary_data_Home  %>%\narrange(factor(role, levels = facet_order))\n\nPlayer_Summary_data_Away  <- Player_Summary_data_Away  %>%\n  arrange(factor(role, levels = facet_order))\n\n#goal plot\nPlayer_Goal_data_Home <- Player_Goal_data_Home %>%\n  arrange(factor(role, levels = facet_order))\n\nPlayer_Goal_data_Away <- Player_Goal_data_Away %>%\n  arrange(factor(role, levels = facet_order))\n\n```\n## Row {.flow}\n### column {.tabset}\n\n```{r, results='asis'}\n#| title: Passing stats\n#| results: asis\n#| label: Home player Passing table\n\nMatchSummaryPLayerPassingTableHome <- MatchSummaryPLayerPassingData %>%\n  filter(Team == Match_Home) %>%\n  gt(groupname_col = \"Position\", rowname_col = \"Name\") %>%\n  row_group_order(groups = c(\"Keeper\",\n                             \"Defender\",\n                             \"Midfielder\", \n                             \"Forward\"\n                             )) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Possession Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  summary_rows(columns = c(5:24), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:24), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(5, 10, 21, 24),\n    decimals = 0\n  ) %>%\n  fmt_number(\n    columns = c(6,7,22,23),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Expected Metrics\", columns = c(6:7)) %>%\n  tab_spanner(label = \"Passes\", columns = c(8:17)) %>%\n  tab_spanner(label = \"Recieving\", columns = c(18:24)) %>%\n tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Expected Metrics'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Recieving'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  #gt_plt_bar(\n  #  'Long Ps',\n    #keep_column = TRUE,\n  #  labels = TRUE,\n  #  color = Color_Home,\n  #  scaled = FALSE,\n  #) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  #gt_color_rows(columns = c(6, 17, 28), palette = ColorScale_Home, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(12:13, 16:17), palette = ColorScale_Home, domain = c(0,10)) %>%\n  #gt_color_rows(columns = c(10:12, 18:19, 20), palette = ColorScale_Home, domain = c(0,5)) %>%\n  #gt_color_rows(columns = c(5, 21, 22, 23, 24, 26), palette = ColorScale_Home, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(5, 10, 21, 24), palette = ColorScale_Home, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(14:15), palette = ColorScale_Home, domain = c(0,20))\n\nMatchSummaryPLayerPassingTableHome\n\n```\n\n```{r, results='asis'}\n#| title: Touches and Carries\n#| results: asis\n#| label: home player Touches table\n\nMatchSummaryPLayerTouchesTableHome <- \n  MatchSummaryPLayerTouchesData %>% \n  filter(Team == Match_Home) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(11:14, 16:18), decimals = 0) %>%\n  fmt_number(columns = c(10), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_spanner(label = \"Touches (T) Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"% Touches Thirds Breakdown\", columns = c(11:14)) %>%\n  tab_spanner(label = \"Carries Breakdown\", columns = c(15:18)) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Touches Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners(\"Touches (T) Breakdown\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('% Touches Thirds Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Carries Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(10), palette = ColorScale_Home, domain = c(0,3)) %>% # touch/per min\n  gt_color_rows(columns = c(12:14, 16:18), palette = ColorScale_Home, domain = c(0,1)) # % scales\nMatchSummaryPLayerTouchesTableHome\n\n```\n```{r, results='asis'}\n#| title: Shooting stats\n#| results: asis\n\n\nMatchSummaryPLayerShootingTableHome <- MatchSummaryPLayerShootingData %>% \n  filter(Team == Match_Home) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(15:16), decimals = 0) %>%\n  fmt_number(columns = c(12:14), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Shooting Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(5:11), palette = ColorScale_Home, domain = c(0,5)) %>% # shots\n  gt_color_rows(columns = c(15), palette = ColorScale_Home, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(16), palette = ColorScale_Home, domain = c(-5, 5)) # % scales# % scales\n\nMatchSummaryPLayerShootingTableHome\n```\n\n```{r, results='asis'}\n#| title: Defensive stats\n#| results: asis\n\nMatchSummaryPLayerDefensiveTableHome <- MatchSummaryPLayerDefensiveData %>% \n  filter(Team == Match_Home) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(7, 10, 23:24), decimals = 0) %>%\n  fmt_number(columns = c(22), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Defensive Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_spanner(label = \"Duels Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"Defensive Threat\", columns = c(22:24)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Defensive Threat'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(22), palette = ColorScale_Home, domain = c(0,2)) %>% # epv faced\n  gt_color_rows(columns = c(7, 10, 23, 24), palette = ColorScale_Home, domain = c(0,1)) # % scales\n\nMatchSummaryPLayerDefensiveTableHome\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r, results= 'asis'}\n#| title: Passing stats\n#| results: asis\n#| label: Away player Passing tables\n\nMatchSummaryPLayerPassingTableAway <- MatchSummaryPLayerPassingData %>%\n  filter(Team == Match_Away) %>%\n  gt(groupname_col = \"Position\", rowname_col = \"Name\") %>%\n  row_group_order(groups = c(\"Keeper\",\n                             \"Defender\",\n                             \"Midfielder\", \n                             \"Forward\"\n                             )) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Possession Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  summary_rows(columns = c(5:24), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:24), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(5, 10, 21, 24),\n    decimals = 0\n  ) %>%\n  fmt_number(\n    columns = c(6,7,22,23),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Expected Metrics\", columns = c(6:7)) %>%\n  tab_spanner(label = \"Passes\", columns = c(8:17)) %>%\n  tab_spanner(label = \"Recieving\", columns = c(18:24)) %>%\n tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Expected Metrics'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Recieving'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  #gt_color_rows(columns = c(6, 17, 28), palette = ColorScale_Home, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(12:13, 16:17), palette = ColorScale_Away, domain = c(0,10)) %>%\n  #gt_color_rows(columns = c(10:12, 18:19, 20), palette = ColorScale_Home, domain = c(0,5)) %>%\n  #gt_color_rows(columns = c(5, 21, 22, 23, 24, 26), palette = ColorScale_Home, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(5, 10, 21, 24), palette = ColorScale_Away, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(14:15), palette = ColorScale_Away, domain = c(0,20))\n\nMatchSummaryPLayerPassingTableAway\n```\n\n```{r, results='asis'}\n#| title: Touches and Carries\n#| results: asis\n#| label: away playertouches table\n\nMatchSummaryPLayerTouchesTableAway <- MatchSummaryPLayerTouchesData %>% \n  filter(Team == Match_Away) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(11:14, 16:18), decimals = 0) %>%\n  fmt_number(columns = c(10), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_spanner(label = \"Touches (T) Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"% Touches Thirds Breakdown\", columns = c(11:14)) %>%\n  tab_spanner(label = \"Carries Breakdown\", columns = c(15:18)) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Touches Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners(\"Touches (T) Breakdown\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('% Touches Thirds Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Carries Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(10), palette = ColorScale_Away, domain = c(0,3)) %>% # touch/per min\n  gt_color_rows(columns = c(12:14, 16:18), palette = ColorScale_Away, domain = c(0,1)) # % scales\nMatchSummaryPLayerTouchesTableAway\n```\n```{r, results='asis'}\n#| title: Shooting stats\n#| results: asis\n\nMatchSummaryPLayerShootingTableAway <- MatchSummaryPLayerShootingData %>% \n  filter(Team == Match_Away) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(15:16), decimals = 0) %>%\n  fmt_number(columns = c(12:14), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Shooting Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(5:11), palette = ColorScale_Away, domain = c(0,5)) %>% # shots\n  gt_color_rows(columns = c(15), palette = ColorScale_Away, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(16), palette = ColorScale_Away, domain = c(-5,5))# % scales\n\nMatchSummaryPLayerShootingTableAway\n\n```\n\n```{r, results='asis'}\n#| title: Defensive stats\n#| results: asis\n\nMatchSummaryPLayerDefensiveTableAway <- MatchSummaryPLayerDefensiveData %>% \n  filter(Team == Match_Away) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(7, 10, 23:24), decimals = 0) %>%\n  fmt_number(columns = c(22), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Defensive Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_spanner(label = \"Duels Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"Defensive Threat\", columns = c(22:24)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Defensive Threat'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(21), palette = ColorScale_Away, domain = c(0,2)) %>% # epv faced\n  gt_color_rows(columns = c(7, 10, 23, 24), palette = ColorScale_Away, domain = c(0,1)) # % scales\n\nMatchSummaryPLayerDefensiveTableAway\n\n```\n\n\n## Row\n```{r}\n#| output: false\n#| label: dribbles and duels data setup\n\nheatmapdata <- plottingData \n\nDribblesmapdata <- heatmapdata %>%\n  filter(Dribbles_Total == 1) %>%\n  mutate(DribblesFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DribblesFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName, teamId, playerId, player_shirt, playerNumber, role,  x, y, DribblesFinalX, DribblesFinalY, outcome, Game_Period )\n\n\n#duels aerial and ground data\nDuelsmapdata <- heatmapdata\n  \nDuelsmapdata <- heatmapdata %>%\n  filter(Ground_Duels_Total == 1 |\n           Aerial_total == 1) %>%\n  mutate(DuelsFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DuelsFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName, teamId, playerId, player_shirt, playerNumber, role, x, y, DuelsFinalX, DuelsFinalY, outcome, Game_Period )\n\n\n#Liverpool duels data\nHomeDuelsmapdata <- Duelsmapdata %>%\n  filter(TeamName == Match_Home)\n\n#Away duels data\nAwayDuelsmapdata <- Duelsmapdata %>%\n  filter(TeamName == Match_Away)\n\n#Home Dribbles Data\nHomeDribblesmapdata <- Dribblesmapdata %>%\n  filter(TeamName == Match_Home)\n\n#Away Dribbles Data\nAwayDribblesmapdata <- Dribblesmapdata %>%\n  filter(TeamName == Match_Away)\n\n#PLayer touch data \nTouchDataHome <- plottingData %>%\n  filter(TeamName == Match_Home)\n\nTouchDataAway <- plottingData %>%\n  filter(TeamName == Match_Away)\n\n#Home TEAM Touch zones\nTouchData <- plottingData %>%\n  filter(\n    Corners == 0,\n    Short_Corners == 0,\n    Attempted_Passes == 1,\n    FreeKicks == 0,\n    `type/value` %in% c(1, 2, 3, 13, 14, 15, 16, 42, 50, 61))\n\nHomeTeamTouchData <- TouchData %>%\n  filter(TeamName == Match_Home)\n\nAwayTeamTouchData <- TouchData %>%\n  filter(TeamName == Match_Away)\n\n```\n\n## Row  {.flow}\n```{r}\n#| label: home player touch plot\n#| height: 100%\n#| message: false\n\nHomeconvexPlot1stsubs <- TouchPlayerPlot_AI(TouchDataHome,  title = Match_Home,\n                                    plot_start = 00, plot_finish = firstSubHome, color = Color_Home, text_color = Color_Home_Text, method = \"mad\",\n                                    subtitle = paste0(Match_Fixture, \" Up to 1st subs\"))\nHomeconvexPlot1stsubs\n\n\n```\n\n### column {.tabset}\n```{r}\n#| title: On ball touch plot 1st subs\n#| label: home team touch plot 1st subs\n#| height: 100%\n#| message: false\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomeTeamTouchData,  title = paste0(Match_Home, \" Team On Ball Touch\"),\n                                     plot_start = 00, plot_finish = firstSubHome, color = Color_Home, logo = \"\", method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team On Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 1st Half\n#| label: home team touch plot 1st half\n#| height: 100%\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomeTeamTouchData,  title = paste0(Match_Home, \" Team On Ball Touch\"),\n                                     plot_start = 00, plot_finish = 45, color = Color_Home, logo = \"\", method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team On Ball Touch Zones 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 2nd Half\n#| label: home team touch plot 2nd half\n#| height: 100%\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomeTeamTouchData,  title = paste0(Match_Home, \" Team On Ball Touch\"),\n                                     plot_start = 50, plot_finish = 110, color = Color_Home, logo = \"\", method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team On Ball Touch Zones 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row {.flow}\n\n```{r}\n#| label: away player touch plot\n#| height: 100%\n#| message: false\n#team touch plots Away\nAwayconvexPlot1stSubs <- TouchPlayerPlot_AI(TouchDataAway,  title = Match_Away,\n                                     plot_start = 00, plot_finish = firstSubAway,  color = Color_Away, text_color = Color_Away_Text, method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st subs\"))\nAwayconvexPlot1stSubs\n\n```\n### column {.tabset}\n```{r}\n#| title: On ball touch plot 1st subs\n#| label: away team touch plot 1st subs\n#| height: 100%\n#| message: false\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayTeamTouchData,  title = paste0(Match_Away, \" Team On Ball Touch\"),\n                                       plot_start = 00, plot_finish = firstSubAway, color = Color_Away, method = \"mad\",\n                                       subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team On Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 1st Half\n#| label: away team touch plot 1st half\n#| height: 100%\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayTeamTouchData,  title = paste0(Match_Away, \" Team On Ball Touch\"),\n                                       plot_start = 00, plot_finish = 45, palette =, color = Color_Away, method = \"mad\",\n                                       subtitle = paste0(Match_Fixture, \" 1st Half\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team On Ball Touch Zones 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 2nd Half\n#| label: away team touch plot 2nd half\n#| height: 100%\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayTeamTouchData,  title = paste0(Match_Away, \" Team On Ball Touch\"),\n                                       plot_start = 50, plot_finish = 110, palette =, color = Color_Away, method = \"mad\",\n                                       subtitle = paste0(Match_Fixture, \" 2nd Half\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team On Ball Touch Zones 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Dribbles by Game Period\n#| height: 100%\nHomeDribblesPlotT <- HomeDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(Match_Home, \" \", DribblesTitle_text, \" by game period\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nHomeDribblesPlotT\n```\n\n```{r}\n#| title: Dules by Game Period\n#| height: 100%\nHomeDulesPlotT <- HomeDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  #  facet_grid(Game_Period ~ playerId) +\n  labs(title = paste0(Match_Home, \" \", DuelsTitle_text, \" by game period\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nHomeDulesPlotT\n```\n\n### column {.tabset}\n\n```{r}\n#| title: Dribbles by Game Period\n#| height: 100%\nAwayDribblesPlotT <- AwayDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(Match_Away, \" \", DribblesTitle_text, \" by game period \"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayDribblesPlotT\n\n```\n```{r}\n#| title: Duels by Game Period\n#| height: 100%\nAwayDulesPlotT <- AwayDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(Match_Away, \" \", DuelsTitle_text, \" by game period\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\ntheme(plot.title = element_markdown(),\n      plot.caption = element_markdown(),\n      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n      plot.subtitle = element_text(colour = \"black\", size = 1),\n      legend.position = \"none\",\n      strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n      strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayDulesPlotT\n\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Dribbles by Player\nHomeDribblesPlotP <- HomeDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 5) +\n  \n  labs(title = paste0(Match_Home, \" \", DribblesTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\nHomeDribblesPlotP\n\n```\n\n\n```{r}\n#| height: 100%\n#| title: Duels by Player\n#| label: Home Duels plot by player\n#canvas\nHomeDulesPlotP <- HomeDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 6) +\n  \n  labs(title = paste0(Match_Home, \" \", DuelsTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nHomeDulesPlotP\n```\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Dribbles by Player\nAwayDribblesPlotP <- AwayDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 5) +\n  \n  labs(title = paste0(Match_Away, \" \", DribblesTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayDribblesPlotP\n```\n\n```{r}\n#| height: 100%\n#| title: Duels by Player\nAwayDulesPlotP <- AwayDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 6) +\n  \n  labs(title = paste0(Match_Away, \" \", DuelsTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\nAwayDulesPlotP\n\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Whole Team\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n   # scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + Name, ncol = 6) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 4, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 3, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n\n```{r}\n#| title: Defenders\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  filter(role == \"Defender\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n```{r}\n#| title: Midfielders\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  filter(role == \"Midfielder\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n```{r}\n#| title: Forwards\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  filter(role == \"Forward\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Whole team\n#| out-height: 100%\n#| out-width: 100%\n\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~factor(role, levels = c(\n                                      \"Keeper\", \n                                      \"Defender\", \n                                      \"Midfielder\", \n                                      \"Forward\"\n                                      )) + Name, ncol = 6) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 4, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 3, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n```{r}\n#| title: Defenders\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>% \n  filter(role == \"Defender\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n```{r}\n#| title: Midfielders\n#| out-height: 100%\n#| out-width: 100%\n\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>%\n  filter(role == \"Midfielder\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n```{r}\n#| title: Forwards\n#| out-height: 100%\n#| out-width: 100%\n\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>% \n  filter(role == \"Forward\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n## Column {.flow}\n```{r}\n\n#| out-height: 100%\n#| out-width: 100%\n\nPlayer_Summary_data_A_MOM <- Player_Summary_data_Home %>% \n  filter(Name == HMOM)\n  \nPlayer_Summary_Plot_Home <- Player_Summary_data_A_MOM %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n   # scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  #facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + Name, ncol = 6) +\n  #force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Player_Summary_data_A_MOM$Name, \" Player Match Profile\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 8, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 8, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n\n```{r}\n\n#| out-height: 100%\n#| out-width: 100%\n\nPlayer_Summary_data_MOM <- Player_Summary_data_Away %>% \n  filter(Name == AMOM)\n  \nPlayer_Summary_Plot_Away <- Player_Summary_data_MOM %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n   # scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  #facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + Name, ncol = 6) +\n  #force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Player_Summary_data_MOM$Name, \" Player Match Profile\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 8, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 8, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Away\n\n```\n\n# EPV Analysis\n```{r}\n#| output: false\n#| label: EPV Time Data setup\n#| echo: false\n#set final plot data frame\n\n#EPV over time line plot Opta data\n#data wrangling\nEPVPlotData <- plottingData %>%\n    mutate(Home_EPV = ifelse(TeamName == Match_Home & `outcomeType/value` == 1, EPVvalue, 0)) %>%\n  mutate(Home_Cumalative_EPV = cumsum(Home_EPV))\n\nEPVPlotData <- EPVPlotData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Home_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n          Goal_point_Y = round(Goal_point_Y,2),\n         Home_Cumalative_EPV = round(Home_Cumalative_EPV,2)) %>%\n  select(TeamName, expandedMinute, minute, type, Home_Cumalative_EPV, TeamEPV, EPVvalue, Goal_point_Y, Goal_point_X, Cumalative_EPV, Home_Cumalative_EPV, Successful_Passes,Successful_Carries)\n\nEPVdfHome <- EPVPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    EPV_roll5 = slide_dbl(Home_Cumalative_EPV,\n                           mean,\n                           .before = 10,   \n                           .complete = TRUE)) %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n\n\nAwayEPVPlotData <- plottingData %>%\n    mutate(Away_EPV = ifelse(TeamName == Match_Away & `outcomeType/value` == 1, EPVvalue, 0)) %>%\n  mutate(Away_Cumalative_EPV = cumsum(Away_EPV))\n\nAwayEPVPlotData <- AwayEPVPlotData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Away_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Goal_point_Y = round(Goal_point_Y,2),\n         Away_Cumalative_EPV = round(Away_Cumalative_EPV,2)) %>%\n  select(TeamName, expandedMinute, minute, type, Away_Cumalative_EPV, TeamEPV, EPVvalue, Goal_point_Y, Goal_point_X, Cumalative_EPV, Away_Cumalative_EPV, Successful_Passes, Successful_Carries)\n\n\nEPVdfAway <- AwayEPVPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    EPV_roll5 = slide_dbl(Away_Cumalative_EPV,\n                           mean,\n                           .before = 10,   \n                           .complete = TRUE)) %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n```\n\n\n```{r}\n#| output: false\n#| echo: false\n#| label: EPV Area Setup\n#EPV Development area  plot Opta data\n#data wrangling\nEPVAreaPlotData <- plottingData\n\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  filter(TeamName == Match_Home)\n\n#set final plot data frame\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  #mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = sum(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Goal_point_Y = round(Goal_point_Y,2))\n\n#Away EPV Development area  plot Opta data\n#data wrangling\nAwayEPVAreaPlotData <- plottingData\n\nAwayEPVAreaPlotData <- AwayEPVAreaPlotData %>%\n  filter(TeamName == Match_Away)\n\n#set final plot data frame\nAwayEPVAreaPlotData <- AwayEPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  #mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = sum(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Goal_point_Y = round(Goal_point_Y,2))\n\n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nEPVTimePlot <- EPVPlotData %>%\n#canvas\n  ggplot(aes(x = expandedMinute, y = Home_Cumalative_EPV)) +\n  \n#geometrics\n  \n  # smoothed lines\n  geom_smooth(data = EPVdfHome, aes(x = expandedMinute, y = EPV_roll5), linewidth = 1.2, color = Color_Home, fill = \"snow\") +\n  #geom_line(size = 1.5, colour = Color_Home) +\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +    \n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute, \" EPV:\", Goal_point_Y)), size = 2) +\n  \n#formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, 0.5)) +\n  labs(title = paste(Match_Home, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Match time (Mins)\",\n         caption = My_caption,\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nEPVTimePlot\n\n```\n\n```{r} \n#| height: 100%\n#set final plot data frame\nAwayEPVTimePlot <- AwayEPVPlotData %>%\n  \n  #canvas\n  ggplot(aes(x = expandedMinute, y = Away_Cumalative_EPV)) +\n  \n  # smoothed lines\n  geom_smooth(data = EPVdfAway, aes(x = expandedMinute, y = EPV_roll5), linewidth = 1.2, color = Color_Away, fill = \"snow\") +\n\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +   \n  \n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute, \" EPV:\", Goal_point_Y)), size = 2) +\n  \n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, 0.5)) +\n  labs( title = paste0(Match_Away, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Match time (Mins)\",\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\nAwayEPVTimePlot\n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#canvas\nEPVAreaPlot <- EPVAreaPlotData %>% \n  ggplot(aes(x = expandedMinute, y = EPVArea)) +\n  \n#geometrics\n  geom_line(size = 1, colour = \"black\") +\n  geom_area(fill = Color_Home) +\n\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(\"Game Min:\", minute, \" \", type, \"\\nEPV:\", Goal_point_Y)), size = 2) +\n\n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 0.60), breaks = seq(0, 0.60, 0.02)) +\n  labs(title = paste(Match_Home, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Match Time (mins)\",\n         caption = My_caption,\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\nEPVAreaPlot\n```\n\n```{r EVP away area}\n#| height: 100%\n#canvas\nAwayEPVAreaPlot <- AwayEPVAreaPlotData %>% \n  ggplot(aes(x = expandedMinute, y = EPVArea)) +\n  \n  #geometrics\n  geom_line(size = 1, colour = \"black\") +\n  geom_area(fill = Color_Away) +\n  #geom_segment(aes(y = 0, yend = max(EPVArea), x = 45, xend = 45), linewidth = 0.8, colour = \"black\", linetype = \"longdash\") +\n  #geom_text(aes(x = 45, y = max(EPVArea), label = \"HT\"), colour = \"black\", hjust = 1.5, vjust = 1, size = 4) +\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(\"Game Min:\", minute, \" \", type, \"\\nEPV:\", Goal_point_Y)), size = 2) +\n\n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 0.60), breaks = seq(0, 0.60, 0.02)) +\n  labs( title = paste0(Match_Away, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Match Time (mins)\",\n         caption = My_caption,\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\nAwayEPVAreaPlot\n\n```\n\n## Row\n\n```{r}  \n#| output: false\nEPVHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(Corners == 0,\n         FreeKicks == 0,\n         Cross_Passes == 0,\n         Successful_Passes == 1,\n         Successful_Carries == 1, \n         Successful_Touches == 1,\n             !if_any(matches(\"^qualifiers/\\\\d+/type/value$\"),\n            ~ coalesce(.x == 107, FALSE)))\n\n#set time period\nEPVHeatMapDataFT <- EPVHeatMapData\n\n# Calculate average player position\n      Average_PlayerFT <- EPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPVFT <- sum(EPVHeatMapDataFT$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFT$zone_x <- cut(EPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFT$zone_y <- cut(EPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFT <- EPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFT,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZFT <- average_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZFT <- average_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPVFT,2)))  \n\n\n```\n\n```{r}\n#Away EPV heat plots\n#| output: false\nAwayEPVHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(Corners == 0,\n         FreeKicks == 0,\n         Cross_Passes == 0,\n         Successful_Passes == 1,\n         Successful_Carries == 1, \n         Successful_Touches == 1,\n             !if_any(matches(\"^qualifiers/\\\\d+/type/value$\"),\n            ~ coalesce(.x == 107, FALSE)))\n\n\n#set for time period\nAwayEPVHeatMapDataFT <- AwayEPVHeatMapData\n\n# Calculate average player position\n      AwayAverage_PlayerFT <- AwayEPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPVFT <- sum(AwayEPVHeatMapDataFT$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataFT$zone_x <- cut(AwayEPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataFT$zone_y <- cut(AwayEPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvFT <- AwayEPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZFT <- Awayaverage_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZFT <- Awayaverage_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPVFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nEPVHeatMapplotFT <- EPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n    #plot player positions\n  geom_point(data = AwayAverage_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n\n  # add zone percentage numbers\n  geom_text(data = average_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n    \n  #plot player names\n  geom_text(data = AwayAverage_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n    #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n\n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nFull Game\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nEPVHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayEPVHeatMapplotFT <- AwayEPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerFT, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nFull Game\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplotFT\n\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(expandedMinute <= firstSubHome)\n\n# Calculate average player position\n      Average_Player1Sub <- EPVHeatMapData1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n\n```{r} \n#| output: false\n#Post first subs map\n#set time period\nEPVHeatMapDataP1sub <- EPVHeatMapData %>%\n  filter(expandedMinute > firstSubHome)\n\n# Calculate average player position\n      Average_PlayerP1Sub <- EPVHeatMapDataP1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPVP1sub <- sum(EPVHeatMapDataP1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataP1sub$zone_x <- cut(EPVHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataP1sub$zone_y <- cut(EPVHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvP1sub <- EPVHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVP1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZP1sub <- average_epvP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZP1sub <- average_epvNZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPVP1sub,2)))  \n```\n\n```{r}\n#| output: false\n#first subs\n#set for time period\nAwayEPVHeatMapData1sub <- AwayEPVHeatMapData %>%\n  filter(expandedMinute <= firstSubAway)\n\n# Calculate average player position\n      AwayAverage_Player1Sub <- AwayEPVHeatMapData1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPV1sub <- sum(AwayEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapData1sub$zone_x <- cut(AwayEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapData1sub$zone_y <- cut(AwayEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epv1sub <- AwayEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPV1sub,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZ1sub <- Awayaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZ1sub <- Awayaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPV1sub,2)))  \n```\n\n```{r}\n#| output: false\n#post first subs\n#set for time period\nAwayEPVHeatMapDataP1sub <- AwayEPVHeatMapData %>%\n  filter(expandedMinute > firstSubAway)\n\n# Calculate average player position\n      AwayAverage_PlayerP1Sub <- AwayEPVHeatMapDataP1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPVP1sub <- sum(AwayEPVHeatMapDataP1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataP1sub$zone_x <- cut(AwayEPVHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataP1sub$zone_y <- cut(AwayEPVHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvP1sub <- AwayEPVHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVP1sub,3)) \n\n\n#calculate for combined tile and heat map\nAwayaverage_epvNZP1sub <- Awayaverage_epvP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZP1sub <- Awayaverage_epvNZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPVP1sub,2)))  \n```\n\n\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat to 1st Sub\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nUp to first subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home EPV Heat Map 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| height: 100%\n#| title: Threat Post 1st Sub\nEPVHeatMapplotP1sub <- EPVHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_PlayerP1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZP1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nPost 1st Subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplotP1sub\n\n```\n\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat to 1st Sub\nAwayEPVHeatMapplot1sub <- AwayEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nUp to 1st Subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplot1sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away EPV Heat Map 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| height: 100%\n#| title: Threat Post 1st Sub\nAwayEPVHeatMapplotP1sub <- AwayEPVHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerP1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZP1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nPost 1st Subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplotP1sub\n```\n\n## Row {.flow}\n```{r} \n#| output: false\n#first half EPV Mao\n#set time period\nEPVHeatMapData1H <- EPVHeatMapData %>%\n  filter(period == 1)\n\n# Calculate average player position\n      Average_Player1H <- EPVHeatMapData1H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n\n#set EPV total for time period\nHomeEPV1H <- sum(EPVHeatMapData1H$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1H$zone_x <- cut(EPVHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1H$zone_y <- cut(EPVHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1H <- EPVHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1H,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1H <- average_epv1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1H <- average_epvNZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1H,2)))  \n```\n\n```{r}  \n#| output: false\n\n#Second half EPV Map\n#set time period\nEPVHeatMapData2H <- EPVHeatMapData %>%\n  filter(period == 2)\n\n# Calculate average player position\n      Average_Player2H <- EPVHeatMapData2H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPV2H <- sum(EPVHeatMapData2H$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData2H$zone_x <- cut(EPVHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData2H$zone_y <- cut(EPVHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv2H <- EPVHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV2H,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ2H <- average_epv2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ2H <- average_epvNZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV2H,2))) \n\n```\n\n```{r}\n#| output: false\n#first half\n#set for time period\nAwayEPVHeatMapData1H <- AwayEPVHeatMapData %>%\n  filter(period == 1)\n\n# Calculate average player position\n      AwayAverage_Player1H <- AwayEPVHeatMapData1H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPV1H <- sum(AwayEPVHeatMapData1H$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapData1H$zone_x <- cut(AwayEPVHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapData1H$zone_y <- cut(AwayEPVHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epv1H <- AwayEPVHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPV1H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZ1H <- Awayaverage_epv1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZ1H <- Awayaverage_epvNZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPV1H,2)))  \n\n```\n\n```{r}\n#| output: false\n#Second half\n#set for time period\nAwayEPVHeatMapData2H <- AwayEPVHeatMapData %>%\n  filter(period == 2)\n\n# Calculate average player position\n      AwayAverage_Player2H <- AwayEPVHeatMapData2H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPV2H <- sum(AwayEPVHeatMapData2H$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapData2H$zone_x <- cut(AwayEPVHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapData2H$zone_y <- cut(AwayEPVHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epv2H <- AwayEPVHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPV2H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZ2H <- Awayaverage_epv2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZ2H <- Awayaverage_epvNZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPV2H,2)))  \n```\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat 1st Half\n\nEPVHeatMapplot1H <- EPVHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n      \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) + \n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nFirst Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Home EPV Heat Map 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| title: Threat 2nd Half\n\nEPVHeatMapplot2H <- EPVHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player2H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ2H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player2H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nSecond Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Home EPV Heat Map 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat 1st Half\nAwayEPVHeatMapplot1H <- AwayEPVHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n    \n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZ1H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nFirst Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Away EPV Heat Map 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| title: Threat 2nd Half\nAwayEPVHeatMapplot2H <- AwayEPVHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player2H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n    \n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZ2H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player2H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nSecond Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Away EPV Heat Map 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#set for time period\nAwayEPVHeatMapDataFTW <- AwayEPVHeatMapData\n\n#set EPV total for time period\nAwayEPVFTW <- sum(AwayEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nAwayEPVFTGP <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataFTW$zone_x <- cut(AwayEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataFTW$zone_y <- cut(AwayEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvFTW <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVFTW,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZFTW <- Awayaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  left_join(AwayEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.8, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nAwayEPVHeatMapplotFTW <- AwayEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.8, adjust = 0.75, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayEPVHeatMapplotFTW\n```\n## Column {.tabset}\n```{r}\n#| title: EPV Passing Events - Top 5 Home\n#| label: Home Event tables T5\n#| results: asis\n\nEPVPassEventsTop5TableHome <- EPVPassEvents %>%\n  filter(`Successful Passes` == 1,\n    Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsTop5TableHome\n```\n```{r}\n#| title: EPV Passing Events - Bottom 5 Home\n#| label: Home Event tables B5\n#| results: asis\n\nEPVPassEventsBottom5TableHome <- EPVPassEvents %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsBottom5TableHome\n```\n```{r}\n#| title: EPV Carry Events - Top 5 Home\n#| label: Home Carry Event tables T5\n#| results: asis\n\nEPVCarrieEventsTop5TableHome <- EPVCarrieEvents %>%\n  filter(`Successful Carries` == 1,\n         Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsTop5TableHome\n```\n```{r}\n#| title: EPV Carry Events - Bottom 5 Home\n#| label: Home Carry Event tables B5\n#| results: asis\n\nEPVCarrieEventsBottom5TableHome <- EPVCarrieEvents %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsBottom5TableHome\n```\n## Column {.tabset}\n```{r}\n#| title: EPV Passing Events - Top 5 Away\n#| label: Away Event tables t5\n#| results: asis\n\nEPVPassEventsTop5TableAway <- EPVPassEvents %>%\n    filter(`Successful Passes` == 1,\n           Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n        slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsTop5TableAway\n```\n```{r}\n#| title: EPV Passing Events - Bottom 5 Away\n#| label: Away Event tables b5\n#| results: asis\n\nEPVPassEventsBottom5TableAway <- EPVPassEvents %>%\n    filter(Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n        slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsBottom5TableAway\n```\n```{r}\n#| title: EPV Carry Events - Top 5 Away\n#| label: Away Carry Event tables t5\n#| results: asis\n\nEPVCarrieEventsTop5TableAway <- EPVCarrieEvents %>%\n    filter(`Successful Carries` == 1,\n           Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n      slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsTop5TableAway\n```\n```{r}\n#| title: EPV Carry Events - Bottom 5 Away\n#| label: Away Carry Event tables b5\n#| results: asis\n\nEPVCarrieEventsBottom5TableAway <- EPVCarrieEvents %>%\n  filter(Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n      slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsBottom5TableAway\n```\n\n# PPDA Analysis\n## Row\n```{r}\n#| output: false\n#| echo: false\n#| warning: false\n#| message: false\n#| label: PPDA setup\nHomePPDAPlotData <- plottingData\n\nHomePPDAPlotData <- HomePPDAPlotData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Home_PPDA_Cumalative), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Home_PPDA_Cumalative = round(Home_PPDA_Cumalative,2)) %>% \n  select(expandedMinute, Home_PPDA_Cumalative, TeamName, Goal_point_X, Goal_point_Y, isGoal, type, minute)\n\ndfHome <- HomePPDAPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    PPDA_roll5 = slide_dbl(Home_PPDA_Cumalative,\n                                 mean,\n                                 .before = 10,   \n                                 .complete = TRUE))  %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n\nAwayPPDAPlotData <- plottingData\n\nAwayPPDAPlotData <- AwayPPDAPlotData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Away_PPDA_Cumalative), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Away_PPDA_Cumalative = round(Away_PPDA_Cumalative,2)) %>% \n  select(expandedMinute, Away_PPDA_Cumalative, TeamName, Goal_point_X, Goal_point_Y, isGoal, type, minute)\n\ndfAway <- AwayPPDAPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    PPDA_roll5 = slide_dbl(Away_PPDA_Cumalative,\n                           mean,\n                           .before = 10,   \n                           .complete = TRUE)) %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n\n```\n\n```{r}\n#| label: PPDA over time plot Home\n#| height: 100%\n#| warning: false\n#| message: false\n\nHomePPDATimePlot <- HomePPDAPlotData %>%\n  #canvas\n  ggplot(aes(x = expandedMinute, y = Home_PPDA_Cumalative)) +\n  # smoothed lines\n  geom_smooth(data = dfHome, aes(x = expandedMinute, y = PPDA_roll5), linewidth = 1.2, color = Color_Home, fill = \"snow\") +\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute)), size = 2) +\n  \n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  labs(title = paste(Match_Home, \" PPDA Development\"),\n       subtitle = paste0(Match_Fixture),\n       x = \"Match time (Mins)\",\n       caption = My_caption,\n       y = \"PPDA\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nHomePPDATimePlot\n```\n\n``` {r}\n#| label: PPDA over time plot Away\n#| height: 100%\n#| warning: false\n#| message: false\n\nAwayPPDATimePlot <- AwayPPDAPlotData %>%\n  #canvas\n  ggplot(aes(x = expandedMinute, y = Home_PPDA_Cumalative)) +\n\n  # smoothed lines\n  geom_smooth(data = dfAway, aes(x = expandedMinute, y = PPDA_roll5), linewidth = 1.2, color = Color_Away, fill = \"snow\") +\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute)), size = 2) +\n  \n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  labs(title = paste(Match_Away, \" PPDA Development\"),\n       subtitle = paste0(Match_Fixture),\n       x = \"Match time (Mins)\",\n       caption = My_caption,\n       y = \"PPDA\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nAwayPPDATimePlot\n\n```\n\n## Row\n\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(Defensive_Action == 1)\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(Defensive_Action == 1)\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nFull Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerFT, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nFull Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nHomePPDAHeatMapData1sub <- HomePPDAHeatMapData %>%\n  filter(expandedMinute <= firstSubHome)\n\n\n#set PPDA total for time period\nHomePPDA1sub <- sum(HomePPDAHeatMapData1sub$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapData1sub$zone_x <- cut(HomePPDAHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapData1sub$zone_y <- cut(HomePPDAHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDA1sub <- HomePPDAHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDA1sub,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZ1sub <- average_PPDA1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZ1sub <- average_PPDANZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDA1sub,2)))  \n```\n\n```{r} \n#| output: false\n#Post first subs map\n#set time period\nHomePPDAHeatMapDataP1sub <- HomePPDAHeatMapData %>%\n  filter(expandedMinute > firstSubHome)\n\n\n#set PPDA total for time period\nHomePPDAP1sub <- sum(HomePPDAHeatMapDataP1sub$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataP1sub$zone_x <- cut(HomePPDAHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataP1sub$zone_y <- cut(HomePPDAHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAP1sub <- HomePPDAHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAP1sub,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZP1sub <- average_PPDAP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZP1sub <- average_PPDANZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAP1sub,2)))  \n```\n\n```{r}\n#| output: false\n#| label: first subs away ppda\n#set for time period\nAwayPPDAHeatMapData1sub <- AwayPPDAHeatMapData %>%\n  filter(expandedMinute <= firstSubAway)\n\n\n#set PPDA total for time period\nAwayPPDA1sub <- sum(AwayPPDAHeatMapData1sub$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapData1sub$zone_x <- cut(AwayPPDAHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapData1sub$zone_y <- cut(AwayPPDAHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDA1sub <- AwayPPDAHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDA1sub,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZ1sub <- Awayaverage_PPDA1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZ1sub <- Awayaverage_PPDANZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDA1sub,2)))  \n```\n\n```{r}\n#| output: false\n#post first subs\n#set for time period\nAwayPPDAHeatMapDataP1sub <- AwayPPDAHeatMapData %>%\n  filter(expandedMinute > firstSubAway)\n\n#set PPDA total for time period\nAwayPPDAP1sub <- sum(AwayPPDAHeatMapDataP1sub$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataP1sub$zone_x <- cut(AwayPPDAHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataP1sub$zone_y <- cut(AwayPPDAHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAP1sub <- AwayPPDAHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAP1sub,3)) \n\n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZP1sub <- Awayaverage_PPDAP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZP1sub <- Awayaverage_PPDANZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAP1sub,2)))  \n```\n\n\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Defensive actions to 1st Sub\n#| height: 100%\nHomePPDAHeatMapplot1sub <- HomePPDAHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nUp to first subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplot1sub\n```\n\n```{r}\n#| height: 100%\n#| title: Defensive actions Post 1st Sub\nHomePPDAHeatMapplotP1sub <- HomePPDAHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_PlayerP1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZP1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nPost 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplotP1sub\n\n```\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Defensive actions to 1st Sub\nAwayPPDAHeatMapplot1sub <- AwayPPDAHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nUp to 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplot1sub\n```\n\n```{r}\n#| height: 100%\n#| title: Defensive actions Post 1st Sub\nAwayPPDAHeatMapplotP1sub <- AwayPPDAHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerP1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZP1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nPost 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotP1sub\n```\n\n## Row {.flow}\n```{r} \n#| output: false\n#first half PPDA Mao\n#set time period\nHomePPDAHeatMapData1H <- HomePPDAHeatMapData %>%\n  filter(period == 1)\n\n#set PPDA total for time period\nHomePPDA1H <- sum(HomePPDAHeatMapData1H$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapData1H$zone_x <- cut(HomePPDAHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapData1H$zone_y <- cut(HomePPDAHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDA1H <- HomePPDAHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDA1H,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZ1H <- average_PPDA1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZ1H <- average_PPDANZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDA1H,2)))  \n```\n\n```{r}  \n#| output: false\n\n#Second half PPDA Map\n#set time period\nHomePPDAHeatMapData2H <- HomePPDAHeatMapData %>%\n  filter(period == 2)\n\n#set PPDA total for time period\nHomePPDA2H <- sum(HomePPDAHeatMapData2H$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapData2H$zone_x <- cut(HomePPDAHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapData2H$zone_y <- cut(HomePPDAHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDA2H <- HomePPDAHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDA2H,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZ2H <- average_PPDA2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZ2H <- average_PPDANZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDA2H,2))) \n\n```\n\n```{r}\n#| output: false\n#first half\n#set for time period\nAwayPPDAHeatMapData1H <- AwayPPDAHeatMapData %>%\n  filter(period == 1)\n\n#set PPDA total for time period\nAwayPPDA1H <- sum(AwayPPDAHeatMapData1H$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapData1H$zone_x <- cut(AwayPPDAHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapData1H$zone_y <- cut(AwayPPDAHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDA1H <- AwayPPDAHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDA1H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZ1H <- Awayaverage_PPDA1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZ1H <- Awayaverage_PPDANZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDA1H,2)))  \n\n```\n\n```{r}\n#| output: false\n#| label: Second half away PPDA\n\n#set for time period\nAwayPPDAHeatMapData2H <- AwayPPDAHeatMapData %>%\n  filter(period == 2)\n\n#set PPDA total for time period\nAwayPPDA2H <- sum(AwayPPDAHeatMapData2H$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapData2H$zone_x <- cut(AwayPPDAHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapData2H$zone_y <- cut(AwayPPDAHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDA2H <- AwayPPDAHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDA2H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZ2H <- Awayaverage_PPDA2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZ2H <- Awayaverage_PPDANZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDA2H,2)))  \n```\n### column {.tabset}\n```{r}\n#| title: Defensive actions 1st Half\n#| height: 100%\n\nHomePPDAHeatMapplot1H <- HomePPDAHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZ1H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) + \n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nFirst Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Home DA Heat map 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: Defensive actions 2nd Half\n#| height: 100%\n\nHomePPDAHeatMapplot2H <- HomePPDAHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player2H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZ2H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player2H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) + \n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nSecond Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Home DA Heat map 2nd half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Defensive actions 1st Half\n#| height: 100%\nAwayPPDAHeatMapplot1H <- AwayPPDAHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZ1H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nFirst Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Away DA Heat map 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: Defensive actions 2nd Half\n#| height: 100%\nAwayPPDAHeatMapplot2H <- AwayPPDAHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player2H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZ2H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player2H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nSecond Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Away DA Heat map 2nd half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, TeamName, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,TeamName == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, TeamName, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,TeamName == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n### column {.tabset}\n```{r}\n#| title: Post DA 1st Half\n#| label: Home Post DA Plot 1st Half\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\") \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| title: Post DA 2nd Half\n#| label: Home Post DA Plot 2nd Half\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\") \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Post DA 1st Half\n#| label: Away Post DA Plot 1st Half\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\")\n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: Post DA 2nd Half\n#| label: Away Post DA Plot 2nd Half\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\")\n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n\n```\n\n```{r}\n#set for time period\nAwayEPVHeatMapDataFTW <- AwayEPVHeatMapData\n\n#set EPV total for time period\nAwayEPVFTW <- sum(AwayEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nAwayEPVFTGP <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataFTW$zone_x <- cut(AwayEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataFTW$zone_y <- cut(AwayEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvFTW <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVFTW,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZFTW <- Awayaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  left_join(AwayEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| label: home team off ball touch plot subs\n#| title: Off ball touch map to 1st subs\n\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomePPDAHeatMapData,  title = paste0(Match_Home, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = firstSubHome, color = Color_Home, logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Off Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: home team off ball touch plot 1st half\n#| title: Off ball touch map to 1st half\n\n\nHometouchPlot1half <- TouchTeamPlot_OPTA(HomePPDAHeatMapData,  title = paste0(Match_Home, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = 45, color = Color_Home, logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 1st Half\"))\nHometouchPlot1half\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Off Ball Touch Zones 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: home team off ball touch plot 2 half\n#| title: Off ball touch map to 2nd half\n\n\nHometouchPlot2half <- TouchTeamPlot_OPTA(HomePPDAHeatMapData,  title = paste0(Match_Home, \" Team Off Ball Touch\"),\n                                     plot_start = 50, plot_finish = 110, color = Color_Home,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 2nd half\"))\nHometouchPlot2half\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Off Ball Touch Zones 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| label: Away team off ball touch plot subs\n#| title: Off ball touch map to 1st subs\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayPPDAHeatMapData,  title = paste0(Match_Away, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = firstSubAway, color = Color_Away,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Off Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: Away team off ball touch plot 1 half\n#| title: Off ball touch map to 1st Half\n\nAwaytouchPlot1half <- TouchTeamPlot_OPTA(AwayPPDAHeatMapData,  title = paste0(Match_Away, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = 45, color = Color_Away,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 1st Half\"))\nAwaytouchPlot1half\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Off Ball Touch Zones 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: Away team off ball touch plot 2 half\n#| title: Off ball touch map 2nd Half\n\nAwaytouchPlot2half <- TouchTeamPlot_OPTA(AwayPPDAHeatMapData,  title = paste0(Match_Away, \" Team Off Ball Touch\"),\n                                     plot_start = 50, plot_finish = 110, color = Color_Away,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 2nd Half\"))\nAwaytouchPlot2half\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Off Ball Touch Zones 2nd half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n# xG & Shot Analysis\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: xG setup\n\n#Load home data\ndashboard_data <- plottingData\n\ndashboard_data <- dashboard_data %>%\n  filter(TeamName == Match_Home) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, OTShots, minute, expandedMinute, result = type, player = playerId, period, Game_Period)\n\n#Load away data\nAwaydashboard_data <- plottingData\n\nAwaydashboard_data <- Awaydashboard_data %>%\n  filter(TeamName == Match_Away) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, OTShots, minute, expandedMinute, result = type, player = playerId, period, Game_Period)\n\n```\n\n\n## Row\n\n```{r home xG line}\n\n# Line Plot\n\n  xGLinePlot <- dashboard_data %>%\n    ggplot() +\n  #Geometrics\n  #xg line\n  geom_line(aes(x = expandedMinute, y = TotalxG), linewidth = 2, colour = Color_Home) +\n  \n  #npXg line\n  geom_line(aes(x = expandedMinute, y = TotalNPxG), linewidth = 1, colour = Color_Home, linetype = \"dashed\") +\n  \n  #xGOT line\n  geom_line(aes(x = expandedMinute, y = TotalxGOT), linewidth = 1, colour = \"ivory4\") +\n  \n  #add ball image for goals\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(result, \" Min:\", expandedMinute, \"\\nxG:\", xG)), size = 2) +\n\n  #formatting\n  expand_limits(x = 0, y = 0) +\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 6), breaks = seq(0, 6, 0.2)) +\n  labs(x = \"Match Time (mins)\", \n       y = \"xG, NPxG, xGOT\",\n       title = paste0(Match_Home, \" \", xGlineTitle_text),\n       caption = My_caption,\n       subtitle = paste0(Match_Fixture))  +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(size = 12),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(size = 8),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        legend.position = \"none\",\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nxGLinePlot\n\n```\n\n```{r away xG line}\n# Line Plot\n#canvas\nxGLinePlotAway <- Awaydashboard_data %>%\n  ggplot() +\n  \n  #Geometrics\n  #plot xg line\n  geom_line(aes(x = expandedMinute, y = TotalxG), linewidth = 2, colour = Color_Away) +\n  \n  #npXg line\n  geom_line(aes(x = expandedMinute, y = TotalNPxG), linewidth = 1, colour = Color_Away, linetype = \"dashed\") +\n  \n  #xGOT line\n  geom_line(aes(x = expandedMinute, y = TotalxGOT), linewidth = 1, colour = \"ivory4\") +\n  \n  #add ball image for goals\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(result, \" Min:\", expandedMinute, \"\\nxG:\", xG)), size = 2) +\n  \n\n  #formatting\n  expand_limits(x = 0, y = 0) +\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 6), breaks = seq(0, 6, 0.2)) +\n  labs(x = \"Match Time (mins)\", \n       y = \"xG, NPxG, xGOT\",\n       title = paste0(Match_Away, \" \", AwayxGlineTitle_text), \n       caption = My_caption,\n       subtitle = paste0(Match_Fixture))  +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(size = 12),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(size = 8),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nxGLinePlotAway\n```\n\n## Row\n\n```{r home density plot}\n\n# Density Shot Map\n#canvas\nxGDensityPlot <- dashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture, \"\\nDarker Colour + Tighter Lines = Higher xG\"),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n       caption = My_caption,\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        legend.position = \"none\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\n#xGDensityPlot_I\nxGDensityPlot\n\n```\n\n```{r away density plot}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotAway <- Awaydashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) + \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture, \"\\nDarker Colour + Tighter Lines = Higher xG\"),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n       caption = My_caption,\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),        \n        plot.caption = element_markdown(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nxGDensityPlotAway_I <- ggplotly(xGDensityPlotAway, tooltip = \"text\")\n\nxGDensityPlotAway_I <- xGDensityPlotAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\n#xGDensityPlotAway_I\nxGDensityPlotAway\n```\n\n\n\n## Row\n\n```{r home bubble plot}\n\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(TeamName == Match_Home)\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 5)) +\n  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, 1)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n#xGBubble_Plot\n```\n\n```{r away bubble plot}\n\nAwayShotBubblexG_data <- plottingData \n\nAwayShotBubblexG_data <- AwayShotBubblexG_data %>%\n  filter(TeamName == Match_Away)\n\nAwayShotBubblexG_data <- AwayShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGAwayBubblePlot_data <- AwayShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGAwayBubblePlot_data <- xGAwayBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGAwayBubblePlot_data_pivot <- xGAwayBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  AwayxGBubble_Plot <- xGAwayBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 5)) +\n  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, 1)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nAwayxGBubble_Plot_I  <- ggplotly(AwayxGBubble_Plot, tooltip = \"text\")\n\nAwayxGBubble_Plot_I <- AwayxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nAwayxGBubble_Plot_I\n#AwayxGBubble_Plot\n\n```\n\n## Row\n### column {.tabset}\n```{r}\n#| title: Full Time xG Situation\n#| label: Home Situation plot ft\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n#xGSituationBar\n\n```\n```{r}\n#| title: 1st Half xG Situation\n#| label: Home Situation plot 1h\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n    filter(period == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n#xGSituationBar\n\n```\n\n```{r}\n#| title: 2nd Half xG Situation\n#| label: Home Situation plot 2h\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n  filter(period == 2) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n#xGSituationBar\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Full Time xG Situation\n#| label: Away Situation plot ft\n# Bar Plot\nxGSituationBarAwayData <- Awaydashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarAway <- xGSituationBarAwayData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarAway_I <- ggplotly(xGSituationBarAway, tooltip = \"xG\")\n\nxGSituationBarAway_I <- xGSituationBarAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarAway_I\n#xGSituationBarAway\n```\n```{r}\n#| title: 1st Half  xG Situation\n#| label: Away Situation plot 1h\n# Bar Plot\nxGSituationBarAwayData <- Awaydashboard_data %>%\n  filter(period == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarAway <- xGSituationBarAwayData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarAway_I <- ggplotly(xGSituationBarAway, tooltip = \"xG\")\n\nxGSituationBarAway_I <- xGSituationBarAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarAway_I\n#xGSituationBarAway\n```\n\n```{r}\n#| title: 2nd Half xG Situation\n#| label: Away Situation plot 2nd\n# Bar Plot\nxGSituationBarAwayData <- Awaydashboard_data %>%\n  filter(period == 2) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarAway <- xGSituationBarAwayData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarAway_I <- ggplotly(xGSituationBarAway, tooltip = \"xG\")\n\nxGSituationBarAway_I <- xGSituationBarAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarAway_I\n#xGSituationBarAway\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Overall shot map\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\n#shot map\nHome_S_plot <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Shot Map.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\nHome_S_plot_I <- ggplotly(Home_S_plot, tooltip = \"text\")\n\nHome_S_plot_I <- Home_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nHome_S_plot_I\n#Home_S_plot\n\n```\n```{r}\n#| title: Shot Map by player\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nHome_S_plotW <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Player\")\n\nHome_S_plotW_I <- ggplotly(Home_S_plotW, tooltip = \"text\")\nHome_S_plotW_I <- Home_S_plotW_I %>%\n    config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n Home_S_plotW_I \n#Home_S_plotW\n```\n\n```{r}\n#| title: Shot Map by time\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nHome_S_plotWT <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nHome_S_plotWT_I <- ggplotly(Home_S_plotWT, tooltip = \"text\")\nHome_S_plotWT_I <- Home_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nHome_S_plotWT_I\n#Home_S_plotWT\n```\n\n### column {.tabset}\n```{r}\n#| title: Overall Shot Map\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\nAway_S_plot <- plot_shot_AI(Awaydashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = AwayHA,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Shot Map.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\nAway_S_plot_I <- ggplotly(Away_S_plot, tooltip = \"text\")\n\n\nAway_S_plot_I <- Away_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nAway_S_plot_I\n#Away_S_plot\n\n```\n\n```{r}\n#| title: Shot Map by player\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nAway_S_plotW <- plot_shot_AI(Awaydashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = AwayHA,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Player\")\n\nAway_S_plotW_I <- ggplotly(Away_S_plotW, tooltip = \"text\")\nAway_S_plotW_I <- Away_S_plotW_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n#Away_S_plotW\nAway_S_plotW_I\n\n```\n\n```{r}\n#| title: Shot Map by time\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nAway_S_plotWT <- plot_shot_AI(Awaydashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = AwayHA,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nAway_S_plotWT_I <- ggplotly(Away_S_plotWT, tooltip = \"text\")\nAway_S_plotWT_I <- Away_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nAway_S_plotWT_I\n#Away_S_plotWT\n```\n","srcMarkdownNoYaml":"\n\n\n```{r}\n#' Simulate Football Match Outcomes Based on xG\n#'\n#' @param home_xg_vector Numeric vector of xG values for each home team shot\n#' @param away_xg_vector Numeric vector of xG values for each away team shot\n#' @param runs Number of simulations to perform (default: 10000)\n#' @param seed Random seed for reproducibility (default: 1111)\n#'\n#' @return A list containing:\n#' - `prob_matrix`: A matrix of scoreline probabilities\n#' - `long_prob_matrix`: Data frame for plotting with ggplot\n#' - `simulation_results`: Data frame of simulated outcomes\n\n\nsimulate_match_outcomes <- function(\n  home_xg_vector, \n  away_xg_vector, \n  runs = 10000, \n  seed = 1111,\n  actual_home_goals = NULL,\n  actual_away_goals = NULL\n) {\n  set.seed(seed)\n\n  safe_simulate_goals <- function(xg_vector, runs) {\n    # Flatten in case it's a list (like from dplyr::select)\n    xg_vector <- unlist(xg_vector)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    # Clean and clip to [0, 1]\n    xg_vector <- as.numeric(xg_vector)\n    xg_vector <- xg_vector[!is.na(xg_vector)]\n    xg_vector <- pmin(pmax(xg_vector, 0), 1)\n\n    if (length(xg_vector) == 0) return(rep(0, runs))\n\n    draws <- rbinom(length(xg_vector) * runs, size = 1, prob = rep(xg_vector, each = runs))\n    goals_matrix <- matrix(draws, nrow = runs, byrow = FALSE)\n    rowSums(goals_matrix)\n  }\n\n  home_goals <- safe_simulate_goals(home_xg_vector, runs)\n  away_goals <- safe_simulate_goals(away_xg_vector, runs)\n\n  simulation_results <- data.frame(Home = home_goals, Away = away_goals)\n  prob_matrix <- table(simulation_results$Home, simulation_results$Away) / runs\n\n  long_prob_matrix <- as.data.frame(as.table(prob_matrix))\n  colnames(long_prob_matrix) <- c(\"Home\", \"Away\", \"Probability\")\n  long_prob_matrix <- long_prob_matrix %>%\n    mutate(Probability = round(Probability * 100, 2))\n\n  goal_summary <- NULL\n  if (!is.null(actual_home_goals) && !is.null(actual_away_goals)) {\n    exact_count <- sum(home_goals == actual_home_goals & away_goals == actual_away_goals)\n    at_least_home <- sum(home_goals >= actual_home_goals)\n    at_least_away <- sum(away_goals >= actual_away_goals)\n\n    goal_summary <- list(\n      actual_score = paste(actual_home_goals, \"-\", actual_away_goals),\n      exact_occurrences = exact_count,\n      exact_percentage = round(100 * exact_count / runs, 2),\n      home_goals_at_least = at_least_home,\n      away_goals_at_least = at_least_away,\n      home_goals_at_least_pct = round(100 * at_least_home / runs, 2),\n      away_goals_at_least_pct = round(100 * at_least_away / runs, 2)\n    )\n  }\n\n  return(list(\n    prob_matrix = prob_matrix,\n    long_prob_matrix = long_prob_matrix,\n    simulation_results = simulation_results,\n    goal_summary = goal_summary\n  ))\n}\n\n\n```\n\n```{r}\n#| label: Team season sumary function \n\n# Reusable function to compute team summary metrics\ncompute_season_summary <- function(data, group_vars) {\n  data %>%\n    mutate(Successful_Touch = ifelse(isTouch == \"TRUE\", 1, 0),\n           TeamEPV = ifelse(str_detect(`outcomeType/value`, \"1\"), EPVvalue, 0),\n           TeamEPV = as.numeric(TeamEPV),\n           Match_day = as.numeric(Match_day)) %>%\n    group_by(across(all_of(group_vars))) %>%\n    summarise(Match_day = first(Match_day),\n              n_matches = n_distinct(game_name),\n              across(c(Goals, In_play_time, Touches, UnSuccessful_Touches, PK_Box_Touches,\n                       Final_Third_Touches, Attacking_Half_Touches, Defensive_Half_Touches,\n                       Mis_Control, Dispossessed_Total, Dribbles_Total, Dribbles_Won, Dribbles_Lost,\n                       TotalShots, OFShots, Blocked_Shot, OTShots, SixYard_Box_Shots,\n                       PK_Box_Shots, Out_Box_Shots, BCs, xG, NPxG, xGOT, \n                       Attempted_Passes,\n                       Successful_Passes, \n                       UnSuccessful_Passes, \n                       Long_Passes, \n                       Successful_Long_Passes,\n                       Corners, \n                       Short_Corners, \n                       Cross_Passes, \n                       Successful_Cross, \n                       UnSuccessful_Cross,\n                       Tackles_Total, \n                       Tackles_Won, \n                       Tackles_Lost, \n                       Fouls_Total, \n                       Fouls_Conceeded,\n                       Fouls_Received, \n                       Aerial_Won, \n                       Aerial_Lost,\n                       Clearances_Total,\n                       Interceptions_Total,\n                       Recoverys_Total, \n                       Offside_Won, \n                       Offside_Lost, \n                       TeamEPV, \n                       Defensive_Third_Touches, \n        Middle_Third_Touches, \n        SixYard_Box_Touches, \n        Attempted_Carries, \n        Successful_Carries, \n        Prog_Carries, \n        Final_Third_Carries,\n        Final_Third_Passes, \n        PK_Box_Passes,\n        Prog_Passes,\n        Key_Passes,\n        Assists,\n        MyxA,\n        TeamxT,\n        Aerial_total, \n        Ground_Duels_Total, \n        Ground_Duels_Won, \n        Ground_Duels_Lost,\n),\n        ~ sum(.x, na.rm = TRUE) / n_matches\n      ),\n      #.groups = \"drop\"\n    ) %>%\n    #select(-n_matches) %>%\n    mutate(\n      In_play_time = round(In_play_time / 60, 1),\n      Possession   = round((Touches / (sum(Touches))) * 100, 1),\n      Field_Tilt   = round((Final_Third_Touches / (sum(Final_Third_Touches))) * 100, 1),\n      Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n      Long_Pass_Success = round((Successful_Long_Passes / Long_Passes) * 100, 1),\n      Long_Pass_Rate    = round((Long_Passes / Attempted_Passes) * 100, 2),\n      Cross_Success     = round((Successful_Cross / Cross_Passes) * 100, 2),\n      Failed_Pass    = Attempted_Passes - Successful_Passes,\n      Failed_Cross   = Cross_Passes - Successful_Cross,\n      Failed_Dribble = Dribbles_Total - Dribbles_Won,\n      Poss_Gained = Interceptions_Total + Recoverys_Total +\n                    (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost),\n      Poss_Lost = Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble +\n                  OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost,\n      Posession_Control =\n        Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) +\n        (Aerial_Won - Aerial_Lost) -\n        (Mis_Control + Dispossessed_Total + UnSuccessful_Passes +\n         UnSuccessful_Cross + Dribbles_Lost + OFShots + Blocked_Shot + Offside_Lost),\n      `EPV % xG Con.`   = round((xG   / TeamEPV) * 100, 1),\n      `EPV % NPxG Con.` = round((NPxG / TeamEPV) * 100, 1)\n    ) %>%\n    mutate(across(everything(), ~ replace_na(.x, 0))) %>%\n    mutate(across(where(is.numeric), ~ round(.x, 2)))\n}\n\n```\n\n\n```{r}\n#| label: Team sumary function \n\n# Reusable function to compute team summary metrics\ncompute_summary <- function(data, group_vars) {\n  data %>%\n    mutate(Successful_Touch = ifelse(isTouch == \"TRUE\", 1, 0),\n           TeamEPV = ifelse(str_detect(`outcomeType/value`, \"1\"), EPVvalue, 0),\n           TeamEPV = as.numeric(TeamEPV)) %>%\n    group_by(across(all_of(group_vars))) %>%\n        summarise(Match_day = first(Match_day), \n                  across(c(Goals, In_play_time, Touches, UnSuccessful_Touches, PK_Box_Touches,\n                       Final_Third_Touches, Attacking_Half_Touches, Defensive_Half_Touches,\n                       Mis_Control, Dispossessed_Total, Dribbles_Total, Dribbles_Won, Dribbles_Lost,\n                       TotalShots, OFShots, Blocked_Shot, OTShots, SixYard_Box_Shots,\n                       PK_Box_Shots, Out_Box_Shots, BCs, xG, NPxG, xGOT, \n                       Attempted_Passes,\n                       Successful_Passes, \n                       UnSuccessful_Passes, \n                       Long_Passes, \n                       Successful_Long_Passes,\n                       Corners, \n                       Short_Corners, \n                       Cross_Passes, \n                       Successful_Cross, \n                       UnSuccessful_Cross,\n                       Tackles_Total, \n                       Tackles_Won, \n                       Tackles_Lost, \n                       Fouls_Total, \n                       Fouls_Conceeded,\n                       Fouls_Received, \n                       Aerial_Won, \n                       Aerial_Lost,\n                       Clearances_Total,\n                       Interceptions_Total,\n                       Recoverys_Total, \n                       Offside_Won, \n                       Offside_Lost, \n                       TeamEPV, \n                       Defensive_Third_Touches, \n        Middle_Third_Touches, \n        SixYard_Box_Touches, \n        Attempted_Carries, \n        Successful_Carries, \n        Prog_Carries, \n        Final_Third_Carries,\n        Final_Third_Passes, \n        PK_Box_Passes,\n        Prog_Passes,\n        Key_Passes,\n        Assists,\n        MyxA,\n        TeamxT,\n        Aerial_total, \n        Ground_Duels_Total, \n        Ground_Duels_Won, \n        Ground_Duels_Lost,\n        ),\n                 sum, na.rm = TRUE)) %>%\n    mutate(In_play_time = round(In_play_time / 60, 1),\n           Possession = round((Touches/(sum(Touches)))*100,1),\n           Field_Tilt = round((Final_Third_Touches/(sum(Final_Third_Touches)))*100,1),\n           Pass_Success = round((Successful_Passes / Attempted_Passes) * 100, 1),\n           Long_Pass_Success = round((Successful_Long_Passes / Long_Passes) * 100, 1),\n           Long_Pass_Rate = round((Long_Passes / Attempted_Passes) * 100, 2),\n           Cross_Success = round((Successful_Cross / Cross_Passes) * 100, 2),\n           Failed_Pass = Attempted_Passes - Successful_Passes,\n           Failed_Cross = Cross_Passes - Successful_Cross,\n           Failed_Dribble = Dribbles_Total - Dribbles_Won,\n           Poss_Gained = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost),\n           Poss_Lost = Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble + OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost,\n           Posession_Control = Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) +\n                               (Aerial_Won - Aerial_Lost) -\n                               (Mis_Control + Dispossessed_Total + UnSuccessful_Passes +\n                               UnSuccessful_Cross + Dribbles_Lost + OFShots + Blocked_Shot + Offside_Lost),\n           `EPV % xG Con.` = round((xG / TeamEPV) * 100, 1),\n           `EPV % NPxG Con.` = round((NPxG / TeamEPV) * 100, 1),\n           ) %>%\n    \n    mutate(across(everything(), ~replace_na(.x, 0))) \n  \n}\n\n```\n\n``` {r}\n#| label: Shift column function\n# Shift column funtion, this copies the player name columna into a new column and shifts it up one to then be the reciever \nshift_column <- function(data, columns, new_names = sprintf(\"%s.Shifted\", columns), len = 1L, up = TRUE) {\n  if (length(columns) != length(new_names)) {\n    stop(\"columns and new_names must be the same length\")\n  }\n  \n  # get the rows to keep based on how much to shift it by and weather to shift up or down\n  rowsToKeep <- seq(from = 1 + len * up, length.out = NROW(data) - len)\n  \n  # for the original data -- it needs to be shifted the other way\n  dataRowsToKeep <- seq(from = 1 + len * !up, length.out = NROW(data) - len)\n  \n  #create a df of the shifted rows\n  shiftedDF <- data[rowsToKeep, columns]\n  \n  # give the right names to these new columns\n  names(shiftedDF) <- new_names\n  \n  # data names\n  dataNames <- names(data)\n  \n  # get rid of excess rows in data\n  data <- data[dataRowsToKeep, ]\n  \n  # tack shifted data onto the end of the original (and cutoff) data\n  data <- cbind(data, shiftedDF)\n  names(data) <- c(dataNames, new_names)\n  \n  return(data)\n  } \n\n```\n\n```{r}\n#| output: false\n#| label: touch area function Quantiles\n#' Function for plotting Player touch areas\n#' Function for plotting Team touch areas - set at 75%\n\n#calculate touch area of player - set at 75% using quantiles\ntouch_area_shape_quantiles <- function(data) {\n  \n  x_low <- quantile(data$x, 0.15)\n  x_high <- quantile(data$x, 0.85)\n  \n  y_low <- quantile(data$y, 0.15)\n  y_high <- quantile(data$y, 0.85)\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n```\n```{r}\n\n#| output: false\n#| label: touch area function Mad\n#' Function for plotting Player touch areas using 1.5 MAD( 75% of data) Mediands\ntouch_area_shape_mad <- function(data) {\n  \n  x_median <- median(data$x)\n  y_median <- median(data$y)\n  \n  x_mad <- median(abs(data$x - x_median))/0.6745\n  y_mad <- median(abs(data$y - y_median))/0.6745\n  \n  x_low <- x_median - 1.5*x_mad\n  x_high <- x_median + 1.5*x_mad\n  \n  y_low <- y_median - 1.5*y_mad\n  y_high <- y_median + 1.5*y_mad\n  \n  touch_area_data <- data %>%  \n    filter((x > x_low) & (x < x_high)) %>%\n    filter((y > y_low) & (y < y_high)) %>%\n    slice(chull(x, y))\n  \n  return(touch_area_data)\n}\n\n```\n\n\n```{r}\n#| output: false\n#| label: Enhanced TouchPlayerPlot_AI with method selection and dynamic faceting\nTouchPlayerPlot_AI <- function(\n  data,\n  color = \"firebrick4\",\n  text_color = \"\",\n  title = \"\",\n  subtitle = \"\",\n  plot_start = 0,\n  plot_finish = 45,\n  logo = \"\",\n  method = \"quantile\",  # or \"mad\"\n  facet_by = \"playerId\"\n) {\n  required_cols <- c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"expandedMinute\", \"Game_Period\", \"role\")\n  if (nrow(data) == 0 || !all(required_cols %in% names(data))) {\n    stop(\"The dataset has insufficient columns and/or insufficient data.\")\n  }\n\n  data <- data %>%\n    filter(`type/value` %in% c(1, 2, 3, 4, 7, 8, 9, 10:16, 41, 42, 44, 45, 50, 52, 54, 61, 73, 74),\n           `outcomeType/value` == 1) %>%\n    drop_na(playerId, x, y) %>%\n    filter(between(expandedMinute, plot_start, plot_finish))\n\n  list_data <- split(data, data$playerId)\n\n  # Use appropriate shape function\n  shape_fn <- if (method == \"mad\") touch_area_shape_mad else touch_area_shape_quantiles\n  touch_area_data <- purrr::map(list_data, shape_fn) %>% purrr::reduce(full_join)\n\n  PlayerPos <- touch_area_data %>%\n    group_by(playerId) %>%\n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), .groups = \"drop\") %>%\n    na.omit()\n\n  teamtitle <- paste(title, \"Player Touch Areas\")\n\n  player_touch_map <- ggplot(touch_area_data) +\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n    annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n    \n    geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\") +\n    geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\") +\n    geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\") +\n    \n    geom_point(data = data, aes(x = x, y = y), alpha = 0.5, colour = \"black\", size = 1) +\n    geom_polygon(aes(x = x, y = y), colour = color, alpha = 0.2, fill = color, size = 0.4) +\n    geom_point(data = PlayerPos, aes(x = x, y = y), colour = color, alpha = 0.8, shape = 19, size = 2) +\n    facet_wrap(as.formula(paste(\"~\", facet_by)), ncol = 4) +\n    labs(\n      title = teamtitle,\n      x = \"\",\n      subtitle = paste(subtitle, \"\nArea = 75% of activity, Team Colour Dot = Player Average Position\"),\n      caption = My_caption\n    ) +\n    theme(\n      legend.position = \"none\",\n      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      strip.background = element_rect(fill = color, color = \"black\", linetype = \"solid\", linewidth = 1),\n      strip.text = element_text(size = 8, colour = text_color),\n      plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n      plot.subtitle = element_text(colour = \"black\", size = 10),\n      plot.caption = element_markdown(),\n      axis.title.x = element_blank()\n    )\n\n  if (logo == \"Yes\") {\n    player_touch_mapAI <- ggdraw() +\n      draw_plot(player_touch_map, x = 0, y = 0, width = 1, scale = 1) +\n      draw_image(logo_AI, x = 0.445, y = 0.438, scale = 0.12)\n  } else {\n    player_touch_mapAI <- player_touch_map\n  }\n\n  return(player_touch_mapAI)\n}\n```\n\n```{r}\n#| output: false\n#| lable: Enhanced TouchTeamPlot_OPTA with method selection\nTouchTeamPlot_OPTA <- function(\n  data,\n  color = \"#E74C3C\",\n  palette = NULL,\n  title = \"\",\n  subtitle = \"\",\n  plot_start = 0,\n  plot_finish = 45,\n  logo = \"\",\n  method = \"mad\"  # or \"quantile\"\n) {\n  required_cols <- c(\"x\", \"y\", \"finalX\", \"finalY\", \"playerId\", \"expandedMinute\", \"Game_Period\", \"file_name\", \"role\")\n  if (nrow(data) == 0 || !all(required_cols %in% names(data))) {\n    stop(\"The dataset has insufficient columns and/or insufficient data.\")\n  }\n\n  data <- data %>%\n    drop_na(playerId, x, y) %>%\n    filter(dplyr::between(expandedMinute, plot_start, plot_finish))\n\n  shape_fn <- if (method == \"quantile\") touch_area_shape_quantiles else touch_area_shape_mad\n  list_data <- split(data, data$playerId)\n  touch_area_data <- purrr::map(list_data, shape_fn) %>% purrr::reduce(dplyr::full_join)\n\n  PlayerPos <- touch_area_data %>%\n    group_by(playerId) %>%\n    summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), .groups = \"drop\") %>%\n    tidyr::drop_na()\n\n  # ---- NEW: build palette from `palette` or default white -> color ramp ----\n  players <- sort(unique(as.character(touch_area_data$playerId)))\n  n <- length(players)\n\n  build_palette <- function(players, palette, color) {\n    n <- length(players)\n\n    # 1) Named vector mapping playerId -> color\n    if (is.character(palette) && !is.null(names(palette))) {\n      if (!all(players %in% names(palette))) {\n        warning(\"Named palette does not cover all players; missing players will be auto-colored.\")\n      }\n      cols <- palette[players]\n      # fill any NAs (uncovered players) from a white->color ramp\n      if (anyNA(cols)) {\n        fill_cols <- grDevices::colorRampPalette(c(\"#FFFFFF\", color))(sum(is.na(cols)))\n        cols[is.na(cols)] <- fill_cols\n      }\n      names(cols) <- players\n      return(cols)\n    }\n\n    # 2) Paletteer \"pkg::pal\" string\n    if (is.character(palette) && length(palette) == 1 && grepl(\"::\", palette, fixed = TRUE)) {\n      if (requireNamespace(\"paletteer\", quietly = TRUE)) {\n        cols <- as.character(paletteer::paletteer_d(palette, n))\n        names(cols) <- players\n        return(cols)\n      } else {\n        warning(\"paletteer not installed; falling back to white -> color ramp.\")\n      }\n    }\n\n    # 3) Plain vector of colors to interpolate\n    if (is.character(palette) && length(palette) >= 1) {\n      cols <- grDevices::colorRampPalette(palette)(n)\n      names(cols) <- players\n      return(cols)\n    }\n\n    # Default: white -> color ramp (keeps your 'min = white' feel)\n    cols <- grDevices::colorRampPalette(c(\"#FFFFFF\", color))(n)\n    if (n == 1) cols <- color\n    names(cols) <- players\n    cols\n  }\n\n  pal <- build_palette(players, palette, color)\n\n  # lock factor levels\n  touch_area_data <- touch_area_data %>%\n    mutate(playerId = factor(as.character(playerId), levels = players))\n  PlayerPos <- PlayerPos %>%\n    mutate(playerId = factor(as.character(playerId), levels = players))\n  # -------------------------------------------------------------------------\n\n  teamtitle <- paste(title, \"Areas\")\n\n  touch_map <- ggplot(touch_area_data) +\n    \n    # use the palette (discrete by player)\n    scale_fill_manual(values = pal) +\n    scale_colour_manual(values = pal) +\n\n    annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n    theme_pitch() +\n    annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9),\n             x = 0, xend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83),\n             y = 0, yend = 100, linewidth = 0.5, colour = \"#95A5A6\", linetype = \"longdash\") +\n    #plot player touch area\n    geom_polygon(aes(x = x, y = y, fill = playerId, colour = playerId), alpha = 0.15, size = 0.5) +\n    #plot player average position\n    geom_point(data = PlayerPos, aes(x = x, y = y, fill = playerId, colour = playerId),\n               alpha = 0.7, shape = 21, size = 3, stroke = 0.5) +\n    # plot player name\n    geom_text(data = PlayerPos, aes(x = x, y = y + 4, label = playerId, colour = playerId), size = 3) +\n    labs(\n      title = teamtitle,\n      subtitle = paste(subtitle, \"\\nArea = 75% of activity, Dot = Player Average Position\"),\n      caption = My_caption,\n      x = \"\"\n    ) +\n    theme(\n      strip.background = element_rect(fill = \"#E5E5E5\", \n      colour = NA), strip.text = element_text(colour = \"black\", size = 10), \n      plot.title = element_text(colour = \"black\", \n      size = 14, face = \"bold\"),\n      plot.subtitle = element_text(colour = \"black\", size = 10),\n      plot.caption = element_markdown(),\n      axis.title.x = element_text(colour = \"black\", size = 12, face = \"bold\"),\n      legend.position = \"none\"\n    )\n\n  if (logo == \"Yes\") {\n    touch_mapAI <- ggdraw() +\n      draw_plot(touch_map, x = 0, y = 0, width = 1, scale = 1) +\n      draw_image(logo_AI, x = 0.4, y = 0.45, scale = 0.07)\n  } else {\n    touch_mapAI <- touch_map\n  }\n\n  return(touch_mapAI)\n}\n\n```\n\n```{r}\n#| output: false\n#| label: Shot map function\n\n#' Function for plotting shots for a team\n\nplot_shot_AI <- function(data, type = \"\", teamColor = \"#B22222\", text_color = \"\", bins = 30, highlight_goals = \"\", average_location = \"\", matchFixture = \"\", mapName = \"\", mapType = \"\", matchDate = \"\", dataSource = \"\", logo = \"\", wrap = \"\") {\n  \n  # Checking data frame   \n  if ((nrow(data) > 0) &&\n      sum(c(\"minute\", \"X\", \"Y\", \"xG\", \"xGOT\", \"NPxG\", \"result\", \"OTShots\", \"player\", \"Game_Period\") %in% names(data)) == 10) {\n\n    # set plot names\n    if (dataSource == \"UnderStat\") {\n      \n      if (mapType == \"Home\") {\n      \n        home_team <- (data$home_team[nrow(data)])\n        \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"Away\") {\n      \n        away_team <- (data$away_team[nrow(data)]) \n        \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold \\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n    \n      } else if (mapType == \"Player\") {  \n      \n        last <- sub(\".* \", \"\", data$player[nrow(data)])\n        first <- sub(\" .*\", \"\", data$player[nrow(data)])\n        player_name <- paste(first, last)\n      \n        #shot_map_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span>><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n      \n    } else if (dataSource == \"FotMob\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$home_team[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$away_team[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        last <- (data$last_name[nrow(data)])\n        first <- (data$first_name[nrow(data)])\n        player_name <- paste(first, last)\n        \n        #shotshot_map_name_name <- paste(player_name, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n        \n    } else if (dataSource == \"Opta\") {\n      if (mapType == \"Home\") {\n        \n        home_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(home_team, \" \", ShotTitle_text_Home)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{home_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Away\") {\n        \n        away_team <- (data$TeamName[nrow(data)]) \n        #shot_map_name <- paste0(away_team, \" \", ShotTitle_text_Away)\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{away_team}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n        \n      } else if (mapType == \"Player\") {  \n        \n        player_name <- (data$playerId[nrow(data)])\n        \n        #shot_map_name <- paste(player, \"Shot Map\")\n        shot_map_name <- paste0(\n  glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>{player_name}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Shot Map (</span><span style='font-family:\\\"Arial Bold\\\";color:{teamColor};font-size:16px;'>Goal,</span><span style='font-family:\\\"Arial\\\";color:{teamColor};font-size:16px;'> SoT</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#95A5A6;font-size:16px;'>No Goal</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n      \n      } else if (mapType == \"\") {  \n      \n        shot_map_name <- paste(mapName, \"Shot Map\")\n      }\n    }\n      \n    fixture_name <- paste(matchFixture, \"(\",dataSource,\")\")\n  \n\n    # set Plot Colours and scale\n    fill_b <- \"#E5E5E5\"\n    pitch_lines <- \"black\"\n    color_b <- teamColor\n    colorLine <- \"#95A5A6\"\n    colorText <- \"black\"\n    fill_Goal <- c(\"No Goal\" = fill_b,\"SoT\" = teamColor, \"Goal\" = teamColor)\n    Alpha_Goal <- c(\"No Goal\" = 0.9,\"SoT\" = 0.3, \"Goal\" = 1)\n    # Data Wrangling \n    if (dataSource == \"UnderStat\") {\n      data <- data %>%\n        mutate(X = 100 * X) %>%\n        mutate(Y = 100 * Y)\n      \n     } else if (dataSource == \"FotMob\") {\n        data <- data %>%\n             mutate(X = (X * 0.941050375),\n                    Y = (Y * 1.464079972))\n        \n     } else if (dataSource == \"Opta\") {\n        data <- data \n      }\n    \n    if (nrow(data) >= 1) {\n      data <- data %>%\n        mutate(xG = round(xG,2),\n               isGoal = ifelse(result == \"Goal\", \"Goal\", ifelse(OTShots == 1, \"SoT\", \"No Goal\"))) \n\n              # set the pitch up\n              plot <- data %>%\n                ggplot() +\n                annotate_pitch(dimensions = pitch_opta, colour = pitch_lines, fill = fill_b) +\n                theme_pitch() +\n                annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n                annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n                \n                # add zone numbers\n                geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n                geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE)\n              \n              # geometrics \n              if (average_location == TRUE || average_location == \"\") {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") { ## Don't highlight goals ----\n                    plot  <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute,\"\\nOutcome:\", result, \"\\nxG\", xG, \"\\nxGOT\", xGOT)), alpha = 0.7, stroke = 0.5) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\",\n                      )\n                  } else if (highlight_goals == TRUE) { ## Highlight goals ----\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X,  y = Y, size = xG, fill = isGoal, alpha = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result, \"\\nxG\", xG, \"\\nxGOT\", xGOT)), color = color_b, shape = 21, stroke = 0.5) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_alpha_manual(values = Alpha_Goal)+\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") { ## DENSITY ----\n                  plot <- plot +\n                      stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n                    scale_fill_gradient(high = teamColor, low = text_color) +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5)\n                  \n                } else if (type == \"hexbin\") { ## HEXBIN ----\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result,  \"\\nxG\", xG, \"\\nxGOT\", xGOT)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    geom_vline(xintercept = mean(data$X), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    geom_hline(yintercept = mean(data$Y), color = colorLine, linetype = 2, linewidth = 1.5) +\n                    labs(\n                      fill = \"Count of Shots\"\n                    )\n                }\n              } else if (average_location == FALSE) {\n                \n                if (type == \"point\" || type == \"\") {\n                  \n                  if (highlight_goals == FALSE || highlight_goals == \"\") {\n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, color = result, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result, \"\\nxG\", xG, \"\\nxGOT\", xGOT)), alpha = 0.7, stroke = 0.5) +\n                      geom_image(data = filter(data, isGoal == \"Goal\"),\n    mapping = aes(x = X, y = Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball3.png\"), \n     by = \"width\", inherit.aes = TRUE\n  ) +\n                      \n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        color = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } else if (highlight_goals == TRUE) {\n                    \n                    plot <- plot +\n                      geom_point(data = data, aes(x = X, y = Y, size = xG, fill = isGoal, alpha = isGoal, text = paste(\"Player:\", player, \"\\nMin:\", minute,  \"\\nOutcome:\", result,  \"\\nxG\", xG, \"\\nxGOT\", xGOT)), color = color_b, shape = 21,  stroke = 0.5) +\n                      \n                      geom_image(data = filter(data, isGoal == \"Goal\"),\n    mapping = aes(x = X, y = Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball3.png\"),\n    by = \"width\", inherit.aes = TRUE\n  ) +\n                      scale_fill_manual(values = fill_Goal) +\n                      scale_alpha_manual(values = Alpha_Goal) +\n                      scale_size_continuous(range = c(0.5, 6)) +\n                      labs(\n                        fill = paste(\"Shot Result \n                                     \\n& xG\"),\n                        size = \"\"\n                      )\n                  } \n                } else if (type == \"density\") {\n                  plot <- plot +\n                    stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n                    scale_fill_gradient(high = teamColor, low = text_color) +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(fill = \"xG\")\n                  \n                  \n                } else if (type == \"hexbin\") {\n                  plot <- plot +\n                    geom_hex(data = data, aes(x = X, y = Y, text = paste(\"Player:\", player, \"\\nMin:\", minute, \"\\nOutcome:\", result,  \"\\nxG\", xG, \"\\nxGOT\", xGOT)), bins = bins) +\n                    scale_fill_continuous(type = \"viridis\") +\n                    scale_size_continuous(range = c(0.5, 6)) +\n                    labs(\n                      fill = \"Count of Shots\")\n                } \n              }\n              # Make Half pitch  \n              plot <- plot +\n                coord_flip(xlim = c(50, 100),\n                           ylim = c(100, 0))\n              # formatting  \n              plot <- plot +\n                labs(title = shot_map_name, \n                     subtitle = fixture_name,\n                     caption = My_caption) +\n                \n                theme(legend.position = \"none\",\n                      legend.direction = \"horizontal\",\n                      legend.background = element_rect(fill = \"snow\"),\n                      legend.title = element_text(colour = colorText, face = \"bold\"),\n                      legend.text = element_text(colour = colorText, size = 10),\n                      legend.key = element_rect(fill = \"snow\"),\n                      plot.title = element_markdown(),\n                      plot.caption = element_markdown(),\n                      plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n                      plot.subtitle = element_text(colour = colorText, hjust = 0, size = 10))\n              \n              # wrap or not\n              if (wrap == \"Player\") {\n                #divide stats by player\n                player_stats <- data %>%\n                  group_by(player) %>%\n                  summarize(\n                    total_xG = sum(xG),\n                    total_goal = sum(result == \"Goal\"),\n                    xg_sot = total_xG / n(),\n                    total_shots = n(),\n                    SOT = sum(OTShots)\n                  )\n\n                plot <- plot +\n                  facet_wrap(~player) +\n                  theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                        strip.text = element_text(size = 10, colour = text_color))\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 71.05, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 50, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 28.95, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                  \n                  geom_point(x = 54, y = 10.55, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(data = player_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = colorText, size = 2) +\n                  geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                \n                } else if (wrap == \"Time\") {\n                  \n                  #divide stats by time period\n                  GPeriod_stats <- data %>%\n                    group_by(Game_Period) %>%\n                    summarize(\n                      total_xG = sum(xG),\n                      total_goal = sum(result == \"Goal\"),\n                      xg_sot = total_xG / n(),\n                      total_shots = n(),\n                      SOT = sum(OTShots)\n                    )\n                  \n                  \n                    plot <- plot +\n                      \n                      facet_wrap(~ Game_Period) +\n                      theme(strip.background = element_rect(fill = teamColor, color = \"black\", linetype = \"solid\", linewidth = 1),\n                            strip.text = element_text(size = 10, colour = text_color)) \n                    \n                    plot <- plot +\n                    geom_point(x = 54, y = 89.45, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 89.45, label = format(round(total_xG, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 89.45, label = \"xG\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 71.05, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 71.05, label = format(round(SOT, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 71.05, label = \"SOT\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 50, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 50, label = format(round(total_shots, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 50, label = \"Shots\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 28.95, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 28.95, label = format(round(xg_sot, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 28.95, label = \"xG/Shot\", color = colorText, size = 2) +\n                      \n                      geom_point(x = 54, y = 10.55, size = 5, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                      geom_text(data = GPeriod_stats, aes(x = 54, y = 10.55, label = format(round(total_goal, 2))), color = colorText, size = 2) +\n                      geom_text(x = 62, y = 10.55, label = \"Goals\", color = colorText, size = 2)\n                  \n              } else if (wrap == \"\") {\n                total_xG <- sum(data$xG)\n                total_goal <- sum(data$result == \"Goal\")\n                xg_sot <- total_xG / nrow(data)\n                total_shots <- nrow(data)\n                SOT <- sum(data$OTShots)\n                \n                plot <- plot +\n                  geom_point(x = 54, y = 89.45, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 89.45, label = format(round(total_xG, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 89.45, label = \"Total xG\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 71.05, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 71.05, label = format(round(SOT, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 71.05, label = \"SOT\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 50, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  \n                  geom_text(x = 54, y = 50, label = format(round(total_shots, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 50, label = \"Total Shots\", color = colorText, size = 3) +  \n                  geom_point(x = 54, y = 28.95, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 28.95, label = format(round(xg_sot, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 28.95, label = \"xG/Shot\", color = colorText, size = 3) +\n                  geom_point(x = 54, y = 10.55, size = 12, color = pitch_lines, shape = 21, fill = fill_b, stroke = 0.5) +\n                  geom_text(x = 54, y = 10.55, label = format(round(total_goal, 2)), color = colorText, size = 3) +\n                  geom_text(x = 60, y = 10.55, label = \"Goals\", color = colorText, size = 3)\n              \n                Finalplot <- plot\n              }\n              \n              # logo or not\n              if (logo == \"Yes\") {\n                \n                # annotate plot\n                Finalplot <- ggdraw() +\n                  draw_plot(plot, x = 0, y = 0, width = 1, height = , scale = 1) +\n                  draw_image(logo_AI,  x = 0.42, y = 0.45, scale = 0.07) \n                \n              } else if (logo == \"\") {\n                \n                Finalplot <- plot\n              }\n              \n              return(Finalplot)\n              \n             } else \n               {\n              ## add WARNING that there were no rows in the data frame passed into function??\n              return(plot)\n    }\n    }\n  }\n\n```\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n#| label: Pass network function\n#' Function for plotting pass networks\n\nplot_passnet_AI <- function(data, team_name, scale_stat = \"EPV\", \n                         scale_color = \"firebrick2\", text_color = \"white\", subtitle = \"\", plot_start = \"00\", plot_finish = \"45\", logo = \"\", pitch = \"\", wrap = \"\", pressmap = \"\", passes = \"2\") {\n  \n    # Checking data frame \n    \n    if ((nrow(data) > 0) &&\n        sum(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"expandedMinute\", \"outcome\", \"Game_Period\", \"player_shirt\", \"Successful_Passes\") %in% names(data)) == 12) {\n    } else {\n      print(c(\"x\", \"y\", \"finalX\", \"finalY\", \"TeamName\", \"playerId\", \"type\", \"expandedMinute\", \"outcome\", \"Game_Period\", \"player_shirt\", \"Successful_Passes\"))\n      stop(\"The dataset has insufficient columns and/or insufficient data.\")\n    }\n    \n    # Generate error messages\n    \n    if (is.character(data$playerId) == FALSE) {\n      stop(\"The playerId column is supposed to contain player names.\")\n    }\n    \n    if (is.character(data$TeamName) == FALSE) {\n      stop(\"The TeamName column is supposed to contain team names.\")\n    }\n  \n    # full Pitch or half Pitch\n\n    if  (pitch == \"Half\") { \n      data <- data %>%\n        filter(x >= 50)\n    \n    }else if (pitch == \"Full\") {\n      data <- data\n    }\n  # exclude set pieces and throw ins\n  Pass_data <- data %>%\n    filter(Attempted_Passes == 1)\n\n      # Stat calculation\n    \n    if (scale_stat == \"xT\") {\n      \n      df <- Pass_data %>%\n        calculate_threat(type = \"opta\")\n      \n      df <- df %>%\n        mutate(xT = xTEnd - xTStart) %>%\n        select(xT)\n      df[is.na(df)] <- 0\n      \n      Pass_data$stat <- df$xT\n      \n      leg_title <- \"xT\"\n      \n    } else if (scale_stat == \"EPV\") {\n      \n      df <- Pass_data %>%\n        calculate_epv(type = \"opta\")\n      \n      df <- df %>%\n        mutate(EPV = EPVEnd - EPVStart) %>%\n        select(EPV)\n      df[is.na(df)] <- 0\n      \n      Pass_data$stat <- df$EPV\n      \n      leg_title <- \"EPV\"\n      \n    }\n    \n  # Calculate Pass percentage\n  Pass_data <- Pass_data %>%\n  replace_na(list(Attempted_Passes = 0, Successful_Passes = 0)) %>%\n  mutate(stat = as.numeric(stat)) %>%\n replace_na(list(stat = 0))\n\n  Pass_data <- Pass_data %>%\n  mutate(Pass_Suc = if_else(Attempted_Passes > 0,\n                                   Successful_Passes / Attempted_Passes, NA_real_))\n  \n  #set title text\n    PassNetTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network</span>\"))\n  \n  PassNetTitle_textD <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{scale_color};font-size:14px;'>{team_name}</span><span style='color:gray12;font-size:14px;'> Pass Network & </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:14px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:14px;'>Unsuccessful</span><span style='color:gray12;font-size:14px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:14px;'>Successful</span><span style='color:gray12;font-size:14px;'>)</span>\"))\n  \n    # wrap or not\n    if (wrap == \"Yes\") {\n      \n      #calculate pressing date\n\nif (pressmap == \"Yes\") {\n  PressData <- data %>%\n    filter(TeamName == team_name, Defensive_Action == 1)\n}\n\nplotCaption <- paste0(\n  glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span>\n       <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Line = </span>\n       <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span>\n       <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes</span>\"))\n\n# ---- Data wrangling --------------------------------------------------------\ndata1 <- Pass_data %>%\n  filter(TeamName == team_name) %>%\n  filter(!is.na(playerId))\n\n# If you still want the \"receiver\" column by next event within period:\ndata1 <- data1 %>%\n  arrange(Game_Period, expandedMinute) %>%\n  group_by(Game_Period) %>%\n  mutate(receiver = dplyr::lead(playerId, n = 1)) %>%\n  ungroup()\n\n# ---- Nodes: player averages per period (DROP groups) -----------------------\nnodes <- data1 %>% \n  group_by(playerId, player_shirt, Game_Period) %>% \n  summarise(\n    x = mean(x, na.rm = TRUE),\n    y = mean(y, na.rm = TRUE),\n    events = dplyr::n(),\n    stat   = sum(stat, na.rm = TRUE),\n    Successful_Passes = sum(Successful_Passes, na.rm = TRUE),\n    Attempted_Passes  = sum(Attempted_Passes,  na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# ---- Edgelist: successful passes per period ------------------\nedgelist <- data1 %>%\n  filter(Successful_Passes == 1) %>%\n  select(from = playerId, to = receiver, Game_Period) %>%\n  filter(!is.na(to)) %>%\n  group_by(from, to, Game_Period) %>%\n  summarise(n = dplyr::n(), .groups = \"drop\")\n\n# ---- Coordinates for pass lines -----------------\ncoords <- nodes %>%\n  ungroup() %>%\n  select(playerId, Game_Period, x, y)\n\n# Join coords for 'from' and 'to' WITH Game_Period\nedges <- edgelist %>%\n  left_join(coords, by = c(\"from\" = \"playerId\", \"Game_Period\" = \"Game_Period\")) %>%\n  left_join(coords, by = c(\"to\"   = \"playerId\", \"Game_Period\" = \"Game_Period\"),\n            suffix = c(\"\", \".to\")) %>%\n  mutate(xend = x.to, yend = y.to)\n\n# Collapse to undirected pairs *within period*, keep one geometry per pair\nedges <- edges %>%\n  mutate(player1 = pmin(from, to), player2 = pmax(from, to)) %>%\n  group_by(player1, player2, Game_Period) %>%\n  summarise(\n    Total_Passes = sum(n, na.rm = TRUE),\n    x    = dplyr::first(x),\n    y    = dplyr::first(y),\n    xend = dplyr::first(xend),\n    yend = dplyr::first(yend),\n    .groups = \"drop\"\n  ) %>%\n  filter(Total_Passes >= passes)\n\n# ---- Final tidy on nodes ---------------------------------------------------\nnodes <- nodes %>%\n  arrange(Game_Period) %>%\n  mutate(playerId = ifelse(grepl(\" \", playerId), sub(\".*\\\\s\", \"\", playerId), playerId),\n         playerId_short = if_else(grepl(\" \", playerId),\n                                         sub(\".*\\\\s\", \"\", playerId),\n                                         playerId))\n\n# Plot the passnetwork\n      \n      plot_passnet <- ggplot() +\n        \n        #setup the pitch\n        annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n        theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        \n        #set scale and color gradient\n        scale_colour_gradientn(\n          colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 0.5)), \n        breaks = scales::breaks_width(0.1), \n        name = \"Circle Colour = Threat (EPV)\") +\n        \n        scale_size_continuous(range = c(0.5, 3)) +\n        \n        scale_fill_manual(values = c(\"#0000FF\",  \"red2\"))\n      \n      if (pressmap == \"Yes\") {\n        \n        #plot pressing data\n        plot_passnet <- plot_passnet +\n          geom_point(data = PressData, aes(x = x, y = y, group = Game_Period, fill = outcome), shape = 21, size = 1, show.legend = FALSE)\n        \n      } else if (pressmap == \"\") {\n        \n        plot_passnet <- plot_passnet\n      }\n      \n        #plot player connections\n        plot_passnet <- plot_passnet +\n          geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, linewidth = (Total_Passes*0.25)), colour = \"black\", alpha = 0.8, show.legend = FALSE) +\n\n        #plot player positions\n          new_scale_color() +\n          new_scale_fill() +\n          geom_point(data = nodes, aes(x, y, fill = stat), size = 3, shape = 21, colour = \"black\", stroke = 0.5) +\n\n        #plot player Numbers\n        geom_text(data = nodes, aes(x, y, label = player_shirt), colour = \"black\", size = 1) +\n        \n        # set scale and colors\n        scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 0.5)), \n        breaks = scales::breaks_width(0.1), \n        name = \"Circle Colour = Threat (EPV)\") +\n        \n        #formatting\n          labs(title = PassNetTitle_text,\n               subtitle = plotCaption,\n             x = \"\",\n             colour = leg_title,\n             caption = My_caption) +\n          \n            theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            #axis.title.x = element_text(colour = \"black\", size = 6)\n            axis.title.x = element_blank()) +\n\n        #Wrap the plots\n          facet_wrap(~Game_Period, ncol = 4) +\n          theme(strip.text.x = element_text(face = \"bold\", size = 10, colour = text_color),\n              strip.background.x = element_rect(fill = scale_color, color = \"black\", linetype = \"solid\", linewidth = 1))\n\n    } else if (wrap == \"\") {\n      \n      #calculate pressing date\n      \n      if (pressmap == \"Yes\") {\n        \n        data <- data %>%\n          filter(between(expandedMinute, plot_start, plot_finish))\n        \n        PressData <- data %>%\n          filter(TeamName == team_name) \n        \n        PressData <- PressData %>%\n          filter(Defensive_Action == 1)\n\n      } else if (pressmap == \"\") {\n        \n      }\n      \n      plotCaption <- paste0(\n  glue(\"\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><br>\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>Line = </span>\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span>\n    <span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes, Larger Circle = More Passes</span>\"))\n\n#            plotCaption <- paste0(\n#              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Line =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes, Larger Circle = More Passes</span>\"))\n            \n            plotTag <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{subtitle}</span\"))\n            \n            plotExplaination <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Line =  </span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>{passes}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>+ Passes, Thicker Line = More Passes</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;'>, Darker Circle Colour = Higher Threat (EPV)</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:10px;', Darker Line = Higher Pass Completion, Direction of Attack Right to Left</span>\"))\n\n# Data Wrangling \n      \n# Team + valid IDs\ndata1 <- Pass_data %>%\n  dplyr::filter(TeamName == team_name) %>%\n  dplyr::filter(!is.na(playerId))\n\n# Create Receiver data\n  data1 <- data1 %>%\n  mutate(receiver = dplyr::lead(playerId, n = 1))\n\n# Restrict time window (ensure plot_start/finish are numeric)\ndata1 <- data1 %>%\n  dplyr::filter(dplyr::between(expandedMinute, as.numeric(plot_start), as.numeric(plot_finish)))\n\n# Nodes (per player)\nnodes <- data1 %>%\n  dplyr::group_by(playerId, player_shirt) %>%\n  dplyr::summarise(\n    x = mean(x, na.rm = TRUE),\n    y = mean(y, na.rm = TRUE),\n    events = dplyr::n(),\n    stat   = sum(stat, na.rm = TRUE),\n    Successful_Passes = sum(Successful_Passes, na.rm = TRUE),\n    Attempted_Passes  = sum(Attempted_Passes,  na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Edgelist (successful passes between players)\nedgelist <- data1 %>%\n  dplyr::filter(Successful_Passes == 1) %>%\n  dplyr::select(from = playerId, to = receiver) %>%\n  dplyr::group_by(from, to) %>%\n  dplyr::summarise(n = dplyr::n(), .groups = \"drop\") %>%  \n  tidyr::drop_na()\n\n# Join coordinates\ncoords <- nodes %>% dplyr::ungroup() %>% dplyr::select(playerId, x, y)\n\nedges <- edgelist %>%\n  dplyr::left_join(coords, by = c(\"from\" = \"playerId\")) %>%\n  dplyr::rename(x = x, y = y) %>%\n  dplyr::left_join(coords, by = c(\"to\"   = \"playerId\"), suffix = c(\"\", \".to\")) %>%\n  dplyr::rename(xend = x.to, yend = y.to)\n\n# Collapse to undirected pairs\nedges <- edges %>%\n  dplyr::mutate(player1 = pmin(from, to), player2 = pmax(from, to)) %>%\n  dplyr::group_by(player1, player2) %>%\n  dplyr::summarise(\n    Total_Passes = sum(n, na.rm = TRUE),\n    x    = dplyr::first(x),\n    y    = dplyr::first(y),\n    xend = dplyr::first(xend),\n    yend = dplyr::first(yend),\n    .groups = \"drop\"                         \n  ) %>%\n  dplyr::filter(Total_Passes >= passes)\n\n# Pass % per connection\nPassStats <- data1 %>%\n  dplyr::select(player1 = playerId, player2 = receiver,\n                Successful_Passes, Attempted_Passes) %>%\n  dplyr::group_by(player1, player2) %>%\n  dplyr::summarise(\n    n = dplyr::n(),\n    Successful_Passes = sum(Successful_Passes, na.rm = TRUE),\n    Attempted_Passes  = sum(Attempted_Passes,  na.rm = TRUE),\n    .groups = \"drop\"                \n  ) %>%\n  tidyr::drop_na() %>%\n  dplyr::mutate(Pass_Suc = dplyr::if_else(Attempted_Passes > 0,\n                                          Successful_Passes / Attempted_Passes, NA_real_)) %>%\n  tidyr::replace_na(list(Pass_Suc = 0))\n\nedges <- edges %>%\n  dplyr::left_join(PassStats %>% dplyr::select(player1, player2, Pass_Suc),\n                   by = c(\"player1\", \"player2\")) %>%\n  tidyr::replace_na(list(Pass_Suc = 1))\n\n# Final tidy on nodes\nnodes <- nodes %>%\n  dplyr::arrange(events) %>%\n  dplyr::mutate(\n    playerId_short = dplyr::if_else(grepl(\" \", playerId),\n                                    sub(\".*\\\\s\", \"\", playerId),\n                                    playerId)\n  )\n\n      #set range for text to change on player circle\n      EPVRange <- (max(nodes$stat)) * 0.7\n      \n      # Plot\n\n    plot_passnet <- ggplot() +\n      \n      #setup the pitch\n      annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n      theme_pitch() +\n      annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n      annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n      \n      # add zone numbers\n      geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n      \n      #set scale and color gradient\n      scale_fill_manual(values = c(\"#0000FF\",  \"red2\"), labels = c(\"Won\", \"Lost\"), name = \"\")\n\n      \n    if (pressmap == \"Yes\") {\n      \n      #plot pressing data\n      plot_passnet <- plot_passnet +\n        geom_point(data = PressData, aes(x = x, y = y, fill = outcome), shape = 21, size = 1.5, stroke = 0.5, show.legend = FALSE)\n\n    } else if (pressmap == \"\") {\n     \n      plot_passnet <- plot_passnet\n      \n    }\n      \n      #plot player connections\n    plot_passnet <- plot_passnet +\n      new_scale_fill() +\n      \n      geom_segment(data = edges, aes(x, y, xend = xend, yend = yend, linewidth = (Total_Passes*0.25), colour = Pass_Suc)) +\n      guides(linewidth = \"none\") +\n\n      #plot player positions\n      geom_point(data = nodes, aes(x, y, fill = stat, size = Attempted_Passes), shape = 21, colour = \"black\", stroke = 0.5) +\n      \n      # set colour\n      scale_colour_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 1)),\n        breaks = c(0, .25, .5, .75, 1),\n        labels = scales::label_percent(accuracy = 1),\n        name   = \"Line Color = Passing Success\") +\n      \n      scale_fill_gradientn(\n        colors = c(\"#FFFFF0\", scale_color),\n        values = scales::rescale(c(0, 0.5)), \n        breaks = scales::breaks_width(0.1), \n        name = \"Circle Colour = Threat (EPV)\") +\n      \n      # set scale\n      scale_size_continuous(range = c(2, 10),\n                        name = \"Attempted Passes\",\n        guide = \"none\")\n      \n      plot_passnet <- plot_passnet +\n      new_scale_color() +\n      \n      #plot player Numbers\n      geom_text(data = nodes,\n          aes(x, y, label = player_shirt,\n              color = stat > EPVRange,\n              size = Successful_Passes/4),\n          show.legend = FALSE) +\n      \n      # set scale    \n      scale_color_manual(values = c(\"TRUE\" = \"white\", \"FALSE\" = \"black\"), guide = \"none\") +\n      \n      #formatting\n      labs(title = PassNetTitle_text,\n           subtitle = plotCaption,\n           #tag = plotTag,\n           x = \"\",\n           colour = leg_title,\n           caption = My_caption) +\n      theme(legend.position = \"bottom\",\n            legend.direction = \"horizontal\",\n            legend.background = element_rect(fill = \"snow\"),\n            legend.key = element_rect(fill = \"snow\"),\n            plot.title = element_markdown(),\n            plot.subtitle = element_markdown(),\n            plot.caption = element_markdown(),\n            plot.tag = element_markdown(),\n            plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n            legend.title = element_text(colour = \"black\", size = 6),\n            legend.text = element_text(colour = \"black\", size = 6),\n            #axis.title.x = element_text(colour = \"black\", size = 6)\n            axis.title.x = element_blank())\n    }\n    \n    # If half pitch\n    \n    if (pitch == \"Half\") {\n      \n      plot_passnet <- plot_passnet +\n        coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n        labs(y = \" \") +\n        theme(axis.title.y = element_blank(),\n              axis.title.x = element_blank())\n      \n    } else if (pitch == \"Full\") {\n      \n      plot_passnet <- plot_passnet\n      \n    }\n    \n    # Press or not formatting\n    \n    if (pressmap == \"Yes\") {\n      \n      plot_passnet <- plot_passnet +\n\n        #formatting\n        labs(title = PassNetTitle_textD,\n             x = \"\",\n             colour = leg_title)\n      \n    } else if (pressmap == \"\") {\n      \n      plot_passnet <- plot_passnet\n    }\n\n    # logo or not\n  \n    if (logo == \"Yes\") {\n    \n    # annotate plot\n    Finalplot_passnet <- plot_passnet +\n    annotation_custom(AI_Logo, xmin = 90, xmax = 100, ymin = 105, ymax = 115) +\n      coord_cartesian(clip = \"off\") +\n      theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n    \n    } else if (logo == \"\") {\n      \n      Finalplot_passnet <- plot_passnet \n      #+\n       # theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n    }\n\n  return(Finalplot_passnet)\n  #return(list(plot = Finalplot_passnet, nodes = nodes, edges = edges))\n\n}\n```\n\n\n``` {r}\n#| label: Dashboard Setup\n#| echo: false\n#| output: false\n#| warning: false\n#| message: false\n\nlibrary(tidyverse)\nlibrary(shiny)\nlibrary(gifski)\nlibrary(magick)\nlibrary(systemfonts)\nlibrary(sysfonts)\nlibrary(fontawesome)\nlibrary(glue)\nlibrary(worldfootballR)\nlibrary(gganimate)\nlibrary(ggsoccer)\nlibrary(paletteer)\nlibrary(ggpointdensity)\nlibrary(ggthemes)\nlibrary(ggtext)\nlibrary(ggiraph)\n#library(ggiraphExtra)\nlibrary(ggimage)\nlibrary(gt)\nlibrary(gtExtras)\nlibrary(grid)\nlibrary(ggdensity)\nlibrary(treemapify)\nlibrary(magick)\nlibrary(readxl)\nlibrary(writexl)\nlibrary(chromote)\nlibrary(ggrepel)\nlibrary(png)\nlibrary(patchwork)\nlibrary(plotly)\nlibrary(reshape)\nlibrary(psych)\nlibrary(ggshakeR)\nlibrary(tidyquant)\nlibrary(gfonts)\nlibrary(extrafont)\nlibrary(extrafontdb)\nlibrary(ggnewscale)\nlibrary(stringr)\nlibrary(ggh4x)\nlibrary(ggforce)\nlibrary(scales)\nlibrary(slider)\n\n#load fonts\n#set fonts\nfont_add(\"Awesome\", regular = \"/Library/Fonts/Font Awesome 7 Brands-Regular-400.otf\")\n\n### data needed for match analysis script\n#set away\nMatch_Away <- paste0(\"Liverpool\")\n\n#Set Home\nMatch_Home <- paste0(\"Brentford\")\n\n#set match date\nGame_date <- paste(\"25-10-2025\")\n\n#set Game name\nGameName <- paste0(Match_Home,\" vs \", Match_Away)\n\n#set fixture\nMatch_Fixture <- paste0(Match_Home, \" vs \", Match_Away, \" - \", Game_date)\n\n#set database\nDataBaseName <- paste0(\"EPLComp_LFC_Games_2526\")\n\n######################\n\n#load match data\nfileName <- paste0(\"~/Documents/Dropbox files/AI LFC data/Data Sets/WhoScored/Season 2526/EPL Games/Processed Games/\", Match_Fixture, \".xlsx\")\nplottingData <- read_xlsx(fileName)\n\n#load player data\nPlayerfileName <- paste0(\"~/Documents/Dropbox files/AI lfc data/Data Sets/WhoScored/Season 2526/EPL Players/Processed Games/\", Match_Fixture, \"- PlayerData.xlsx\")\nPlayerdata <- read_xlsx(PlayerfileName)\n\n#load sesondata\nfileName <- paste0(\"~/Documents/Dropbox files/AI LFC data/Data Sets/WhoScored/Databases/\", DataBaseName, \".xlsx\")\nSeasonData <- read_xlsx(fileName)\n\n#add in team group to data base\nSeasonData <- SeasonData %>%\n  mutate(Team_Group = ifelse(TeamName == \"Liverpool\", \"Liverpool\", \"All Oppo\"))\n\n#set match day number\n#MatchDay <- first(na.omit(plottingData$Match_day))\nMatchDay <- 9\n\nGame_date <- first(na.omit(plottingData$Game_date))\n\n#set Home h/a\nHomeHA <- paste(\"Home\")\n\n#set Away h/a\nAwayHA <- paste(\"Away\") \n\n#set game week\nGameWeek <- paste0(\"MD \",MatchDay)\n\n#set Away color\nColor_Home <- paste(\"red\")\n\n#set Away text\nColor_Home_Text <- paste(\"white\")\n\n#set away color scale\nColorScale_Home <- paste(\"ggsci::red_material\")\n\n#set away color scale con\nColorScale_HomeC <- paste(\"ggthemes::Red\")\n\n#set Home color\nColor_Away <- paste(\"green4\")\n\n#set home text color\nColor_Away_Text <- paste(\"white\")\n\n#set home color scale\nColorScale_Away <- paste(\"ggsci::green_material\")\n\n#set home color scale con\nColorScale_AwayC <- paste(\"ggthemes::Green\")\n\n\n#set viz location for camcorder adn blue sky images\nVizlocation <- paste0(\"~/Documents/Dropbox files/AI LFC data/R files/AI UP/Scripts/Viz Pack/Season 2526/EPL/\", GameWeek)\n\n#seet pk timte\nPKTime <- 00\n\n#redcard (min before)\nredcard <- 00\n\n#redcard (min before)\nredcard2 <- 00\n\n#set league points\nLeague_Points <- 0\nAFC_League_Points <- 00\nMC_League_Points <- 00\n\n#set man of the match\nHMOM = paste(\"\")\nAMOM = paste(\"\")\n\n#set Waves titles\nWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\nAwayWavesTitle_text <- paste0(\n            glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Attacking Waves </span><span style='color:gray12;font-size:16px;'>(</span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Touches</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>Passes</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:green3;font-size:16px;'>Shots</span><span style='color:gray12;font-size:16px;'>)</span>\"))\n\n#set xg line titles \nxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\nAwayxGlineTitle_text <- paste0(\n          glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>xG</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>NPxG Dashed</span><span style='color:gray12;font-size:16px;'>, </span><span style='font-family:\\\"Arial Bold\\\";color:ivory4;font-size:16px;'>xGOT</span><span style='color:gray12;font-size:16px;'> development</span>\"))\n\n#set dribbles title\nDribblesTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Dribbles (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set duels title\nDuelsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'>Duels (</span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Unsuccessful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'>),</span>\"))\n\n#set PPs title\nPPsTitle_textHalf <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayPPsTitle_textHalf <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nAwayPPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Z14 & HS Passes (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nHomeTertiary_title <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Match  </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Possession</span><span style='color:grey12;font-size:16px;'> to </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Field Tilt</span><span style='color:gray12;font-size:16px;'> conversion</span>\"))\n\nAwayTertiary_title <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Match  </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>Possession</span><span style='color:grey12;font-size:16px;'> to </span><span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>Field Tilt</span><span style='color:gray12;font-size:16px;'> conversion</span>\"))\n\n##new socials\nsocial_caption <- function(twitter=\"@Barts78\",\n                           github = \"Barts78\",\n                           linkedin= \"Phil-barter\",\n                           mastodon= \"@DrBarts\",\n                           threads = \"Barts78\",\n                           data = \"OPTA\",\n                           blueSky = \"@barts78\",\n                           icon_color=\"black\",\n                           font_color=\"#454545\",\n                           bg_color=\"snow\",\n                           font_family=\"sans-serif\"){\n  \n  icons = list(\n    twitter = \"&#xe61a\",\n    github = \"&#xf09b\",\n    linkedin = \"&#xf08c\",\n    mastodon = \"&#xf4f6\",\n    threads = \"&#xe618\",\n    data = \"&#xf16b\",\n    blueSky = \"&#xe671\"\n  )   \n  \n  social = list(threads = threads, linkedin = linkedin, twitter = twitter, mastodon = mastodon, github = github, blueSky = blueSky, data = data)\n  social = social[!is.na(social)]\n  \n  caption = \"\"\n  for (name in names(social)) {\n    icon = icons[name]\n    info = social[name]\n    html = glue(\"<span style='font-family:\\\"Font Awesome 7 Brands\\\";color:{icon_color};font-size:8px;'>{icon};</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\n                <span style='font-family:{font_family};color:{font_color};font-size:8px;'>{info}</span>\n                <span style='color:{bg_color};font-size:8px;'>.</span>\")\n    \n    \n    caption = paste0(caption,html)\n  }\n  \n  caption\n}\n\n#create social caption\nmy_socials <- social_caption(twitter = \"@Barts78\",\n                             github = \"Barts78\",\n                             linkedin = \"Phil-barter\",\n                             mastodon = \"@DrBarts\",\n                             threads = NA,\n                             blueSky = \"@barts78\",\n                             data = \"OPTA\",\n                             icon_color = \"#454545\",\n                             font_color = \"#454545\",\n                             bg_color = \"snow\",\n                             font_family = \"sans-serif\")\n\nmy_datasource <- paste0('<span style=\"font-family:\\'Font Awesome 7 Free\\', Arial, sans-serif;color:#454545;font-size:8px;\">&#x1F4BE;</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>',\n                        '<span style=\"font-family:sans-serif;color:#454545;font-size:8px;\">OPTA</span>',\n                        '<span style=\"color:#FFF9FB;font-size:8px;\">...</span>')\n\nMy_caption <- paste0(my_socials)\n\n```\n\n```{r}\n#| output: false\n#| label: set Summary values\n#| message: false\n#| warning: false\n\n#set summary values\nTotal_EPV <- sum(plottingData$Cumalative_EPV)\nGameTime <- max(plottingData$expandedMinute)\nOutofPlayTime <- round(sum(plottingData$Out_of_play_time)/60,2)\nInPlayTime <- round(sum(plottingData$In_play_time)/60,2)\nPossession <- round(sum(plottingData$Touches),2)\nHomePossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName == Match_Home))/Possession)*100),2)\nAwayPossession <- round((((sum(plottingData$Touches == 1 & plottingData$TeamName == Match_Away))/Possession)*100),2)\nHomeEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPV <- round(sum(plottingData$EPVvalue[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomeEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayEPVA <- round(sum(plottingData$TeamEPV[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomexT <- round(sum(plottingData$xTvalue[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayxT <- round(sum(plottingData$xTvalue[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomexTA <- round(sum(plottingData$TeamxT[plottingData$TeamName == Match_Home & plottingData$`outcomeType/value` == 1]),2)\nAwayxTA <- round(sum(plottingData$TeamxT[plottingData$TeamName == Match_Away & plottingData$`outcomeType/value` == 1]),2)\nHomexG <- round(sum(plottingData$xG[plottingData$TeamName == Match_Home]),2)\nAwayxG <- round(sum(plottingData$xG[plottingData$TeamName == Match_Away]),2)\nHomeNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName == Match_Home]),2)\nAwayNPxG <- round(sum(plottingData$NPxG[plottingData$TeamName == Match_Away]),2)\nHomeBCs <- round(sum(plottingData$BCs[plottingData$TeamName == Match_Home]),0)\nAwayBCs <- round(sum(plottingData$BCs[plottingData$TeamName == Match_Away]),0)\nFinal_Third_Possession <- round(sum(plottingData$Final_Third_Touches),2)\nHomeFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName == Match_Home))/Final_Third_Possession)*100),2)\nAwayFieldTilt <- round((((sum(plottingData$Final_Third_Touches == 1 & plottingData$TeamName == Match_Away))/Final_Third_Possession)*100),2)\nHomeDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName == Match_Home]),0)\nAwayDActions <- round(sum(plottingData$Defensive_Action[plottingData$TeamName == Match_Away]),0)\nHomePasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName == Match_Home]),0)\nAwayPasses <- round(sum(plottingData$Attempted_Passes[plottingData$TeamName == Match_Away]),0)\nHomePPDA <- round(sum(AwayPasses/HomeDActions),2)\nAwayPPDA <- round(sum(HomePasses/AwayDActions),2)\nHomeEPVCon <- round(sum(HomexG/HomeEPVA),2)\nAwayEPVCon <- round(sum(AwayxG/AwayEPVA),2)\nHomeProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName == Match_Home]),2)\nAwayProgPasses <- round(sum(plottingData$Prog_Passes[plottingData$TeamName == Match_Away]),2)\nHomeCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName == Match_Home]),2)\nHomeProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName == Match_Home]),2)\nAwayCarries <- round(sum(plottingData$Successful_Carries[plottingData$TeamName == Match_Away]),2)\nAwayProgCarries <- round(sum(plottingData$Prog_Carries[plottingData$TeamName == Match_Away]),2)\nHomeGoals <- round(sum(plottingData$Home_Goals),0)\nHomeSOT <- round(sum(plottingData$OTShots[plottingData$TeamName == Match_Home]),0)\nHomeShootingP <- round(sum(HomeGoals/HomeSOT), 2)\nAwayGoals <- round(sum(plottingData$Away_Goals),0)\nAwaySOT <- round(sum(plottingData$OTShots[plottingData$TeamName == Match_Away]),0)\nAwayShootingP <- round(sum(AwayGoals/AwaySOT), 2)\nHomePPDO <- round(sum(HomeShootingP + (1 - AwayShootingP))*1000, 0)\nAwayPPDO <- round(sum(AwayShootingP + (1 - HomeShootingP))*1000, 0)\n\n#prepare first sub time data (min before sub)\nfirstSubHome <- plottingData %>%\n  filter(TeamName == Match_Home, SubTime != 0) %>%\n  summarise(firstsubhome = min(SubTime)) %>%\n  pull(firstsubhome)\n\nfirstSubAway <- plottingData %>%\n  filter(TeamName == Match_Away, SubTime != 0) %>%\n  summarise(firstsubaway = min(SubTime)) %>%\n  pull(firstsubaway)\n\n# set-up data frame from main variables above for summary tables\nPPDOTable <- data.frame(TeamName = c(Match_Home, Match_Away),\n                         PPDO = c(HomePPDO, AwayPPDO))\n\n```\n\n# Line Up\n\n```{r}\n#| label: lineup setup\n#| output: false\n\nPlayerdata <- Playerdata %>%\n  filter(role == \"Substitute\") %>%\n    select(Team = TeamName, Player = PlayerName, Shirt_Number = jerseyNumber, Mins_Played = substitution_minute, role) %>%\n    replace_na(list(Mins_Played = 0))\n\nMD_lineups <- plottingData %>%\n  select(TeamName, playerId, playerNumber, Shirt_Number = player_shirt, role, minutes_played) %>%\n  group_by(playerId, TeamName) %>%\n  replace_na(list(minutes_played = 0)) %>%\n  summarise(Mins_Played = min(minutes_played),  playerNumber = first(playerNumber), Shirt_Number = first(Shirt_Number),\n    role = first(role), .groups = \"drop\") %>%\n  select(Team = TeamName, Player = playerId, Shirt_Number, Mins_Played, role)\n\nMD_lineups <- bind_rows(MD_lineups, Playerdata)\n\n```\n\n## Row {.flow}\n### column\n```{r}\n#| label: Line up Home\n#| message: false\n#| warning: false\n#| results: asis\nlineupdataHome <- MD_lineups %>%\n  filter(Team == Match_Home) %>%\n  arrange(desc(Mins_Played)) %>%\n  mutate(role = factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\", \"Substitute\"))) %>%\n  arrange(role) %>%\n  \n  #lineupdataHome <- lineupdataHome %>%\n  gt(groupname_col = \"role\") %>%\n  cols_hide(Team) %>%\n  cols_move_to_end(columns = c(Shirt_Number, Player)) %>%\n  #cols_move_to_end(columns = c(Player, Shirt_Number, Mins_Played, Sub_On)) %>%\n  #row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\", \"Substitute\")) %>%\n  cols_align(align = \"right\", columns = (rev(everything()))) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Line up\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_style(\n    style = list(cell_text(align = \"right\"), \n                 cell_fill(color = \"#E5E5E5\")),\n    locations = cells_body(columns = \"Player\")) %>%\n    tab_style(\n    style = cell_text(color = \"#E5E5E5\"),\n    locations = cells_column_labels('Player')) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text, align = \"right\"), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"Right\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 20,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nlineupdataHome\n```\n### column\n```{r}\n#| label: Line up Away\n#| message: false\n#| warning: false\n#| results: asis\n\nlineupdataAway <- MD_lineups %>%\n  filter(Team == Match_Away) %>%\n  arrange(desc(Mins_Played)) %>%\n  gt(groupname_col = \"role\", rowname_col = \"Player\") %>%\n  cols_hide(Team) %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\", \"Substitute\")) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Line up\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text, align = \"left\"), \n                 cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"Left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 20,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\n\nlineupdataAway\n```\n\n# Match Summary\n``` {r}\n#| output: false\n#| label: Season summary table setup\n#posession and goals by team\nMatchSummarySeasonData <- compute_season_summary(SeasonData, group_vars = c(\"Team_Group\")) \n\nMatchSummarySeasonData <- MatchSummarySeasonData %>%\n  select('Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummarySeasonHalfData <- compute_season_summary(SeasonData %>% mutate(Half = case_when(\n  period == 1 ~ \"First Half\",\n  period == 2 ~ \"Second Half\",\n  period == 3 ~ \"First Half Extra Time\",\n  period == 4 ~ \"Second Half Extra Time\",\n  TRUE ~ \"Injury Time\")\n), group_vars = c(\"Half\", \"Team_Group\"))\n\nMatchSummarySeasonHalfData <- MatchSummarySeasonHalfData %>%\n  select(Half, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummarySeasonPeriodData <- compute_season_summary(SeasonData, group_vars = c(\"Game_Period\", \"Team_Group\"))\n\nMatchSummarySeasonPeriodData <- MatchSummarySeasonPeriodData %>%\n  select(Game_Period, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'ONT Shots' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummarySeasonGameStateData <- compute_season_summary(SeasonData, group_vars = c(\"Game_State\", \"Team_Group\"))\n\nMatchSummarySeasonGameStateData <- MatchSummarySeasonGameStateData %>%\n  select(Game_State, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\nMatchSummaryGameNameData <- compute_summary(SeasonData, group_vars = c(\"game_name\", \"Team_Group\"))\n\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  select('Fixture' = game_name, Match_day, 'Team' = Team_Group, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control, 'EPV % NPxG Con.')\n\n```\n\n``` {r}\n#| output: false\n#| message: false\n#| warning: false\n#| label: Match summary table setup\n#posession and goals by team\nMatchSummaryData <- compute_summary(plottingData, group_vars = c(\"TeamName\")) \n\n\nMatchSummaryData <- MatchSummaryData %>%\n  left_join(PPDOTable, by = c(\"TeamName\" = \"TeamName\"), copy = TRUE) \n\n\nMatchSummaryData <- MatchSummaryData %>%\n  select('Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, PPDO, 'Possession Control' = Posession_Control)\n\nMatchSummaryHalfData <- compute_summary(plottingData %>% mutate(Half = case_when(\n  period == 1 ~ \"First Half\",\n  period == 2 ~ \"Second Half\",\n  period == 3 ~ \"First Half Extra Time\",\n  period == 4 ~ \"Second Half Extra Time\",\n  TRUE ~ \"Injury Time\")\n), group_vars = c(\"Half\", \"TeamName\"))\n\nMatchSummaryHalfData <- MatchSummaryHalfData %>%\n  select(Half, 'Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control)\n\nMatchSummaryPeriodData <- compute_summary(plottingData, group_vars = c(\"Game_Period\", \"TeamName\"))\n\nMatchSummaryPeriodData <- MatchSummaryPeriodData %>%\n  select(Game_Period, 'Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'ONT Shots' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control)\n\nMatchSummaryGameStateData <- compute_summary(plottingData, group_vars = c(\"Game_State\", \"TeamName\"))\n\nMatchSummaryGameStateData <- MatchSummaryGameStateData %>%\n  select(Game_State, 'Team' = TeamName, 'Possession %' = Possession, 'On Ball Time' = In_play_time, Touches, 'PKBox Touches' = PK_Box_Touches, 'Field Tilt %' = Field_Tilt, 'Total Shots' = TotalShots, 'OFF Shots' = OFShots, 'SoT' = OTShots, '6yrd box Shots' = SixYard_Box_Shots, 'PK Box Shots' = PK_Box_Shots, 'Outside Box Shots' = Out_Box_Shots, 'Blocked Shots' = Blocked_Shot, BCs, Goals, xG, NPxG, xGOT, EPV = TeamEPV, 'EPV % xG Con.', 'EPV % NPxG Con.', 'Attempted Passes' = Attempted_Passes,  'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Long Ball Rate' = Long_Pass_Rate,  'Crosses' = Cross_Passes, 'Cross Success %' = Cross_Success, Corners, 'Short Corners' = Short_Corners, 'Possession Control' = Posession_Control)\n\n```\n```{r}\n#| output: false\n#| message: false\n#| warning: false\n#| label: Match MC setup\n\n#Load data (opta Data)\ndashboard_data <- plottingData\n\n#Home team Dashboard data\ndashboard_data <- dashboard_data %>%\n  filter(TeamName == Match_Home) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period)\n\n#Away dashboard data\n#Load data\nAwaydashboard_data <- plottingData\n\nAwaydashboard_data <- Awaydashboard_data %>%\n  filter(TeamName == Match_Away) %>%\n  filter(TotalShots == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, expandedMinute, type, period)\n\n#Matchday MC Data setup\nHomexGMC <- HomeShots <- dashboard_data %>%\n  filter(period != 5) %>%\n  select(xG)\nAwayxGMC <- AwayShots <- Awaydashboard_data %>%\n  filter(period != 5) %>%\n  select(xG)\n\n#calculate match actual goals\nHomeTotalGoals <- sum(!is.na(ifelse(dashboard_data$type == \"Goal\", 1, NA)))\nAwayTotalGoals <- sum(!is.na(ifelse(Awaydashboard_data$type == \"Goal\", 1, NA)))\n\n\n#run MC for Match outcomes and Match Score proablity\nsim_results <- simulate_match_outcomes(home_xg_vector = HomexGMC, away_xg_vector = AwayxGMC, seed = 1111, runs = 10000, actual_home_goals = HomeTotalGoals, actual_away_goals = AwayTotalGoals)\n\n# Calculate probabilities for different outcomes\nAway_wins_prob <- (sum(sim_results$prob_matrix[upper.tri(sim_results$prob_matrix)])*100)\nHome_wins_prob <- (sum(sim_results$prob_matrix[lower.tri(sim_results$prob_matrix)])*100)\ntie_prob <- (sum(diag(sim_results$prob_matrix))*100)\n\n# Create a data frame for Match outcome bar chart\noutcome_prob <- data.frame(Outcome = c(Match_Home, \"Match Drawn\", Match_Away),\n                           Probability = c(Home_wins_prob, tie_prob, Away_wins_prob))\n\noutcome_prob <- outcome_prob %>%\n  mutate(Probability = round(Probability, 2))\n\n#create data frame for Match score tile plot\nlong_prob_matrix <- sim_results$long_prob_matrix\n\n#redo factor to numeric the score probablity\nlong_prob_matrix <- long_prob_matrix %>%\n  mutate(Home = as.numeric(as.character(Home)),\n         Away = as.numeric(as.character(Away)))\n\n\n# Define custom colors\ncustom_colors <- c(Match_Home = Color_Home, \"Match Drawn\" = \"gray\", Match_Away = Color_Away)\n\n```\n\n## Row {.tabset}\n```{r}\n#| title: Match Summary tables\n#| label: Summary tables\n#| results: asis\nMatchSummaryTable <- MatchSummaryData %>%\n  gt(groupname_col = \"Team\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - Full Time**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(3, 16:19),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(2, 6, 20:21, 24, 26, 28),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(2:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:18)) %>%\n  tab_spanner(label = \"Passes\", columns = c(19:26)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = Match_Away)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = Match_Home)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \nMatchSummaryTable\n\nMatchSummaryHalfsTable <- MatchSummaryHalfData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Half\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - By Half**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 17:20),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 21:22, 25, 27, 29),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:7)) %>%\n  tab_spanner(label = \"Shots\", columns = c(8:19)) %>%\n  tab_spanner(label = \"Passes\", columns = c(20:27)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryHalfData$Half)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Home),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Home_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Home\n    )\n  ) %>%\n  \n  tab_style(\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Away\n    )\n  ) %>%\n  \n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryHalfsTable\n\nMatchSummaryPeriodTable <- MatchSummaryPeriodData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_Period\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - By Game Period**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 17:20),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 21:22, 25, 27, 29),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:7)) %>%\n  tab_spanner(label = \"Shots\", columns = c(8:19)) %>%\n  tab_spanner(label = \"Passes\", columns = c(20:27)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryPeriodData$Game_Period)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n\n  tab_style(\n    style = list(cell_fill(color = Color_Home),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Home_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Home\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Away\n    )\n  ) %>%\n  \n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryPeriodTable\n\nMatchSummaryGameStateTable <- MatchSummaryGameStateData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_State\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Match Summary - By Game State**\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  #cols_hide(`Possession %`) %>%\n  fmt_number(\n    columns = c(4, 17:20),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 21:22, 25, 27, 29),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:7)) %>%\n  tab_spanner(label = \"Shots\", columns = c(8:19)) %>%\n  tab_spanner(label = \"Passes\", columns = c(20:27)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Home),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Home_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Home\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = Color_Away),\n                 cell_text(size = 16, weight = \"bold\", color = Color_Away_Text)),\n    locations = cells_stub(\n      rows = Team == !!Match_Away\n    )\n  ) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameStateData$Game_State)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameStateTable\n\n```\n\n``` {r}\n#| title: Season Summary Tables\n#| results: asis\n#| label: Season summary tables\n\n\nMatchSummarySeasonTable <- MatchSummarySeasonData %>%\n  gt(groupname_col = \"Team\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - Full Games**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(3, 14:17),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(2, 6, 19, 22, 24, 26, 30),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = \"white\"), cell_fill(color = \"black\")),\n    locations = cells_row_groups(groups = \"All Oppo\")) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = \"white\"), cell_fill(color = \"red4\")),\n    locations = cells_row_groups(groups = \"Liverpool\")) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"#B22222\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \nMatchSummarySeasonTable\n\nMatchSummarySeasonHalfsTable <- MatchSummarySeasonHalfData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Half\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Half**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryHalfData$Half)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n    tab_style(\n    style = list(cell_fill(color = \"red4\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"Liverpool\"\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"All Oppo\"\n    )\n  ) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummarySeasonHalfsTable\n\nMatchSummarySeasonPeriodTable <- MatchSummarySeasonPeriodData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_Period\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game Period**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(4, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryPeriodData$Game_Period)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"red4\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"Liverpool\"\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"All Oppo\"\n    )\n  ) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummarySeasonPeriodTable\n\nMatchSummarySeasonGameStateTable <- MatchSummarySeasonGameStateData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Game_State\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Game State**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(5, 15:18),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(3, 7, 20, 23, 25, 27, 31),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    style = list(cell_fill(color = \"red4\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"Liverpool\"\n    )\n  ) %>%\n  tab_style(\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\")),\n    locations = cells_stub(\n      rows = Team == !!\"All Oppo\"\n    )\n  ) %>%\n    tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameStateData$Game_State)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  \n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummarySeasonGameStateTable\n\nMatchSummaryGameNameData <- MatchSummaryGameNameData %>%\n  mutate(Match_day = as.numeric(Match_day)) %>%\n  filter(!Match_day == 0) %>%\n  arrange(Match_day)\n  \n  MatchSummaryGameNameTable <- MatchSummaryGameNameData %>%\n  gt(rowname_col = \"Team\", groupname_col = \"Match_day\") %>%\n  cols_hide('On Ball Time') %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = md(\"**Season Summary - By Match Day**\"),\n    subtitle = paste0(\"Up to \", Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  fmt_number(\n    columns = c(6, 16:19),\n    decimals = 2\n  ) %>%\n  fmt_percent(\n    columns = c(4, 8, 21, 24, 26, 28, 32),\n    decimals = 1,\n    scale_values = FALSE\n  ) %>%\n  tab_spanner(label = \"Possession\", columns = c(3:6)) %>%\n  tab_spanner(label = \"Shots\", columns = c(7:17)) %>%\n  tab_spanner(label = \"Passes\", columns = c(18:22)) %>%\n  tab_style(\n    locations = cells_column_spanners('Possession'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Shots'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_row_groups(groups = unique(MatchSummaryGameNameData$Match_day)),\n    style = cell_text(weight = \"bold\", size = 16, color = \"white\")\n  ) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == \"All Oppo\")),\n    style = list(cell_fill(color = \"black\"),\n                 cell_text(size = 16, weight = \"bold\", color = \"white\"))) %>%\n  tab_style(\n    locations = cells_stub(rows = c(MatchSummaryGameNameData$Team == \"Liverpool\")),\n    style = list(cell_fill(color = \"red4\"),\n                cell_text(size = 16,  weight = \"bold\", color = \"white\"))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = \"ivory4\",\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\")\nMatchSummaryGameNameTable\n\n```\n\n## Row {.flow}\n```{r}\n#| label: Match Goals Probablity Plot\n# Create a tiled plot for the MC Match scores\nMD_MC_Plot <- ggplot(long_prob_matrix, aes(x = as.numeric(Home), y = as.numeric(Away), fill = Probability)) +\n  geom_tile(colour = \"black\") +\n  geom_text(aes(label = paste(Probability, \"%\")), size = 4, color = if_else(long_prob_matrix$Probability > 4.5, Color_Home_Text, Color_Away_Text),) +\n        scale_fill_gradientn(\n        colors = c(Color_Away, Color_Home),\n        values = scales::rescale(c(0, 1)), \n        name = \"Probablity\") +\n  scale_x_continuous(breaks = seq(0, max(long_prob_matrix$Home), 1)) +\n  scale_y_continuous(breaks = seq(0, max(long_prob_matrix$Away), 1)) +\n  labs(title = paste(\"Match Final Score Probablity (10000 sims)\"),\n        subtitle = paste(Match_Fixture),\n        x = paste0(Match_Home, \" Goals\"), \n        y = paste0(Match_Away, \" Goals\"),\n        caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Match Goals Probality Plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n```{r}\n#| label: Match Result Probablity Plot\n# Create a bar chart for the MC Match results\nMD_MC_Result_Plot <- ggplot(outcome_prob) +\n  geom_bar(aes(x = Outcome, y = Probability, fill = custom_colors), stat = \"identity\", colour = \"black\", width = 1)  +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Home,\"gray\", Color_Away),\n                      labels = c(Match_Home, \"Match Drawn\", Match_Away),\n                      guide = \"legend\") +\n  geom_text(aes(x = Outcome, y = Probability, label = paste(Probability, \" %\")), vjust = -0.5,colour = \"black\") + \n#  scale_fill_manual(values = custom_colors) +\n  labs(title = \"Probabilities of Match Outcome (10000 Sims)\",\n       subtitle = Match_Fixture,\n       x = \"\", \n       y = \"Probability %\",\n       caption = My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nMD_MC_Result_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Match Result Probablity Plot.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n## Row {.flow}\n```{r}\n#|label: Home Match teratitory plot\n#data imports\ndf <- plottingData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    possession_roll5 = slide_dbl(Home_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE),\n    Field_tilt_roll5 = slide_dbl(Home_FThird_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE)) %>% \n  \n  select(expandedMinute, Home_Possession, Away_Possession, TeamName, possession_roll5, Field_tilt_roll5, Home_FThird_Possession, Away_FThird_Possession) %>%   \n  mutate(across(everything(), ~replace_na(., 0))) %>%\n  mutate(\n    Possession_diff = possession_roll5 - Field_tilt_roll5   # positive = home leading\n  )\n\n# 2) Smooth the two lines into 'pred' (loess) and clamp to [0,1]\nlo_home <- loess(possession_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\nlo_away <- loess(Field_tilt_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\n\npred <- tibble(expandedMinute = sort(unique(df$expandedMinute))) %>%\n  mutate(\n    home_s = pmax(0, pmin(1, predict(lo_home, newdata = cur_data()))),\n    away_s = pmax(0, pmin(1, predict(lo_away, newdata = cur_data())))\n  )\n\n\n\n#data wrangling \nseg <- pred %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    xmin = expandedMinute,\n    xmax = lead(expandedMinute),\n    home_next = lead(home_s),\n    away_next = lead(away_s)\n  ) %>%\n  filter(!is.na(xmax)) %>%\n  mutate(\n    ymin = pmin(home_s, away_s, home_next, away_next),\n    ymax = pmax(home_s, away_s, home_next, away_next),\n    leader = ifelse(home_s > away_s, \"home\", \"away\")\n  )\n\neps <- 1e-3  # small tolerance around crossings\n\n# seg must already have: expandedMinute, home_s, away_s\nrib <- seg %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    ymin = pmin(home_s, away_s),\n    ymax = pmax(home_s, away_s),\n    home_on_top = home_s > away_s + eps,\n    away_on_top = away_s > home_s + eps\n  )\n\n# Two masked ribbons (no overlap)\nrib_home <- rib %>%\n  mutate(ymin = ifelse(home_on_top, ymin, NA_real_),\n         ymax = ifelse(home_on_top, ymax, NA_real_))\n\nrib_away <- rib %>%\n  mutate(ymin = ifelse(away_on_top, ymin, NA_real_),\n         ymax = ifelse(away_on_top, ymax, NA_real_))\n#plot the ribbons and lines\nggplot() +\n  # ribbon when HOME is above\n  geom_ribbon(data = rib_home,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Home, alpha = 0.30, color = NA) +\n  # ribbon when AWAY is above\n  geom_ribbon(data = rib_away,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Away, alpha = 0.30, color = NA) +\n\n\n  # smoothed lines\n  geom_line(data = seg, aes(x = expandedMinute, y = home_s),\n            linewidth = 1.2, color = Color_Home) +\n  geom_line(data = seg, aes(x = expandedMinute, y = away_s),\n            linewidth = 1.2, color = Color_Away) +\n  \n  scale_fill_manual(\n    values = c(\"home\" = Color_Home, \"away\" = Color_Away),\n    name   = \"Tertiary\",\n    labels = c(\"home\" = \"Possession (red)\", \"away\" = \"Field Tilt (blue)\")\n  ) +\n  \n  scale_y_continuous(\n    labels = label_percent(accuracy = 1),   # show 25% instead of 0.25\n    limits = c(0, 1)                        # keep axis from 0% to 100%\n  ) +\n  scale_x_continuous(breaks = seq(0, max(seg$expandedMinute), 15)) +\n  \n  labs(\n    title    = HomeTertiary_title,\n    subtitle = Match_Fixture,\n    x        = \"Match Time (Mins)\",\n    y        = \"Possession (%)\",\n    caption  = My_caption\n  ) +\n  coord_cartesian(ylim = c(0, 1), clip = \"off\") +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    legend.background = element_rect(fill = \"snow\"),\n    legend.key = element_rect(fill = \"snow\"),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    plot.title = element_markdown(),\n    plot.subtitle = element_markdown(),\n    plot.caption = element_markdown(),\n    legend.title = element_text(colour = \"black\", size = 6),\n    legend.text  = element_text(colour = \"black\", size = 6),\n    axis.title = element_text(colour = \"black\", size = 8),\n    \n    plot.margin  = margin(28, 20, 48, 20)\n  ) +\n  # team labels\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 1,\n           label = paste(Match_Away, \" Defensive Goal Line\"), vjust = 0, hjust = 0.5,\n           size = 4, color = Color_Away_Text, fontface = \"bold\", fill = Color_Away) +\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 0.05,\n           label = paste(Match_Home, \" Defensive Goal Line\"), vjust = 1, hjust = 0.5,\n           size = 4, color = Color_Home_Text, fontface = \"bold\", fill = Color_Home)\n\n```\n```{r}\n#|label: Away Match teratitory plot\n#data imports\ndf <- plottingData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    possession_roll5 = slide_dbl(Away_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE),\n    Field_tilt_roll5 = slide_dbl(Away_FThird_Possession,\n                                 mean,\n                                 .before = 4,   \n                                 .complete = TRUE)) %>% \n  \n  select(expandedMinute, Home_Possession, Away_Possession, TeamName, possession_roll5, Field_tilt_roll5, Home_FThird_Possession, Away_FThird_Possession) %>%   \n  mutate(across(everything(), ~replace_na(., 0))) %>%\n  mutate(\n    Possession_diff = possession_roll5 - Field_tilt_roll5   # positive = home leading\n  )\n\n# 2) Smooth the two lines into 'pred' (loess) and clamp to [0,1]\nlo_home <- loess(possession_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\nlo_away <- loess(Field_tilt_roll5  ~ expandedMinute, data = df, span = 0.2, na.action = na.exclude)\n\npred <- tibble(expandedMinute = sort(unique(df$expandedMinute))) %>%\n  mutate(\n    home_s = pmax(0, pmin(1, predict(lo_home, newdata = cur_data()))),\n    away_s = pmax(0, pmin(1, predict(lo_away, newdata = cur_data())))\n  )\n\n#pred <- df %>% transmute(expandedMinute, home_s = possession_roll5, away_s = Field_tilt_roll5).\n\n#data wrangling \nseg <- pred %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    xmin = expandedMinute,\n    xmax = lead(expandedMinute),\n    home_next = lead(home_s),\n    away_next = lead(away_s)\n  ) %>%\n  filter(!is.na(xmax)) %>%\n  mutate(\n    ymin = pmin(home_s, away_s, home_next, away_next),\n    ymax = pmax(home_s, away_s, home_next, away_next),\n    leader = ifelse(home_s > away_s, \"home\", \"away\")\n  )\n\neps <- 1e-3  # small tolerance around crossings\n\n# seg must already have: expandedMinute, home_s, away_s\nrib <- seg %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    ymin = pmin(home_s, away_s),\n    ymax = pmax(home_s, away_s),\n    home_on_top = home_s > away_s + eps,\n    away_on_top = away_s > home_s + eps\n  )\n\n# Two masked ribbons (no overlap)\nrib_home <- rib %>%\n  mutate(ymin = ifelse(home_on_top, ymin, NA_real_),\n         ymax = ifelse(home_on_top, ymax, NA_real_))\n\nrib_away <- rib %>%\n  mutate(ymin = ifelse(away_on_top, ymin, NA_real_),\n         ymax = ifelse(away_on_top, ymax, NA_real_))\n#plot the ribbons and lines\nggplot() +\n  # ribbon when HOME is above\n  geom_ribbon(data = rib_home,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Home, alpha = 0.30, color = NA) +\n  # ribbon when AWAY is above\n  geom_ribbon(data = rib_away,\n              aes(x = expandedMinute, ymin = ymin, ymax = ymax),\n              fill = Color_Away, alpha = 0.30, color = NA) +\n\n\n  # smoothed lines\n  geom_line(data = seg, aes(x = expandedMinute, y = home_s),\n            linewidth = 1.2, color = Color_Home) +\n  geom_line(data = seg, aes(x = expandedMinute, y = away_s),\n            linewidth = 1.2, color = Color_Away) +\n  \n  scale_fill_manual(\n    values = c(\"home\" = Color_Home, \"away\" = Color_Away),\n    name   = \"Tertiary\",\n    labels = c(\"home\" = \"Possession (red)\", \"away\" = \"Field Tilt (blue)\")\n  ) +\n  \n  scale_y_continuous(\n    labels = label_percent(accuracy = 1),   # show 25% instead of 0.25\n    limits = c(0, 1)                        # keep axis from 0% to 100%\n  ) +\n  scale_x_continuous(breaks = seq(0, max(seg$expandedMinute), 15)) +\n  \n  labs(\n    title    = AwayTertiary_title,\n    subtitle = Match_Fixture,\n    x        = \"Match Time (Mins)\",\n    y        = \"Possession (%)\",\n    caption  = My_caption\n  ) +\n  coord_cartesian(ylim = c(0, 1), clip = \"off\") +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    legend.background = element_rect(fill = \"snow\"),\n    legend.key = element_rect(fill = \"snow\"),\n    plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n    plot.title = element_markdown(),\n    plot.subtitle = element_markdown(),\n    plot.caption = element_markdown(),\n    legend.title = element_text(colour = \"black\", size = 6),\n    legend.text  = element_text(colour = \"black\", size = 6),\n    axis.title = element_text(colour = \"black\", size = 8),\n    \n    plot.margin  = margin(28, 20, 48, 20)\n  ) +\n  # team labels\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 1,\n           label = paste(Match_Home, \" Defensive Goal Line\"), vjust = 0, hjust = 0.5,\n           size = 4, color = Color_Home_Text, fontface = \"bold\", fill = Color_Home) +\n  annotate(\"label\",\n           x = max(pred$expandedMinute) / 2, y = 0.05,\n           label = paste(Match_Away, \" Defensive Goal Line\"), vjust = 1, hjust = 0.5,\n           size = 4, color = Color_Away_Text, fontface = \"bold\", fill = Color_Away)\n\n```\n\n\n``` {r}\n#| output: false\n#| message: false\n#| warning: false\n#MC Season calculations for top three\n#load data\n\n#Awaydashboard__Season_data <- Awaydashboard__Season_data %>%\n#  filter(TeamName == Match_Away) %>%\n#  filter(TotalShots == 1) %>%\n#  filter(!situation == \"NA\") %>%\n#  mutate(TotalxG = cumsum(xG)) %>%\n#  mutate(TotalNPxG = cumsum(NPxG)) %>%\n#  mutate(TotalxGOT = cumsum(xGOT)) %>%\n#  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n#  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n#  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n#  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n#  select(x, y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, #TotalShots, xG, NPxG, xGOT, expandedMinute, type)\n\nAwayShotsALL <- Awaydashboard_data %>%\n  select(xGA = xG)\n\nHomeShotsALL <- dashboard_data %>%\n  select(xG)\n\n#predit seaosn on a match by match basis\n# Set simulation parameters\nn_sims <- 10000  # Number of simulations\nn_games <- 38    # Number of games in season\nremaining_games <- 38\n#- n_games\ncurrent_points <- League_Points\nwin_prob <- 0.5   # Probability of winning a game (adjust as needed)\ndraw_prob <- 0.5 # Probability of drawing a game (adjust as needed)\n#loss_prob <- 1 - win_prob - draw_prob\nloss_prob <- 0.5\n\n# Simulate goals scored and conceded using appropriate distributions\n# (adjust distributions and parameters based on your data or assumptions)\ngoals_scored <- rpois(n_sims * n_games, lambda = HomeShotsALL$xG)  # Poisson distribution for goals scored\ngoals_conceded <- rpois(n_sims * n_games, lambda = AwayShotsALL$xGA)  # Poisson distribution for goals conceded\n\n# Reshape data into a single data frame for clarity\nsim_data <- data.frame(\n  sim_id = rep(1:n_sims, each = n_games),\n  game_id = 1:n_games,\n  goals_scored = goals_scored,\n  goals_conceded = goals_conceded\n)\n\n# Calculate points per game for each simulated team\nsim_data <- sim_data %>%\n  mutate(\n    points = case_when(\n      goals_scored > goals_conceded ~ 3,\n      goals_scored == goals_conceded ~ 1,\n      TRUE ~ 0\n    )\n  )\n\nP_Season = (remaining_games/38)\n#print(P_Season)\n\n# Calculate total points per season for each simulation\nseason_totals <- sim_data %>%\n  group_by(sim_id) %>%\n  summarise(total_points = sum(points) * P_Season + current_points)\n\n# Limit total points to the maximum possible (current + remaining games * 3)\nseason_totals <- season_totals %>%\n  mutate(total_points = pmin(total_points, current_points + remaining_games * 3))\n\n# Calculate and summarize final point probabilities\npoint_probs <- season_totals %>%\n  mutate(total_points = round(total_points)) %>%  \n  count(total_points) %>%\n  mutate(prob = (n / n_sims) * 100) %>%\n  arrange(total_points) %>%\n  mutate(total_points = round(total_points))\n\n```\n\n```{r}\n#|height: 50%\n# Create a histogram for the distribution of final points for each team\nSeason_MC_Plot <- ggplot(point_probs, aes(x = total_points, y = prob)) +\n  geom_bar(stat = \"identity\", fill = Color_Home, color = \"black\") +\n  labs(title = \"Liverpool Final Predicted Point Totals (10000 Sims)\",\n       subtitle = paste(\"After Match Day \", MatchDay),\n       x = \"Final Points\",\n       y = \"Probability %\",\n       caption = my_socials) +\n#  scale_x_continuous(limits = c((min(League_Points)), (max(point_probs$total_points))), \n#                     breaks = seq(0, (max(point_probs$total_points)), 1)) +\n  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 5)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 16),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 14),\n        axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12, face = \"bold\"),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\n#Season_MC_Plot\n\n```\n\n# Pass Maps\n```{r}\n# data wrangling for pass connection tables\n\nPassConnections <- plottingData \nPassConnections <- PassConnections[complete.cases(PassConnections[, \"playerId\"]), ]\nPassConnections <- PassConnections[complete.cases(PassConnections[, \"TeamName\"]), ]\nPassConnections <- shift_column(data = PassConnections, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"x\", new_names = \"Endx\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"y\", new_names = \"Endy\", len = 1, up = TRUE)\nPassConnections <- shift_column(data = PassConnections, columns = \"second\", new_names = \"End_second\", len = 1, up = FALSE)\n\n# number of passes or carries between players\nEPVEvents <- PassConnections %>%\n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Attempted_Passes, Successful_Passes, UnSuccessful_Passes, BCs, Key_Passes, Prog_Passes, Attempted_Carries, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Final_Third_Carries,EPV, xT, x, y, Endx, Endy, PK_Box_Passes, Final_Third_Passes, Cross_Passes, Long_Passes, expandedMinute)\n\n\n#EPV events prep for main tables\nEPVPassEvents <- EPVEvents %>%\n  filter(Attempted_Passes == 1) %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Successful Passes' = Successful_Passes, UnSuccessful_Passes, 'Long Passes' = Long_Passes, Crosses = Cross_Passes, 'PK Box Passes' = PK_Box_Passes, 'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, 'Final Third Passes' = Final_Third_Passes,  BCs, EPV, xT, 'Game Min' = expandedMinute)\n\nEPVCarrieEvents <- EPVEvents %>%\n    filter(Attempted_Carries == 1) %>%\n    select(Passer_Team, Passer, Receiver, Receiver_Team, 'Successful Carries' = Successful_Carries, UnSuccessful_Carries, 'Prog Carries' = Prog_Carries, 'Final Third Carries' = Final_Third_Carries,  BCs, EPV, xT, 'Game Min' = expandedMinute)\n  \n\n# number of passes between players\nPassConnections <- PassConnections %>%\n  filter(Attempted_Passes == 1) %>% \n  select(Passer = playerId, Receiver = receiver, Passer_Team = TeamName, Receiver_Team = receiver_team, Successful_Passes, BCs, Key_Passes, Prog_Passes, EPV = EPVvalue, x, y, Endx, Endy, PK_Box_Passes, Final_Third_Passes, Cross_Passes, Long_Passes, second, End_second, EventTime) %>%\n  mutate(Pass_time = round(((End_second - second) + 60) %% 60, 2))\n\n#calculate pass success\nPassConnections <- PassConnections %>%\n  group_by(Passer, Receiver, Passer_Team, Receiver_Team) %>% \n  summarise(Passes = n(), Successful_Passes = sum(Successful_Passes), Long_Passes = sum(Long_Passes), Final_Third_Passes = sum(Final_Third_Passes), PK_Box_Passes = sum(PK_Box_Passes), Crosses = sum(Cross_Passes), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), Pass_time = mean(EventTime)) %>% \n  na.omit() %>%\n  mutate(Pass_Suc = (round(Successful_Passes / Passes,2)*100),\n         EPV_P_Pass = (round(EPV / Successful_Passes, 3))) %>%\n  replace_na(list(Pass_Suc = 0))\n\n#filter by over 5 connections\nPassConnections <- PassConnections %>%\n  group_by(Passer = pmin(Passer, Passer), Receiver = pmax(Receiver, Receiver), Passer_Team, Receiver_Team) %>%\n  filter(Passes >= 5) %>%\n  summarise(Passes = sum(Passes), Successful_Passes = sum(Successful_Passes), Pass_Success = mean(Pass_Suc), Long_Passes = sum(Long_Passes), 'Final Third Passes' = sum(Final_Third_Passes), 'PK Box Passes' = sum(PK_Box_Passes), Crosses = sum(Crosses), Key_Passes = sum(Key_Passes), BCs = sum(BCs), Prog_Passes = sum(Prog_Passes), EPV = sum(EPV), EPV_P_Pass, Pass_time)\n\n#prep for main tables\nPassConnectiondata <- PassConnections %>%\n  select(Passer_Team, Passer, Receiver, Receiver_Team, 'Attempted Passes' = Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, 'Long Passes' = Long_Passes, 'Final Third Passes', 'PK Box Passes', Crosses,  'Key Passes' = Key_Passes, 'Prog Passes' = Prog_Passes, EPV, 'EPV / Pass' = EPV_P_Pass, 'Pass Time' = Pass_time)\n\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: 1st Half passnetwork\n\n\nHomepassPlot1stWD <- plot_passnet_AI(data = plottingData,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlot1stWD\n\n#save Plot\nggsave(path = Vizlocation, \"Home Passnetwork 1st  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: 2nd Half passnetwork\n\n\nHomepassPlot2ndWD <- plot_passnet_AI(data = plottingData,  \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 47, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlot2ndWD\n\n#save Plot\nggsave(path = Vizlocation, \"Home Passnetwork 2nd  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n### column {.tabset}\n```{r}\n#| title: 1st Half passnetwork\n\n\nAwaypassPlot1stWD <- plot_passnet_AI(data = plottingData,  \n                                   team_name = Match_Away, scale_stat = \"EPV\", \n                                   scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                   plot_start = 00, plot_finish = 44, pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlot1stWD\n\n#save Plot\nggsave(path = Vizlocation, \"Away Passnetwork 1st  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: 2nd Half passnetwork\n\n\nAwaypassPlot2ndWD <- plot_passnet_AI(data = plottingData,  \n                                   team_name = Match_Away, scale_stat = \"EPV\", \n                                   scale_color = Color_Away, text_color = Color_Away_Text,  subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                   plot_start = 46, plot_finish = 100, pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlot2ndWD\n\n#save Plot\nggsave(path = Vizlocation, \"Away Passnetwork 2nd  half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Passnetwork to 1st Sub \n#| label: Home 1st subs passnetwork\nHomepassPlot1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                   team_name = Match_Home, scale_stat = \"EPV\", \n                                   scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" to 1st Subs\"),\n                                   plot_start = 00, plot_finish = firstSubHome, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlot1stsubsWD\n\n#save Plot\nggsave(path = Vizlocation, \"Home Passnetwork 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n``` {r}\n#| title: Passnetwork Post 1st Sub \n#| label: Home post 1st subs passnetwork\nHomepassPlotPost1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                        team_name = Match_Home, scale_stat = \"EPV\", \n                                        scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                        plot_start = firstSubHome, plot_finish = 100, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nHomepassPlotPost1stsubsWD\n```\n\n### column {.tabset}\n```{r away 1st subs}\n#| title: Passnetwork to 1st Sub \n#| label: Away 1st subs passnetwork\n\nAwaypassPlot1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                   team_name = Match_Away, scale_stat = \"EPV\", \n                                   scale_color = Color_Away, text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" to 1st Subs\"),\n                                   plot_start = 00, plot_finish = firstSubAway, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlot1stsubsWD\n\n#save Plot\nggsave(path = Vizlocation, \"Away Passnetwork 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n``` {r away post 1st subs}\n#| title: Passnetwork post 1st Sub \n#| label: Away post 1st subs passnetwork\nAwaypassPlotpost1stsubsWD <- plot_passnet_AI(data = plottingData, \n                                        team_name = Match_Away, scale_stat = \"EPV\", \n                                        scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                        plot_start = firstSubAway, plot_finish = 100, pitch = \"\", wrap = \"\", pressmap = \"Yes\", logo = \"\", passes = 5)\nAwaypassPlotpost1stsubsWD\n```\n## Row {.flow}\n### column {.tabset}\n```{r home attack pass 1st}\n#| title: Attacking Passnetwork 1st Half\n#pass map EPV Home 1st half\nHomepassPlot1stAtt <- plot_passnet_AI(data = plottingData, \n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home, text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                  plot_start = 00, plot_finish = 44, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot1stAtt\n\n\n```\n\n```{r home attack pass 2nd}\n#| title: Attacking Passnetwork 2nd Half\n\n#pass map EPV Home 2nd half\nHomepassPlot2ndAtt <- plot_passnet_AI(data = plottingData,\n                                  team_name = Match_Home, scale_stat = \"EPV\", \n                                  scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                  plot_start = 46, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot2ndAtt\n\n```\n\n### column {.tabset}\n```{r away attack pass 1st}\n#| title: Attacking Passnetwork 1st Half\n#pass map EPV Away 1st half\nAwaypassPlot1stAtt <- plot_passnet_AI(data = plottingData, \n                                     team_name = Match_Away, scale_stat = \"EPV\", \n                                     scale_color = Color_Away, text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" 1st Half\"),\n                                     plot_start = 00, plot_finish = 44, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot1stAtt\n\n```\n\n```{r away attack pass 2nd}\n#| title: Attacking Passnetwork 2nd Half\n#pass map EPV Away 2nd half\nAwaypassPlot2ndAtt <- plot_passnet_AI(data = plottingData,\n                                     team_name = Match_Away, scale_stat = \"EPV\", \n                                     scale_color = Color_Away, text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" 2nd Half\"),\n                                     plot_start = 46, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot2ndAtt\n\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Attacking Passnetwork 1st Sub\n#pass map EPV Home 1st sub\nHomepassPlot1subAtt <- plot_passnet_AI(data = plottingData,  \n                                    team_name = Match_Home, scale_stat = \"EPV\", \n                                    scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" up to 1st Sub\"),\n                                    plot_start = 00, plot_finish = firstSubHome, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot1subAtt\n\n```\n\n```{r}\n#| title: Attacking Passnetwork Post 1st Sub\n#pass map EPV Home 1st sub\nHomepassPlot1subAttpost <- plot_passnet_AI(data = plottingData,  \n                                    team_name = Match_Home, scale_stat = \"EPV\", \n                                    scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                    plot_start = firstSubHome, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nHomepassPlot1subAttpost\n\n```\n### column {.tabset}\n```{r}\n#| title: Attacking Passnetwork 1st Sub\n#pass map EPV Away 1st Sub\nAwaypassPlot1SubAtt <- plot_passnet_AI(data = plottingData,\n                                      team_name = Match_Away, scale_stat = \"EPV\", \n                                      scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" up to 1st Sub\"),\n                                      plot_start = 00, plot_finish = firstSubAway, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot1SubAtt\n\n```\n\n```{r}\n#| title: Attacking Passnetwork Post 1st Sub\n#pass map EPV Away 1st Sub\nAwaypassPlot1SubAttpost <- plot_passnet_AI(data = plottingData,\n                                      team_name = Match_Away, scale_stat = \"EPV\", \n                                      scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" Post 1st Subs\"),\n                                      plot_start = firstSubAway, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", passes = 5)\nAwaypassPlot1SubAttpost\n\n```\n\n## Row {.flow}\n```{r}\nHomepassPlotFTAttW <- plot_passnet_AI(data = plottingData,  \n                                      team_name = Match_Home, scale_stat = \"EPV\", \n                                      scale_color = Color_Home,  text_color = Color_Home_Text, subtitle = paste0(Match_Fixture, \" By Time Period\"),\n                                      plot_start = 00, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", wrap = \"Yes\", passes = 2)\nHomepassPlotFTAttW\n```\n\n```{r}\nAwaypassPlotFTAttW <- plot_passnet_AI(data = plottingData,  \n                                     team_name = Match_Away, scale_stat = \"EPV\", \n                                     scale_color = Color_Away,  text_color = Color_Away_Text, subtitle = paste0(Match_Fixture, \" By Time Period\"),\n                                     plot_start = 00, plot_finish = 100, pitch = \"Half\", pressmap = \"Yes\", wrap = \"Yes\", passes = 2)\nAwaypassPlotFTAttW\n```\n## Row {.tabset}\n```{r}\n#| title: Pass Connections by Passer\n#| label: Home pass connections tables\n#| results: asis\n\nPassConnectionTableHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHome\n```\n```{r}\n#| title: Pass Connections by Receiver\n#| label: Home pass connections tables Reciever\n#| results: asis\n\nPassConnectionTableHomeR <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n  gt(rowname_col = \"Passer\", groupname_col = \"Receiver\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nPassConnectionTableHomeR\n```\n\n## Row {.tabset}\n```{r}\n#| title: Pass Connections by Passer\n#| results: asis\n#| label: away Pass connections table\nPassConnectionTableAway <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Away,\n         Passer_Team == Match_Away) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16)))\n\nPassConnectionTableAway\n```\n\n```{r}\n#| title: Pass Connections by Receiver\n#| results: asis\n#| label: away Pass connections table Reciever\nPassConnectionTableAwayr <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Away,\n         Passer_Team == Match_Away) %>%\n  gt(rowname_col = \"Passer\", groupname_col = \"Receiver\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_percent(\n    columns = c(7),\n    scale_values = FALSE,\n    decimals = 0\n   ) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n    fmt_number(\n    columns = c(5, 8, 9),\n    decimals = 0\n   ) %>%\n    fmt_number(\n    columns = c(16),\n    decimals = 2\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Passing connections\")),\n    subtitle = paste0(Match_Fixture, \" Min 5 passes\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16)))\n\nPassConnectionTableAwayr\n```\n\n## Row {.flow}\n```{r}\n#| label: home passing tree plot\n\nPassConnectionTreeHome <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) \n\ngroup <- PassConnectionTreeHome$Passer\nsubgroup <- PassConnectionTreeHome$Receiver\nvalue <- PassConnectionTreeHome$'Attempted Passes'\n\nPassConnectionTreeHomePlot <- PassConnectionTreeHome %>%\n  \n  #geometrics\n  ggplot(aes(area = value, fill = value, subgroup = subgroup,\n             label = paste(group, value, sep = \"\\n\"))) +\n  geom_treemap() +\n  geom_treemap_subgroup_border(colour = \"white\", size = 5) +\n  geom_treemap_subgroup_text(place = \"centre\", grow = TRUE,\n                             alpha = 0.25, colour = \"black\",\n                             fontface = \"italic\") +\n  geom_treemap_text(colour = \"black\",\n                    place = \"centre\",\n                    size = 13,\n                    grow = FALSE) +\n  #formatting\n  theme(legend.position = \"none\",\n        plot.background = element_rect(colour = \"black\", fill = \"#E5E5E5\"),\n        panel.background = element_blank()) +\n  scale_fill_paletteer_c(ColorScale_HomeC) + \n  labs(title = paste0(Match_Home, \" Passing Connections (Min 5 passes)\"), \n       subtitle = paste0(Match_Fixture, \" Darker color = More Passes, \\n Number & Name = Number Passes by Player, Large Name =  Reciever\"),\n       caption = my_socials) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nPassConnectionTreeHomePlot\n\n```\n\n``` {r}\n\n#| label: away passing tree plot\n\nPassConnectionTreeAway <- PassConnectiondata %>%\n  filter(Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) \n\ngroup <- PassConnectionTreeAway$Passer\nsubgroup <- PassConnectionTreeAway$Receiver\nvalue <- PassConnectionTreeAway$'Attempted Passes'\n\nPassConnectionTreeAwayPlot <- PassConnectionTreeAway %>%\n  \n  #geometrics\n  ggplot(aes(area = value, fill = value, subgroup = subgroup,\n             label = paste(group, value, sep = \"\\n\"))) +\n  geom_treemap() +\n  geom_treemap_subgroup_border(colour = \"white\", size = 5) +\n  geom_treemap_subgroup_text(place = \"centre\", grow = TRUE,\n                             alpha = 0.25, colour = \"black\",\n                             fontface = \"italic\") +\n  geom_treemap_text(colour = \"black\",\n                    place = \"centre\",\n                    size = 13,\n                    grow = FALSE) +\n  #formatting\n  theme(legend.position = \"none\",\n        plot.background = element_rect(colour = \"black\", fill = \"#E5E5E5\"),\n        panel.background = element_blank()) +\n  scale_fill_paletteer_c(ColorScale_AwayC) + \n  labs(title = paste0(Match_Away, \" Passing Connections (Min 5 passes)\"), \n       subtitle = paste0(Match_Fixture, \" Darker color = More Passes,  \\n Number & Name = Number Passes by Player, Large Name =  Reciever\"),\n       caption = my_socials) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nPassConnectionTreeAwayPlot\n\n```\n\n\n# Passing Analysis\n## Row {.flow}\n```{r home wave plot}\ntouchpass_bar_data <- plottingData \n\ntouchpass_bar_data <- touchpass_bar_data %>%\n  filter(TeamName == Match_Home) %>%\n    filter(!Own_Goals == 1)\n\ntouchpass_bar_data <- touchpass_bar_data %>%\n  group_by(expandedMinute, minute) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Successful_Passes = sum(Successful_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    Possession = mean(Home_Possession),\n    TotalShots = sum(TotalShots),) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point = ifelse(str_detect(Goals, \"1\"), paste0(minute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Touches + 0.5), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point = as.numeric(Goal_point)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  mutate(Possession = round(Possession,2))\n\n#canvas\ntouchpass_bar_plot <- touchpass_bar_data %>%\n  ggplot(aes(x = expandedMinute, y = value)) +\n  \n#geometrics\n  geom_bar(aes(x = expandedMinute, y = Touches, fill = Color_Home), stat = \"identity\", colour = \"black\", width = 1, position = position_nudge(x = 0.5)) +\n  geom_bar(aes(x = expandedMinute, y = Attempted_Passes, fill = \"ivory4\"), stat = \"identity\",  colour = \"black\", width = 1, position = position_nudge(x = -0.5)) +\n  geom_bar(aes(x = expandedMinute, y = TotalShots, fill = \"green3\"), stat = \"identity\", colour = \"black\", width = 1) +\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = -0.5, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.03) +    \n  \n  scale_fill_identity(name = \"\",\n                       breaks = c(Color_Home,\"ivory4\", \"green3\"),\n                       labels = c(\"Touches\", \"Passes\", \"Shots\"),\n                       guide = \"legend\") +\n  \n#formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5)) +\n  labs(title = WavesTitle_text,\n        caption = My_caption,\n         subtitle = paste0(Match_Fixture),\n         x = \"Match Time (Mins)\",\n         y = \"Metric Total\") +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(face = \"bold\", size = 12),\n        axis.text = element_text(size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank(),\n        panel.background = element_blank(),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        legend.position = \"none\")\n\ntouchpass_bar_plot\n```\n\n```{r Away waves plot}\nAwaytouchpass_bar_data <- plottingData \n\nAwaytouchpass_bar_data <- Awaytouchpass_bar_data %>%\n  filter(TeamName == Match_Away) %>%\n    filter(!Own_Goals == 1)\n\nAwaytouchpass_bar_data <- Awaytouchpass_bar_data %>%\n  group_by(expandedMinute, minute) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Successful_Passes = sum(Successful_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    AwayPossession = mean(Away_Possession),\n    TotalShots = sum(TotalShots),) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Touches + 0.5), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  mutate(AwayPossession = round(AwayPossession,2))\n\n#canvas\nAwaytouchpass_bar_plot <- Awaytouchpass_bar_data %>%\n  ggplot(aes(x = expandedMinute)) +\n  \n\n  #bars\n  geom_bar(aes(x = expandedMinute, y = Touches, fill = Color_Away), stat = \"identity\", colour = \"black\", width = 1, position = position_nudge(x = 0.5)) +\n  geom_bar(aes(x = expandedMinute, y = Attempted_Passes, fill = \"ivory4\"), stat = \"identity\",  colour = \"black\", width = 1, position = position_nudge(x = -0.5)) +\n  geom_bar(aes(x = expandedMinute, y = TotalShots, fill = \"green3\"), stat = \"identity\", colour = \"black\", width = 1) +\n  scale_fill_identity(name = \"\",\n                      breaks = c(Color_Away,\"ivory4\", \"green3\"),\n                      labels = c(\"Touches\", \"Passes\", \"Shots\"),\n                      guide = \"legend\") +\n  \n  # Other geoms and formatting for half time etc\n  #geom_segment(aes(y = 0, yend = max(Touches), x = 45, xend = 45), linewidth = 0.8, colour = \"black\", linetype = \"longdash\") +\n  #geom_text(aes(x = 45, y = max(Touches), label = \"HT\"), colour = \"black\", hjust = 1.5, vjust = 1, size = 4) +\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = -0.5, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.03) +\n\n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5)) +\n  labs(title = AwayWavesTitle_text,\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Match Time (Mins)\",\n         y = \"Metric Total\") +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(face = \"bold\", size = 12),\n        axis.text = element_text(size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank(),\n        panel.background = element_blank(),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        legend.position = \"none\")\n\nAwaytouchpass_bar_plot\n```\n\n```{r}\n#| output: false\n# Step 1: Filter successful passes open play only\nsuccessful_passes <- plottingData \n\n# Step 2: Identify passing sequences with more than the defined level of pass\n\npassing_sequencesHome <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Home, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Home, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, TeamName, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, period\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1) %>%\n  mutate(Goal_point_X = ifelse(TeamName == Match_Home & (str_detect(type, \"Goal\")), paste0(x), NA)) %>%\n  mutate(Goal_point_Y = ifelse(TeamName == Match_Home & (str_detect(type, \"Goal\")), paste0(y), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n\npassing_sequencesAway <- successful_passes %>%\n  mutate(\n    pass_count = ifelse(Successful_Passes == 1 & TeamName == Match_Away, 1, 0),\n    passing_seq = accumulate(Successful_Passes == 1 & TeamName == Match_Away, ~ifelse(.y == 0, .y, .x + .y)),\n    Pchain = cumsum(passing_seq == 0) + 1,\n    pass_count = cumsum(pass_count)\n  ) %>%\n  group_by(Pchain) %>%\n  mutate(\n    Distance_seq = ifelse(passing_seq > 0, cumsum(Distance_Metre),0),\n    PChain_pass_count = max(passing_seq),\n    PChain_distance_count = ifelse(passing_seq > 0, sum(Distance_Metre),0),\n    PDistance = ifelse(passing_seq > 0, Distance_Metre, 0),\n  ) %>%\n  ungroup() %>%\n  select(\n    minute, second, TeamName, playerId, type, `type/value`, outcome, `outcomeType/value`, pass_count, passing_seq, Pchain, PChain_pass_count, x, y, Distance_Metre, PDistance, Distance_seq, PChain_distance_count, Game_Period, period\n  ) %>%\n  mutate(Pchain_Length = ifelse(PChain_pass_count <= 5, \"VLow\",\n                                ifelse(PChain_pass_count <= 10 & PChain_pass_count > 5.5, \"Low\",\n                                       ifelse(PChain_pass_count <= 15 & PChain_pass_count > 10.5, \"Medium\",\n                                              ifelse(PChain_pass_count > 15.5, \"High\", NA))))) %>%\n  mutate(PchainN = cumsum(passing_seq == 0) + 1) %>%\n  mutate(Goal_point_X = ifelse(TeamName == Match_Away & (str_detect(type, \"Goal\")), paste0(x), NA)) %>%\n  mutate(Goal_point_Y = ifelse(TeamName == Match_Away & (str_detect(type, \"Goal\")), paste0(y), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y))\n\n#tabeldata\npassing_sequencesHome_Table <- passing_sequencesHome %>%\n  filter(TeamName == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesHome_1st_Table <- passing_sequencesHome %>%\n  filter(TeamName == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1, \n    period == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesHome_2nd_Table <- passing_sequencesHome %>%\n  filter(TeamName == Match_Home,\n    `type/value` == 1, \n    `outcomeType/value` == 1,\n    period == 2) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n\npassing_sequencesAway_Table <- passing_sequencesAway %>%\n  filter(TeamName == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesAway_1st_Table <- passing_sequencesAway %>%\n  filter(TeamName == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1,\n    period == 1) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\npassing_sequencesAway_2nd_Table <- passing_sequencesAway %>%\n  filter(TeamName == Match_Away,\n    `type/value` == 1, \n    `outcomeType/value` == 1,\n    period == 2) %>%\n  select(passes = `type/value`, Pchain, PChain_pass_count, Pass_Chain_Length = Pchain_Length, PchainN, pass_count, passing_seq, PChain_distance_count, Distance_Metre, Distance_seq, PDistance) %>%\n  group_by(Pass_Chain_Length) %>%\n  summarise(Total_Chain_Passes = sum(passes), Max_Chain_Length = max(passing_seq), Average_Chain_Length = round(mean(PChain_pass_count),0), Total_Chain_Distance = sum(PDistance), Max_Chain_Distance = max(PChain_distance_count), Average_Chain_Distance = round(mean(PDistance), 1)) %>%\n  mutate('% of teams passes' = round(Total_Chain_Passes/sum(Total_Chain_Passes),2)) %>%\n  mutate('% of teams passing distance' = round(Total_Chain_Distance/sum(Total_Chain_Distance),2)) %>%\n  select(Pass_Chain_Length, Total_Chain_Passes, Max_Chain_Length, Average_Chain_Length, '% of teams passes', Total_Chain_Distance, Max_Chain_Distance, Average_Chain_Distance, '% of teams passing distance')\n\n# Define the desired order\ndesired_order <- c(\"VLow\", \"Low\", \"Medium\", \"High\")\n\n# Arrange passing_sequencesHome_Table\npassing_sequencesHome_Table <- passing_sequencesHome_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesAway_Table\npassing_sequencesAway_Table <- passing_sequencesAway_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesHome_1st_Table <- passing_sequencesHome_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesAway_Table\npassing_sequencesAway_1st_Table <- passing_sequencesAway_1st_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\npassing_sequencesHome_2nd_Table <- passing_sequencesHome_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n\n# Arrange passing_sequencesAway_Table\npassing_sequencesAway_2nd_Table <- passing_sequencesAway_2nd_Table %>%\n  arrange(factor(Pass_Chain_Length, levels = desired_order))\n```\n\n## Row {.flow}\n```{r}\n#| label: passing chains all in\n\npassing_sequencesHome_Plot <- passing_sequencesHome %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesHome$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.09, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.08,\n    color = passing_sequencesHome$Pchain\n  ) +\n  # add goal\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.1) +\n\n  #wrap it \n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  \n  #format it\n  labs(title = paste0(Match_Home, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesHome_Plot\n```\n\n```{r}\n#| label: Away passing chains all in\n\npassing_sequencesAway_Plot <- passing_sequencesAway %>%\n  ggplot(aes(x = x, y = y, group = Pchain)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  geom_path(color = passing_sequencesAway$Pchain) +\n  geom_segment(\n    aes(xend = lead(x), yend = lead(y)),\n    arrow = arrow(type = \"closed\", length = unit(0.09, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.08,\n    color = passing_sequencesAway$Pchain\n  ) +  \n# add goal\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.1) +\n\n  #wrap it \n  facet_grid(factor(Pchain_Length, levels = c(\"VLow\", \"Low\", \"Medium\", \"High\")) ~ Game_Period) +\n  \n  #format it\n  labs(title = paste0(Match_Away, \" Passing Chain Length (5, 6-10, 11-15, 16 +) by Game Period\"), \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        legend.position = \"none\",\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\npassing_sequencesAway_Plot\n\n```\n\n## Row {.flow}\n### column {.tabset}\n``` {r}\n#| title: Full time\n#| label: home passing chains tables FT\n#| results: asis\n\nHome_Passing_Chains_Table <- passing_sequencesHome_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" FT Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_Table\n```\n\n``` {r}\n#| title: 1st Half\n#| label: home passing chaing tables 1st\n#| results: asis\n\nHome_Passing_Chains_1st_Table <- passing_sequencesHome_1st_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" 1st Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_1st_Table\n```\n\n``` {r}\n#| title: 2nd Half\n#| label: home passing chaing tables 2nd\n#| results: asis\n\nHome_Passing_Chains_2nd_Table <- passing_sequencesHome_2nd_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" 2nd Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Home,\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n    tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Home_Text))) %>%\n    tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\", \n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Home, domain = c(0,1))\nHome_Passing_Chains_2nd_Table\n\n```\n### column {.tabset}\n``` {r}\n#| title: Full time\n#| label: away passing chaing tables FT\n#| results: asis\nAway_Passing_Chains_Table <- passing_sequencesAway_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" FT Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nAway_Passing_Chains_Table\n```\n\n``` {r}\n#| title: 1st Half\n#| label: away passing chaing tables 1st\n#| results: asis\n\nAway_Passing_Chains_1st_Table <- passing_sequencesAway_1st_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" 1st Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nAway_Passing_Chains_1st_Table\n```\n\n``` {r}\n#| title: 2nd Half\n#| label: away passing chaing tables 2nd\n#| results: asis\n\nAway_Passing_Chains_2nd_Table <- passing_sequencesAway_2nd_Table %>%\n  gt() %>%\n  fmt_percent(columns = c(5,9), decimals = 0) %>%\n  fmt_number(columns = c(2:4), decimals = 0) %>%\n  fmt_number(columns = c(6:8), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" 2nd Half Passing Chain Length (5, 6-10, 11-15, 16 +) & Distance (m)\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_label_with(fn = ~ janitor::make_clean_names(., case = \"title\")) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Totals\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  grand_summary_rows(columns = c(2:4, 6:8), fns = list(\"Overall Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals =0))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = Color_Away,\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 12,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_column_labels(columns = everything()),\n            style = list(cell_text(weight = \"bold\", \n                                   color = Color_Away_Text))) %>%\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(cell_text(weight = \"bold\",\n                                   size = 16))) %>%\n  gt_color_rows(columns = c(5,9), palette = ColorScale_Away, domain = c(0,1))\nAway_Passing_Chains_2nd_Table\n```\n\n```{r}\n#| output: false\nZone14_Passes_Home_Data <- plottingData %>%\n  filter(TeamName == Match_Home,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nZone14_Passes_Home_Data <- Zone14_Passes_Home_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_Home_Data <- plottingData %>%\n  filter(TeamName == Match_Home,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nLHS_Passes_Home_Data <- LHS_Passes_Home_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_Home_Data <- plottingData %>%\n  filter(TeamName == Match_Home,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nRHS_Passes_Home_Data <- RHS_Passes_Home_Data %>%\n  filter(Successful_Passes == 1)\n\nZone14_Passes_Away_Data <- plottingData %>%\n  filter(TeamName == Match_Away,\n         Zone_14_Start == 1 | Zone_14_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Zone_14_Finish, Zone_14_Start)  %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nZone14_Passes_Away_Data <- Zone14_Passes_Away_Data %>%\n  filter(Successful_Passes == 1)\n\nLHS_Passes_Away_Data <- plottingData %>%\n  filter(TeamName == Match_Away,\n         Left_HS_Finish == 1 | Left_HS_Start == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Left_HS_Finish, Left_HS_Start) %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nLHS_Passes_Away_Data <- LHS_Passes_Away_Data %>%\n  filter(Successful_Passes == 1)\n\nRHS_Passes_Away_Data <- plottingData %>%\n  filter(TeamName == Match_Away,\n         Right_HS_Start == 1 | Right_HS_Finish == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, period, Game_Period, EPVvalue, Right_HS_Finish, Right_HS_Start) %>%\n      mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\nRHS_Passes_Away_Data <- RHS_Passes_Away_Data %>%\n  filter(Successful_Passes == 1)\n\n#combine data frames\nZ14_HS_Passes_Home_Data <- bind_rows(Zone14_Passes_Home_Data, LHS_Passes_Home_Data, RHS_Passes_Home_Data)\n\nZ14_HS_Passes_Away_Data <- bind_rows(Zone14_Passes_Away_Data, LHS_Passes_Away_Data, RHS_Passes_Away_Data)\n\nZ14_HS_Passes_Home_Data <- Z14_HS_Passes_Home_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_Away_Data <- Z14_HS_Passes_Away_Data %>%\n  mutate_all(~ifelse(is.na(.), 0, .))\n\nZ14_HS_Passes_Home_Data <- Z14_HS_Passes_Home_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n\nZ14_HS_Passes_Away_Data <- Z14_HS_Passes_Away_Data %>%\n  mutate(Pass_Area = ifelse(Zone_14_Start == 1, \"Zone 14\",\n                            ifelse(Zone_14_Finish == 1, \"Zone 14\",\n                            ifelse(Right_HS_Start == 1, \"RHS\",\n                                   ifelse(Right_HS_Finish == 1, \"RHS\",\n                                   ifelse(Left_HS_Start == 1, \"LHS\",\n                                          ifelse(Left_HS_Finish == 1, \"LHS\",\"Successful\")))))))\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: By half\nZone14_HS_Passes_Home_Plot <- Z14_HS_Passes_Home_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Half) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = PPsTitle_textHalf, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Z14 and HS plot by half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: By Game Period\nZone14_HS_Passes_Home_Plot <- Z14_HS_Passes_Home_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #facet_grid(Pass_Area ~ Game_Period) +\n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  #facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = PPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Z14 and HS plot by period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n\n### column {.tabset}\n```{r}\n#| title: By Half\nZone14_HS_Passes_Away_Plot <- Z14_HS_Passes_Away_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Half) +\n  labs(title = AwayPPsTitle_textHalf, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Away_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Away Z14 and HS plot by Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: By Game Period\nZone14_HS_Passes_Away_Plot <- Z14_HS_Passes_Away_Data %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"square\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(factor(Pass_Area, levels = c(\"LHS\", \"Zone 14\", \"RHS\")) ~ Game_Period) +\n  labs(title = AwayPPsTitle_text,\n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 6, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nZone14_HS_Passes_Away_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Away Z14 and HS plot by period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n## Row {.flow}\n```{r}\n#| echo: false\n#| output: false\n#| \nLong_Passes_Data <- plottingData %>%\n  filter(Long_Passes == 1 | Cross_Passes == 1) %>%\n  select(TeamName, playerId, x, y, finalX, finalY, C_End_point_X, C_End_point_Y, minute, Successful_Carries, UnSuccessful_Carries, Prog_Carries, Long_Passes, Cross_Passes, Successful_Passes, UnSuccessful_Passes, Prog_Passes, Distance_Metre, Game_Period, period, EPVvalue, xTvalue, Half = period_displayName, Corners, Short_Corners) %>%\n  mutate(Pass_Type = ifelse(Cross_Passes == 1, \"Cross\",\n                            ifelse(Long_Passes == 1, \"Long Pass\",\"Successful\"))) %>%\n    mutate(Half = ifelse(period == 1, \"First Half\",\n                            ifelse(period == 2, \"Second Half\",\n                                   ifelse(period == 3, \"First Half Extra Time\",\n                                          ifelse(period == 4, \"Second Half Extra Time\", \"Injury Time\")))))\n\n#set LPs title\nLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nAwayLPsTitle_text <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Half,</span>\"))\n\nLPsTitle_textGP <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Home};font-size:16px;'>{Match_Home}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n\nAwayLPsTitle_textGP <- paste0(\n              glue(\"<span style='font-family:\\\"Arial Bold\\\";color:{Color_Away};font-size:16px;'>{Match_Away}</span><span style='font-family:\\\"Arial\\\";color:gray12;font-size:16px;'> Long Passes & Crosses (</span><span style='font-family:\\\"Arial Bold\\\";color:#0000FF;font-size:16px;'>Successful</span><span style='color:gray12;font-size:16px;'> and </span><span style='font-family:\\\"Arial Bold\\\";color:#BD1100;font-size:16px;'>Progressive</span><span style='color:gray12;font-size:16px;'>) by Game Period,</span>\"))\n```\n\n### column {.tabset}\n```{r}\n#| out-height: 100%\n#| out-width: 100%\n#| title: By half\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Home ,\n           Corners == 0,\n           Short_Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot by half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: By Game Period\nLong_Passes_Home_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Home,\n           Short_Corners == 0,\n           Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Game_Period) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = LPsTitle_textGP, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Home_Text),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\nLong_Passes_Home_Plot\n\n#save Plot\nggsave(path = Vizlocation, \"Home Crosses and Long pass plot by game period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n### column {.tabset}\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\n#| title: By Half\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Away,\n           Corners == 0,\n           Short_Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.2, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Half) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_text, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot by half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n``` {r}\n#| out-height: 100%\n#| out-width: 100%\n#| title: By Game period\nLong_Passes_Away_Plot <- Long_Passes_Data %>%\n    filter(TeamName == Match_Away, \n           Short_Corners == 0,\n           Corners == 0) %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#95A5A6\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 1, color = \"grey\", show.legend = FALSE) +\n  \n  #  geom_path() +\n  geom_segment_interactive(\n    aes(x = x, y = y, xend = finalX, yend = finalY, color = Prog_Passes,  tooltip = paste(\"Player:\", playerId, \"\\nMin\", minute, \"\\nEPV\", EPVvalue)),\n    arrow = arrow(type = \"closed\", \n                  length = unit(0.1, \"cm\")),\n    lineend = \"round\",\n    linewidth = 0.15) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  facet_grid(Pass_Type ~Game_Period) +\n  #facet_wrap(~Half, nrow = 1) +\n  labs(title = AwayLPsTitle_textGP, \n       subtitle = paste0(Match_Fixture),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        strip.text = element_text(size = 8, colour = Color_Away_Text),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.position = \"none\")\n\n\nLong_Passes_Away_Plot\n\n\n#save Plot\nggsave(path = Vizlocation, \"Away Crosses and Long pass plot by period.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n## Row\n### column {.tabset}\n```{r}\n#| title: 1st Half Pass Recieving Areas\n\nHomePRecievedHeatMapplot1Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Home, \n         period == 1) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Recieving Pass Heat Map \\nUp 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePRecievedHeatMapplot1Half\n\n```\n```{r}\n#| title: 2nd Half Pass Recieving Areas\nHomePRecievedHeatMapplot2Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Home, \n         period == 2) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Recieving Pass Heat Map \\nUp 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePRecievedHeatMapplot2Half\n\n\n```\n```{r}\n#| title: Up to 1st Sub Pass Recieving Areas\n\nHomePRecievedHeatMapplot1Sub <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Home, \n         between(minute, 00, firstSubHome)) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n\n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Recieving Pass Heat Map \\nUp 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePRecievedHeatMapplot1Sub\n```\n### column {.tabset}\n```{r}\n#| title: 1st Half Pass Recieving Areas\nAwayPRecievedHeatMapplot1Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Away, \n         period == 1) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" Open Play Recieving Pass Heat Map \\nUp 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPRecievedHeatMapplot1Half\n```\n```{r}\n#| title: 2nd Half Pass Recieving Areas\n\nAwayPRecievedHeatMapplot2Half <- plottingData %>%\n  filter(Successful_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Away, \n         period == 2) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" Open Play Recieving Pass Heat Map \\nUp 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPRecievedHeatMapplot2Half\n\n```\n```{r}\n#| title: Up to 1st Sub Pass Recieving Areas\n\nAwayPRecievedHeatMapplot1Sub <- plottingData %>%\n  filter(Attempted_Passes == 1,\n         Short_Corners == 0,\n         Corners == 0,\n         TeamName == Match_Away, \n         between(minute, 00, firstSubAway)) %>%\n  ggplot(aes(x = finalX, y = finalY)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  #geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n\n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" Open Play Recieving Pass Heat Map \\nUp 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Receieved Passes, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPRecievedHeatMapplot1Sub\n\n```\n\n\n\n# Player Analysis\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: player stats tables setup\n\nMatchSummaryPLayerData <- plottingData %>%\n  mutate(\n    Out_of_play_time = round(Out_of_play_time / 60, 1),\n    EventTime = round(EventTime / 60, 1),\n    TeamEPV = as.numeric(ifelse(str_detect(`outcomeType/value`, \"1\"), paste0(EPVvalue), 0))) %>%\n  group_by(TeamName, playerId, role, player_shirt) %>%\n    summarise(\n    across(\n      c(Goals, \n        TotalShots, \n        OFShots, \n        SoT = OTShots, \n        Out_Box_Shots, \n        Touches, \n        Defensive_Third_Touches, \n        Middle_Third_Touches, \n        Final_Third_Touches, \n        PK_Box_Touches, \n        SixYard_Box_Touches, \n        Attempted_Carries, \n        Successful_Carries, \n        Prog_Carries, \n        Final_Third_Carries, \n        Attempted_Passes, \n        Successful_Passes, \n        Long_Passes, \n        Final_Third_Passes, \n        PK_Box_Passes,\n        Prog_Passes,\n        Key_Passes,\n        Assists,\n        BCs,\n        TeamEPV,   \n        xG, \n        xGOT, \n        MyxA,\n        TeamxT,\n        Aerial_total, \n        Aerial_Won, \n        Aerial_Lost, \n        Ground_Duels_Total, \n        Ground_Duels_Won, \n        Ground_Duels_Lost,\n        UnSuccessful_Touches,\n        Attacking_Half_Touches, \n        Defensive_Half_Touches, \n        Mis_Control, \n        Dispossessed_Total, \n        Dribbles_Total, \n        Dribbles_Won, \n        Dribbles_Lost,\n        Blocked_Shot,\n        SixYard_Box_Shots, \n        PK_Box_Shots, \n        NPxG,\n        UnSuccessful_Passes,\n        Successful_Long_Passes, \n        Corners, \n        Short_Corners, \n        Cross_Passes, \n        Successful_Cross, \n        UnSuccessful_Cross, \n        Tackles_Total, \n        Tackles_Won, \n        Tackles_Lost, \n        Fouls_Total, \n        Fouls_Conceeded, \n        Fouls_Received,\n        Interceptions_Total, \n        Recoverys_Total,\n        Clearances_Total,\n        Offside_Won, \n        Offside_Lost\n        ), \n      \\(x) sum(x, na.rm = TRUE)\n    ),\n    minutes_played = min(minutes_played, na.rm = TRUE),\n    Carries_distance = sum(Carries_distance, na.rm = TRUE),\n    Successful_Carries_Distance = sum(Successful_Carries_Distance, na.rm = TRUE),\n    Prog_Carries_Distance = sum(Prog_Carries_Distance, na.rm = TRUE)\n  ) %>%\n  ungroup() %>%\n  group_by(TeamName) %>%\n  mutate(\n    Team_TotalTouches = sum(Touches),\n    Team_TotalEPV = sum(TeamEPV),\n    Team_TotalxG = sum(xG),\n    Team_TotalPasses = sum(Attempted_Passes),\n    Team_TotalDuels = sum(Ground_Duels_Total),\n    Team_TotalAerials = sum(Aerial_total),\n    Team_TotalShots = sum(TotalShots),\n    Possession = round((Touches / Team_TotalTouches), 2),\n    Pass_Success = round((Successful_Passes / Attempted_Passes), 2),\n    Aerial_Success = (Aerial_Won / Aerial_total),\n    Duel_Success = (Ground_Duels_Won / Ground_Duels_Total),\n    On_Ball_Time = round(InPlayTime * Possession,2),\n    Team_EPV_P = round((TeamEPV / Team_TotalEPV), 2),\n    Team_xG_P = round((xG / Team_TotalxG), 2),\n    Team_Duels_P = round((Ground_Duels_Total / Team_TotalDuels), 2),\n    Team_Aerial_P = round((Aerial_total / Team_TotalAerials), 2),\n    Team_Passes_P = round((Attempted_Passes / Team_TotalPasses), 2),\n    Team_Shots_P = round((TotalShots / Team_TotalShots), 2)\n  ) %>%\n  replace_na(list( Aerial_Success = 0)) %>%\n  replace_na(list( Duel_Success = 0)) %>%\n  ungroup()\n\nMD_adv_passing <- plottingData \nMD_adv_passing <- shift_column(data = MD_adv_passing, columns = \"playerId\", new_names = \"Receiver\", len = 1, up = TRUE)\nMD_adv_passing <- shift_column(data = MD_adv_passing, columns = \"TeamName\", new_names = \"Receiver_Team\", len = 1, up = TRUE)\nMD_adv_passing <- shift_column(data = MD_adv_passing, columns = \"player_shirt\", new_names = \"Receiver_shirt\", len = 1, up = TRUE)\n\nMD_adv_passing <- MD_adv_passing %>%\n  filter(Attempted_Passes == 1) %>% \n  select(Receiver, Receiver_shirt, Passer_Team = TeamName, Receiver_Team, minutes_played, Attempted_Passes, Successful_Passes, Key_Passes, Prog_Passes, EPV = EPVvalue) \n\nMD_adv_passing <- MD_adv_passing %>%\n  group_by(Receiver, Receiver_Team) %>%\n    summarise(Receiver_shirt = first(Receiver_shirt), Passes_Recieved = sum(Attempted_Passes), Successful_Recieved = sum(Successful_Passes), Key_Passes_Recieved = sum(Key_Passes), Prog_Passes_Recieved = sum(Prog_Passes), EPV = sum(EPV))  %>% \n  #na.omit() %>%\n  mutate(Recieving_Suc = (Successful_Recieved / Passes_Recieved)) %>%\n  replace_na(list(Recieving_Suc = 0)) %>%\n  select(Team = Receiver_Team, Shirt = Receiver_shirt, Passes_Recieved, Successful_Recieved, Key_Passes_Recieved, Prog_Passes_Recieved, EPV_Recieved = EPV, Recieving_Suc)\n\n#data load check for data to be converted to number\n#MatchdayTablePass <- MD_passing_values #xt xa from fbref\nMatchdayTableAdvPass <- MD_adv_passing\n\n#sort out advanced passing for the main table\n#MatchdayTableAdvPass <- MatchdayTableAdvPass %>%\n#  select(Team = Receiver_Team, Shirt = Receiver_shirt, Passes_Recieved, Successful_Recieved, Key_Passes_Recieved, Prog_Passes_Recieved, #EPV_Recieved = EPV, Recieving_Suc)\n  \n\n# add all data together\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  left_join(MatchdayTableAdvPass, by = c(\"TeamName\" = \"Team\", \"player_shirt\" = \"Shirt\", \"playerId\" = \"Receiver\"), copy = TRUE) %>% \n  mutate_all(~ ifelse(is.na(.), 0, .))\n\n#work out detailed passing, and touches variables\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  mutate('xG/Shot' =  xG/TotalShots,\n  'Shot Accuracy' = SoT/TotalShots,\n  'Shot Quality' = (xGOT - xG)/xG) %>%\n  mutate(`% F 3rd Carries` = Final_Third_Carries / Successful_Carries) %>%\n  mutate(`% P Carries` = Prog_Carries / Successful_Carries) %>%\n  mutate(`% Carries D Prog` = Prog_Carries_Distance / Successful_Carries_Distance) %>%\n  mutate(`Def Third Touches / Min` = Defensive_Third_Touches / minutes_played) %>%\n  mutate(`Mid Third Touches / Min` = Middle_Third_Touches / minutes_played) %>%\n  mutate(`F 3rd Touches / Min` = Final_Third_Touches / minutes_played) %>%\n  mutate(`PK Box Touches / Min` = PK_Box_Touches / minutes_played) %>%\n  mutate(`% T D Third` = Defensive_Third_Touches / Touches) %>%\n  mutate(`% T M Third` = Middle_Third_Touches / Touches) %>%\n  mutate(`% T F 3rd` = Final_Third_Touches / Touches) %>%\n  mutate(`% T PK Box` = PK_Box_Touches / Touches) %>%\n  mutate(`T / Min` = Touches / minutes_played) %>%\n  mutate(Failed_Pass = round(Attempted_Passes - Successful_Passes, 2),\n         Failed_Cross = round(Cross_Passes - Successful_Cross, 2),\n         Failed_Dribble = round(Dribbles_Total - Dribbles_Won, 2),\n         Poss_Gained = round(Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost), 2),\n         Poss_Lost = (Mis_Control + Failed_Pass + Failed_Cross + Failed_Dribble + OFShots + Blocked_Shot + Dispossessed_Total + Offside_Lost),\n         Posession_Control = (Interceptions_Total + Recoverys_Total + (Tackles_Won - Tackles_Lost) + (Aerial_Won - Aerial_Lost) - (Mis_Control + Dispossessed_Total + UnSuccessful_Passes + UnSuccessful_Cross + Dribbles_Lost  + OFShots + Blocked_Shot + Offside_Lost)),) %>%\n  mutate_all(~ ifelse(is.na(.), 0, .))\n\nDefEPVData <- plottingData %>%\n  filter(Corners == 0,\n         Short_Corners == 0,\n         FreeKicks == 0,\n         !`qualifiers/0/type/value` == 107, #throw in\n         !`qualifiers/1/type/value` == 107,\n         !`qualifiers/2/type/value` == 107,\n         !`qualifiers/3/type/value` == 107,\n           `type/value` == 1 |\n           `type/value` == 2 | \n           `type/value` == 3 |\n           `type/value` == 4 |\n           `type/value` == 9 |\n           `type/value` == 7 |\n           `type/value` == 8 |\n           `type/value` == 10 |\n           `type/value` == 11 |\n           `type/value` == 12 |\n           `type/value` == 13 |\n           `type/value` == 14 |\n           `type/value` == 15 |\n           `type/value` == 16 |\n           `type/value` == 41 |\n           `type/value` == 44 |\n           `type/value` == 42 |\n           `type/value` == 45 |\n           `type/value` == 50 |\n           `type/value` == 52 |\n           `type/value` == 54 |\n           `type/value` == 61 |\n           `type/value` == 73 |\n           `type/value` == 74) \n\nDefEPVData <- shift_column(data = DefEPVData, columns = \"EPVvalue\", new_names = \"EPV_Def\", len = 1, up = TRUE)\n\nDefEPVData <- DefEPVData %>%\n  filter(Defensive_Action == 1) %>%\n  select(TeamName, playerId, EPVvalue, Defensive_Action, `outcomeType/value`, EPV_Def, role) %>%\n  mutate(EPV_Faced = (EPVvalue + EPV_Def),\n    Successful_Def_EPV = ifelse(`outcomeType/value` == 1, paste0(EPV_Faced), 0),\n         Unsuccessful_Def_EPV = ifelse(`outcomeType/value` == 0, paste0(EPV_Faced), 0), \n         Successful_Def_EPV = as.numeric(Successful_Def_EPV),\n         Unsuccessful_Def_EPV = as.numeric(Unsuccessful_Def_EPV))\n\nDefEPVData <- DefEPVData %>%\n    group_by(playerId, role, TeamName) %>% \n  summarise(EPV_Faced = sum(EPV_Faced),\n            EPV_Won = sum(Successful_Def_EPV/EPV_Faced), \n            EPV_Lost = sum(Unsuccessful_Def_EPV/EPV_Faced)) %>%\n    mutate_all(~ifelse(is.nan(.), 0, .)) \n\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n  left_join(DefEPVData, by = c('playerId' = 'playerId', 'TeamName' = 'TeamName', 'role' = 'role'), copy = TRUE)\n\n\nMatchSummaryPLayerData <- MatchSummaryPLayerData %>%\n    replace_na(list( EPV_Faced = 0, EPV_Won = 0, EPV_Lost = 0)) \n\n\n#subset for standard player stats data table 1\nMatchSummaryPLayerPassingData <- MatchSummaryPLayerData\n\n#subset for detailed player stats data table 2\nMatchSummaryPLayerTouchesData <- MatchSummaryPLayerData\n\n#subset for detailed player stats data table 3\nMatchSummaryPLayerShootingData <- MatchSummaryPLayerData\n\n#subset for detailed player stats data table 4\nMatchSummaryPLayerDefensiveData <- MatchSummaryPLayerData\n\n#sub set for player profile plots\nMatchSummaryPLayerProfileData <- MatchSummaryPLayerData\n\n#data wrangling for general player stat table 1\nMatchSummaryPLayerPassingData <- MatchSummaryPLayerPassingData %>%\n  select(Team = TeamName, \n         Position = role, \n         Name = playerId, \n         Mins = minutes_played, \n         '% of Team Possession' = Possession, \n         xA = MyxA, \n         xT = TeamxT,  \n         'Attempted Passes' = Attempted_Passes, \n         'Successful Passes' = Successful_Passes, \n         'Pass Success %' = Pass_Success, Assists, \n         BCs, \n         'Key Passes' = Key_Passes, \n         `Long Ps`  = Long_Passes, \n         `Final 3rd P` = Final_Third_Passes, \n         `Prog Ps` = Prog_Passes, \n         'PK Box P' = PK_Box_Passes, \n         `Pass Received` = Passes_Recieved, \n         `PPs Received` = Prog_Passes_Recieved, \n         `KPs Recieved` = Key_Passes_Recieved, \n         `Recieveing Suc` = Recieving_Suc, \n         `EPV Recieved` = EPV_Recieved, \n         'EPV Created' = TeamEPV, \n         '% of Team EPV' = Team_EPV_P)\n\n#data wrangling for detailed player stats table 2\nMatchSummaryPLayerTouchesData <- MatchSummaryPLayerTouchesData %>%\n  select(Team = TeamName, \n         Name = playerId, \n         Position = role, \n         Mins = minutes_played, \n         Touches, \n         `Def 3rd` = Defensive_Third_Touches, \n         `Mid 3rd` = Middle_Third_Touches, \n         `Final 3rd` = Final_Third_Touches, \n         `PK Box` = PK_Box_Touches, \n         `Total / Min` = `T / Min`, \n         `Def 3rd % TT` = `% T D Third`, \n         `Mid Third % TT` = `% T M Third`, \n         `Final 3rd % TT` = `% T F 3rd`, \n         `PK Box % TT` = `% T PK Box`, \n         `Carries` = Successful_Carries, \n         `% Carries Prog` = `% P Carries`, \n         `% Carries F 3rd` = `% F 3rd Carries`, \n         `% Carries D Prog`)\n\n#data wrangling for detailed player stats table 3\nMatchSummaryPLayerShootingData <- MatchSummaryPLayerShootingData %>%\n    select(Team = TeamName, \n           Position = role, \n           Name = playerId, \n           Mins = minutes_played, \n           'Total Shots' = TotalShots, \n           SoT, \n           '6 yard box' = SixYard_Box_Shots,     \n           'PK Box Shot' = PK_Box_Shots, \n           'Out Box Shots' = Out_Box_Shots, \n           'Blocked Shot' = Blocked_Shot,\n           Goals, \n           xG, \n           xGOT,\n           'xG/Shot',\n           'Shot Accuracy',\n           'Shot Quality')\n\n#data wrangling for detailed player stats table 4\nMatchSummaryPLayerDefensiveData <- MatchSummaryPLayerDefensiveData %>%\n  select(Team = TeamName, \n         Name = playerId, \n         Position = role, \n         Mins = minutes_played, \n         'Aerials Total' = Aerial_total, \n         'Aerials Won' = Aerial_Won, \n         'Aerial Success %' = Aerial_Success, \n         'Duels Total' = Ground_Duels_Total, \n         'Duels Won' = Ground_Duels_Won, \n         'Duel Success' = Duel_Success,         \n         'Tackles Total' = Tackles_Total, \n         'Tackles Won' = Tackles_Won, \n         'Tackles Lost' = Tackles_Lost, \n         'Interceptions Total' = Interceptions_Total, \n         'Recoverys Total' = Recoverys_Total,\n         'Clearances Total' = Clearances_Total, #c16\n         'Fouls Total' = Fouls_Total, \n         'Fouls Conceeded' = Fouls_Conceeded, \n         'Fouls Received' = Fouls_Received,\n         'Offside Won' = Offside_Won, \n         'Offside Lost' = Offside_Lost,\n         'EPV Faced' =  EPV_Faced, \n         'EPV Won'  = EPV_Won, \n         'EPV Lost' = EPV_Lost,\n         'Possession Control' = Posession_Control)\n\n#data wrangling for player profile plots\nPlayer_Summary_plot_data <- MatchSummaryPLayerProfileData %>%\n  select(Team = TeamName, Name = playerId, role, '% Possession' = Possession, `% On Ball Time` = On_Ball_Time, Touches = Touches, 'Total Shots' = TotalShots, OFShots, SoT, 'Out Box Shots' = Out_Box_Shots, BCs, Goals, xG, xGOT, '% xG' = Team_xG_P, Touches, PK_Box_Touches, \n         'Attempted Passes' = Attempted_Passes, 'Successful Passes' = Successful_Passes, 'Pass Success %' = Pass_Success, Assists, 'Key Passes' = Key_Passes, EPV = TeamEPV, '% EPV' = Team_EPV_P, 'Aerials Total' = Aerial_total, 'Aerials Won' = Aerial_Won, 'Aerial Success %' = Aerial_Success, 'Duels Total' = Ground_Duels_Total, 'Duels Won' = Ground_Duels_Won, 'Duel Success %' = Duel_Success, '% Duels' = Team_Duels_P, '% Passes' = Team_Passes_P, '% Shots' = Team_Shots_P, '% Aerials' = Team_Aerial_P)\n\n\nPlayer_Summary_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, '% Possession', '% xG', '% EPV', '% Passes', '% Shots', '% Duels', '% Aerials') %>%\n  pivot_longer(cols = c('% Possession', '% xG', '% EPV','% Passes', '% Shots', '% Duels', '% Aerials'), names_to = \"Metric\", values_to = \"Value\")\n\n#player profile plot data\nPlayer_Goal_data <- Player_Summary_plot_data %>%\n  select(Team, Name, role, OFShots, SoT, 'Out Box Shots', BCs, Goals, Assists, 'Key Passes') %>%\n  pivot_longer(cols = c(OFShots, SoT, `Out Box Shots`, BCs, Goals, Assists, `Key Passes`), names_to = \"Metric\", values_to = \"Value\") \n\n#filter data by team\nPlayer_Summary_plot_data_Home <- Player_Summary_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Summary_plot_data_Away <- Player_Summary_data %>%\n  filter(Team == Match_Away) \n\nPlayer_Goal_plot_data_Home <- Player_Goal_data %>%\n  filter(Team == Match_Home)\n\nPlayer_Goal_plot_data_Away <- Player_Goal_data %>%\n  filter(Team == Match_Away) \n\n\n#work out team and unit averages\n#general metrics\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\ngroup_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Home  <- Player_Summary_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Summary_data_Away  <- Player_Summary_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n#goal metrics\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Home  <- Player_Goal_plot_data_Home  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(Metric) %>%\n  mutate(TeamAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\nPlayer_Goal_data_Away  <- Player_Goal_plot_data_Away  %>%\n  group_by(role, Metric) %>%\n  mutate(UnitAverage = round(mean(Value, na.rm = TRUE),2)) %>%\n  ungroup()\n\n\n#wrap the tiles for the general plot\nPlayer_Summary_data_Home$Metric  <- str_wrap(Player_Summary_data_Home$Metric, width = 5)  \n\nPlayer_Summary_data_Away$Metric  <- str_wrap(Player_Summary_data_Away$Metric, width = 5)  \n\n\n#wrap the tiles for the goal plot\nPlayer_Goal_data_Home$Metric  <- str_wrap(Player_Goal_data_Home$Metric, width = 5)  \n\nPlayer_Goal_data_Away$Metric  <- str_wrap(Player_Goal_data_Away$Metric, width = 5)  \n\n\n#reorder data\nfacet_order <- c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")\n\n#general plot\nPlayer_Summary_data_Home  <- Player_Summary_data_Home  %>%\narrange(factor(role, levels = facet_order))\n\nPlayer_Summary_data_Away  <- Player_Summary_data_Away  %>%\n  arrange(factor(role, levels = facet_order))\n\n#goal plot\nPlayer_Goal_data_Home <- Player_Goal_data_Home %>%\n  arrange(factor(role, levels = facet_order))\n\nPlayer_Goal_data_Away <- Player_Goal_data_Away %>%\n  arrange(factor(role, levels = facet_order))\n\n```\n## Row {.flow}\n### column {.tabset}\n\n```{r, results='asis'}\n#| title: Passing stats\n#| results: asis\n#| label: Home player Passing table\n\nMatchSummaryPLayerPassingTableHome <- MatchSummaryPLayerPassingData %>%\n  filter(Team == Match_Home) %>%\n  gt(groupname_col = \"Position\", rowname_col = \"Name\") %>%\n  row_group_order(groups = c(\"Keeper\",\n                             \"Defender\",\n                             \"Midfielder\", \n                             \"Forward\"\n                             )) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Possession Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  summary_rows(columns = c(5:24), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:24), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(5, 10, 21, 24),\n    decimals = 0\n  ) %>%\n  fmt_number(\n    columns = c(6,7,22,23),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Expected Metrics\", columns = c(6:7)) %>%\n  tab_spanner(label = \"Passes\", columns = c(8:17)) %>%\n  tab_spanner(label = \"Recieving\", columns = c(18:24)) %>%\n tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Expected Metrics'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Recieving'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  #gt_plt_bar(\n  #  'Long Ps',\n    #keep_column = TRUE,\n  #  labels = TRUE,\n  #  color = Color_Home,\n  #  scaled = FALSE,\n  #) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  #gt_color_rows(columns = c(6, 17, 28), palette = ColorScale_Home, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(12:13, 16:17), palette = ColorScale_Home, domain = c(0,10)) %>%\n  #gt_color_rows(columns = c(10:12, 18:19, 20), palette = ColorScale_Home, domain = c(0,5)) %>%\n  #gt_color_rows(columns = c(5, 21, 22, 23, 24, 26), palette = ColorScale_Home, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(5, 10, 21, 24), palette = ColorScale_Home, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(14:15), palette = ColorScale_Home, domain = c(0,20))\n\nMatchSummaryPLayerPassingTableHome\n\n```\n\n```{r, results='asis'}\n#| title: Touches and Carries\n#| results: asis\n#| label: home player Touches table\n\nMatchSummaryPLayerTouchesTableHome <- \n  MatchSummaryPLayerTouchesData %>% \n  filter(Team == Match_Home) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(11:14, 16:18), decimals = 0) %>%\n  fmt_number(columns = c(10), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_spanner(label = \"Touches (T) Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"% Touches Thirds Breakdown\", columns = c(11:14)) %>%\n  tab_spanner(label = \"Carries Breakdown\", columns = c(15:18)) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Touches Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners(\"Touches (T) Breakdown\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('% Touches Thirds Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Carries Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(10), palette = ColorScale_Home, domain = c(0,3)) %>% # touch/per min\n  gt_color_rows(columns = c(12:14, 16:18), palette = ColorScale_Home, domain = c(0,1)) # % scales\nMatchSummaryPLayerTouchesTableHome\n\n```\n```{r, results='asis'}\n#| title: Shooting stats\n#| results: asis\n\n\nMatchSummaryPLayerShootingTableHome <- MatchSummaryPLayerShootingData %>% \n  filter(Team == Match_Home) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(15:16), decimals = 0) %>%\n  fmt_number(columns = c(12:14), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Shooting Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(5:11), palette = ColorScale_Home, domain = c(0,5)) %>% # shots\n  gt_color_rows(columns = c(15), palette = ColorScale_Home, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(16), palette = ColorScale_Home, domain = c(-5, 5)) # % scales# % scales\n\nMatchSummaryPLayerShootingTableHome\n```\n\n```{r, results='asis'}\n#| title: Defensive stats\n#| results: asis\n\nMatchSummaryPLayerDefensiveTableHome <- MatchSummaryPLayerDefensiveData %>% \n  filter(Team == Match_Home) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(7, 10, 23:24), decimals = 0) %>%\n  fmt_number(columns = c(22), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Home, \" Player Match Defensive Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_spanner(label = \"Duels Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"Defensive Threat\", columns = c(22:24)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Defensive Threat'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(22), palette = ColorScale_Home, domain = c(0,2)) %>% # epv faced\n  gt_color_rows(columns = c(7, 10, 23, 24), palette = ColorScale_Home, domain = c(0,1)) # % scales\n\nMatchSummaryPLayerDefensiveTableHome\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r, results= 'asis'}\n#| title: Passing stats\n#| results: asis\n#| label: Away player Passing tables\n\nMatchSummaryPLayerPassingTableAway <- MatchSummaryPLayerPassingData %>%\n  filter(Team == Match_Away) %>%\n  gt(groupname_col = \"Position\", rowname_col = \"Name\") %>%\n  row_group_order(groups = c(\"Keeper\",\n                             \"Defender\",\n                             \"Midfielder\", \n                             \"Forward\"\n                             )) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Possession Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  summary_rows(columns = c(5:24), fns = list(Average = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:24), fns = list(Total = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:24), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  fmt_percent(\n    columns = c(5, 10, 21, 24),\n    decimals = 0\n  ) %>%\n  fmt_number(\n    columns = c(6,7,22,23),\n    decimals = 2) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_spanner(label = \"Expected Metrics\", columns = c(6:7)) %>%\n  tab_spanner(label = \"Passes\", columns = c(8:17)) %>%\n  tab_spanner(label = \"Recieving\", columns = c(18:24)) %>%\n tab_style(\n    locations = cells_column_spanners('Passes'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Expected Metrics'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Recieving'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  #gt_color_rows(columns = c(6, 17, 28), palette = ColorScale_Home, domain = c(0,100)) %>%\n  gt_color_rows(columns = c(12:13, 16:17), palette = ColorScale_Away, domain = c(0,10)) %>%\n  #gt_color_rows(columns = c(10:12, 18:19, 20), palette = ColorScale_Home, domain = c(0,5)) %>%\n  #gt_color_rows(columns = c(5, 21, 22, 23, 24, 26), palette = ColorScale_Home, domain = c(0,20)) %>%\n  gt_color_rows(columns = c(5, 10, 21, 24), palette = ColorScale_Away, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(14:15), palette = ColorScale_Away, domain = c(0,20))\n\nMatchSummaryPLayerPassingTableAway\n```\n\n```{r, results='asis'}\n#| title: Touches and Carries\n#| results: asis\n#| label: away playertouches table\n\nMatchSummaryPLayerTouchesTableAway <- MatchSummaryPLayerTouchesData %>% \n  filter(Team == Match_Away) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(11:14, 16:18), decimals = 0) %>%\n  fmt_number(columns = c(10), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_spanner(label = \"Touches (T) Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"% Touches Thirds Breakdown\", columns = c(11:14)) %>%\n  tab_spanner(label = \"Carries Breakdown\", columns = c(15:18)) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Touches Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:18), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:18), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners(\"Touches (T) Breakdown\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('% Touches Thirds Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_column_spanners('Carries Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(10), palette = ColorScale_Away, domain = c(0,3)) %>% # touch/per min\n  gt_color_rows(columns = c(12:14, 16:18), palette = ColorScale_Away, domain = c(0,1)) # % scales\nMatchSummaryPLayerTouchesTableAway\n```\n```{r, results='asis'}\n#| title: Shooting stats\n#| results: asis\n\nMatchSummaryPLayerShootingTableAway <- MatchSummaryPLayerShootingData %>% \n  filter(Team == Match_Away) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(15:16), decimals = 0) %>%\n  fmt_number(columns = c(12:14), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Shooting Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:16), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:16), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(5:11), palette = ColorScale_Away, domain = c(0,5)) %>% # shots\n  gt_color_rows(columns = c(15), palette = ColorScale_Away, domain = c(0,1)) %>%\n  gt_color_rows(columns = c(16), palette = ColorScale_Away, domain = c(-5,5))# % scales\n\nMatchSummaryPLayerShootingTableAway\n\n```\n\n```{r, results='asis'}\n#| title: Defensive stats\n#| results: asis\n\nMatchSummaryPLayerDefensiveTableAway <- MatchSummaryPLayerDefensiveData %>% \n  filter(Team == Match_Away) %>%\n  gt(rowname_col = \"Name\", groupname_col = \"Position\") %>%\n  row_group_order(groups = c(\"Keeper\",\"Defender\",\"Midfielder\", \"Forward\")) %>%\n  cols_hide(Team) %>%\n  cols_width(Name ~ px(100)) %>%\n  fmt_percent(columns = c(7, 10, 23:24), decimals = 0) %>%\n  fmt_number(columns = c(22), decimals = 2) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  tab_header(\n    title = paste0(Match_Away, \" Player Match Defensive Summary\"),\n    subtitle = paste0(Match_Fixture)) %>%\n  tab_source_note(md(My_caption)) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  summary_rows(columns = c(5:25), fns = list(\"Pos Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Average\" = ~ mean (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 1))) %>%\n  grand_summary_rows(columns = c(5:25), fns = list(\"Team Total\" = ~ sum (., na.rm=TRUE)), fmt = list(~fmt_number(., decimals = 0))) %>%\n  tab_spanner(label = \"Duels Breakdown\", columns = c(5:10)) %>%\n  tab_spanner(label = \"Defensive Threat\", columns = c(22:24)) %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(\n    locations = cells_column_spanners('Duels Breakdown'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n    tab_style(\n    locations = cells_column_spanners('Defensive Threat'),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_style(\n    locations = cells_title(groups = \"title\"),\n    style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) %>%\n  gt_color_rows(columns = c(21), palette = ColorScale_Away, domain = c(0,2)) %>% # epv faced\n  gt_color_rows(columns = c(7, 10, 23, 24), palette = ColorScale_Away, domain = c(0,1)) # % scales\n\nMatchSummaryPLayerDefensiveTableAway\n\n```\n\n\n## Row\n```{r}\n#| output: false\n#| label: dribbles and duels data setup\n\nheatmapdata <- plottingData \n\nDribblesmapdata <- heatmapdata %>%\n  filter(Dribbles_Total == 1) %>%\n  mutate(DribblesFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DribblesFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName, teamId, playerId, player_shirt, playerNumber, role,  x, y, DribblesFinalX, DribblesFinalY, outcome, Game_Period )\n\n\n#duels aerial and ground data\nDuelsmapdata <- heatmapdata\n  \nDuelsmapdata <- heatmapdata %>%\n  filter(Ground_Duels_Total == 1 |\n           Aerial_total == 1) %>%\n  mutate(DuelsFinalX = ifelse(type == \"TakeOn\", lead(x), NA),\n         DuelsFinalY = ifelse(type == \"TakeOn\", lead(y), NA)) %>%\n  select(TeamName, teamId, playerId, player_shirt, playerNumber, role, x, y, DuelsFinalX, DuelsFinalY, outcome, Game_Period )\n\n\n#Liverpool duels data\nHomeDuelsmapdata <- Duelsmapdata %>%\n  filter(TeamName == Match_Home)\n\n#Away duels data\nAwayDuelsmapdata <- Duelsmapdata %>%\n  filter(TeamName == Match_Away)\n\n#Home Dribbles Data\nHomeDribblesmapdata <- Dribblesmapdata %>%\n  filter(TeamName == Match_Home)\n\n#Away Dribbles Data\nAwayDribblesmapdata <- Dribblesmapdata %>%\n  filter(TeamName == Match_Away)\n\n#PLayer touch data \nTouchDataHome <- plottingData %>%\n  filter(TeamName == Match_Home)\n\nTouchDataAway <- plottingData %>%\n  filter(TeamName == Match_Away)\n\n#Home TEAM Touch zones\nTouchData <- plottingData %>%\n  filter(\n    Corners == 0,\n    Short_Corners == 0,\n    Attempted_Passes == 1,\n    FreeKicks == 0,\n    `type/value` %in% c(1, 2, 3, 13, 14, 15, 16, 42, 50, 61))\n\nHomeTeamTouchData <- TouchData %>%\n  filter(TeamName == Match_Home)\n\nAwayTeamTouchData <- TouchData %>%\n  filter(TeamName == Match_Away)\n\n```\n\n## Row  {.flow}\n```{r}\n#| label: home player touch plot\n#| height: 100%\n#| message: false\n\nHomeconvexPlot1stsubs <- TouchPlayerPlot_AI(TouchDataHome,  title = Match_Home,\n                                    plot_start = 00, plot_finish = firstSubHome, color = Color_Home, text_color = Color_Home_Text, method = \"mad\",\n                                    subtitle = paste0(Match_Fixture, \" Up to 1st subs\"))\nHomeconvexPlot1stsubs\n\n\n```\n\n### column {.tabset}\n```{r}\n#| title: On ball touch plot 1st subs\n#| label: home team touch plot 1st subs\n#| height: 100%\n#| message: false\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomeTeamTouchData,  title = paste0(Match_Home, \" Team On Ball Touch\"),\n                                     plot_start = 00, plot_finish = firstSubHome, color = Color_Home, logo = \"\", method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team On Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 1st Half\n#| label: home team touch plot 1st half\n#| height: 100%\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomeTeamTouchData,  title = paste0(Match_Home, \" Team On Ball Touch\"),\n                                     plot_start = 00, plot_finish = 45, color = Color_Home, logo = \"\", method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team On Ball Touch Zones 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 2nd Half\n#| label: home team touch plot 2nd half\n#| height: 100%\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomeTeamTouchData,  title = paste0(Match_Home, \" Team On Ball Touch\"),\n                                     plot_start = 50, plot_finish = 110, color = Color_Home, logo = \"\", method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team On Ball Touch Zones 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row {.flow}\n\n```{r}\n#| label: away player touch plot\n#| height: 100%\n#| message: false\n#team touch plots Away\nAwayconvexPlot1stSubs <- TouchPlayerPlot_AI(TouchDataAway,  title = Match_Away,\n                                     plot_start = 00, plot_finish = firstSubAway,  color = Color_Away, text_color = Color_Away_Text, method = \"mad\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st subs\"))\nAwayconvexPlot1stSubs\n\n```\n### column {.tabset}\n```{r}\n#| title: On ball touch plot 1st subs\n#| label: away team touch plot 1st subs\n#| height: 100%\n#| message: false\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayTeamTouchData,  title = paste0(Match_Away, \" Team On Ball Touch\"),\n                                       plot_start = 00, plot_finish = firstSubAway, color = Color_Away, method = \"mad\",\n                                       subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team On Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 1st Half\n#| label: away team touch plot 1st half\n#| height: 100%\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayTeamTouchData,  title = paste0(Match_Away, \" Team On Ball Touch\"),\n                                       plot_start = 00, plot_finish = 45, palette =, color = Color_Away, method = \"mad\",\n                                       subtitle = paste0(Match_Fixture, \" 1st Half\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team On Ball Touch Zones 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: On ball touch plot 2nd Half\n#| label: away team touch plot 2nd half\n#| height: 100%\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayTeamTouchData,  title = paste0(Match_Away, \" Team On Ball Touch\"),\n                                       plot_start = 50, plot_finish = 110, palette =, color = Color_Away, method = \"mad\",\n                                       subtitle = paste0(Match_Fixture, \" 2nd Half\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team On Ball Touch Zones 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Dribbles by Game Period\n#| height: 100%\nHomeDribblesPlotT <- HomeDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(Match_Home, \" \", DribblesTitle_text, \" by game period\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nHomeDribblesPlotT\n```\n\n```{r}\n#| title: Dules by Game Period\n#| height: 100%\nHomeDulesPlotT <- HomeDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  #  facet_grid(Game_Period ~ playerId) +\n  labs(title = paste0(Match_Home, \" \", DuelsTitle_text, \" by game period\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nHomeDulesPlotT\n```\n\n### column {.tabset}\n\n```{r}\n#| title: Dribbles by Game Period\n#| height: 100%\nAwayDribblesPlotT <- AwayDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(Match_Away, \" \", DribblesTitle_text, \" by game period \"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayDribblesPlotT\n\n```\n```{r}\n#| title: Duels by Game Period\n#| height: 100%\nAwayDulesPlotT <- AwayDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  \n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~ Game_Period, ncol = 4) +\n  labs(title = paste0(Match_Away, \" \", DuelsTitle_text, \" by game period\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\ntheme(plot.title = element_markdown(),\n      plot.caption = element_markdown(),\n      panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n      plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n      plot.subtitle = element_text(colour = \"black\", size = 1),\n      legend.position = \"none\",\n      strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n      strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayDulesPlotT\n\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Dribbles by Player\nHomeDribblesPlotP <- HomeDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 5) +\n  \n  labs(title = paste0(Match_Home, \" \", DribblesTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\nHomeDribblesPlotP\n\n```\n\n\n```{r}\n#| height: 100%\n#| title: Duels by Player\n#| label: Home Duels plot by player\n#canvas\nHomeDulesPlotP <- HomeDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 6) +\n  \n  labs(title = paste0(Match_Home, \" \", DuelsTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nHomeDulesPlotP\n```\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Dribbles by Player\nAwayDribblesPlotP <- AwayDribblesmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 5) +\n  \n  labs(title = paste0(Match_Away, \" \", DribblesTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayDribblesPlotP\n```\n\n```{r}\n#| height: 100%\n#| title: Duels by Player\nAwayDulesPlotP <- AwayDuelsmapdata %>%\n  ggplot(aes(x = x, y = y, group = Game_Period)) +\n  \n  #geometrics\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n        annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 2, color = \"grey\", show.legend = FALSE) +\n  \n  # plot duels\n  geom_point(aes(fill = outcome), shape = 21, size = 1.5, alpha = 0.6) +\n  \n  #formatting\n  scale_color_paletteer_c(\"ggthemes::Red-Black-White Diverging\", -1) +\n  scale_fill_manual(values = c(\"#0000FF\",  \"#BD1100\")) +\n  scale_size_continuous(range = c(0.5, 5)) +\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + playerId, ncol = 6) +\n  \n  labs(title = paste0(Match_Away, \" \", DuelsTitle_text, \" by player\"), \n       subtitle = paste0(Match_Fixture,\" - Direction of play Left to Right\"),\n       caption = My_caption) +\n  theme(plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        plot.subtitle = element_text(colour = \"black\", size = 10),\n        legend.position = \"none\",\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\nAwayDulesPlotP\n\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Whole Team\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n   # scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + Name, ncol = 6) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 4, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 3, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n\n```{r}\n#| title: Defenders\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  filter(role == \"Defender\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n```{r}\n#| title: Midfielders\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  filter(role == \"Midfielder\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n```{r}\n#| title: Forwards\n\nPlayer_Summary_Plot_Home <- Player_Summary_data_Home %>% \n  filter(role == \"Forward\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n  force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Home, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Whole team\n#| out-height: 100%\n#| out-width: 100%\n\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~factor(role, levels = c(\n                                      \"Keeper\", \n                                      \"Defender\", \n                                      \"Midfielder\", \n                                      \"Forward\"\n                                      )) + Name, ncol = 6) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 4, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 3, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n```{r}\n#| title: Defenders\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>% \n  filter(role == \"Defender\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n```{r}\n#| title: Midfielders\n#| out-height: 100%\n#| out-width: 100%\n\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>%\n  filter(role == \"Midfielder\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n```{r}\n#| title: Forwards\n#| out-height: 100%\n#| out-width: 100%\n\n\nPlayer_Summary_Plot_Away <- Player_Summary_data_Away %>% \n  filter(role == \"Forward\") %>%\n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  facet_wrap(~Name, ncol = 4) +\n\n  guides(fill = guide_colorsteps(\n      barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 4, colour = \"black\"))) +\n  \n  labs(title = paste0(Match_Away, \" Player Match Profiles\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 6, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 6, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 6),\n        legend.position = \"top\")\n        \n\nPlayer_Summary_Plot_Away\n\n```\n## Column {.flow}\n```{r}\n\n#| out-height: 100%\n#| out-width: 100%\n\nPlayer_Summary_data_A_MOM <- Player_Summary_data_Home %>% \n  filter(Name == HMOM)\n  \nPlayer_Summary_Plot_Home <- Player_Summary_data_A_MOM %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n   # scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  #facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + Name, ncol = 6) +\n  #force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Player_Summary_data_A_MOM$Name, \" Player Match Profile\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 8, colour = Color_Home_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 8, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Home\n\n```\n\n```{r}\n\n#| out-height: 100%\n#| out-width: 100%\n\nPlayer_Summary_data_MOM <- Player_Summary_data_Away %>% \n  filter(Name == AMOM)\n  \nPlayer_Summary_Plot_Away <- Player_Summary_data_MOM %>% \n  ggplot() +\n  geom_col(aes(x = Metric,\n               y = Value,\n               fill = Value), color = \"gray4\",\n              linewidth = 0.1) +\n   # scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n  geom_segment(\n    aes(\n      x = Metric,\n      y = 0,\n      xend = Metric,\n      yend = max(Value) #The maximum values you want to extend the line.\n    ),\n    linetype = \"dashed\",\n    lineend = \"butt\",\n    linejoin = \"mitre\",\n    color = \"gray4\",\n    linewidth = 0.2,\n  ) +\n  geom_point(aes(x = Metric,\n                 y = UnitAverage),\n             shape = 19,\n             size = 0.8,\n             stroke = 0.2,\n             color = \"gray4\") +\n  \n  # Make it circular!\n  coord_polar() +\n  \n  #wrap\n  #facet_wrap(~factor(role, levels = c(\"Keeper\", \"Defender\", \"Midfielder\", \"Forward\")) + Name, ncol = 6) +\n  #force_panelsizes(rows = c(10, 10, 10, 10, 10, 10), cols = c(10, 10, 10, 10, 10, 10)) +\n\n  guides(fill = guide_colorsteps(barwidth = 15, barheight = .25, title.position = \"top\", title.hjust = .5, title.theme = element_text(size = 5, colour = \"black\"))) +\n  \n  labs(title = paste0(Player_Summary_data_MOM$Name, \" Player Match Profile\"), \n       subtitle = paste0(Match_Fixture, \"\\nBar = Player Absolute % of Team Metric Value, \\nDot = Position Average % of Team Metric\"),\n       caption = My_caption,\n       fill = \"Percentage %\") +\n  theme(plot.subtitle = element_text(colour = \"black\", size = 8),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.background = element_rect(fill = \"snow\", color = \"snow\"),\n        strip.text.x = element_text(size = 8, colour = Color_Away_Text, face = \"bold\"),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5),\n        axis.title = element_blank(), # Removing the x axis title\n        axis.ticks = element_blank(), # Removing the x axis ticks\n        axis.text.y = element_blank(), # Removing the y axis text\n        axis.text.x = element_text(color = \"gray12\", size = 8, hjust = 1),  #Making the text grey to look asthetic\n        panel.grid = element_blank(),\n        panel.grid.major = element_line(color = \"gray\"),\n        legend.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        legend.text = element_text(colour = \"black\", size = 4),\n        legend.position = \"top\")\n\nPlayer_Summary_Plot_Away\n\n```\n\n# EPV Analysis\n```{r}\n#| output: false\n#| label: EPV Time Data setup\n#| echo: false\n#set final plot data frame\n\n#EPV over time line plot Opta data\n#data wrangling\nEPVPlotData <- plottingData %>%\n    mutate(Home_EPV = ifelse(TeamName == Match_Home & `outcomeType/value` == 1, EPVvalue, 0)) %>%\n  mutate(Home_Cumalative_EPV = cumsum(Home_EPV))\n\nEPVPlotData <- EPVPlotData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Home_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n          Goal_point_Y = round(Goal_point_Y,2),\n         Home_Cumalative_EPV = round(Home_Cumalative_EPV,2)) %>%\n  select(TeamName, expandedMinute, minute, type, Home_Cumalative_EPV, TeamEPV, EPVvalue, Goal_point_Y, Goal_point_X, Cumalative_EPV, Home_Cumalative_EPV, Successful_Passes,Successful_Carries)\n\nEPVdfHome <- EPVPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    EPV_roll5 = slide_dbl(Home_Cumalative_EPV,\n                           mean,\n                           .before = 10,   \n                           .complete = TRUE)) %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n\n\nAwayEPVPlotData <- plottingData %>%\n    mutate(Away_EPV = ifelse(TeamName == Match_Away & `outcomeType/value` == 1, EPVvalue, 0)) %>%\n  mutate(Away_Cumalative_EPV = cumsum(Away_EPV))\n\nAwayEPVPlotData <- AwayEPVPlotData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Away_Cumalative_EPV), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Goal_point_Y = round(Goal_point_Y,2),\n         Away_Cumalative_EPV = round(Away_Cumalative_EPV,2)) %>%\n  select(TeamName, expandedMinute, minute, type, Away_Cumalative_EPV, TeamEPV, EPVvalue, Goal_point_Y, Goal_point_X, Cumalative_EPV, Away_Cumalative_EPV, Successful_Passes, Successful_Carries)\n\n\nEPVdfAway <- AwayEPVPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    EPV_roll5 = slide_dbl(Away_Cumalative_EPV,\n                           mean,\n                           .before = 10,   \n                           .complete = TRUE)) %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n```\n\n\n```{r}\n#| output: false\n#| echo: false\n#| label: EPV Area Setup\n#EPV Development area  plot Opta data\n#data wrangling\nEPVAreaPlotData <- plottingData\n\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  filter(TeamName == Match_Home)\n\n#set final plot data frame\nEPVAreaPlotData <- EPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  #mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = sum(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Goal_point_Y = round(Goal_point_Y,2))\n\n#Away EPV Development area  plot Opta data\n#data wrangling\nAwayEPVAreaPlotData <- plottingData\n\nAwayEPVAreaPlotData <- AwayEPVAreaPlotData %>%\n  filter(TeamName == Match_Away)\n\n#set final plot data frame\nAwayEPVAreaPlotData <- AwayEPVAreaPlotData %>%\n  group_by(expandedMinute) %>%\n  filter(!Own_Goals == 1) %>%\n  #mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(EPVArea = sum(EPVvalue)) %>%\n  mutate(EPVArea = as.numeric(EPVArea),\n         EPVArea = round(EPVArea,2)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(EPVArea), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Goal_point_Y = round(Goal_point_Y,2))\n\n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nEPVTimePlot <- EPVPlotData %>%\n#canvas\n  ggplot(aes(x = expandedMinute, y = Home_Cumalative_EPV)) +\n  \n#geometrics\n  \n  # smoothed lines\n  geom_smooth(data = EPVdfHome, aes(x = expandedMinute, y = EPV_roll5), linewidth = 1.2, color = Color_Home, fill = \"snow\") +\n  #geom_line(size = 1.5, colour = Color_Home) +\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +    \n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute, \" EPV:\", Goal_point_Y)), size = 2) +\n  \n#formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, 0.5)) +\n  labs(title = paste(Match_Home, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Match time (Mins)\",\n         caption = My_caption,\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nEPVTimePlot\n\n```\n\n```{r} \n#| height: 100%\n#set final plot data frame\nAwayEPVTimePlot <- AwayEPVPlotData %>%\n  \n  #canvas\n  ggplot(aes(x = expandedMinute, y = Away_Cumalative_EPV)) +\n  \n  # smoothed lines\n  geom_smooth(data = EPVdfAway, aes(x = expandedMinute, y = EPV_roll5), linewidth = 1.2, color = Color_Away, fill = \"snow\") +\n\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +   \n  \n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute, \" EPV:\", Goal_point_Y)), size = 2) +\n  \n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, 0.5)) +\n  labs( title = paste0(Match_Away, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Match time (Mins)\",\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\nAwayEPVTimePlot\n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\n#canvas\nEPVAreaPlot <- EPVAreaPlotData %>% \n  ggplot(aes(x = expandedMinute, y = EPVArea)) +\n  \n#geometrics\n  geom_line(size = 1, colour = \"black\") +\n  geom_area(fill = Color_Home) +\n\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(\"Game Min:\", minute, \" \", type, \"\\nEPV:\", Goal_point_Y)), size = 2) +\n\n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 0.60), breaks = seq(0, 0.60, 0.02)) +\n  labs(title = paste(Match_Home, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Match Time (mins)\",\n         caption = My_caption,\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\nEPVAreaPlot\n```\n\n```{r EVP away area}\n#| height: 100%\n#canvas\nAwayEPVAreaPlot <- AwayEPVAreaPlotData %>% \n  ggplot(aes(x = expandedMinute, y = EPVArea)) +\n  \n  #geometrics\n  geom_line(size = 1, colour = \"black\") +\n  geom_area(fill = Color_Away) +\n  #geom_segment(aes(y = 0, yend = max(EPVArea), x = 45, xend = 45), linewidth = 0.8, colour = \"black\", linetype = \"longdash\") +\n  #geom_text(aes(x = 45, y = max(EPVArea), label = \"HT\"), colour = \"black\", hjust = 1.5, vjust = 1, size = 4) +\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(\"Game Min:\", minute, \" \", type, \"\\nEPV:\", Goal_point_Y)), size = 2) +\n\n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 0.60), breaks = seq(0, 0.60, 0.02)) +\n  labs( title = paste0(Match_Away, \" EPV Development\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Match Time (mins)\",\n         caption = My_caption,\n         y = \"EPV\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\nAwayEPVAreaPlot\n\n```\n\n## Row\n\n```{r}  \n#| output: false\nEPVHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(Corners == 0,\n         FreeKicks == 0,\n         Cross_Passes == 0,\n         Successful_Passes == 1,\n         Successful_Carries == 1, \n         Successful_Touches == 1,\n             !if_any(matches(\"^qualifiers/\\\\d+/type/value$\"),\n            ~ coalesce(.x == 107, FALSE)))\n\n#set time period\nEPVHeatMapDataFT <- EPVHeatMapData\n\n# Calculate average player position\n      Average_PlayerFT <- EPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPVFT <- sum(EPVHeatMapDataFT$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFT$zone_x <- cut(EPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFT$zone_y <- cut(EPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFT <- EPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFT,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZFT <- average_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZFT <- average_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPVFT,2)))  \n\n\n```\n\n```{r}\n#Away EPV heat plots\n#| output: false\nAwayEPVHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(Corners == 0,\n         FreeKicks == 0,\n         Cross_Passes == 0,\n         Successful_Passes == 1,\n         Successful_Carries == 1, \n         Successful_Touches == 1,\n             !if_any(matches(\"^qualifiers/\\\\d+/type/value$\"),\n            ~ coalesce(.x == 107, FALSE)))\n\n\n#set for time period\nAwayEPVHeatMapDataFT <- AwayEPVHeatMapData\n\n# Calculate average player position\n      AwayAverage_PlayerFT <- AwayEPVHeatMapDataFT %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPVFT <- sum(AwayEPVHeatMapDataFT$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataFT$zone_x <- cut(AwayEPVHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataFT$zone_y <- cut(AwayEPVHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvFT <- AwayEPVHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZFT <- Awayaverage_epvFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZFT <- Awayaverage_epvNZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPVFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nEPVHeatMapplotFT <- EPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n    #plot player positions\n  geom_point(data = AwayAverage_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n\n  # add zone percentage numbers\n  geom_text(data = average_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n    \n  #plot player names\n  geom_text(data = AwayAverage_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n    #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n\n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nFull Game\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nEPVHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayEPVHeatMapplotFT <- AwayEPVHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerFT, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZFT, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nFull Game\"), \n                            subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplotFT\n\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nEPVHeatMapData1sub <- EPVHeatMapData %>%\n  filter(expandedMinute <= firstSubHome)\n\n# Calculate average player position\n      Average_Player1Sub <- EPVHeatMapData1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n\n#set EPV total for time period\nHomeEPV1sub <- sum(EPVHeatMapData1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1sub$zone_x <- cut(EPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1sub$zone_y <- cut(EPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1sub <- EPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1sub <- average_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1sub <- average_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1sub,2)))  \n```\n\n```{r} \n#| output: false\n#Post first subs map\n#set time period\nEPVHeatMapDataP1sub <- EPVHeatMapData %>%\n  filter(expandedMinute > firstSubHome)\n\n# Calculate average player position\n      Average_PlayerP1Sub <- EPVHeatMapDataP1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPVP1sub <- sum(EPVHeatMapDataP1sub$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataP1sub$zone_x <- cut(EPVHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataP1sub$zone_y <- cut(EPVHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvP1sub <- EPVHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVP1sub,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZP1sub <- average_epvP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZP1sub <- average_epvNZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPVP1sub,2)))  \n```\n\n```{r}\n#| output: false\n#first subs\n#set for time period\nAwayEPVHeatMapData1sub <- AwayEPVHeatMapData %>%\n  filter(expandedMinute <= firstSubAway)\n\n# Calculate average player position\n      AwayAverage_Player1Sub <- AwayEPVHeatMapData1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPV1sub <- sum(AwayEPVHeatMapData1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapData1sub$zone_x <- cut(AwayEPVHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapData1sub$zone_y <- cut(AwayEPVHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epv1sub <- AwayEPVHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPV1sub,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZ1sub <- Awayaverage_epv1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZ1sub <- Awayaverage_epvNZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPV1sub,2)))  \n```\n\n```{r}\n#| output: false\n#post first subs\n#set for time period\nAwayEPVHeatMapDataP1sub <- AwayEPVHeatMapData %>%\n  filter(expandedMinute > firstSubAway)\n\n# Calculate average player position\n      AwayAverage_PlayerP1Sub <- AwayEPVHeatMapDataP1sub %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPVP1sub <- sum(AwayEPVHeatMapDataP1sub$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataP1sub$zone_x <- cut(AwayEPVHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataP1sub$zone_y <- cut(AwayEPVHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvP1sub <- AwayEPVHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVP1sub,3)) \n\n\n#calculate for combined tile and heat map\nAwayaverage_epvNZP1sub <- Awayaverage_epvP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZP1sub <- Awayaverage_epvNZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPVP1sub,2)))  \n```\n\n\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat to 1st Sub\nEPVHeatMapplot1sub <- EPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nUp to first subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home EPV Heat Map 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| height: 100%\n#| title: Threat Post 1st Sub\nEPVHeatMapplotP1sub <- EPVHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n  annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_PlayerP1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZP1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nPost 1st Subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplotP1sub\n\n```\n\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat to 1st Sub\nAwayEPVHeatMapplot1sub <- AwayEPVHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZ1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nUp to 1st Subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplot1sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away EPV Heat Map 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| height: 100%\n#| title: Threat Post 1st Sub\nAwayEPVHeatMapplotP1sub <- AwayEPVHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerP1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZP1sub, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nPost 1st Subs\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplotP1sub\n```\n\n## Row {.flow}\n```{r} \n#| output: false\n#first half EPV Mao\n#set time period\nEPVHeatMapData1H <- EPVHeatMapData %>%\n  filter(period == 1)\n\n# Calculate average player position\n      Average_Player1H <- EPVHeatMapData1H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n\n#set EPV total for time period\nHomeEPV1H <- sum(EPVHeatMapData1H$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData1H$zone_x <- cut(EPVHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData1H$zone_y <- cut(EPVHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv1H <- EPVHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV1H,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ1H <- average_epv1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ1H <- average_epvNZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV1H,2)))  \n```\n\n```{r}  \n#| output: false\n\n#Second half EPV Map\n#set time period\nEPVHeatMapData2H <- EPVHeatMapData %>%\n  filter(period == 2)\n\n# Calculate average player position\n      Average_Player2H <- EPVHeatMapData2H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nHomeEPV2H <- sum(EPVHeatMapData2H$EPVvalue)\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapData2H$zone_x <- cut(EPVHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapData2H$zone_y <- cut(EPVHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epv2H <- EPVHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPV2H,3)) \n\n#calculate for combined tile and heat map\naverage_epvNZ2H <- average_epv2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_epvNZ2H <- average_epvNZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/HomeEPV2H,2))) \n\n```\n\n```{r}\n#| output: false\n#first half\n#set for time period\nAwayEPVHeatMapData1H <- AwayEPVHeatMapData %>%\n  filter(period == 1)\n\n# Calculate average player position\n      AwayAverage_Player1H <- AwayEPVHeatMapData1H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPV1H <- sum(AwayEPVHeatMapData1H$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapData1H$zone_x <- cut(AwayEPVHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapData1H$zone_y <- cut(AwayEPVHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epv1H <- AwayEPVHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPV1H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZ1H <- Awayaverage_epv1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZ1H <- Awayaverage_epvNZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPV1H,2)))  \n\n```\n\n```{r}\n#| output: false\n#Second half\n#set for time period\nAwayEPVHeatMapData2H <- AwayEPVHeatMapData %>%\n  filter(period == 2)\n\n# Calculate average player position\n      AwayAverage_Player2H <- AwayEPVHeatMapData2H %>% \n        group_by(playerId, player_shirt) %>% \n        summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n        na.omit() %>%\n        mutate(x = (100 - x),\n               y = (100 - y))\n\n#set EPV total for time period\nAwayEPV2H <- sum(AwayEPVHeatMapData2H$EPVvalue)\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapData2H$zone_x <- cut(AwayEPVHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapData2H$zone_y <- cut(AwayEPVHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epv2H <- AwayEPVHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPV2H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZ2H <- Awayaverage_epv2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZ2H <- Awayaverage_epvNZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) %>%\n  mutate(PEPV = 100*(round(avg_epv/AwayEPV2H,2)))  \n```\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat 1st Half\n\nEPVHeatMapplot1H <- EPVHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ1H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n      \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) + \n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nFirst Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Home EPV Heat Map 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| title: Threat 2nd Half\n\nEPVHeatMapplot2H <- EPVHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player2H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZ2H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player2H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n   scale_fill_paletteer_c(ColorScale_HomeC) +\n   scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map \\nSecond Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nEPVHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Home EPV Heat Map 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Threat 1st Half\nAwayEPVHeatMapplot1H <- AwayEPVHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n    \n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZ1H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nFirst Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Away EPV Heat Map 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| height: 100%\n#| title: Threat 2nd Half\nAwayEPVHeatMapplot2H <- AwayEPVHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player2H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n    \n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZ2H, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player2H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map \\nSecond Half\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayEPVHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Away EPV Heat Map 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| output: false\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n```\n\n```{r}\n#| output: false\n#set for time period\nAwayEPVHeatMapDataFTW <- AwayEPVHeatMapData\n\n#set EPV total for time period\nAwayEPVFTW <- sum(AwayEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nAwayEPVFTGP <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataFTW$zone_x <- cut(AwayEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataFTW$zone_y <- cut(AwayEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvFTW <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVFTW,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZFTW <- Awayaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  left_join(AwayEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))\n```\n## Row\n```{r}\nEPVHeatMapplotFTW <- EPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.8, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2,  color = \"black\") +\n  \n  #scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play EPV Heat Map - By Game Period\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Home_Text),\n        strip.background.x = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nEPVHeatMapplotFTW\n```\n```{r}\nAwayEPVHeatMapplotFTW <- AwayEPVHeatMapDataFTW %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.8, adjust = 0.75, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_epvNZFTW, aes(x = x, y = y, label = paste(PEPV, \"%\")), size = 2, color = \"black\") +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #wrap\n  facet_wrap(~Game_Period, ncol = 4) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play EPV Heat Map - By Game Period\"), \n                     subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher, EPV, Box figures = % of Total EPV \\nDirection of Attack Left to Right\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(),\n        strip.text.x = element_text(face = \"bold\", size = 8, colour = Color_Away_Text),\n        strip.background.x = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 1))\n\nAwayEPVHeatMapplotFTW\n```\n## Column {.tabset}\n```{r}\n#| title: EPV Passing Events - Top 5 Home\n#| label: Home Event tables T5\n#| results: asis\n\nEPVPassEventsTop5TableHome <- EPVPassEvents %>%\n  filter(`Successful Passes` == 1,\n    Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsTop5TableHome\n```\n```{r}\n#| title: EPV Passing Events - Bottom 5 Home\n#| label: Home Event tables B5\n#| results: asis\n\nEPVPassEventsBottom5TableHome <- EPVPassEvents %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsBottom5TableHome\n```\n```{r}\n#| title: EPV Carry Events - Top 5 Home\n#| label: Home Carry Event tables T5\n#| results: asis\n\nEPVCarrieEventsTop5TableHome <- EPVCarrieEvents %>%\n  filter(`Successful Carries` == 1,\n         Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsTop5TableHome\n```\n```{r}\n#| title: EPV Carry Events - Bottom 5 Home\n#| label: Home Carry Event tables B5\n#| results: asis\n\nEPVCarrieEventsBottom5TableHome <- EPVCarrieEvents %>%\n  filter(Receiver_Team == Match_Home, \n         Passer_Team == Match_Home) %>%\n      slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Home, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Home_Text), cell_fill(color = Color_Home)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsBottom5TableHome\n```\n## Column {.tabset}\n```{r}\n#| title: EPV Passing Events - Top 5 Away\n#| label: Away Event tables t5\n#| results: asis\n\nEPVPassEventsTop5TableAway <- EPVPassEvents %>%\n    filter(`Successful Passes` == 1,\n           Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n        slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsTop5TableAway\n```\n```{r}\n#| title: EPV Passing Events - Bottom 5 Away\n#| label: Away Event tables b5\n#| results: asis\n\nEPVPassEventsBottom5TableAway <- EPVPassEvents %>%\n    filter(Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n        slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(14,15),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Away,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVPassEventsBottom5TableAway\n```\n```{r}\n#| title: EPV Carry Events - Top 5 Away\n#| label: Away Carry Event tables t5\n#| results: asis\n\nEPVCarrieEventsTop5TableAway <- EPVCarrieEvents %>%\n    filter(`Successful Carries` == 1,\n           Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n      slice_max(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Top 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsTop5TableAway\n```\n```{r}\n#| title: EPV Carry Events - Bottom 5 Away\n#| label: Away Carry Event tables b5\n#| results: asis\n\nEPVCarrieEventsBottom5TableAway <- EPVCarrieEvents %>%\n  filter(Receiver_Team == Match_Away, \n         Passer_Team == Match_Away) %>%\n      slice_min(order_by = EPV, n = 5) %>%\n  gt(rowname_col = \"Receiver\", groupname_col = \"Passer\") %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  cols_align(align = \"right\", columns = everything()) %>%\n  fmt_number(\n    columns = c(10,11),\n    decimals = 3\n   ) %>%\n  cols_hide(columns = c(Passer_Team, Receiver_Team)) %>%\n  tab_header(\n    title = md(paste0(Match_Away, \" Open Play Threat Events\")),\n    subtitle = paste0(Match_Fixture, \" Bottom 5 Events\")) %>%\n  tab_source_note(md(My_caption)) %>%\n  tab_options(\n    heading.padding = px(1),\n    heading.align = \"left\",\n    column_labels.background.color = \"#E5E5E5\",\n    row_group.background.color = Color_Home,\n    stub.background.color = \"#E5E5E5\",\n    column_labels.border.bottom.color = \"black\",\n    summary_row.background.color = \"#E5E5E5\",\n    table.font.size = 14,\n    heading.title.font.size = 16,\n    heading.subtitle.font.size = 14,\n    source_notes.font.size = 8,\n    table.width = \"100%\") %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = Color_Away_Text), cell_fill(color = Color_Away)),\n    locations = cells_row_groups(groups = everything())) %>%\n  tab_style(locations = cells_title(groups = \"title\"),style = list(cell_text(weight = \"bold\", size = 16))) \n\nEPVCarrieEventsBottom5TableAway\n```\n\n# PPDA Analysis\n## Row\n```{r}\n#| output: false\n#| echo: false\n#| warning: false\n#| message: false\n#| label: PPDA setup\nHomePPDAPlotData <- plottingData\n\nHomePPDAPlotData <- HomePPDAPlotData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Home_PPDA_Cumalative), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Home_PPDA_Cumalative = round(Home_PPDA_Cumalative,2)) %>% \n  select(expandedMinute, Home_PPDA_Cumalative, TeamName, Goal_point_X, Goal_point_Y, isGoal, type, minute)\n\ndfHome <- HomePPDAPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    PPDA_roll5 = slide_dbl(Home_PPDA_Cumalative,\n                                 mean,\n                                 .before = 10,   \n                                 .complete = TRUE))  %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n\nAwayPPDAPlotData <- plottingData\n\nAwayPPDAPlotData <- AwayPPDAPlotData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(!Own_Goals == 1) %>%\n  mutate(isGoal = ifelse(type == \"Goal\", 1, 0)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(Away_PPDA_Cumalative), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y),\n         Away_PPDA_Cumalative = round(Away_PPDA_Cumalative,2)) %>% \n  select(expandedMinute, Away_PPDA_Cumalative, TeamName, Goal_point_X, Goal_point_Y, isGoal, type, minute)\n\ndfAway <- AwayPPDAPlotData %>%\n  arrange(expandedMinute) %>%\n  mutate(\n    PPDA_roll5 = slide_dbl(Away_PPDA_Cumalative,\n                           mean,\n                           .before = 10,   \n                           .complete = TRUE)) %>%   \n  mutate(across(everything(), ~replace_na(., 0)))\n\n```\n\n```{r}\n#| label: PPDA over time plot Home\n#| height: 100%\n#| warning: false\n#| message: false\n\nHomePPDATimePlot <- HomePPDAPlotData %>%\n  #canvas\n  ggplot(aes(x = expandedMinute, y = Home_PPDA_Cumalative)) +\n  # smoothed lines\n  geom_smooth(data = dfHome, aes(x = expandedMinute, y = PPDA_roll5), linewidth = 1.2, color = Color_Home, fill = \"snow\") +\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute)), size = 2) +\n  \n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  labs(title = paste(Match_Home, \" PPDA Development\"),\n       subtitle = paste0(Match_Fixture),\n       x = \"Match time (Mins)\",\n       caption = My_caption,\n       y = \"PPDA\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nHomePPDATimePlot\n```\n\n``` {r}\n#| label: PPDA over time plot Away\n#| height: 100%\n#| warning: false\n#| message: false\n\nAwayPPDATimePlot <- AwayPPDAPlotData %>%\n  #canvas\n  ggplot(aes(x = expandedMinute, y = Home_PPDA_Cumalative)) +\n\n  # smoothed lines\n  geom_smooth(data = dfAway, aes(x = expandedMinute, y = PPDA_roll5), linewidth = 1.2, color = Color_Away, fill = \"snow\") +\n  # plot goals by ball image\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  # annotate with goal details\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(type, \"\\nMin:\", minute)), size = 2) +\n  \n  #formatting\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  labs(title = paste(Match_Away, \" PPDA Development\"),\n       subtitle = paste0(Match_Fixture),\n       x = \"Match time (Mins)\",\n       caption = My_caption,\n       y = \"PPDA\") +\n  theme(plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title.x = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.title.y = element_text(colour = \"black\", face = \"bold\", size = 12),\n        axis.text.x = element_text(colour = \"black\", size = 8),\n        axis.text.y = element_text(colour = \"black\", size = 8),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nAwayPPDATimePlot\n\n```\n\n## Row\n\n```{r}  \n#| output: false\nHomePPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(Defensive_Action == 1)\n\n#set time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataFT$zone_x <- cut(HomePPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataFT$zone_y <- cut(HomePPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAFT <- HomePPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAFT,3)) \n\n\n```\n\n```{r}\n#| output: false\n# Plot the tile plot\nPPDAMapplotFT <- ggplot(average_PPDAFT, aes(x = zone_x, y = zone_y, fill = avg_PPDA)) +\n  theme_pitch() +\n  \n  #geometrics\n  geom_tile() +\n  geom_text(aes(label = PPDA, size = 3)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map - Full Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\n#calculate for combined tile and heat map\naverage_PPDANZFT <- average_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZFT <- average_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAFT,2)))  \n\n```\n\n\n```{r}\n#Away PPDA heat plots\n#| output: false\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(Defensive_Action == 1)\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataFT$zone_x <- cut(AwayPPDAHeatMapDataFT$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataFT$zone_y <- cut(AwayPPDAHeatMapDataFT$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAFT <- AwayPPDAHeatMapDataFT %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAFT,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZFT <- Awayaverage_PPDAFT %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZFT <- Awayaverage_PPDANZFT %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAFT,2)))  \n\n```\n\n## Row {.flow}\n```{r}\n#| height: 100%\nHomePPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nFull Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"#E5E5E5\"), \n        legend.key = element_rect(fill = \"#E5E5E5\"))\n\nHomePPDAHeatMapplotFT\n```\n\n```{r}\n#| height: 100%\nAwayPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerFT, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZFT, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nFull Game\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotFT\n\n```\n\n\n```{r} \n#| output: false\n#up to first subs map\n#set time period\nHomePPDAHeatMapData1sub <- HomePPDAHeatMapData %>%\n  filter(expandedMinute <= firstSubHome)\n\n\n#set PPDA total for time period\nHomePPDA1sub <- sum(HomePPDAHeatMapData1sub$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapData1sub$zone_x <- cut(HomePPDAHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapData1sub$zone_y <- cut(HomePPDAHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDA1sub <- HomePPDAHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDA1sub,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZ1sub <- average_PPDA1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZ1sub <- average_PPDANZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDA1sub,2)))  \n```\n\n```{r} \n#| output: false\n#Post first subs map\n#set time period\nHomePPDAHeatMapDataP1sub <- HomePPDAHeatMapData %>%\n  filter(expandedMinute > firstSubHome)\n\n\n#set PPDA total for time period\nHomePPDAP1sub <- sum(HomePPDAHeatMapDataP1sub$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapDataP1sub$zone_x <- cut(HomePPDAHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapDataP1sub$zone_y <- cut(HomePPDAHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDAP1sub <- HomePPDAHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDAP1sub,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZP1sub <- average_PPDAP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZP1sub <- average_PPDANZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDAP1sub,2)))  \n```\n\n```{r}\n#| output: false\n#| label: first subs away ppda\n#set for time period\nAwayPPDAHeatMapData1sub <- AwayPPDAHeatMapData %>%\n  filter(expandedMinute <= firstSubAway)\n\n\n#set PPDA total for time period\nAwayPPDA1sub <- sum(AwayPPDAHeatMapData1sub$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapData1sub$zone_x <- cut(AwayPPDAHeatMapData1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapData1sub$zone_y <- cut(AwayPPDAHeatMapData1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDA1sub <- AwayPPDAHeatMapData1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDA1sub,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZ1sub <- Awayaverage_PPDA1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZ1sub <- Awayaverage_PPDANZ1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDA1sub,2)))  \n```\n\n```{r}\n#| output: false\n#post first subs\n#set for time period\nAwayPPDAHeatMapDataP1sub <- AwayPPDAHeatMapData %>%\n  filter(expandedMinute > firstSubAway)\n\n#set PPDA total for time period\nAwayPPDAP1sub <- sum(AwayPPDAHeatMapDataP1sub$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapDataP1sub$zone_x <- cut(AwayPPDAHeatMapDataP1sub$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapDataP1sub$zone_y <- cut(AwayPPDAHeatMapDataP1sub$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDAP1sub <- AwayPPDAHeatMapDataP1sub %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDAP1sub,3)) \n\n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZP1sub <- Awayaverage_PPDAP1sub %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZP1sub <- Awayaverage_PPDANZP1sub %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDAP1sub,2)))  \n```\n\n\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Defensive actions to 1st Sub\n#| height: 100%\nHomePPDAHeatMapplot1sub <- HomePPDAHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nUp to first subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplot1sub\n```\n\n```{r}\n#| height: 100%\n#| title: Defensive actions Post 1st Sub\nHomePPDAHeatMapplotP1sub <- HomePPDAHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_PlayerP1Sub, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZP1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nPost 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplotP1sub\n\n```\n### column {.tabset}\n```{r}\n#| height: 100%\n#| title: Defensive actions to 1st Sub\nAwayPPDAHeatMapplot1sub <- AwayPPDAHeatMapData1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZ1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nUp to 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplot1sub\n```\n\n```{r}\n#| height: 100%\n#| title: Defensive actions Post 1st Sub\nAwayPPDAHeatMapplotP1sub <- AwayPPDAHeatMapDataP1sub %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_PlayerP1Sub, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZP1sub, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_PlayerP1Sub, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nPost 1st Subs\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplotP1sub\n```\n\n## Row {.flow}\n```{r} \n#| output: false\n#first half PPDA Mao\n#set time period\nHomePPDAHeatMapData1H <- HomePPDAHeatMapData %>%\n  filter(period == 1)\n\n#set PPDA total for time period\nHomePPDA1H <- sum(HomePPDAHeatMapData1H$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapData1H$zone_x <- cut(HomePPDAHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapData1H$zone_y <- cut(HomePPDAHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDA1H <- HomePPDAHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDA1H,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZ1H <- average_PPDA1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZ1H <- average_PPDANZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDA1H,2)))  \n```\n\n```{r}  \n#| output: false\n\n#Second half PPDA Map\n#set time period\nHomePPDAHeatMapData2H <- HomePPDAHeatMapData %>%\n  filter(period == 2)\n\n#set PPDA total for time period\nHomePPDA2H <- sum(HomePPDAHeatMapData2H$Home_Defensive_Action)\n\n# Create a new variable to represent the zone for each observation\nHomePPDAHeatMapData2H$zone_x <- cut(HomePPDAHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nHomePPDAHeatMapData2H$zone_y <- cut(HomePPDAHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\naverage_PPDA2H <- HomePPDAHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Home_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/HomePPDA2H,3)) \n\n#calculate for combined tile and heat map\naverage_PPDANZ2H <- average_PPDA2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\naverage_PPDANZ2H <- average_PPDANZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/HomePPDA2H,2))) \n\n```\n\n```{r}\n#| output: false\n#first half\n#set for time period\nAwayPPDAHeatMapData1H <- AwayPPDAHeatMapData %>%\n  filter(period == 1)\n\n#set PPDA total for time period\nAwayPPDA1H <- sum(AwayPPDAHeatMapData1H$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapData1H$zone_x <- cut(AwayPPDAHeatMapData1H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapData1H$zone_y <- cut(AwayPPDAHeatMapData1H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDA1H <- AwayPPDAHeatMapData1H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDA1H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZ1H <- Awayaverage_PPDA1H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZ1H <- Awayaverage_PPDANZ1H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDA1H,2)))  \n\n```\n\n```{r}\n#| output: false\n#| label: Second half away PPDA\n\n#set for time period\nAwayPPDAHeatMapData2H <- AwayPPDAHeatMapData %>%\n  filter(period == 2)\n\n#set PPDA total for time period\nAwayPPDA2H <- sum(AwayPPDAHeatMapData2H$Away_Defensive_Action)\n\n\n# Create a new variable to represent the zone for each observation\nAwayPPDAHeatMapData2H$zone_x <- cut(AwayPPDAHeatMapData2H$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayPPDAHeatMapData2H$zone_y <- cut(AwayPPDAHeatMapData2H$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average PPDA for each zone\nAwayaverage_PPDA2H <- AwayPPDAHeatMapData2H %>%\n  group_by(zone_x, zone_y) %>%\n  summarize(avg_PPDA = sum(Away_Defensive_Action, na.rm = TRUE)) %>%\n  mutate(avg_PPDA = round(ifelse(avg_PPDA < 0, abs(avg_PPDA), avg_PPDA), 3),\n         PPDA = round(avg_PPDA/AwayPPDA2H,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_PPDANZ2H <- Awayaverage_PPDA2H %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_PPDANZ2H <- Awayaverage_PPDANZ2H %>%\n  group_by(x, y) %>%\n  summarise(avg_PPDA = sum(avg_PPDA, na.rm = TRUE)) %>%\n  mutate(PPDA = 100*(round(avg_PPDA/AwayPPDA2H,2)))  \n```\n### column {.tabset}\n```{r}\n#| title: Defensive actions 1st Half\n#| height: 100%\n\nHomePPDAHeatMapplot1H <- HomePPDAHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player1H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZ1H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player1H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) + \n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nFirst Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Home DA Heat map 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: Defensive actions 2nd Half\n#| height: 100%\n\nHomePPDAHeatMapplot2H <- HomePPDAHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = AwayAverage_Player2H, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = average_PPDANZ2H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = AwayAverage_Player2H, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  scale_color_paletteer_d(ColorScale_Home) + \n  \n  #formatting\n  labs(title = paste0(Match_Home,\" Open Play Defensive Actions Heat Map \\nSecond Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nHomePPDAHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Home DA Heat map 2nd half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Defensive actions 1st Half\n#| height: 100%\nAwayPPDAHeatMapplot1H <- AwayPPDAHeatMapData1H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player1H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZ1H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player1H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nFirst Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplot1H\n\n#save Plot\nggsave(path = Vizlocation, \"Away DA Heat map 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n```{r}\n#| title: Defensive actions 2nd Half\n#| height: 100%\nAwayPPDAHeatMapplot2H <- AwayPPDAHeatMapData2H %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  geom_point(data = Average_Player2H, aes(x, y), fill = Color_Home, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  # add zone percentage numbers\n  geom_text(data = Awayaverage_PPDANZ2H, aes(x = x, y = y, label = paste(PPDA, \"%\")), size = 4) +\n  \n  #plot player names\n  geom_text(data = Average_Player2H, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #set scales\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  scale_color_paletteer_d(ColorScale_Away) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\" Open Play Defensive Actions Heat Map \\nSecond Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nBox figures = % of Total DA, \\nDirection of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank())\n\nAwayPPDAHeatMapplot2H\n\n#save Plot\nggsave(path = Vizlocation, \"Away DA Heat map 2nd half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n## Row {.flow}\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: PPDS Post pass or carries setup\n\n#filter by da following pass or carries\nHome_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, TeamName, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nHome_Post_DA_Passes <- Home_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,TeamName == Match_Home) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)),\n         Prog_Action = as.numeric(Prog_Action))\n\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Home_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nHome_Post_DA_Passes <- shift_column(data = Home_Post_DA_Passes, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\n\nHomePPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Home) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n         \n#set for time period\nHomePPDAHeatMapDataFT <- HomePPDAHeatMapData\n\n\n# Calculate average player position\nAverage_PlayerFT <- HomePPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n#set PPDA total for time period\nHomePPDAFT <- sum(HomePPDAHeatMapDataFT$Home_Defensive_Action)\n\n#filter by da following pass\nAway_Post_DA_Passes <- plottingData %>%\n  select(period, period_displayName, TeamName, playerId, player_shirt, Prog_Passes, Prog_Carries, Attempted_Passes, Successful_Passes, Successful_Long_Passes, Attempted_Carries, Successful_Carries, x, y, finalX, finalY, Prev_Defensive_Action, EPVvalue, EPVStart, EPVEnd)\n\nAway_Post_DA_Passes <- Away_Post_DA_Passes %>%\n  filter(Prev_Defensive_Action == 1\n         ,TeamName == Match_Away) %>%\n  mutate(Pass_or_Carrie = ifelse(Successful_Passes == 1, 1, 0),\n         Prog_Action = ifelse(Prog_Passes == 1 | Prog_Carries == 1, 1, 0)) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                          period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                          TRUE ~ as.character(period_displayName)))\n\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"playerId\", new_names = \"receiver\", len = 1, up = TRUE)\n  Away_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"player_shirt\", new_names = \"receiver_shirt\", len = 1, up = TRUE)\nAway_Post_DA_Passes <- shift_column(data = Away_Post_DA_Passes, columns = \"TeamName\", new_names = \"receiver_team\", len = 1, up = TRUE)\n\n\nAwayPPDAHeatMapData <- plottingData %>%\n  filter(TeamName == Match_Away) %>%\n  filter(Defensive_Action == 1) %>%\n  mutate(period_displayName = case_when(period_displayName == \"FirstHalf\" ~ \"First Half\",\n                                        period_displayName == \"SecondHalf\" ~ \"Second Half\",\n                                        TRUE ~ as.character(period_displayName)))\n\n#set for time period\nAwayPPDAHeatMapDataFT <- AwayPPDAHeatMapData\n\n# Calculate average player position\nAway_Average_PlayerFT <- AwayPPDAHeatMapDataFT %>% \n  group_by(playerId, player_shirt) %>% \n  summarise(x = mean(x, na.rm = TRUE), y = mean(y, na.rm = TRUE), events = n()) %>% \n  na.omit()\n\n\n#set PPDA total for time period\nAwayPPDAFT <- sum(AwayPPDAHeatMapDataFT$Away_Defensive_Action)\n\n```\n### column {.tabset}\n```{r}\n#| title: Post DA 1st Half\n#| label: Home Post DA Plot 1st Half\n\nHome_Post_DA_Passes_1st <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"First Half\") \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n    #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| title: Post DA 2nd Half\n#| label: Home Post DA Plot 2nd Half\n\nHome_Post_DA_Passes_2nd <- Home_Post_DA_Passes %>%\n    filter(period_displayName == \"Second Half\") \n\nHomePostPPDAHeatMapplotFT <- HomePPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player + shirt for DA win\n  #geom_text(data = Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Home_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Home_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Home, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Home_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Home_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  \n  #formatting\n  labs(title = paste(Match_Home,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Home_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Home, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nHomePostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Home Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Post DA 1st Half\n#| label: Away Post DA Plot 1st Half\nAway_Post_DA_Passes_1st <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"First Half\")\n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n    filter(period_displayName == \"First Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_1st,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_1st, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 1st Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#| title: Post DA 2nd Half\n#| label: Away Post DA Plot 2nd Half\n\nAway_Post_DA_Passes_2nd <- Away_Post_DA_Passes %>%\n  filter(period_displayName == \"Second Half\")\n\nAwayPostPPDAHeatMapplotFT <- AwayPPDAHeatMapDataFT %>%\n  filter(period_displayName == \"Second Half\") %>%\n  ggplot(aes(x = x, y = y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n  geom_tile() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  #geometrics\n  #plot player positions\n  #geom_point(data = Away_Average_PlayerFT, aes(x, y), fill = Color_Away, size = 8, shape = 21, colour = \"black\", stroke = 0.5, alpha = 0.4) +\n  \n  #plot heat map\n  stat_density_2d(aes(#color = after_stat(level), \n    fill = after_stat(level)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  \n  #plot player names\n  #geom_text(data = Away_Average_PlayerFT, aes(x, y, label = player_shirt), color = Color_Away_Text, size = 4) +\n  \n  #plot next pass or carrie\n  geom_link(data = Away_Post_DA_Passes_2nd,\n               aes( x = x, y = y, xend = finalX, yend = finalY, \n                    color = Prog_Action, \n                    alpha = stat(index),\n                    size = after_stat(index)\n                    ),\n            show.legend = NA,\n            inherit.aes = TRUE\n  ) +\n  \n  #plot recieving player from DA\n  geom_point(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, color = Prog_Action), fill = Color_Away, size = 4, shape = 21, stroke = 0.5, alpha = 0.8) +\n  \n  geom_text(data = Away_Post_DA_Passes_2nd, aes(x = finalX, y = finalY, label = receiver_shirt), color = Color_Away_Text, size = 2) +\n  \n  scale_colour_gradientn(\n    colors = c(\"#0000FF\", \"#BD1100\"),\n    values = scales::rescale(c(0, 1)), \n    breaks = scales::breaks_width(0.01), \n    name = \"Progressive Pass\") +\n  \n  #set scales\n  scale_size(range = c(0.5, 2)) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n\n  #wrap by half\n  #facet_wrap(~period_displayName) +\n  \n  #formatting\n  labs(title = paste(Match_Away,\"Passes or Carries Post Successful DA - 2nd Half\"), \n       subtitle = paste0(Match_Fixture,\"  \\nIncreased Colour = Higher Defensive Actions (DA), \\nComets: Red = Progressive or Blue = Successful, \\nCircle Number = Recieving player, Direction of Attack Right to Left\"),\n       caption =  My_caption) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        legend.position = \"none\", \n        legend.background = element_blank(), \n        legend.key = element_blank(), \n        strip.text = element_text(size = 10, colour = Color_Away_Text, face = \"bold\"),\n        strip.background = element_rect(fill = Color_Away, color = \"black\", linetype = \"solid\", linewidth = 0.5))\n\nAwayPostPPDAHeatMapplotFT\n\n#save Plot\nggsave(path = Vizlocation, \"Away Post PD 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n```\n\n```{r}\n#wrapped home plot\n#set time period\nEPVHeatMapDataFTW <- EPVHeatMapData\n\n#set EPV total for time period\nHomeEPVFTW <- sum(EPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nHomeEPVFTGP <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n# Create a new variable to represent the zone for each observation\nEPVHeatMapDataFTW$zone_x <- cut(EPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nEPVHeatMapDataFTW$zone_y <- cut(EPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\naverage_epvFTW <- EPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/HomeEPVFTW,3)) \n\n\n#calculate for combined tile and heat map\naverage_epvNZFTW <- average_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  left_join(HomeEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)\n\naverage_epvNZFTW <- average_epvNZFTW %>%\n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n\n```\n\n```{r}\n#set for time period\nAwayEPVHeatMapDataFTW <- AwayEPVHeatMapData\n\n#set EPV total for time period\nAwayEPVFTW <- sum(AwayEPVHeatMapDataFTW$EPVvalue)\n\n#set EPV total for time period by game period\nAwayEPVFTGP <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period) %>%\n  summarise(TEPVGP = sum(EPVvalue))\n\n\n# Create a new variable to represent the zone for each observation\nAwayEPVHeatMapDataFTW$zone_x <- cut(AwayEPVHeatMapDataFTW$x, breaks = c(0, 17, 33.2, 50, 66.4, 83, 100), include.lowest = TRUE)\nAwayEPVHeatMapDataFTW$zone_y <- cut(AwayEPVHeatMapDataFTW$y, breaks = c(0, 21.1, 36.8, 63.2, 78.9, 100), include.lowest = TRUE)\n\n# Calculate average EPV for each zone\nAwayaverage_epvFTW <- AwayEPVHeatMapDataFTW %>%\n  group_by(Game_Period, zone_x, zone_y) %>%\n  summarize(avg_epv = sum(EPVvalue, na.rm = TRUE)) %>%\n  mutate(avg_epv = round(ifelse(avg_epv < 0, abs(avg_epv), avg_epv), 3),\n         PEPV = round(avg_epv/AwayEPVFTW,3)) \n\n#calculate for combined tile and heat map\nAwayaverage_epvNZFTW <- Awayaverage_epvFTW %>%\n  mutate(x = ifelse(zone_x == \"[0,17]\", 8.5,\n                    ifelse(zone_x == \"(17,33.2]\", 25.1,\n                           ifelse(zone_x == \"(33.2,50]\", 41.6,\n                                  ifelse(zone_x == \"(50,66.4]\", 58.2,\n                                         ifelse(zone_x == \"(66.4,83]\", 74.7,\n                                                ifelse(zone_x == \"(83,100]\", 91.5, NA))))))) %>%\n  mutate(y = ifelse(zone_y == \"[0,21.1]\", 10,\n                    ifelse(zone_y == \"(21.1,36.8]\", 30,\n                           ifelse(zone_y == \"(36.8,63.2]\", 50,\n                                  ifelse(zone_y == \"(63.2,78.9]\", 70,\n                                         ifelse(zone_y == \"(78.9,100]\", 90, NA))))))\n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  group_by(Game_Period, x, y) %>%\n  summarise(avg_epv = sum(avg_epv, na.rm = TRUE)) \n\nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%\n  left_join(AwayEPVFTGP, by = c('Game_Period' = 'Game_Period'), copy = TRUE)  \n  \nAwayaverage_epvNZFTW <- Awayaverage_epvNZFTW %>%  \n  mutate(PEPV = 100*(round(avg_epv/TEPVGP,2)))  \n\n```\n\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| label: home team off ball touch plot subs\n#| title: Off ball touch map to 1st subs\n\n\nHometouchPlot1Sub <- TouchTeamPlot_OPTA(HomePPDAHeatMapData,  title = paste0(Match_Home, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = firstSubHome, color = Color_Home, logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nHometouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Off Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: home team off ball touch plot 1st half\n#| title: Off ball touch map to 1st half\n\n\nHometouchPlot1half <- TouchTeamPlot_OPTA(HomePPDAHeatMapData,  title = paste0(Match_Home, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = 45, color = Color_Home, logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 1st Half\"))\nHometouchPlot1half\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Off Ball Touch Zones 1st Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: home team off ball touch plot 2 half\n#| title: Off ball touch map to 2nd half\n\n\nHometouchPlot2half <- TouchTeamPlot_OPTA(HomePPDAHeatMapData,  title = paste0(Match_Home, \" Team Off Ball Touch\"),\n                                     plot_start = 50, plot_finish = 110, color = Color_Home,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 2nd half\"))\nHometouchPlot2half\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Off Ball Touch Zones 2nd Half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n### column {.tabset}\n```{r}\n#| label: Away team off ball touch plot subs\n#| title: Off ball touch map to 1st subs\n\nAwaytouchPlot1Sub <- TouchTeamPlot_OPTA(AwayPPDAHeatMapData,  title = paste0(Match_Away, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = firstSubAway, color = Color_Away,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" Up to 1st Sub\"))\nAwaytouchPlot1Sub\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Off Ball Touch Zones 1st Sub.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: Away team off ball touch plot 1 half\n#| title: Off ball touch map to 1st Half\n\nAwaytouchPlot1half <- TouchTeamPlot_OPTA(AwayPPDAHeatMapData,  title = paste0(Match_Away, \" Team Off Ball Touch\"),\n                                     plot_start = 00, plot_finish = 45, color = Color_Away,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 1st Half\"))\nAwaytouchPlot1half\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Off Ball Touch Zones 1st half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n```{r}\n#| label: Away team off ball touch plot 2 half\n#| title: Off ball touch map 2nd Half\n\nAwaytouchPlot2half <- TouchTeamPlot_OPTA(AwayPPDAHeatMapData,  title = paste0(Match_Away, \" Team Off Ball Touch\"),\n                                     plot_start = 50, plot_finish = 110, color = Color_Away,  logo = \"\",\n                                     subtitle = paste0(Match_Fixture, \" 2nd Half\"))\nAwaytouchPlot2half\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Off Ball Touch Zones 2nd half.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\n```\n\n# xG & Shot Analysis\n```{r}\n#| output: false\n#| echo: false\n#| message: false\n#| warning: false\n#| label: xG setup\n\n#Load home data\ndashboard_data <- plottingData\n\ndashboard_data <- dashboard_data %>%\n  filter(TeamName == Match_Home) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, OTShots, minute, expandedMinute, result = type, player = playerId, period, Game_Period)\n\n#Load away data\nAwaydashboard_data <- plottingData\n\nAwaydashboard_data <- Awaydashboard_data %>%\n  filter(TeamName == Match_Away) %>%\n  filter(TotalShots == 1) %>%\n  filter(!Own_Goals == 1) %>%\n  filter(!situation == \"NA\") %>%\n  mutate(TotalxG = cumsum(xG)) %>%\n  mutate(TotalNPxG = cumsum(NPxG)) %>%\n  mutate(TotalxGOT = cumsum(xGOT)) %>%\n  mutate(Goal_point_X = ifelse(str_detect(Goals, \"1\"), paste0(expandedMinute), NA)) %>%\n  mutate(Goal_point_Y = ifelse(str_detect(Goals, \"1\"), paste0(TotalxG), NA)) %>%\n  mutate(Goal_point_X = as.numeric(Goal_point_X)) %>%\n  mutate(Goal_point_Y = as.numeric(Goal_point_Y)) %>%\n  select(X = x, Y = y, Goal_point_Y, Goal_point_X, TotalxG, TotalNPxG, TotalxGOT, situation, TeamName, TotalShots, xG, NPxG, xGOT, OTShots, minute, expandedMinute, result = type, player = playerId, period, Game_Period)\n\n```\n\n\n## Row\n\n```{r home xG line}\n\n# Line Plot\n\n  xGLinePlot <- dashboard_data %>%\n    ggplot() +\n  #Geometrics\n  #xg line\n  geom_line(aes(x = expandedMinute, y = TotalxG), linewidth = 2, colour = Color_Home) +\n  \n  #npXg line\n  geom_line(aes(x = expandedMinute, y = TotalNPxG), linewidth = 1, colour = Color_Home, linetype = \"dashed\") +\n  \n  #xGOT line\n  geom_line(aes(x = expandedMinute, y = TotalxGOT), linewidth = 1, colour = \"ivory4\") +\n  \n  #add ball image for goals\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(result, \" Min:\", expandedMinute, \"\\nxG:\", xG)), size = 2) +\n\n  #formatting\n  expand_limits(x = 0, y = 0) +\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 6), breaks = seq(0, 6, 0.2)) +\n  labs(x = \"Match Time (mins)\", \n       y = \"xG, NPxG, xGOT\",\n       title = paste0(Match_Home, \" \", xGlineTitle_text),\n       caption = My_caption,\n       subtitle = paste0(Match_Fixture))  +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(size = 12),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(size = 8),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        legend.position = \"none\",\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nxGLinePlot\n\n```\n\n```{r away xG line}\n# Line Plot\n#canvas\nxGLinePlotAway <- Awaydashboard_data %>%\n  ggplot() +\n  \n  #Geometrics\n  #plot xg line\n  geom_line(aes(x = expandedMinute, y = TotalxG), linewidth = 2, colour = Color_Away) +\n  \n  #npXg line\n  geom_line(aes(x = expandedMinute, y = TotalNPxG), linewidth = 1, colour = Color_Away, linetype = \"dashed\") +\n  \n  #xGOT line\n  geom_line(aes(x = expandedMinute, y = TotalxGOT), linewidth = 1, colour = \"ivory4\") +\n  \n  #add ball image for goals\n  geom_image(inherit.aes = FALSE, mapping = aes(x = Goal_point_X, y = Goal_point_Y, image = \"~/Documents/Dropbox files/AI LFC data/Icons/ball2.png\"), size = 0.05) +\n  geom_label_repel(aes(x = Goal_point_X, y = Goal_point_Y, label = paste0(result, \" Min:\", expandedMinute, \"\\nxG:\", xG)), size = 2) +\n  \n\n  #formatting\n  expand_limits(x = 0, y = 0) +\n  scale_x_continuous(breaks = seq(0, 135, 15)) +\n  scale_y_continuous(limits = c(0, 6), breaks = seq(0, 6, 0.2)) +\n  labs(x = \"Match Time (mins)\", \n       y = \"xG, NPxG, xGOT\",\n       title = paste0(Match_Away, \" \", AwayxGlineTitle_text), \n       caption = My_caption,\n       subtitle = paste0(Match_Fixture))  +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_blank(),\n        plot.title = element_markdown(),\n        plot.caption = element_markdown(),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(size = 12),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(size = 8),\n        text = element_text(color = \"gray12\", family = \"Arial\"),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_blank())\n\nxGLinePlotAway\n```\n\n## Row\n\n```{r home density plot}\n\n# Density Shot Map\n#canvas\nxGDensityPlot <- dashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) +\n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  scale_color_paletteer_c(ColorScale_HomeC) +\n  scale_fill_paletteer_c(ColorScale_HomeC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Home,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture, \"\\nDarker Colour + Tighter Lines = Higher xG\"),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n       caption = My_caption,\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        plot.caption = element_markdown(),\n        legend.position = \"none\",\n        legend.direction = \"horizontal\",\n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nxGDensityPlot_I <- ggplotly(xGDensityPlot, tooltip = \"text\")\n\nxGDensityPlot_I <- xGDensityPlot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\n#xGDensityPlot_I\nxGDensityPlot\n\n```\n\n```{r away density plot}\n\n# Density Shot Map\n\n#canvas\nxGDensityPlotAway <- Awaydashboard_data %>%\n  ggplot(aes(x = X, y = Y)) +\n  annotate_pitch(dimensions = pitch_opta, fill = \"#E5E5E5\", colour = \"#454545\") +\n  theme_pitch() +\n          annotate(\"segment\", y = c(21.1, 36.8, 63.2, 78.9), yend = c(21.1, 36.8, 63.2, 78.9), x = 0, xend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n        annotate(\"segment\", x = c(17, 33.2, 50, 66.4, 83), xend = c(17, 33.2, 50, 66.4, 83), y = 0, yend = 100, linetype = \"longdash\", linewidth = 0.3, colour = \"#95A5A6\") +\n  \n  # add zone numbers\n  geom_text(aes(y = 50, x = 74.7, label = \"14\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 71.05, x = 74.7, label = \"LHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  geom_text(aes(y = 28.95, x = 74.7, label = \"RHS\"), size = 3, color = \"grey\", show.legend = FALSE) +\n  \n  #make half pitch\n  coord_flip(xlim = c(50, 100),\n                   ylim = c(100, 00)) + \n  #geometrics\n  stat_density_2d(aes(fill = after_stat(level), text = paste(\"xG: \", ..level..)), geom = \"polygon\", alpha = 0.5, adjust = 0.5, linewidth = 0.5) +\n  scale_color_paletteer_c(ColorScale_AwayC) +\n  scale_fill_paletteer_c(ColorScale_AwayC) +\n  guides(fill = guide_legend(title = \"xG Level\")) +\n  guides(color = guide_legend(title = \"xG Level\")) +\n  scale_size_continuous(range = c(0.5, 7)) +\n  \n  #formatting\n  labs(title = paste0(Match_Away,\" xG Density Areas\"), \n       subtitle = paste0(Match_Fixture, \"\\nDarker Colour + Tighter Lines = Higher xG\"),\n       fill = \"xG Level\",\n       color = \"xG Level\",\n       caption = My_caption,\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),        \n        plot.caption = element_markdown(),\n        legend.position = \"none\", \n        legend.direction = \"horizontal\", \n        legend.background = element_rect(fill = \"snow\"), \n        legend.key = element_rect(fill = \"snow\"))\n\nxGDensityPlotAway_I <- ggplotly(xGDensityPlotAway, tooltip = \"text\")\n\nxGDensityPlotAway_I <- xGDensityPlotAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\n#xGDensityPlotAway_I\nxGDensityPlotAway\n```\n\n\n\n## Row\n\n```{r home bubble plot}\n\nShotBubblexG_data <- plottingData \n\nShotBubblexG_data <- ShotBubblexG_data %>%\n  filter(TeamName == Match_Home)\n\nShotBubblexG_data <- ShotBubblexG_data %>%\ngroup_by(expandedMinute, Game_Period) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGBubblePlot_data <- ShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGBubblePlot_data <- xGBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),\n  )  \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGBubblePlot_data_pivot <- xGBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  xGBubble_Plot <- xGBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n\n  #colors\n  #scale_fill_paletteer_d(ColorScale_Home, 1) +\n  scale_fill_paletteer_c(ColorScale_HomeC, 1) +\n  \n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 5)) +\n  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, 1)) +\n\n  #formatting\n  labs(title = paste0(Match_Home, \" xG (Circles) & EPV (Diamonds) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         caption = My_caption,\n         x = \"Passes\",\n         y = \"Shots\") +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nxGBubble_Plot_I  <- ggplotly(xGBubble_Plot, tooltip = \"text\")\n\nxGBubble_Plot_I <- xGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGBubble_Plot_I\n#xGBubble_Plot\n```\n\n```{r away bubble plot}\n\nAwayShotBubblexG_data <- plottingData \n\nAwayShotBubblexG_data <- AwayShotBubblexG_data %>%\n  filter(TeamName == Match_Away)\n\nAwayShotBubblexG_data <- AwayShotBubblexG_data %>%\n  group_by(expandedMinute, Game_Period) %>%\n  summarize(\nAttempted_Passes = sum(Attempted_Passes),\nTouches = sum(Touches),\nOFShots = sum(OFShots),\nOTShots = sum(OTShots),\nGoals = sum(Goals),\nxG = sum(xG),\nEPV = sum(EPV),\nTotalShots = sum(TotalShots),) %>%\n  filter(OFShots > 0 | OTShots > 0 | Goals > 0 )\n\nxGAwayBubblePlot_data <- AwayShotBubblexG_data %>% \n  select(Game_Period, expandedMinute, Attempted_Passes, Touches, OFShots, OTShots, Goals, xG, EPV)\n\nxGAwayBubblePlot_data <- xGAwayBubblePlot_data %>%\n  group_by(Game_Period) %>%\n  mutate(xG = round(xG,2)) %>%\n  mutate(EPV = round(EPV,2)) %>%\n  summarize(\n    Attempted_Passes = sum(Attempted_Passes),\n    Touches = sum(Touches),\n    OFShots = sum(OFShots),\n    OTShots = sum(OTShots),\n    Goals = sum(Goals),\n    xG = sum(xG),\n    EPV = sum(EPV),\n    TotalShots = sum(OFShots + OTShots + Goals),) \n\n#set plot size range\nsizeRange <- c(2, 10)\n\n# change data to enable shape to be defined \n  xGAwayBubblePlot_data_pivot <- xGAwayBubblePlot_data %>%\n  pivot_longer(cols = c(\"EPV\", \"xG\"), names_to = \"Metric\", values_to = \"Value\") %>%\n      mutate(Shape = ifelse(Metric == \"xG\", \"Circle\", \"Diamond\"))\n  \n  #load final data frame for plot\n  AwayxGBubble_Plot <- xGAwayBubblePlot_data_pivot %>%\n  \n  #Canvas      \n  ggplot(aes(x = Attempted_Passes, y = TotalShots, size = Value, fill = Value, text = paste(Metric, \": \", Value, \"\\nTime Period: \", Game_Period))) +\n  \n  #geometrics  \n  geom_point(aes(shape = Metric), colour = \"black\", stroke = 0.3, alpha = 0.7) +\n  scale_shape_manual(values = c( \"xG\" = 21, \"EPV\" = 23)) +  # Assign different shapes\n    \n  #colors\n  #scale_fill_paletteer_d(ColorScale_Away, -1) +\n  scale_fill_paletteer_c(ColorScale_AwayC, 1) +\n\n  #Scale and limits\n  scale_size(range = sizeRange) +\n  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 5)) +\n  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, 1)) +\n\n  #formatting\n  labs(title = paste0(Match_Away, \" xG (Circle) & EPV (Diamond) Creation by Time Period\"),\n         subtitle = paste0(Match_Fixture),\n         x = \"Passes\",\n         y = \"Shots\",\n         caption = My_caption\n       ) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.caption = element_markdown(),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        plot.title = element_text(colour = \"black\", size = 14, face = \"bold\"),\n        plot.title.position = \"plot\",\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        panel.grid.major = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.x = element_line(colour = \"#454545\", size = 0.4, linetype = \"dashed\"),\n        panel.grid.minor.y = element_blank(),\n        legend.position = \"none\", \n        legend.direction = \"vertical\",\n        legend.background = element_blank(),\n        legend.key = element_blank())\n\nAwayxGBubble_Plot_I  <- ggplotly(AwayxGBubble_Plot, tooltip = \"text\")\n\nAwayxGBubble_Plot_I <- AwayxGBubble_Plot_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nAwayxGBubble_Plot_I\n#AwayxGBubble_Plot\n\n```\n\n## Row\n### column {.tabset}\n```{r}\n#| title: Full Time xG Situation\n#| label: Home Situation plot ft\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n#xGSituationBar\n\n```\n```{r}\n#| title: 1st Half xG Situation\n#| label: Home Situation plot 1h\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n    filter(period == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n#xGSituationBar\n\n```\n\n```{r}\n#| title: 2nd Half xG Situation\n#| label: Home Situation plot 2h\n# Bar Plot\n\nxGSituationBarData <- dashboard_data %>%\n  filter(period == 2) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n  \n  #canvas\nxGSituationBar <- xGSituationBarData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Home, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Home,\" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\nxGSituationBar_I <- ggplotly(xGSituationBar, tooltip = \"xG\")\n\nxGSituationBar_I <- xGSituationBar_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBar_I\n#xGSituationBar\n\n```\n\n### column {.tabset}\n```{r}\n#| title: Full Time xG Situation\n#| label: Away Situation plot ft\n# Bar Plot\nxGSituationBarAwayData <- Awaydashboard_data %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarAway <- xGSituationBarAwayData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarAway_I <- ggplotly(xGSituationBarAway, tooltip = \"xG\")\n\nxGSituationBarAway_I <- xGSituationBarAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarAway_I\n#xGSituationBarAway\n```\n```{r}\n#| title: 1st Half  xG Situation\n#| label: Away Situation plot 1h\n# Bar Plot\nxGSituationBarAwayData <- Awaydashboard_data %>%\n  filter(period == 1) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarAway <- xGSituationBarAwayData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarAway_I <- ggplotly(xGSituationBarAway, tooltip = \"xG\")\n\nxGSituationBarAway_I <- xGSituationBarAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarAway_I\n#xGSituationBarAway\n```\n\n```{r}\n#| title: 2nd Half xG Situation\n#| label: Away Situation plot 2nd\n# Bar Plot\nxGSituationBarAwayData <- Awaydashboard_data %>%\n  filter(period == 2) %>%\n    group_by(situation) %>%\n  summarize(\n    xG = sum(xG))\n\n#canvas\nxGSituationBarAway <- xGSituationBarAwayData %>%\n  ggplot(aes(x = xG, y = situation)) +\n  \n  #Geometrics\n  geom_bar(stat = \"identity\", fill = Color_Away, colour = \"#454545\") +\n  \n  #formatting\n  labs(y = \"\", \n       x = \"xG\",\n       title = paste0(Match_Away, \" xG Creation By Situation\"), \n       subtitle = paste0(Match_Fixture)) +\n  theme(plot.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        panel.background = element_rect(colour = \"snow\", fill = \"snow\"),\n        axis.title = element_text(colour = \"gray12\", size = 12),\n        axis.text = element_text(colour = \"black\", size = 10),\n        plot.title = element_text(colour = \"black\", face = \"bold\", size = 14),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_text(colour = \"black\", size = 12),\n        panel.grid.major = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"),\n        panel.grid.minor = element_line(colour = \"#454545\", linewidth = 0.4, linetype = \"dashed\"))\n\n\n\nxGSituationBarAway_I <- ggplotly(xGSituationBarAway, tooltip = \"xG\")\n\nxGSituationBarAway_I <- xGSituationBarAway_I %>%\nconfig(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d','select2d',  'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nxGSituationBarAway_I\n#xGSituationBarAway\n```\n## Row {.flow}\n### column {.tabset}\n```{r}\n#| title: Overall shot map\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\n#shot map\nHome_S_plot <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"\")\n\n#save Plot\nggsave(path = Vizlocation, \"Home Team Shot Map.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\nHome_S_plot_I <- ggplotly(Home_S_plot, tooltip = \"text\")\n\nHome_S_plot_I <- Home_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n\nHome_S_plot_I\n#Home_S_plot\n\n```\n```{r}\n#| title: Shot Map by player\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nHome_S_plotW <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Player\")\n\nHome_S_plotW_I <- ggplotly(Home_S_plotW, tooltip = \"text\")\nHome_S_plotW_I <- Home_S_plotW_I %>%\n    config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n Home_S_plotW_I \n#Home_S_plotW\n```\n\n```{r}\n#| title: Shot Map by time\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nHome_S_plotWT <- plot_shot_AI(dashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = HomeHA, mapName = Match_Home, teamColor = Color_Home, text_color = Color_Home_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", logo = \"\", wrap = \"Time\")\n\nHome_S_plotWT_I <- ggplotly(Home_S_plotWT, tooltip = \"text\")\nHome_S_plotWT_I <- Home_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nHome_S_plotWT_I\n#Home_S_plotWT\n```\n\n### column {.tabset}\n```{r}\n#| title: Overall Shot Map\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\nAway_S_plot <- plot_shot_AI(Awaydashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = AwayHA,  mapName = Match_Away, teamColor = Color_Away, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\")\n\n#save Plot\nggsave(path = Vizlocation, \"Away Team Shot Map.png\", width = 2500, height = 2150, units = \"px\", dpi = 400)\n\nAway_S_plot_I <- ggplotly(Away_S_plot, tooltip = \"text\")\n\n\nAway_S_plot_I <- Away_S_plot_I %>%\n  config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nAway_S_plot_I\n#Away_S_plot\n\n```\n\n```{r}\n#| title: Shot Map by player\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nAway_S_plotW <- plot_shot_AI(Awaydashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = AwayHA,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Player\")\n\nAway_S_plotW_I <- ggplotly(Away_S_plotW, tooltip = \"text\")\nAway_S_plotW_I <- Away_S_plotW_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\n#Away_S_plotW\nAway_S_plotW_I\n\n```\n\n```{r}\n#| title: Shot Map by time\n#| height: 200%\n#| out-height: 200%\n#| out-width: 100%\n\nAway_S_plotWT <- plot_shot_AI(Awaydashboard_data, highlight_goals = TRUE, average_location = FALSE, mapType = AwayHA,  mapName = Match_Away, teamColor = Color_Away, text_color = Color_Away_Text, matchDate = Game_date, matchFixture = Match_Fixture, dataSource = \"Opta\", wrap = \"Time\")\n\nAway_S_plotWT_I <- ggplotly(Away_S_plotWT, tooltip = \"text\")\nAway_S_plotWT_I <- Away_S_plotWT_I %>%\n      config(displayModeBar = TRUE, \n       displaylogo = FALSE,\n       toImageButtonOptions = list(position = \"bottom\"),\n       modeBarButtonsToRemove = list('lasso2d', 'select2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'pan2d', 'hoverClosestCartesian', 'hoverCompareCartesian'))\nAway_S_plotWT_I\n#Away_S_plotWT\n```\n"},"formats":{"dashboard":{"identifier":{"display-name":"HTML","target-format":"dashboard","base-format":"dashboard"},"execute":{"fig-width":8,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":"all","plotly-connected":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"Match day 9 Dashboard.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.33","page-layout":"custom","title":"Match day 9 Season 2526","author":"Dr Phil Barter","scrolling":true,"logo":"https://anfieldindex.com/wp-content/uploads/2016/09/AI-Under-Pressure.png","nav-buttons":[{"icon":"github","href":"https://github.com/Barts78"},{"icon":"linkedin","href":"https://www.linkedin.com/in/phil-barter-55500122/"},{"icon":"twitter","href":"https://twitter.com/Barts78"},{"icon":"bluesky","href":"https://bsky.app/profile/barts78.bsky.social"}],"theme":["Lux","Matchdash.scss"],"type":"default"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}